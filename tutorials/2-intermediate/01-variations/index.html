
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="PyonFX documentation.
">
      
      
        <meta name="author" content="CoffeeStraw">
      
      
      
        <link rel="prev" href="../../1-beginner/03-romaji-kanji-translation/">
      
      
        <link rel="next" href="../02-shapes/">
      
      
      <link rel="icon" href="../../../static/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Variations - PyonFX</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tutorial-adding-variations-to-your-karaoke-effects" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="PyonFX" class="md-header__button md-logo" aria-label="PyonFX" data-md-component="logo">
      
  <img src="../../../static/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PyonFX
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Variations
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/CoffeeStraw/PyonFX" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    CoffeeStraw/PyonFX
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="PyonFX" class="md-nav__button md-logo" aria-label="PyonFX" data-md-component="logo">
      
  <img src="../../../static/logo.png" alt="logo">

    </a>
    PyonFX
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/CoffeeStraw/PyonFX" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    CoffeeStraw/PyonFX
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Install & Set-up
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    First Steps
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            First Steps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../0-first-steps/01-explore-ass-values/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exploring ASS values
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../0-first-steps/02-hello-world/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hello World
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../0-first-steps/03-time-and-space/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Timing & Positioning
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../0-first-steps/04-text-segmentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Text Segmentation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Beginner
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Beginner
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1-beginner/01-first-kfx/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    First Karaoke Effect
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1-beginner/02-first-kfx-organized/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Organizing Your First KFX
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1-beginner/03-romaji-kanji-translation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Romaji, Kanji & Translation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" checked>
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Intermediate
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Intermediate
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Variations
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Variations
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#materials" class="md-nav__link">
    <span class="md-ellipsis">
      Materials
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code-walkthrough" class="md-nav__link">
    <span class="md-ellipsis">
      Code Walkthrough
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#full-source-code" class="md-nav__link">
    <span class="md-ellipsis">
      Full Source Code
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-shapes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Shapes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Advanced
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Advanced
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../3-advanced/01-frame-by-frame/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Frame-by-Frame
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guides/404" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TBD
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Module index
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/ass_core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ass_core
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/convert/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    convert
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/pixel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pixel
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/shape/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    shape
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Explanation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Explanation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../explanation/404" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TBD
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#materials" class="md-nav__link">
    <span class="md-ellipsis">
      Materials
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code-walkthrough" class="md-nav__link">
    <span class="md-ellipsis">
      Code Walkthrough
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#full-source-code" class="md-nav__link">
    <span class="md-ellipsis">
      Full Source Code
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="tutorial-adding-variations-to-your-karaoke-effects">Tutorial: Adding Variations to Your Karaoke Effects</h1>
<p>Welcome to the intermediate series.</p>
<p>You've built a solid foundation with a complete three-line karaoke system, but it can quickly become repetitive. Different singers might need different visual styles or special moments in songs (e.g. refrains) might call for dedicated effects.</p>
<p>In this tutorial, you'll learn how to add variations by defining when to do so directly in your .ass file, and then reading them in your code to apply the variations.</p>
<h2 id="materials">Materials</h2>
<p>We'll continue with the same <a href="https://github.com/CoffeeStraw/PyonFX/blob/v1.0.0/examples/ass/romaji_kanji_translation.ass">romaji_kanji_translation.ass</a> file, but this time we'll leverage some additional data that's been prepared in the file:</p>
<ul>
<li><strong>Actor fields</strong>: Different lines are assigned to "Singer1" and "Singer2" to demonstrate personalized theming</li>
<li><strong>Inline effects</strong>: Some syllables are marked with special <code>inline_fx</code> (<code>\-fx</code>) tags for dramatic moments</li>
<li><strong>Color transformations</strong>: The file includes existing color styling that we'll preserve and enhance</li>
</ul>
<h2 id="code-walkthrough">Code Walkthrough</h2>
<p><strong>0. Familiar Setup with New Imports</strong></p>
<p>We start with our familiar pattern but import several new PyonFX components:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pyonfx</span><span class="w"> </span><span class="kn">import</span> <span class="n">Ass</span><span class="p">,</span> <span class="n">ColorUtility</span><span class="p">,</span> <span class="n">Convert</span><span class="p">,</span> <span class="n">Line</span><span class="p">,</span> <span class="n">Syllable</span><span class="p">,</span> <span class="n">Utils</span>

<span class="n">io</span> <span class="o">=</span> <span class="n">Ass</span><span class="p">(</span><span class="s2">&quot;romaji_kanji_translation.ass&quot;</span><span class="p">,</span> <span class="n">vertical_kanji</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">meta</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
</code></pre></div>
<p>The new imports unlock powerful features:</p>
<ul>
<li><strong><code>ColorUtility</code></strong>: Preserves and works with existing color transformations in your input file</li>
<li><strong><code>Convert</code></strong>: Provides utilities for converting between different ASS value formats (like alpha values)</li>
</ul>
<p><strong>1. Setting Up Color Preservation with ColorUtility</strong></p>
<p>First, let's set up PyonFX's <code>ColorUtility</code> to preserve any existing color styling from our input file:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Set up ColorUtility to preserve existing color transformations</span>
<span class="n">cu</span> <span class="o">=</span> <span class="n">ColorUtility</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</code></pre></div>
<p><code>ColorUtility</code> is a utility that analyzes your entire ASS file and extracts any existing color changes or transformations (like <code>\1c</code>, <code>\3c</code>, <code>\t</code> tags). It then provides methods to recreate those color effects in your output, ensuring that any original styling is maintained while your karaoke effects are applied.</p>
<p>This way you don't need to hardcode color changes in your code: simply use <code>cu.get_color_change(line, c1=True, c3=True)</code> to get the color changes for a line, and then apply them to your output. For more information, see the <a href="../../../reference/utils/#pyonfx.utils.ColorUtility">ColorUtility documentation</a>.</p>
<p><strong>2. Creating Actor-Based Theme System</strong></p>
<p>Next, let's prepare a dictionary of color themes for different performers:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Define color themes for different actors</span>
<span class="n">ACTOR_THEMES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Singer1&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;highlight&quot;</span><span class="p">:</span> <span class="s2">&quot;&amp;H4B19E6&amp;&quot;</span><span class="p">,</span>  <span class="c1"># Purple</span>
        <span class="s2">&quot;outline&quot;</span><span class="p">:</span> <span class="s2">&quot;&amp;H8B4B9B&amp;&quot;</span><span class="p">,</span>   <span class="c1"># Light purple</span>
        <span class="s2">&quot;fade&quot;</span><span class="p">:</span> <span class="s2">&quot;&amp;HBB6BFF&amp;&quot;</span><span class="p">,</span>      <span class="c1"># Very light purple</span>
    <span class="p">},</span>
    <span class="s2">&quot;Singer2&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;highlight&quot;</span><span class="p">:</span> <span class="s2">&quot;&amp;H19E64B&amp;&quot;</span><span class="p">,</span>  <span class="c1"># Green</span>
        <span class="s2">&quot;outline&quot;</span><span class="p">:</span> <span class="s2">&quot;&amp;H4B9B8B&amp;&quot;</span><span class="p">,</span>   <span class="c1"># Light green</span>
        <span class="s2">&quot;fade&quot;</span><span class="p">:</span> <span class="s2">&quot;&amp;H6BFFBB&amp;&quot;</span><span class="p">,</span>      <span class="c1"># Very light green</span>
    <span class="p">},</span>
    <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="p">{</span>  <span class="c1"># Default (no actor)</span>
        <span class="s2">&quot;highlight&quot;</span><span class="p">:</span> <span class="s2">&quot;&amp;HFFFFFF&amp;&quot;</span><span class="p">,</span>  <span class="c1"># White</span>
        <span class="s2">&quot;outline&quot;</span><span class="p">:</span> <span class="s2">&quot;&amp;HABABAB&amp;&quot;</span><span class="p">,</span>   <span class="c1"># Gray</span>
        <span class="s2">&quot;fade&quot;</span><span class="p">:</span> <span class="s2">&quot;&amp;HDDDDDD&amp;&quot;</span><span class="p">,</span>      <span class="c1"># Light gray</span>
    <span class="p">},</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>3. Enhanced Leadin/Leadout Effect with Theming</strong></p>
<p>Let's upgrade our leadin effect to use the theme system:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@io</span><span class="o">.</span><span class="n">track</span>
<span class="k">def</span><span class="w"> </span><span class="nf">leadin_effect</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">syl</span><span class="p">:</span> <span class="n">Syllable</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="n">Line</span><span class="p">):</span>
    <span class="n">l</span><span class="o">.</span><span class="n">layer</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">l</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">start_time</span> <span class="o">-</span> <span class="n">line</span><span class="o">.</span><span class="n">leadin</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="n">l</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">start_time</span> <span class="o">+</span> <span class="n">syl</span><span class="o">.</span><span class="n">start_time</span>

    <span class="c1"># Original style values</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">color1</span>
    <span class="n">c3</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">color3</span>

    <span class="c1"># Configuration</span>
    <span class="n">theme</span> <span class="o">=</span> <span class="n">ACTOR_THEMES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">actor</span><span class="p">,</span> <span class="n">ACTOR_THEMES</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">])</span>

    <span class="n">tags</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">rf</span><span class="s2">&quot;\an5\pos(</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">center</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">middle</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="sa">rf</span><span class="s2">&quot;\1c</span><span class="si">{</span><span class="n">theme</span><span class="p">[</span><span class="s1">&#39;fade&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">\3c</span><span class="si">{</span><span class="n">theme</span><span class="p">[</span><span class="s1">&#39;outline&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="sa">rf</span><span class="s2">&quot;\t(0,</span><span class="si">{</span><span class="n">line</span><span class="o">.</span><span class="n">leadin</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s2">,\1c</span><span class="si">{</span><span class="n">c1</span><span class="si">}</span><span class="s2">\3c</span><span class="si">{</span><span class="n">c3</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="sa">rf</span><span class="s2">&quot;\fad(</span><span class="si">{</span><span class="n">line</span><span class="o">.</span><span class="n">leadin</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s2">,0)&quot;</span>
    <span class="p">)</span>
    <span class="n">l</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="si">{</span><span class="n">tags</span><span class="si">}</span><span class="se">}}</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">io</span><span class="o">.</span><span class="n">write_line</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</code></pre></div>
<p>Notice how we:</p>
<ul>
<li><strong>Extract the theme</strong> using <code>ACTOR_THEMES.get(line.actor, ACTOR_THEMES[""])</code> - this gets the actor's theme or falls back to default</li>
<li><strong>Start with theme colors</strong> then transition to the original line colors using <code>\t()</code> transforms</li>
<li><strong>Preserve original styling</strong> by storing and returning to <code>c1</code> and <code>c3</code></li>
</ul>
<p>We can do something similar for the leadout effect, but we'll leave it to you for exercise! (Or you could check the full source code at the end of this tutorial <img alt="😉" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f609.svg" title=":wink:" />)</p>
<p><strong>4. Enhanced Main Effect with Theming</strong></p>
<p>Let's also apply the theme to the main effect:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@io</span><span class="o">.</span><span class="n">track</span>
<span class="k">def</span><span class="w"> </span><span class="nf">highlight_effect</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">syl</span><span class="p">:</span> <span class="n">Syllable</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="n">Line</span><span class="p">):</span>
    <span class="n">l</span><span class="o">.</span><span class="n">layer</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">l</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">start_time</span> <span class="o">+</span> <span class="n">syl</span><span class="o">.</span><span class="n">start_time</span>
    <span class="n">l</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">start_time</span> <span class="o">+</span> <span class="n">syl</span><span class="o">.</span><span class="n">end_time</span>

    <span class="c1"># Original style values</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">color1</span>
    <span class="n">c3</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">color3</span>
    <span class="n">fscx</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">scale_x</span>
    <span class="n">fscy</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">scale_y</span>

    <span class="c1"># Configuration</span>
    <span class="n">theme</span> <span class="o">=</span> <span class="n">ACTOR_THEMES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">actor</span><span class="p">,</span> <span class="n">ACTOR_THEMES</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">])</span>
    <span class="n">t_fscx</span> <span class="o">=</span> <span class="n">fscx</span> <span class="o">*</span> <span class="mf">1.25</span>
    <span class="n">t_fscy</span> <span class="o">=</span> <span class="n">fscy</span> <span class="o">*</span> <span class="mf">1.25</span>
    <span class="n">grow_duration</span> <span class="o">=</span> <span class="n">syl</span><span class="o">.</span><span class="n">duration</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="n">tags</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">rf</span><span class="s2">&quot;\an5\pos(</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">center</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">middle</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="sa">rf</span><span class="s2">&quot;\t(0,</span><span class="si">{</span><span class="n">grow_duration</span><span class="si">}</span><span class="s2">,\fscx</span><span class="si">{</span><span class="n">t_fscx</span><span class="si">}</span><span class="s2">\fscy</span><span class="si">{</span><span class="n">t_fscy</span><span class="si">}</span><span class="s2">\1c</span><span class="si">{</span><span class="n">theme</span><span class="p">[</span><span class="s1">&#39;highlight&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">\3c</span><span class="si">{</span><span class="n">theme</span><span class="p">[</span><span class="s1">&#39;outline&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="sa">rf</span><span class="s2">&quot;\t(</span><span class="si">{</span><span class="n">grow_duration</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">duration</span><span class="si">}</span><span class="s2">,\fscx</span><span class="si">{</span><span class="n">fscx</span><span class="si">}</span><span class="s2">\fscy</span><span class="si">{</span><span class="n">fscy</span><span class="si">}</span><span class="s2">\1c</span><span class="si">{</span><span class="n">c1</span><span class="si">}</span><span class="s2">\3c</span><span class="si">{</span><span class="n">c3</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="p">)</span>
    <span class="n">l</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="si">{</span><span class="n">tags</span><span class="si">}</span><span class="se">}}</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">io</span><span class="o">.</span><span class="n">write_line</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</code></pre></div>
<p><strong>5. Creating Special Effects for Dramatic Moments</strong></p>
<p>For syllables marked with special effects, we'll create a dramatic echo effect:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@io</span><span class="o">.</span><span class="n">track</span>
<span class="k">def</span><span class="w"> </span><span class="nf">main_echo_effect</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">syl</span><span class="p">:</span> <span class="n">Syllable</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="n">Line</span><span class="p">):</span>
    <span class="n">l</span><span class="o">.</span><span class="n">layer</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">l</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">start_time</span> <span class="o">+</span> <span class="n">syl</span><span class="o">.</span><span class="n">start_time</span>
    <span class="n">l</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">start_time</span> <span class="o">+</span> <span class="n">syl</span><span class="o">.</span><span class="n">end_time</span>

    <span class="c1"># Original style values</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">color1</span>
    <span class="n">fscx</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">scale_x</span>
    <span class="n">fscy</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">scale_y</span>

    <span class="c1"># Configuration</span>
    <span class="n">theme</span> <span class="o">=</span> <span class="n">ACTOR_THEMES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">actor</span><span class="p">,</span> <span class="n">ACTOR_THEMES</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">])</span>

    <span class="c1"># Base layer (fully opaque)</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">rf</span><span class="s2">&quot;\an5\pos(</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">center</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">middle</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="sa">rf</span><span class="s2">&quot;\t(0,</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">duration</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s2">,\1c</span><span class="si">{</span><span class="n">theme</span><span class="p">[</span><span class="s1">&#39;highlight&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="sa">rf</span><span class="s2">&quot;\t(</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">duration</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">duration</span><span class="si">}</span><span class="s2">,\1c</span><span class="si">{</span><span class="n">c1</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="p">)</span>
    <span class="n">l</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="si">{</span><span class="n">tags</span><span class="si">}</span><span class="se">}}</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">io</span><span class="o">.</span><span class="n">write_line</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>

    <span class="c1"># Echo Configuration</span>
    <span class="n">echo_layer_count</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">max_fscx</span><span class="p">,</span> <span class="n">max_fscy</span> <span class="o">=</span> <span class="n">fscx</span> <span class="o">*</span> <span class="mf">1.6</span><span class="p">,</span> <span class="n">fscy</span> <span class="o">*</span> <span class="mf">1.6</span>
    <span class="n">min_alpha</span><span class="p">,</span> <span class="n">max_alpha</span> <span class="o">=</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">230</span>

    <span class="c1"># Echo layers (progressively larger and more transparent)</span>
    <span class="k">for</span> <span class="n">layer_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">echo_layer_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">l</span><span class="o">.</span><span class="n">layer</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">layer_index</span>

        <span class="c1"># Calculate interpolation factor (0.0 to 1.0)</span>
        <span class="n">progress</span> <span class="o">=</span> <span class="n">layer_index</span> <span class="o">/</span> <span class="n">echo_layer_count</span>

        <span class="c1"># Interpolated values</span>
        <span class="n">echo_fscx</span> <span class="o">=</span> <span class="n">fscx</span> <span class="o">+</span> <span class="p">(</span><span class="n">max_fscx</span> <span class="o">-</span> <span class="n">fscx</span><span class="p">)</span> <span class="o">*</span> <span class="n">progress</span>
        <span class="n">echo_fscy</span> <span class="o">=</span> <span class="n">fscy</span> <span class="o">+</span> <span class="p">(</span><span class="n">max_fscy</span> <span class="o">-</span> <span class="n">fscy</span><span class="p">)</span> <span class="o">*</span> <span class="n">progress</span>
        <span class="n">echo_alpha</span> <span class="o">=</span> <span class="n">Convert</span><span class="o">.</span><span class="n">alpha_dec_to_ass</span><span class="p">(</span><span class="n">min_alpha</span> <span class="o">+</span> <span class="p">(</span><span class="n">max_alpha</span> <span class="o">-</span> <span class="n">min_alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">progress</span><span class="p">)</span>

        <span class="n">tags</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">rf</span><span class="s2">&quot;\an5\pos(</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">center</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">middle</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)\alpha</span><span class="si">{</span><span class="n">echo_alpha</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="sa">rf</span><span class="s2">&quot;\t(0,</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">duration</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s2">,\1c</span><span class="si">{</span><span class="n">theme</span><span class="p">[</span><span class="s1">&#39;highlight&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">\fscx</span><span class="si">{</span><span class="n">echo_fscx</span><span class="si">}</span><span class="s2">\fscy</span><span class="si">{</span><span class="n">echo_fscy</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="sa">rf</span><span class="s2">&quot;\t(</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">duration</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">duration</span><span class="si">}</span><span class="s2">,\1c</span><span class="si">{</span><span class="n">c1</span><span class="si">}</span><span class="s2">\fscx</span><span class="si">{</span><span class="n">fscx</span><span class="si">}</span><span class="s2">\fscy</span><span class="si">{</span><span class="n">fscy</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="sa">rf</span><span class="s2">&quot;\fad(</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">duration</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">4</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">duration</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">4</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>

        <span class="n">l</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="si">{</span><span class="n">tags</span><span class="si">}</span><span class="se">}}</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">io</span><span class="o">.</span><span class="n">write_line</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</code></pre></div>
<p>This creates a multi-layered echo effect where:</p>
<ul>
<li><strong>Base layer</strong>: Normal syllable with color transitions</li>
<li><strong>Echo layers</strong>: 8 additional layers with progressively larger scale and increasing transparency</li>
<li><strong>Mathematical progression</strong>: Each layer scales and fades according to its position in the sequence</li>
<li><strong>Convert utility</strong>: <code>Convert.alpha_dec_to_ass()</code> converts decimal alpha values (0-255) to ASS hex format</li>
</ul>
<p><strong>6. Upgrading Effect Dispatch</strong></p>
<p>Now we enhance our handler functions to automatically choose effects based on syllable properties:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@io</span><span class="o">.</span><span class="n">track</span>
<span class="k">def</span><span class="w"> </span><span class="nf">romaji</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="n">Line</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">syl</span> <span class="ow">in</span> <span class="n">Utils</span><span class="o">.</span><span class="n">all_non_empty</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">syls</span><span class="p">):</span>
        <span class="n">leadin_effect</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">syl</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">syl</span><span class="o">.</span><span class="n">inline_fx</span> <span class="o">==</span> <span class="s2">&quot;echo&quot;</span><span class="p">:</span>
            <span class="n">main_echo_effect</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">syl</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">highlight_effect</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">syl</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
        <span class="n">leadout_effect</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">syl</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
</code></pre></div>
<p>The <code>syl.inline_fx</code> property contains any special effect tags from your ASS file. When PyonFX finds <code>{\fx}echo{\fxend}</code> tags around a syllable, it automatically sets <code>syl.inline_fx = "echo"</code>, triggering our special effect.</p>
<p>We'll leave up to you to upgrade the kanji dispatcher as well!</p>
<p><strong>7. Making use of ColorUtility in the translation lines</strong></p>
<p>For translation lines, we'll use <code>ColorUtility</code> to preserve any existing color styling:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@io</span><span class="o">.</span><span class="n">track</span>
<span class="k">def</span><span class="w"> </span><span class="nf">translation</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="n">Line</span><span class="p">):</span>
    <span class="n">l</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">start_time</span> <span class="o">-</span> <span class="n">line</span><span class="o">.</span><span class="n">leadin</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="n">l</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">end_time</span> <span class="o">+</span> <span class="n">line</span><span class="o">.</span><span class="n">leadout</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="n">tags</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">rf</span><span class="s2">&quot;\fad(</span><span class="si">{</span><span class="n">line</span><span class="o">.</span><span class="n">leadin</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">line</span><span class="o">.</span><span class="n">leadout</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cu</span><span class="o">.</span><span class="n">get_color_change</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="w"> </span><span class="n">c3</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="n">l</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="si">{</span><span class="n">tags</span><span class="si">}</span><span class="se">}}</span><span class="si">{</span><span class="n">line</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">io</span><span class="o">.</span><span class="n">write_line</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</code></pre></div>
<p><code>ColorUtility.get_color_change()</code> uses the timing of your line (<code>l.start_time</code> and <code>l.end_time</code>) to determine which color transformations from the original ASS file should be applied during that time range. It generates the appropriate ASS tags to recreate those color effects at the correct timing. This means if your input file has color transformations that overlap with your line's timing, those colors will be accurately reproduced in the output.</p>
<p><strong>8. Final Result</strong></p>
<p>Save and preview your effect:</p>
<div class="highlight"><pre><span></span><code><span class="n">io</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">io</span><span class="o">.</span><span class="n">open_aegisub</span><span class="p">()</span>
</code></pre></div>
<p>You'll now see a sophisticated karaoke experience with:</p>
<ul>
<li><strong>Color-coded singers</strong>: Different performers get distinct visual themes</li>
<li><strong>Special effects</strong>: Syllables marked for emphasis get dramatic echo effects</li>
<li><strong>Preserved styling</strong>: Existing colors and transformations from the input file remain intact</li>
<li><strong>Smart automation</strong>: All variations happen automatically based on input file metadata</li>
</ul>
<p><img alt="Variations Preview" src="../imgs/variations.gif" /></p>
<h2 id="conclusion">Conclusion</h2>
<p>Excellent work. You've transformed your basic karaoke system into a sophisticated variation system. You've learned to leverage PyonFX's advanced features like actor-based theming, inline effect detection, and color preservation utilities.</p>
<p>In the next tutorial, we'll explore one of the PyonFX most powerful classes: the <code>Shape</code> class.</p>
<h2 id="full-source-code">Full Source Code</h2>
<details class="abstract">
<summary>Show full source code</summary>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tutorial: Adding variety</span>

<span class="sd">This tutorial demonstrates how to add variety to your effects by using:</span>
<span class="sd">• line.actor to personalize the effect for specific lines</span>
<span class="sd">• syl.inline_fx to apply special effects to specific syllables</span>
<span class="sd">• ColorUtility to change colors based on existing color transformations in the input file</span>

<span class="sd">Exercise:</span>
<span class="sd">• Try using line.effect instead of line.actor</span>
<span class="sd">• Try adding a &quot;rotate&quot; highlight effect, transforming over the \\frz tag: you&#39;ll find that the input .ass file already has some syllables marked with it</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pyonfx</span><span class="w"> </span><span class="kn">import</span> <span class="n">Ass</span><span class="p">,</span> <span class="n">ColorUtility</span><span class="p">,</span> <span class="n">Convert</span><span class="p">,</span> <span class="n">Line</span><span class="p">,</span> <span class="n">Syllable</span><span class="p">,</span> <span class="n">Utils</span>

<span class="n">io</span> <span class="o">=</span> <span class="n">Ass</span><span class="p">(</span><span class="s2">&quot;../../ass/romaji_kanji_translation.ass&quot;</span><span class="p">,</span> <span class="n">vertical_kanji</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">meta</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>

<span class="c1"># Set up ColorUtility to preserve existing color transformations</span>
<span class="n">cu</span> <span class="o">=</span> <span class="n">ColorUtility</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

<span class="c1"># Define color themes for different actors</span>
<span class="n">ACTOR_THEMES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Singer1&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;highlight&quot;</span><span class="p">:</span> <span class="s2">&quot;&amp;H4B19E6&amp;&quot;</span><span class="p">,</span>  <span class="c1"># Purple</span>
        <span class="s2">&quot;outline&quot;</span><span class="p">:</span> <span class="s2">&quot;&amp;H8B4B9B&amp;&quot;</span><span class="p">,</span>  <span class="c1"># Light purple</span>
        <span class="s2">&quot;fade&quot;</span><span class="p">:</span> <span class="s2">&quot;&amp;HBB6BFF&amp;&quot;</span><span class="p">,</span>  <span class="c1"># Very light purple</span>
    <span class="p">},</span>
    <span class="s2">&quot;Singer2&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;highlight&quot;</span><span class="p">:</span> <span class="s2">&quot;&amp;H19E64B&amp;&quot;</span><span class="p">,</span>  <span class="c1"># Green</span>
        <span class="s2">&quot;outline&quot;</span><span class="p">:</span> <span class="s2">&quot;&amp;H4B9B8B&amp;&quot;</span><span class="p">,</span>  <span class="c1"># Light green</span>
        <span class="s2">&quot;fade&quot;</span><span class="p">:</span> <span class="s2">&quot;&amp;H6BFFBB&amp;&quot;</span><span class="p">,</span>  <span class="c1"># Very light green</span>
    <span class="p">},</span>
    <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="p">{</span>  <span class="c1"># Default (no actor)</span>
        <span class="s2">&quot;highlight&quot;</span><span class="p">:</span> <span class="s2">&quot;&amp;HFFFFFF&amp;&quot;</span><span class="p">,</span>  <span class="c1"># White</span>
        <span class="s2">&quot;outline&quot;</span><span class="p">:</span> <span class="s2">&quot;&amp;HABABAB&amp;&quot;</span><span class="p">,</span>  <span class="c1"># Gray</span>
        <span class="s2">&quot;fade&quot;</span><span class="p">:</span> <span class="s2">&quot;&amp;HDDDDDD&amp;&quot;</span><span class="p">,</span>  <span class="c1"># Light gray</span>
    <span class="p">},</span>
<span class="p">}</span>


<span class="nd">@io</span><span class="o">.</span><span class="n">track</span>
<span class="k">def</span><span class="w"> </span><span class="nf">leadin_effect</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">syl</span><span class="p">:</span> <span class="n">Syllable</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="n">Line</span><span class="p">):</span>
    <span class="n">l</span><span class="o">.</span><span class="n">layer</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">l</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">start_time</span> <span class="o">-</span> <span class="n">line</span><span class="o">.</span><span class="n">leadin</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="n">l</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">start_time</span> <span class="o">+</span> <span class="n">syl</span><span class="o">.</span><span class="n">start_time</span>

    <span class="c1"># Original style values</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">color1</span>
    <span class="n">c3</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">color3</span>

    <span class="c1"># Configuration</span>
    <span class="n">theme</span> <span class="o">=</span> <span class="n">ACTOR_THEMES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">actor</span><span class="p">,</span> <span class="n">ACTOR_THEMES</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">])</span>

    <span class="n">tags</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">rf</span><span class="s2">&quot;\an5\pos(</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">center</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">middle</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="sa">rf</span><span class="s2">&quot;\1c</span><span class="si">{</span><span class="n">theme</span><span class="p">[</span><span class="s1">&#39;fade&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">\3c</span><span class="si">{</span><span class="n">theme</span><span class="p">[</span><span class="s1">&#39;outline&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="sa">rf</span><span class="s2">&quot;\t(0,</span><span class="si">{</span><span class="n">line</span><span class="o">.</span><span class="n">leadin</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s2">,\1c</span><span class="si">{</span><span class="n">c1</span><span class="si">}</span><span class="s2">\3c</span><span class="si">{</span><span class="n">c3</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="sa">rf</span><span class="s2">&quot;\fad(</span><span class="si">{</span><span class="n">line</span><span class="o">.</span><span class="n">leadin</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s2">,0)&quot;</span>
    <span class="p">)</span>
    <span class="n">l</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="si">{</span><span class="n">tags</span><span class="si">}</span><span class="se">}}</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">io</span><span class="o">.</span><span class="n">write_line</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>


<span class="nd">@io</span><span class="o">.</span><span class="n">track</span>
<span class="k">def</span><span class="w"> </span><span class="nf">highlight_effect</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">syl</span><span class="p">:</span> <span class="n">Syllable</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="n">Line</span><span class="p">):</span>
    <span class="n">l</span><span class="o">.</span><span class="n">layer</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">l</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">start_time</span> <span class="o">+</span> <span class="n">syl</span><span class="o">.</span><span class="n">start_time</span>
    <span class="n">l</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">start_time</span> <span class="o">+</span> <span class="n">syl</span><span class="o">.</span><span class="n">end_time</span>

    <span class="c1"># Original style values</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">color1</span>
    <span class="n">c3</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">color3</span>
    <span class="n">fscx</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">scale_x</span>
    <span class="n">fscy</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">scale_y</span>

    <span class="c1"># Configuration</span>
    <span class="n">theme</span> <span class="o">=</span> <span class="n">ACTOR_THEMES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">actor</span><span class="p">,</span> <span class="n">ACTOR_THEMES</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">])</span>
    <span class="n">t_fscx</span> <span class="o">=</span> <span class="n">fscx</span> <span class="o">*</span> <span class="mf">1.25</span>
    <span class="n">t_fscy</span> <span class="o">=</span> <span class="n">fscy</span> <span class="o">*</span> <span class="mf">1.25</span>
    <span class="n">grow_duration</span> <span class="o">=</span> <span class="n">syl</span><span class="o">.</span><span class="n">duration</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="n">tags</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">rf</span><span class="s2">&quot;\an5\pos(</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">center</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">middle</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="sa">rf</span><span class="s2">&quot;\t(0,</span><span class="si">{</span><span class="n">grow_duration</span><span class="si">}</span><span class="s2">,\fscx</span><span class="si">{</span><span class="n">t_fscx</span><span class="si">}</span><span class="s2">\fscy</span><span class="si">{</span><span class="n">t_fscy</span><span class="si">}</span><span class="s2">\1c</span><span class="si">{</span><span class="n">theme</span><span class="p">[</span><span class="s1">&#39;highlight&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">\3c</span><span class="si">{</span><span class="n">theme</span><span class="p">[</span><span class="s1">&#39;outline&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="sa">rf</span><span class="s2">&quot;\t(</span><span class="si">{</span><span class="n">grow_duration</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">duration</span><span class="si">}</span><span class="s2">,\fscx</span><span class="si">{</span><span class="n">fscx</span><span class="si">}</span><span class="s2">\fscy</span><span class="si">{</span><span class="n">fscy</span><span class="si">}</span><span class="s2">\1c</span><span class="si">{</span><span class="n">c1</span><span class="si">}</span><span class="s2">\3c</span><span class="si">{</span><span class="n">c3</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="p">)</span>
    <span class="n">l</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="si">{</span><span class="n">tags</span><span class="si">}</span><span class="se">}}</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">io</span><span class="o">.</span><span class="n">write_line</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>


<span class="nd">@io</span><span class="o">.</span><span class="n">track</span>
<span class="k">def</span><span class="w"> </span><span class="nf">main_echo_effect</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">syl</span><span class="p">:</span> <span class="n">Syllable</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="n">Line</span><span class="p">):</span>
    <span class="n">l</span><span class="o">.</span><span class="n">layer</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">l</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">start_time</span> <span class="o">+</span> <span class="n">syl</span><span class="o">.</span><span class="n">start_time</span>
    <span class="n">l</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">start_time</span> <span class="o">+</span> <span class="n">syl</span><span class="o">.</span><span class="n">end_time</span>

    <span class="c1"># Original style values</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">color1</span>
    <span class="n">fscx</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">scale_x</span>
    <span class="n">fscy</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">scale_y</span>

    <span class="c1"># Configuration</span>
    <span class="n">theme</span> <span class="o">=</span> <span class="n">ACTOR_THEMES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">actor</span><span class="p">,</span> <span class="n">ACTOR_THEMES</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">])</span>

    <span class="c1"># Base layer (fully opaque)</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">rf</span><span class="s2">&quot;\an5\pos(</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">center</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">middle</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="sa">rf</span><span class="s2">&quot;\t(0,</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">duration</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s2">,\1c</span><span class="si">{</span><span class="n">theme</span><span class="p">[</span><span class="s1">&#39;highlight&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="sa">rf</span><span class="s2">&quot;\t(</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">duration</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">duration</span><span class="si">}</span><span class="s2">,\1c</span><span class="si">{</span><span class="n">c1</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="p">)</span>
    <span class="n">l</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="si">{</span><span class="n">tags</span><span class="si">}</span><span class="se">}}</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">io</span><span class="o">.</span><span class="n">write_line</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>

    <span class="c1"># Echo Configuration</span>
    <span class="n">echo_layer_count</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">max_fscx</span><span class="p">,</span> <span class="n">max_fscy</span> <span class="o">=</span> <span class="n">fscx</span> <span class="o">*</span> <span class="mf">1.6</span><span class="p">,</span> <span class="n">fscy</span> <span class="o">*</span> <span class="mf">1.6</span>
    <span class="n">min_alpha</span><span class="p">,</span> <span class="n">max_alpha</span> <span class="o">=</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">230</span>

    <span class="c1"># Echo layers (progressively larger and more transparent)</span>
    <span class="k">for</span> <span class="n">layer_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">echo_layer_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">l</span><span class="o">.</span><span class="n">layer</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">layer_index</span>

        <span class="c1"># Calculate interpolation factor (0.0 to 1.0)</span>
        <span class="n">progress</span> <span class="o">=</span> <span class="n">layer_index</span> <span class="o">/</span> <span class="n">echo_layer_count</span>

        <span class="c1"># Interpolated values</span>
        <span class="n">echo_fscx</span> <span class="o">=</span> <span class="n">fscx</span> <span class="o">+</span> <span class="p">(</span><span class="n">max_fscx</span> <span class="o">-</span> <span class="n">fscx</span><span class="p">)</span> <span class="o">*</span> <span class="n">progress</span>
        <span class="n">echo_fscy</span> <span class="o">=</span> <span class="n">fscy</span> <span class="o">+</span> <span class="p">(</span><span class="n">max_fscy</span> <span class="o">-</span> <span class="n">fscy</span><span class="p">)</span> <span class="o">*</span> <span class="n">progress</span>
        <span class="n">echo_alpha</span> <span class="o">=</span> <span class="n">Convert</span><span class="o">.</span><span class="n">alpha_dec_to_ass</span><span class="p">(</span>
            <span class="n">min_alpha</span> <span class="o">+</span> <span class="p">(</span><span class="n">max_alpha</span> <span class="o">-</span> <span class="n">min_alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">progress</span>
        <span class="p">)</span>

        <span class="n">tags</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">rf</span><span class="s2">&quot;\an5\pos(</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">center</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">middle</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)\alpha</span><span class="si">{</span><span class="n">echo_alpha</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="sa">rf</span><span class="s2">&quot;\t(0,</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">duration</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s2">,\1c</span><span class="si">{</span><span class="n">theme</span><span class="p">[</span><span class="s1">&#39;highlight&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">\fscx</span><span class="si">{</span><span class="n">echo_fscx</span><span class="si">}</span><span class="s2">\fscy</span><span class="si">{</span><span class="n">echo_fscy</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="sa">rf</span><span class="s2">&quot;\t(</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">duration</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">duration</span><span class="si">}</span><span class="s2">,\1c</span><span class="si">{</span><span class="n">c1</span><span class="si">}</span><span class="s2">\fscx</span><span class="si">{</span><span class="n">fscx</span><span class="si">}</span><span class="s2">\fscy</span><span class="si">{</span><span class="n">fscy</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="sa">rf</span><span class="s2">&quot;\fad(</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">duration</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">4</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">duration</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">4</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>

        <span class="n">l</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="si">{</span><span class="n">tags</span><span class="si">}</span><span class="se">}}</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">io</span><span class="o">.</span><span class="n">write_line</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>


<span class="nd">@io</span><span class="o">.</span><span class="n">track</span>
<span class="k">def</span><span class="w"> </span><span class="nf">leadout_effect</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">syl</span><span class="p">:</span> <span class="n">Syllable</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="n">Line</span><span class="p">):</span>
    <span class="n">l</span><span class="o">.</span><span class="n">layer</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">l</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">start_time</span> <span class="o">+</span> <span class="n">syl</span><span class="o">.</span><span class="n">end_time</span>
    <span class="n">l</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">end_time</span> <span class="o">+</span> <span class="n">line</span><span class="o">.</span><span class="n">leadout</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="c1"># Original style values</span>
    <span class="n">original_c1</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">color1</span>
    <span class="n">original_c3</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">color3</span>

    <span class="c1"># Configuration</span>
    <span class="n">theme</span> <span class="o">=</span> <span class="n">ACTOR_THEMES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">actor</span><span class="p">,</span> <span class="n">ACTOR_THEMES</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">])</span>
    <span class="n">leadout_duration</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">leadout</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="n">color_transition_start</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">duration</span> <span class="o">-</span> <span class="n">leadout_duration</span>

    <span class="n">tags</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">rf</span><span class="s2">&quot;\an5\pos(</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">center</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">middle</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="sa">rf</span><span class="s2">&quot;\1c</span><span class="si">{</span><span class="n">original_c1</span><span class="si">}</span><span class="s2">\3c</span><span class="si">{</span><span class="n">original_c3</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="sa">rf</span><span class="s2">&quot;\t(</span><span class="si">{</span><span class="n">color_transition_start</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">l</span><span class="o">.</span><span class="n">duration</span><span class="si">}</span><span class="s2">,\1c</span><span class="si">{</span><span class="n">theme</span><span class="p">[</span><span class="s1">&#39;fade&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">\3c</span><span class="si">{</span><span class="n">theme</span><span class="p">[</span><span class="s1">&#39;outline&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="sa">rf</span><span class="s2">&quot;\fad(0,</span><span class="si">{</span><span class="n">leadout_duration</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="p">)</span>
    <span class="n">l</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="si">{</span><span class="n">tags</span><span class="si">}</span><span class="se">}}</span><span class="si">{</span><span class="n">syl</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">io</span><span class="o">.</span><span class="n">write_line</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>


<span class="nd">@io</span><span class="o">.</span><span class="n">track</span>
<span class="k">def</span><span class="w"> </span><span class="nf">romaji</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="n">Line</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">syl</span> <span class="ow">in</span> <span class="n">Utils</span><span class="o">.</span><span class="n">all_non_empty</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">syls</span><span class="p">):</span>
        <span class="n">leadin_effect</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">syl</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">syl</span><span class="o">.</span><span class="n">inline_fx</span> <span class="o">==</span> <span class="s2">&quot;echo&quot;</span><span class="p">:</span>
            <span class="n">main_echo_effect</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">syl</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">highlight_effect</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">syl</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
        <span class="n">leadout_effect</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">syl</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>


<span class="nd">@io</span><span class="o">.</span><span class="n">track</span>
<span class="k">def</span><span class="w"> </span><span class="nf">kanji</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="n">Line</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">syl</span> <span class="ow">in</span> <span class="n">Utils</span><span class="o">.</span><span class="n">all_non_empty</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">syls</span><span class="p">):</span>
        <span class="n">leadin_effect</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">syl</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">syl</span><span class="o">.</span><span class="n">inline_fx</span> <span class="o">==</span> <span class="s2">&quot;echo&quot;</span><span class="p">:</span>
            <span class="n">main_echo_effect</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">syl</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">highlight_effect</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">syl</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
        <span class="n">leadout_effect</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">syl</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>


<span class="nd">@io</span><span class="o">.</span><span class="n">track</span>
<span class="k">def</span><span class="w"> </span><span class="nf">translation</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="n">Line</span><span class="p">):</span>
    <span class="n">l</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">start_time</span> <span class="o">-</span> <span class="n">line</span><span class="o">.</span><span class="n">leadin</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="n">l</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">end_time</span> <span class="o">+</span> <span class="n">line</span><span class="o">.</span><span class="n">leadout</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="n">tags</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">rf</span><span class="s2">&quot;\fad(</span><span class="si">{</span><span class="n">line</span><span class="o">.</span><span class="n">leadin</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">line</span><span class="o">.</span><span class="n">leadout</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cu</span><span class="o">.</span><span class="n">get_color_change</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="w"> </span><span class="n">c3</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="n">l</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="si">{</span><span class="n">tags</span><span class="si">}</span><span class="se">}}</span><span class="si">{</span><span class="n">line</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">io</span><span class="o">.</span><span class="n">write_line</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>


<span class="c1"># Generating lines</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">Utils</span><span class="o">.</span><span class="n">all_non_empty</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># Process based on alignment (line type)</span>
    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">alignment</span> <span class="o">&gt;=</span> <span class="mi">7</span><span class="p">:</span>
        <span class="n">romaji</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">alignment</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">kanji</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">translation</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>

<span class="n">io</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">io</span><span class="o">.</span><span class="n">open_aegisub</span><span class="p">()</span>
</code></pre></div>
</details>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../../1-beginner/03-romaji-kanji-translation/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Romaji, Kanji &amp; Translation">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Romaji, Kanji & Translation
              </div>
            </div>
          </a>
        
        
          
          <a href="../02-shapes/" class="md-footer__link md-footer__link--next" aria-label="Next: Shapes">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Shapes
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2019-2025 Antonio Strippoli (CoffeeStraw) and <a href="https://github.com/CoffeeStraw/PyonFX/graphs/contributors"><u>contributors</u></a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.sections", "navigation.footer", "content.footnote.tooltips", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.50899def.min.js"></script>
      
    
  </body>
</html>
import os
import sys
from pyonfx import *

# Get ass path
dir_path = os.path.dirname(os.path.realpath(__file__))
path_ass = os.path.join(dir_path, "Ass", "in.ass")

# Extract infos from ass file
io = Ass(path_ass)
meta, styles, lines = io.get_data()

def test_coloralpha():
    assert Convert.coloralpha(0) == "&HFF&"
    assert Convert.coloralpha("&HFF&") == 0

    assert Convert.coloralpha("&H0000FF&") == (255, 0, 0)
    assert Convert.coloralpha(255, 0, 0) == "&H0000FF&"

    assert Convert.coloralpha("&H0000FFFF") == (255, 255, 0, 255)
    assert Convert.coloralpha(255, 255, 0, 255) == "&H0000FFFF"

def test_text_to_shape():
    if sys.platform == "win32":
        assert Convert.text_to_shape(lines[1].syls[0]) == Shape("m 14.938 23.422 b 13.031 22.562 11.156 22.125 9.328 22.125 7.219 22.125 6.156 22.734 6.156 23.984 6.156 24.578 6.391 25.031 6.844 25.359 7.312 25.672 8.109 25.922 9.25 26.078 11.797 26.422 13.625 27.078 14.719 28.047 15.828 29 16.375 30.328 16.375 32 16.375 33.625 15.734 34.922 14.453 35.891 13.172 36.844 11.375 37.328 9.078 37.328 6.312 37.328 3.844 36.75 1.688 35.609 l 2.547 32.234 b 4.5 33.359 6.594 33.922 8.844 33.922 10.844 33.922 11.828 33.266 11.828 31.922 11.828 31.312 11.625 30.844 11.219 30.516 10.797 30.203 10 29.938 8.812 29.766 6.234 29.328 4.422 28.641 3.375 27.734 2.297 26.797 1.75 25.516 1.75 23.906 1.781 22.312 2.406 21.047 3.641 20.125 4.891 19.203 6.703 18.75 9.078 18.75 11.469 18.75 13.703 19.188 15.797 20.062 l 14.938 23.422 m 24.672 19.094 l 24.672 29.766 b 24.672 31.297 24.875 32.344 25.312 32.906 25.734 33.469 26.453 33.75 27.484 33.75 28.5 33.75 29.422 33.25 30.25 32.219 31.062 31.203 31.484 30 31.484 28.625 l 31.484 19.094 35.953 19.094 35.953 36.984 31.797 36.984 31.688 34.469 31.625 34.469 b 30.938 35.375 30.078 36.062 29.078 36.578 28.062 37.078 27.016 37.328 25.938 37.328 24 37.328 22.562 36.781 21.641 35.656 20.719 34.547 20.266 32.734 20.266 30.203 l 20.266 19.094 24.672 19.094")
    elif sys.platform == "linux":
        assert Convert.text_to_shape(lines[1].syls[0]) == Shape("m 14.922 23.656 b 12.992 22.793 11.125 22.359 9.312 22.359 7.227 22.359 6.176 22.945 6.156 24.109 6.156 24.934 6.68 25.512 7.734 25.844 8.148 25.961 8.656 26.055 9.25 26.125 12.914 26.637 15.148 27.797 15.953 29.609 16.234 30.258 16.375 31 16.375 31.844 16.375 34.012 15.258 35.512 13.031 36.344 11.906 36.773 10.586 36.984 9.078 36.984 6.305 36.984 3.844 36.418 1.688 35.281 l 2.547 32.016 b 4.492 33.09 6.594 33.625 8.844 33.625 10.812 33.625 11.805 32.996 11.828 31.734 11.828 30.984 11.473 30.453 10.766 30.141 10.305 29.945 9.648 29.777 8.797 29.641 5.086 29.059 2.852 27.84 2.094 25.984 1.863 25.383 1.75 24.715 1.75 23.984 1.75 21.809 2.91 20.328 5.234 19.547 6.328 19.172 7.609 18.984 9.078 18.984 11.484 18.984 13.719 19.418 15.781 20.281 m 24.67 18.984 l 24.67 29.719 b 24.67 31.773 25.111 33.016 25.998 33.453 26.392 33.641 26.888 33.734 27.482 33.734 28.627 33.734 29.627 33.109 30.482 31.859 31.17 30.871 31.513 29.777 31.513 28.578 l 31.513 18.984 35.982 18.984 35.982 36.984 31.779 36.984 31.685 34.453 31.607 34.453 b 30.345 35.922 28.705 36.758 26.685 36.953 26.412 36.977 26.162 36.984 25.935 36.984 23.185 36.984 21.455 35.852 20.748 33.578 20.423 32.609 20.263 31.402 20.263 29.953 l 20.263 18.984")
    else:
        raise NotImplementedError

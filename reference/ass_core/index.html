
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="PyonFX documentation.
">
      
      
        <meta name="author" content="CoffeeStraw">
      
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../convert/">
      
      
      <link rel="icon" href="../../static/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>ass_core - PyonFX</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ass-core" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="PyonFX" class="md-header__button md-logo" aria-label="PyonFX" data-md-component="logo">
      
  <img src="../../static/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PyonFX
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ass_core
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/CoffeeStraw/PyonFX" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    CoffeeStraw/PyonFX
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="PyonFX" class="md-nav__button md-logo" aria-label="PyonFX" data-md-component="logo">
      
  <img src="../../static/logo.png" alt="logo">

    </a>
    PyonFX
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/CoffeeStraw/PyonFX" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    CoffeeStraw/PyonFX
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/installing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Install & Set-up
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    First Steps
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            First Steps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/0-first-steps/01-explore-ass-values/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exploring ASS values
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/0-first-steps/02-hello-world/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hello World
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/0-first-steps/03-time-and-space/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Timing & Positioning
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/0-first-steps/04-text-segmentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Text Segmentation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Beginner
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Beginner
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/1-beginner/01-first-kfx/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    First Karaoke Effect
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/1-beginner/02-first-kfx-organized/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Organizing Your First KFX
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/1-beginner/03-romaji-kanji-translation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Romaji, Kanji & Translation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Intermediate
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Intermediate
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/2-intermediate/01-variations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Variations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/2-intermediate/02-shapes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Shapes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Advanced
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Advanced
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/3-advanced/01-frame-by-frame/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Frame-by-Frame
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/404" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TBD
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Module index
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    ass_core
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    ass_core
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pyonfx.ass_core" class="md-nav__link">
    <span class="md-ellipsis">
      ass_core
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      Meta
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Meta">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Meta.parse_line" class="md-nav__link">
    <span class="md-ellipsis">
      parse_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Meta.serialize" class="md-nav__link">
    <span class="md-ellipsis">
      serialize
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Style" class="md-nav__link">
    <span class="md-ellipsis">
      Style
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Style">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Style.from_ass_line" class="md-nav__link">
    <span class="md-ellipsis">
      from_ass_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Style.serialize" class="md-nav__link">
    <span class="md-ellipsis">
      serialize
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Char" class="md-nav__link">
    <span class="md-ellipsis">
      Char
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Syllable" class="md-nav__link">
    <span class="md-ellipsis">
      Syllable
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Word" class="md-nav__link">
    <span class="md-ellipsis">
      Word
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Line" class="md-nav__link">
    <span class="md-ellipsis">
      Line
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Line">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Line.copy" class="md-nav__link">
    <span class="md-ellipsis">
      copy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Line.from_ass_line" class="md-nav__link">
    <span class="md-ellipsis">
      from_ass_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Line.serialize" class="md-nav__link">
    <span class="md-ellipsis">
      serialize
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Ass" class="md-nav__link">
    <span class="md-ellipsis">
      Ass
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ass">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Ass.PIXEL_STYLE" class="md-nav__link">
    <span class="md-ellipsis">
      PIXEL_STYLE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Ass.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Ass.replace_meta" class="md-nav__link">
    <span class="md-ellipsis">
      replace_meta
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Ass.replace_style" class="md-nav__link">
    <span class="md-ellipsis">
      replace_style
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Ass.add_style" class="md-nav__link">
    <span class="md-ellipsis">
      add_style
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Ass.get_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Ass.write_line" class="md-nav__link">
    <span class="md-ellipsis">
      write_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Ass.save" class="md-nav__link">
    <span class="md-ellipsis">
      save
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Ass.open_aegisub" class="md-nav__link">
    <span class="md-ellipsis">
      open_aegisub
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Ass.open_mpv" class="md-nav__link">
    <span class="md-ellipsis">
      open_mpv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Ass.track" class="md-nav__link">
    <span class="md-ellipsis">
      track
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../convert/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    convert
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pixel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pixel
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../shape/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    shape
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Explanation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Explanation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanation/404" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TBD
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pyonfx.ass_core" class="md-nav__link">
    <span class="md-ellipsis">
      ass_core
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Meta" class="md-nav__link">
    <span class="md-ellipsis">
      Meta
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Meta">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Meta.parse_line" class="md-nav__link">
    <span class="md-ellipsis">
      parse_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Meta.serialize" class="md-nav__link">
    <span class="md-ellipsis">
      serialize
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Style" class="md-nav__link">
    <span class="md-ellipsis">
      Style
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Style">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Style.from_ass_line" class="md-nav__link">
    <span class="md-ellipsis">
      from_ass_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Style.serialize" class="md-nav__link">
    <span class="md-ellipsis">
      serialize
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Char" class="md-nav__link">
    <span class="md-ellipsis">
      Char
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Syllable" class="md-nav__link">
    <span class="md-ellipsis">
      Syllable
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Word" class="md-nav__link">
    <span class="md-ellipsis">
      Word
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Line" class="md-nav__link">
    <span class="md-ellipsis">
      Line
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Line">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Line.copy" class="md-nav__link">
    <span class="md-ellipsis">
      copy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Line.from_ass_line" class="md-nav__link">
    <span class="md-ellipsis">
      from_ass_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Line.serialize" class="md-nav__link">
    <span class="md-ellipsis">
      serialize
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Ass" class="md-nav__link">
    <span class="md-ellipsis">
      Ass
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ass">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Ass.PIXEL_STYLE" class="md-nav__link">
    <span class="md-ellipsis">
      PIXEL_STYLE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Ass.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Ass.replace_meta" class="md-nav__link">
    <span class="md-ellipsis">
      replace_meta
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Ass.replace_style" class="md-nav__link">
    <span class="md-ellipsis">
      replace_style
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Ass.add_style" class="md-nav__link">
    <span class="md-ellipsis">
      add_style
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Ass.get_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Ass.write_line" class="md-nav__link">
    <span class="md-ellipsis">
      write_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Ass.save" class="md-nav__link">
    <span class="md-ellipsis">
      save
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Ass.open_aegisub" class="md-nav__link">
    <span class="md-ellipsis">
      open_aegisub
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Ass.open_mpv" class="md-nav__link">
    <span class="md-ellipsis">
      open_mpv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.ass_core.Ass.track" class="md-nav__link">
    <span class="md-ellipsis">
      track
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="ass-core">ASS Core</h1>


<div class="doc doc-object doc-module">



<a id="pyonfx.ass_core"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="pyonfx.ass_core.Meta" class="doc doc-heading">
            <code>Meta</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>Encapsulates the script properties of an ASS file, including video resolution, wrap style, and media file paths.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Meta.wrap_style">wrap_style</span></code></td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specifies the wrap style for subtitles. The typical value 0 indicates smart wrapping.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Meta.scaled_border_and_shadow">scaled_border_and_shadow</span></code></td>
            <td>
                  <code><span title="bool">bool</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Determines whether border and shadow sizes are scaled according to the script resolution (True) or the video resolution (False).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Meta.play_res_x">play_res_x</span></code></td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specifies the script's video width resolution in pixels. This influences horizontal coordinate calculations.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Meta.play_res_y">play_res_y</span></code></td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specifies the script's video height resolution in pixels. This influences vertical coordinate calculations.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Meta.audio">audio</span></code></td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Absolute file path to the associated audio file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Meta.video">video</span></code></td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Absolute file path to the associated video file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>pyonfx/ass_core.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">slots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Encapsulates the script properties of an ASS file, including video resolution, wrap style, and media file paths.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        wrap_style: Specifies the wrap style for subtitles. The typical value 0 indicates smart wrapping.</span>
<span class="sd">        scaled_border_and_shadow: Determines whether border and shadow sizes are scaled according to the script resolution (True) or the video resolution (False).</span>
<span class="sd">        play_res_x: Specifies the script&#39;s video width resolution in pixels. This influences horizontal coordinate calculations.</span>
<span class="sd">        play_res_y: Specifies the script&#39;s video height resolution in pixels. This influences vertical coordinate calculations.</span>
<span class="sd">        audio: Absolute file path to the associated audio file.</span>
<span class="sd">        video: Absolute file path to the associated video file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">wrap_style</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="n">scaled_border_and_shadow</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="n">play_res_x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="n">play_res_y</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="n">audio</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="n">video</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="n">timestamps</span><span class="p">:</span> <span class="n">ABCTimestamps</span> <span class="o">|</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parse_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ass_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parses a single ASS line and update the relevant fields.&quot;&quot;&quot;</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">match</span> <span class="o">:=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;WrapStyle:\s*(\d+)$&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wrap_style</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">match</span> <span class="o">:=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;ScaledBorderAndShadow:\s*(.+)$&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scaled_border_and_shadow</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span>
        <span class="k">elif</span> <span class="n">match</span> <span class="o">:=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;PlayResX:\s*(\d+)$&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_res_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">match</span> <span class="o">:=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;PlayResY:\s*(\d+)$&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_res_y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">match</span> <span class="o">:=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Audio File:\s*(.*)$&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">audio</span> <span class="o">=</span> <span class="n">_resolve_path</span><span class="p">(</span><span class="n">ass_path</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Audio File: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">audio</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="n">match</span> <span class="o">:=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Video File:\s*(.*)$&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
            <span class="c1"># Parse video file path</span>
            <span class="n">match_group</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">is_dummy</span> <span class="o">=</span> <span class="n">match_group</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;?dummy&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">video</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">match_group</span> <span class="k">if</span> <span class="n">is_dummy</span> <span class="k">else</span> <span class="n">_resolve_path</span><span class="p">(</span><span class="n">ass_path</span><span class="p">,</span> <span class="n">match_group</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Video File: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="c1"># Set up timestamps based on video file</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timestamps</span> <span class="o">=</span> <span class="n">VideoTimestamps</span><span class="o">.</span><span class="n">from_video_file</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">is_dummy</span><span class="p">:</span>
                <span class="c1"># Parse dummy video format: ?dummy:fps:duration</span>
                <span class="n">parts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">fps_str</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">fps</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">fps_str</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">timestamps</span> <span class="o">=</span> <span class="n">FPSTimestamps</span><span class="p">(</span>
                        <span class="n">RoundingMethod</span><span class="o">.</span><span class="n">ROUND</span><span class="p">,</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span> <span class="n">fps</span><span class="p">,</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># type: ignore[attr-defined]</span>
                    <span class="p">)</span>

        <span class="k">return</span> <span class="n">line</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Serializes the meta object into ASS script info and garbage sections.&quot;&quot;&quot;</span>
        <span class="n">script_info_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap_style</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">script_info_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WrapStyle: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">wrap_style</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaled_border_and_shadow</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">script_info_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;ScaledBorderAndShadow: </span><span class="si">{</span><span class="s1">&#39;Yes&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">scaled_border_and_shadow</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;No&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">play_res_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">script_info_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PlayResX: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">play_res_x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">play_res_y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">script_info_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PlayResY: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">play_res_y</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Append a newline to each Script Info line</span>
        <span class="n">script_info_lines</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">script_info_lines</span><span class="p">]</span>

        <span class="n">garbage_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">audio</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">garbage_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Audio File: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">audio</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">garbage_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Video File: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Append a newline to each Aegisub Project Garbage line</span>
        <span class="n">garbage_lines</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">garbage_lines</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">script_info_lines</span><span class="p">,</span> <span class="n">garbage_lines</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="pyonfx.ass_core.Meta.parse_line" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_line</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">ass_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Parses a single ASS line and update the relevant fields.</p>


            <details class="quote">
              <summary>Source code in <code>pyonfx/ass_core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ass_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses a single ASS line and update the relevant fields.&quot;&quot;&quot;</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">match</span> <span class="o">:=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;WrapStyle:\s*(\d+)$&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wrap_style</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">match</span> <span class="o">:=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;ScaledBorderAndShadow:\s*(.+)$&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaled_border_and_shadow</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span>
    <span class="k">elif</span> <span class="n">match</span> <span class="o">:=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;PlayResX:\s*(\d+)$&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">play_res_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">match</span> <span class="o">:=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;PlayResY:\s*(\d+)$&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">play_res_y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">match</span> <span class="o">:=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Audio File:\s*(.*)$&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">audio</span> <span class="o">=</span> <span class="n">_resolve_path</span><span class="p">(</span><span class="n">ass_path</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="n">line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Audio File: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">audio</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="n">match</span> <span class="o">:=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Video File:\s*(.*)$&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="c1"># Parse video file path</span>
        <span class="n">match_group</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">is_dummy</span> <span class="o">=</span> <span class="n">match_group</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;?dummy&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">video</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">match_group</span> <span class="k">if</span> <span class="n">is_dummy</span> <span class="k">else</span> <span class="n">_resolve_path</span><span class="p">(</span><span class="n">ass_path</span><span class="p">,</span> <span class="n">match_group</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Video File: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Set up timestamps based on video file</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timestamps</span> <span class="o">=</span> <span class="n">VideoTimestamps</span><span class="o">.</span><span class="n">from_video_file</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">is_dummy</span><span class="p">:</span>
            <span class="c1"># Parse dummy video format: ?dummy:fps:duration</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">fps_str</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">fps</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">fps_str</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timestamps</span> <span class="o">=</span> <span class="n">FPSTimestamps</span><span class="p">(</span>
                    <span class="n">RoundingMethod</span><span class="o">.</span><span class="n">ROUND</span><span class="p">,</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span> <span class="n">fps</span><span class="p">,</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># type: ignore[attr-defined]</span>
                <span class="p">)</span>

    <span class="k">return</span> <span class="n">line</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.ass_core.Meta.serialize" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">serialize</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Serializes the meta object into ASS script info and garbage sections.</p>


            <details class="quote">
              <summary>Source code in <code>pyonfx/ass_core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Serializes the meta object into ASS script info and garbage sections.&quot;&quot;&quot;</span>
    <span class="n">script_info_lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap_style</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">script_info_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WrapStyle: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">wrap_style</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaled_border_and_shadow</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">script_info_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;ScaledBorderAndShadow: </span><span class="si">{</span><span class="s1">&#39;Yes&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">scaled_border_and_shadow</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;No&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">play_res_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">script_info_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PlayResX: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">play_res_x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">play_res_y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">script_info_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PlayResY: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">play_res_y</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Append a newline to each Script Info line</span>
    <span class="n">script_info_lines</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">script_info_lines</span><span class="p">]</span>

    <span class="n">garbage_lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">audio</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">garbage_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Audio File: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">audio</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">video</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">garbage_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Video File: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Append a newline to each Aegisub Project Garbage line</span>
    <span class="n">garbage_lines</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">garbage_lines</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">script_info_lines</span><span class="p">,</span> <span class="n">garbage_lines</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pyonfx.ass_core.Style" class="doc doc-heading">
            <code>Style</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>Represents a typographic style for ASS subtitles.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Style.name">name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique identifier for the style.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Style.fontname">fontname</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Typeface used for the subtitles.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Style.fontsize">fontsize</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Font size in points.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Style.color1">color1</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Primary fill color, typically in hexadecimal format.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Style.alpha1">alpha1</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Transparency (alpha channel) for the primary fill color.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Style.color2">color2</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Secondary color used for karaoke effects.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Style.alpha2">alpha2</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Transparency for the secondary color.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Style.color3">color3</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Outline (border) color.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Style.alpha3">alpha3</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Transparency for the outline color.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Style.color4">color4</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shadow color.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Style.alpha4">alpha4</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Transparency for the shadow color.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Style.bold">bold</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Indicates if the font is italic.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Style.italic">italic</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Indicates if the font is italic.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Style.underline">underline</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Indicates if the text is underlined.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Style.strikeout">strikeout</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Indicates if the text has a strike-through effect.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Style.scale_x">scale_x</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Horizontal scaling factor as a percentage (100 means no scaling).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Style.scale_y">scale_y</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Vertical scaling factor as a percentage (100 means no scaling).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Style.spacing">spacing</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional horizontal spacing between letters in pixels.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Style.angle">angle</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Rotation angle of the text in degrees.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Style.border_style">border_style</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specifies the border style: True for an opaque box, False for a standard outline.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Style.outline">outline</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Outline thickness in pixels.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Style.shadow">shadow</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Shadow offset distance in pixels.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Style.alignment">alignment</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ASS alignment code (typically an integer from 1 to 9).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Style.margin_l">margin_l</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Left margin in pixels.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Style.margin_r">margin_r</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Right margin in pixels.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Style.margin_v">margin_v</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Vertical margin in pixels; determines vertical positioning relative to the video frame.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Style.encoding">encoding</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Font encoding/codepage. The value 1 is standard, allowing the selection of any installed font.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>pyonfx/ass_core.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">slots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Style</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a typographic style for ASS subtitles.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        name: Unique identifier for the style.</span>
<span class="sd">        fontname: Typeface used for the subtitles.</span>
<span class="sd">        fontsize: Font size in points.</span>
<span class="sd">        color1: Primary fill color, typically in hexadecimal format.</span>
<span class="sd">        alpha1: Transparency (alpha channel) for the primary fill color.</span>
<span class="sd">        color2: Secondary color used for karaoke effects.</span>
<span class="sd">        alpha2: Transparency for the secondary color.</span>
<span class="sd">        color3: Outline (border) color.</span>
<span class="sd">        alpha3: Transparency for the outline color.</span>
<span class="sd">        color4: Shadow color.</span>
<span class="sd">        alpha4: Transparency for the shadow color.</span>
<span class="sd">        bold: Indicates if the font is italic.</span>
<span class="sd">        italic: Indicates if the font is italic.</span>
<span class="sd">        underline: Indicates if the text is underlined.</span>
<span class="sd">        strikeout: Indicates if the text has a strike-through effect.</span>
<span class="sd">        scale_x: Horizontal scaling factor as a percentage (100 means no scaling).</span>
<span class="sd">        scale_y: Vertical scaling factor as a percentage (100 means no scaling).</span>
<span class="sd">        spacing: Additional horizontal spacing between letters in pixels.</span>
<span class="sd">        angle: Rotation angle of the text in degrees.</span>
<span class="sd">        border_style: Specifies the border style: True for an opaque box, False for a standard outline.</span>
<span class="sd">        outline: Outline thickness in pixels.</span>
<span class="sd">        shadow: Shadow offset distance in pixels.</span>
<span class="sd">        alignment: ASS alignment code (typically an integer from 1 to 9).</span>
<span class="sd">        margin_l: Left margin in pixels.</span>
<span class="sd">        margin_r: Right margin in pixels.</span>
<span class="sd">        margin_v: Vertical margin in pixels; determines vertical positioning relative to the video frame.</span>
<span class="sd">        encoding: Font encoding/codepage. The value 1 is standard, allowing the selection of any installed font.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">fontname</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">fontsize</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">color1</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">alpha1</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">color2</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">alpha2</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">color3</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">alpha3</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">color4</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">alpha4</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">bold</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">italic</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">underline</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">strikeout</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">scale_x</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">scale_y</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">spacing</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">border_style</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">outline</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">shadow</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">alignment</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">margin_l</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">margin_r</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">margin_v</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">encoding</span><span class="p">:</span> <span class="nb">int</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_ass_line</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Style&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse a single ASS line and return the corresponding Style object.&quot;&quot;&quot;</span>
        <span class="n">style_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Style:\s*(.+)$&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">style_match</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid style line: </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Parse style fields</span>
        <span class="c1">#   Name, Fontname, Fontsize, PrimaryColour, SecondaryColour, OutlineColour, BackColour,</span>
        <span class="c1">#   Bold, Italic, Underline, StrikeOut, ScaleX, ScaleY, Spacing, Angle,</span>
        <span class="c1">#   BorderStyle, Outline, Shadow, Alignment, MarginL, MarginR, MarginV, Encoding</span>
        <span class="n">style_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">style_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">fontname</span><span class="o">=</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
            <span class="n">color1</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&amp;H</span><span class="si">{</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">4</span><span class="p">:]</span><span class="si">}</span><span class="s2">&amp;&quot;</span><span class="p">,</span>
            <span class="n">alpha1</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">3</span><span class="p">][:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">&amp;&quot;</span><span class="p">,</span>
            <span class="n">color2</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&amp;H</span><span class="si">{</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">4</span><span class="p">:]</span><span class="si">}</span><span class="s2">&amp;&quot;</span><span class="p">,</span>
            <span class="n">alpha2</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">4</span><span class="p">][:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">&amp;&quot;</span><span class="p">,</span>
            <span class="n">color3</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&amp;H</span><span class="si">{</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">4</span><span class="p">:]</span><span class="si">}</span><span class="s2">&amp;&quot;</span><span class="p">,</span>
            <span class="n">alpha3</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">5</span><span class="p">][:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">&amp;&quot;</span><span class="p">,</span>
            <span class="n">color4</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&amp;H</span><span class="si">{</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">4</span><span class="p">:]</span><span class="si">}</span><span class="s2">&amp;&quot;</span><span class="p">,</span>
            <span class="n">alpha4</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">6</span><span class="p">][:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">&amp;&quot;</span><span class="p">,</span>
            <span class="n">bold</span><span class="o">=</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-1&quot;</span><span class="p">,</span>
            <span class="n">italic</span><span class="o">=</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-1&quot;</span><span class="p">,</span>
            <span class="n">underline</span><span class="o">=</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-1&quot;</span><span class="p">,</span>
            <span class="n">strikeout</span><span class="o">=</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-1&quot;</span><span class="p">,</span>
            <span class="n">scale_x</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">11</span><span class="p">]),</span>
            <span class="n">scale_y</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">12</span><span class="p">]),</span>
            <span class="n">spacing</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">13</span><span class="p">]),</span>
            <span class="n">angle</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">14</span><span class="p">]),</span>
            <span class="n">border_style</span><span class="o">=</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span>
            <span class="n">outline</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">16</span><span class="p">]),</span>
            <span class="n">shadow</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">17</span><span class="p">]),</span>
            <span class="n">alignment</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">18</span><span class="p">]),</span>
            <span class="n">margin_l</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">19</span><span class="p">]),</span>
            <span class="n">margin_r</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">20</span><span class="p">]),</span>
            <span class="n">margin_v</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">21</span><span class="p">]),</span>
            <span class="n">encoding</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">22</span><span class="p">]),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">style_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Serialize a Style object into an ASS style line.&quot;&quot;&quot;</span>
        <span class="n">bold</span> <span class="o">=</span> <span class="s2">&quot;-1&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bold</span> <span class="k">else</span> <span class="s2">&quot;0&quot;</span>
        <span class="n">italic</span> <span class="o">=</span> <span class="s2">&quot;-1&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">italic</span> <span class="k">else</span> <span class="s2">&quot;0&quot;</span>
        <span class="n">underline</span> <span class="o">=</span> <span class="s2">&quot;-1&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">underline</span> <span class="k">else</span> <span class="s2">&quot;0&quot;</span>
        <span class="n">strikeout</span> <span class="o">=</span> <span class="s2">&quot;-1&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">strikeout</span> <span class="k">else</span> <span class="s2">&quot;0&quot;</span>
        <span class="n">border</span> <span class="o">=</span> <span class="s2">&quot;3&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_style</span> <span class="k">else</span> <span class="s2">&quot;1&quot;</span>
        <span class="n">fontsize</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">scale_x</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_x</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_x</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_x</span><span class="p">)</span>
            <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_x</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">scale_y</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">)</span>
            <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">spacing</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">)</span>
            <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">outline_width</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outline</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outline</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outline</span><span class="p">)</span>
            <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outline</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">shadow</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shadow</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shadow</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shadow</span><span class="p">)</span>
            <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shadow</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">primary</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&amp;H</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha1</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">color1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">secondary</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&amp;H</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha2</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">color2</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">outline_col</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&amp;H</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha3</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">color3</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">back</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&amp;H</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha4</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">color4</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">style_line</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Style: </span><span class="si">{</span><span class="n">style_name</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fontname</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">fontsize</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">primary</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">secondary</span><span class="si">}</span><span class="s2">,&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outline_col</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">back</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">bold</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">italic</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">underline</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">strikeout</span><span class="si">}</span><span class="s2">,&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">scale_x</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">scale_y</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">spacing</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">border</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">outline_width</span><span class="si">}</span><span class="s2">,&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">shadow</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alignment</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">margin_l</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">margin_r</span><span class="si">}</span><span class="s2">,&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">margin_v</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">style_line</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="pyonfx.ass_core.Style.from_ass_line" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_ass_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Parse a single ASS line and return the corresponding Style object.</p>


            <details class="quote">
              <summary>Source code in <code>pyonfx/ass_core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_ass_line</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Style&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a single ASS line and return the corresponding Style object.&quot;&quot;&quot;</span>
    <span class="n">style_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Style:\s*(.+)$&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">style_match</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid style line: </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Parse style fields</span>
    <span class="c1">#   Name, Fontname, Fontsize, PrimaryColour, SecondaryColour, OutlineColour, BackColour,</span>
    <span class="c1">#   Bold, Italic, Underline, StrikeOut, ScaleX, ScaleY, Spacing, Angle,</span>
    <span class="c1">#   BorderStyle, Outline, Shadow, Alignment, MarginL, MarginR, MarginV, Encoding</span>
    <span class="n">style_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">style_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">fontname</span><span class="o">=</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
        <span class="n">color1</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&amp;H</span><span class="si">{</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">4</span><span class="p">:]</span><span class="si">}</span><span class="s2">&amp;&quot;</span><span class="p">,</span>
        <span class="n">alpha1</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">3</span><span class="p">][:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">&amp;&quot;</span><span class="p">,</span>
        <span class="n">color2</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&amp;H</span><span class="si">{</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">4</span><span class="p">:]</span><span class="si">}</span><span class="s2">&amp;&quot;</span><span class="p">,</span>
        <span class="n">alpha2</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">4</span><span class="p">][:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">&amp;&quot;</span><span class="p">,</span>
        <span class="n">color3</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&amp;H</span><span class="si">{</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">4</span><span class="p">:]</span><span class="si">}</span><span class="s2">&amp;&quot;</span><span class="p">,</span>
        <span class="n">alpha3</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">5</span><span class="p">][:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">&amp;&quot;</span><span class="p">,</span>
        <span class="n">color4</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&amp;H</span><span class="si">{</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">4</span><span class="p">:]</span><span class="si">}</span><span class="s2">&amp;&quot;</span><span class="p">,</span>
        <span class="n">alpha4</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">6</span><span class="p">][:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">&amp;&quot;</span><span class="p">,</span>
        <span class="n">bold</span><span class="o">=</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-1&quot;</span><span class="p">,</span>
        <span class="n">italic</span><span class="o">=</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-1&quot;</span><span class="p">,</span>
        <span class="n">underline</span><span class="o">=</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-1&quot;</span><span class="p">,</span>
        <span class="n">strikeout</span><span class="o">=</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-1&quot;</span><span class="p">,</span>
        <span class="n">scale_x</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">11</span><span class="p">]),</span>
        <span class="n">scale_y</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">12</span><span class="p">]),</span>
        <span class="n">spacing</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">13</span><span class="p">]),</span>
        <span class="n">angle</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">14</span><span class="p">]),</span>
        <span class="n">border_style</span><span class="o">=</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span>
        <span class="n">outline</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">16</span><span class="p">]),</span>
        <span class="n">shadow</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">17</span><span class="p">]),</span>
        <span class="n">alignment</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">18</span><span class="p">]),</span>
        <span class="n">margin_l</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">19</span><span class="p">]),</span>
        <span class="n">margin_r</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">20</span><span class="p">]),</span>
        <span class="n">margin_v</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">21</span><span class="p">]),</span>
        <span class="n">encoding</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">style_fields</span><span class="p">[</span><span class="mi">22</span><span class="p">]),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.ass_core.Style.serialize" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">serialize</span><span class="p">(</span><span class="n">style_name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Serialize a Style object into an ASS style line.</p>


            <details class="quote">
              <summary>Source code in <code>pyonfx/ass_core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">style_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Serialize a Style object into an ASS style line.&quot;&quot;&quot;</span>
    <span class="n">bold</span> <span class="o">=</span> <span class="s2">&quot;-1&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bold</span> <span class="k">else</span> <span class="s2">&quot;0&quot;</span>
    <span class="n">italic</span> <span class="o">=</span> <span class="s2">&quot;-1&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">italic</span> <span class="k">else</span> <span class="s2">&quot;0&quot;</span>
    <span class="n">underline</span> <span class="o">=</span> <span class="s2">&quot;-1&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">underline</span> <span class="k">else</span> <span class="s2">&quot;0&quot;</span>
    <span class="n">strikeout</span> <span class="o">=</span> <span class="s2">&quot;-1&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">strikeout</span> <span class="k">else</span> <span class="s2">&quot;0&quot;</span>
    <span class="n">border</span> <span class="o">=</span> <span class="s2">&quot;3&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_style</span> <span class="k">else</span> <span class="s2">&quot;1&quot;</span>
    <span class="n">fontsize</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">scale_x</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_x</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_x</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_x</span><span class="p">)</span>
        <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_x</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">scale_y</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">)</span>
        <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">spacing</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">)</span>
        <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">outline_width</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outline</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outline</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outline</span><span class="p">)</span>
        <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outline</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">shadow</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shadow</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shadow</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shadow</span><span class="p">)</span>
        <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shadow</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">primary</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&amp;H</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha1</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">color1</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">secondary</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&amp;H</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha2</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">color2</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">outline_col</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&amp;H</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha3</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">color3</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">back</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&amp;H</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha4</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">color4</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">style_line</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Style: </span><span class="si">{</span><span class="n">style_name</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fontname</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">fontsize</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">primary</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">secondary</span><span class="si">}</span><span class="s2">,&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outline_col</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">back</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">bold</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">italic</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">underline</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">strikeout</span><span class="si">}</span><span class="s2">,&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">scale_x</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">scale_y</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">spacing</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">border</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">outline_width</span><span class="si">}</span><span class="s2">,&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">shadow</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alignment</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">margin_l</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">margin_r</span><span class="si">}</span><span class="s2">,&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">margin_v</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">style_line</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pyonfx.ass_core.Char" class="doc doc-heading">
            <code>Char</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>Represents a single character within a subtitle line.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Char.i">i</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Zero-based index of the character within the line.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Char.word_i">word_i</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of the word to which this character belongs.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Char.syl_i">syl_i</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of the syllable to which this character belongs.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Char.syl_char_i">syl_char_i</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of the character within its parent syllable.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Char.start_time">start_time</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start time in milliseconds when the character appears.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Char.end_time">end_time</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End time in milliseconds when the character disappears.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Char.duration">duration</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Duration in milliseconds, computed as end_time - start_time.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Char.styleref">styleref</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Style


  
      dataclass
   (pyonfx.ass_core.Style)" href="#pyonfx.ass_core.Style">Style</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference to the Style object used for formatting this character.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Char.text">text</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The actual character as a string.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Char.inline_fx">inline_fx</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Inline effects specified for this character (derived from -EFFECT tag).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Char.width">width</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Width of the character in pixels.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Char.height">height</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Height of the character in pixels.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Char.x">x</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Horizontal position (x-coordinate in pixels).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Char.y">y</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Vertical position (y-coordinate in pixels).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Char.left">left</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Left boundary (in pixels).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Char.center">center</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Horizontal center position (in pixels).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Char.right">right</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Right boundary (in pixels).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Char.top">top</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Top boundary (in pixels).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Char.middle">middle</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Vertical center position (in pixels).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Char.bottom">bottom</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bottom boundary (in pixels).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>pyonfx/ass_core.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">slots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Char</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a single character within a subtitle line.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        i: Zero-based index of the character within the line.</span>
<span class="sd">        word_i: Index of the word to which this character belongs.</span>
<span class="sd">        syl_i: Index of the syllable to which this character belongs.</span>
<span class="sd">        syl_char_i: Index of the character within its parent syllable.</span>
<span class="sd">        start_time: Start time in milliseconds when the character appears.</span>
<span class="sd">        end_time: End time in milliseconds when the character disappears.</span>
<span class="sd">        duration: Duration in milliseconds, computed as end_time - start_time.</span>
<span class="sd">        styleref: Reference to the Style object used for formatting this character.</span>
<span class="sd">        text: The actual character as a string.</span>
<span class="sd">        inline_fx: Inline effects specified for this character (derived from \\-EFFECT tag).</span>
<span class="sd">        width: Width of the character in pixels.</span>
<span class="sd">        height: Height of the character in pixels.</span>
<span class="sd">        x: Horizontal position (x-coordinate in pixels).</span>
<span class="sd">        y: Vertical position (y-coordinate in pixels).</span>
<span class="sd">        left: Left boundary (in pixels).</span>
<span class="sd">        center: Horizontal center position (in pixels).</span>
<span class="sd">        right: Right boundary (in pixels).</span>
<span class="sd">        top: Top boundary (in pixels).</span>
<span class="sd">        middle: Vertical center position (in pixels).</span>
<span class="sd">        bottom: Bottom boundary (in pixels).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">i</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">word_i</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">syl_i</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">syl_char_i</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">start_time</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">end_time</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">styleref</span><span class="p">:</span> <span class="n">Style</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">inline_fx</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">left</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">center</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">right</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">top</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">middle</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">bottom</span><span class="p">:</span> <span class="nb">float</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">duration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pyonfx.ass_core.Syllable" class="doc doc-heading">
            <code>Syllable</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>Represents a syllable within a subtitle line.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Syllable.i">i</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Zero-based index of the syllable within the line.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Syllable.word_i">word_i</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of the word that contains this syllable.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Syllable.start_time">start_time</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start time in milliseconds when the syllable begins.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Syllable.end_time">end_time</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End time in milliseconds when the syllable ends.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Syllable.duration">duration</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Duration in milliseconds, computed as end_time - start_time.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Syllable.styleref">styleref</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Style


  
      dataclass
   (pyonfx.ass_core.Style)" href="#pyonfx.ass_core.Style">Style</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference to the Style object used for formatting this syllable.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Syllable.text">text</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Text content of the syllable.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Syllable.tags">tags</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ASS override tags preceding the syllable text (excluding \k tags).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Syllable.inline_fx">inline_fx</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Inline effects for the syllable (derived from -EFFECT tag).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Syllable.prespace">prespace</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of leading spaces before the syllable.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Syllable.postspace">postspace</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of trailing spaces after the syllable.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Syllable.width">width</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Width of the syllable in pixels.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Syllable.height">height</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Height of the syllable in pixels.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Syllable.x">x</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Horizontal position (x-coordinate in pixels).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Syllable.y">y</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Vertical position (y-coordinate in pixels).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Syllable.left">left</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Left boundary (in pixels).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Syllable.center">center</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Horizontal center position (in pixels).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Syllable.right">right</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Right boundary (in pixels).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Syllable.top">top</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Top boundary (in pixels).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Syllable.middle">middle</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Vertical center position (in pixels).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Syllable.bottom">bottom</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bottom boundary (in pixels).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>pyonfx/ass_core.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">slots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Syllable</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a syllable within a subtitle line.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        i: Zero-based index of the syllable within the line.</span>
<span class="sd">        word_i: Index of the word that contains this syllable.</span>
<span class="sd">        start_time: Start time in milliseconds when the syllable begins.</span>
<span class="sd">        end_time: End time in milliseconds when the syllable ends.</span>
<span class="sd">        duration: Duration in milliseconds, computed as end_time - start_time.</span>
<span class="sd">        styleref: Reference to the Style object used for formatting this syllable.</span>
<span class="sd">        text: Text content of the syllable.</span>
<span class="sd">        tags: ASS override tags preceding the syllable text (excluding \\k tags).</span>
<span class="sd">        inline_fx: Inline effects for the syllable (derived from \\-EFFECT tag).</span>
<span class="sd">        prespace: Number of leading spaces before the syllable.</span>
<span class="sd">        postspace: Number of trailing spaces after the syllable.</span>
<span class="sd">        width: Width of the syllable in pixels.</span>
<span class="sd">        height: Height of the syllable in pixels.</span>
<span class="sd">        x: Horizontal position (x-coordinate in pixels).</span>
<span class="sd">        y: Vertical position (y-coordinate in pixels).</span>
<span class="sd">        left: Left boundary (in pixels).</span>
<span class="sd">        center: Horizontal center position (in pixels).</span>
<span class="sd">        right: Right boundary (in pixels).</span>
<span class="sd">        top: Top boundary (in pixels).</span>
<span class="sd">        middle: Vertical center position (in pixels).</span>
<span class="sd">        bottom: Bottom boundary (in pixels).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">i</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">word_i</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">start_time</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">end_time</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">styleref</span><span class="p">:</span> <span class="n">Style</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">tags</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">inline_fx</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">prespace</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">postspace</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">left</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">center</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">right</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">top</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">middle</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">bottom</span><span class="p">:</span> <span class="nb">float</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">duration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pyonfx.ass_core.Word" class="doc doc-heading">
            <code>Word</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>Represents a word within a subtitle line.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Word.i">i</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Zero-based index of the word within the line.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Word.start_time">start_time</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start time in milliseconds for the word (typically matching the line's start time).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Word.end_time">end_time</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End time in milliseconds for the word (typically matching the line's end time).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Word.duration">duration</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Duration in milliseconds, computed as end_time - start_time.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Word.styleref">styleref</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Style


  
      dataclass
   (pyonfx.ass_core.Style)" href="#pyonfx.ass_core.Style">Style</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference to the Style object for this word.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Word.text">text</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Text content of the word.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Word.prespace">prespace</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of leading spaces before the word.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Word.postspace">postspace</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of trailing spaces after the word.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Word.width">width</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Width of the word in pixels.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Word.height">height</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Height of the word in pixels.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Word.x">x</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Horizontal position (x-coordinate in pixels).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Word.y">y</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Vertical position (y-coordinate in pixels).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Word.left">left</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Left boundary (in pixels).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Word.center">center</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Horizontal center position (in pixels).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Word.right">right</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Right boundary (in pixels).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Word.top">top</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Top boundary (in pixels).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Word.middle">middle</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Vertical center position (in pixels).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Word.bottom">bottom</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bottom boundary (in pixels).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>pyonfx/ass_core.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">slots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Word</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a word within a subtitle line.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        i: Zero-based index of the word within the line.</span>
<span class="sd">        start_time: Start time in milliseconds for the word (typically matching the line&#39;s start time).</span>
<span class="sd">        end_time: End time in milliseconds for the word (typically matching the line&#39;s end time).</span>
<span class="sd">        duration: Duration in milliseconds, computed as end_time - start_time.</span>
<span class="sd">        styleref: Reference to the Style object for this word.</span>
<span class="sd">        text: Text content of the word.</span>
<span class="sd">        prespace: Number of leading spaces before the word.</span>
<span class="sd">        postspace: Number of trailing spaces after the word.</span>
<span class="sd">        width: Width of the word in pixels.</span>
<span class="sd">        height: Height of the word in pixels.</span>
<span class="sd">        x: Horizontal position (x-coordinate in pixels).</span>
<span class="sd">        y: Vertical position (y-coordinate in pixels).</span>
<span class="sd">        left: Left boundary (in pixels).</span>
<span class="sd">        center: Horizontal center position (in pixels).</span>
<span class="sd">        right: Right boundary (in pixels).</span>
<span class="sd">        top: Top boundary (in pixels).</span>
<span class="sd">        middle: Vertical center position (in pixels).</span>
<span class="sd">        bottom: Bottom boundary (in pixels).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">i</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">start_time</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">end_time</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">styleref</span><span class="p">:</span> <span class="n">Style</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">prespace</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">postspace</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">left</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">center</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">right</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">top</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">middle</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">bottom</span><span class="p">:</span> <span class="nb">float</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">duration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pyonfx.ass_core.Line" class="doc doc-heading">
            <code>Line</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>Represents a subtitle line in an ASS file.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.comment">comment</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Indicates if the line is a comment (True) or dialogue (False).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.layer">layer</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Layer number for the line (higher layers are rendered above lower ones).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.start_time">start_time</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start time in milliseconds when the line appears.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.end_time">end_time</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End time in milliseconds when the line disappears.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.duration">duration</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Duration in milliseconds, computed as end_time - start_time.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.style">style</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the style applied to the line.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.styleref">styleref</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Style


  
      dataclass
   (pyonfx.ass_core.Style)" href="#pyonfx.ass_core.Style">Style</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference to the Style object used for formatting this line.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.actor">actor</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Actor or source associated with the line.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.margin_l">margin_l</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Left margin in pixels.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.margin_r">margin_r</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Right margin in pixels.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.margin_v">margin_v</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Vertical margin in pixels.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.effect">effect</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Effect field for the line.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.raw_text">raw_text</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Original text of the line, including override tags.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.text">text</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Stripped text of the line (override tags removed).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.i">i</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Zero-based index of the line in the ASS file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.leadin">leadin</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time gap in milliseconds before this line, relative to the previous line.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.leadout">leadout</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time gap in milliseconds after this line, relative to the next line.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.width">width</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Width of the line in pixels.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.height">height</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Height of the line in pixels.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.ascent">ascent</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Font ascent value for the line.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.descent">descent</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Font descent value for the line.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.internal_leading">internal_leading</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Internal leading (line spacing within the font) in pixels.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.external_leading">external_leading</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>External leading (additional spacing between lines) in pixels.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.x">x</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Horizontal position (x-coordinate in pixels) of the line.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.y">y</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Vertical position (y-coordinate in pixels) of the line.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.left">left</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Left boundary of the line (in pixels).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.center">center</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Horizontal center position of the line (in pixels).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.right">right</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Right boundary of the line (in pixels).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.top">top</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Top boundary of the line (in pixels).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.middle">middle</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Vertical center position of the line (in pixels).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.bottom">bottom</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bottom boundary of the line (in pixels).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.words">words</span></code></td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="Word


  
      dataclass
   (pyonfx.ass_core.Word)" href="#pyonfx.ass_core.Word">Word</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of Word objects contained in the line.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.syls">syls</span></code></td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="Syllable


  
      dataclass
   (pyonfx.ass_core.Syllable)" href="#pyonfx.ass_core.Syllable">Syllable</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of Syllable objects in the line (if available).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Line.chars">chars</span></code></td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="Char


  
      dataclass
   (pyonfx.ass_core.Char)" href="#pyonfx.ass_core.Char">Char</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of Char objects in the line.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>pyonfx/ass_core.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">slots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Line</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a subtitle line in an ASS file.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        comment: Indicates if the line is a comment (True) or dialogue (False).</span>
<span class="sd">        layer: Layer number for the line (higher layers are rendered above lower ones).</span>
<span class="sd">        start_time: Start time in milliseconds when the line appears.</span>
<span class="sd">        end_time: End time in milliseconds when the line disappears.</span>
<span class="sd">        duration: Duration in milliseconds, computed as end_time - start_time.</span>
<span class="sd">        style: Name of the style applied to the line.</span>
<span class="sd">        styleref: Reference to the Style object used for formatting this line.</span>
<span class="sd">        actor: Actor or source associated with the line.</span>
<span class="sd">        margin_l: Left margin in pixels.</span>
<span class="sd">        margin_r: Right margin in pixels.</span>
<span class="sd">        margin_v: Vertical margin in pixels.</span>
<span class="sd">        effect: Effect field for the line.</span>
<span class="sd">        raw_text: Original text of the line, including override tags.</span>
<span class="sd">        text: Stripped text of the line (override tags removed).</span>
<span class="sd">        i: Zero-based index of the line in the ASS file.</span>
<span class="sd">        leadin: Time gap in milliseconds before this line, relative to the previous line.</span>
<span class="sd">        leadout: Time gap in milliseconds after this line, relative to the next line.</span>
<span class="sd">        width: Width of the line in pixels.</span>
<span class="sd">        height: Height of the line in pixels.</span>
<span class="sd">        ascent: Font ascent value for the line.</span>
<span class="sd">        descent: Font descent value for the line.</span>
<span class="sd">        internal_leading: Internal leading (line spacing within the font) in pixels.</span>
<span class="sd">        external_leading: External leading (additional spacing between lines) in pixels.</span>
<span class="sd">        x: Horizontal position (x-coordinate in pixels) of the line.</span>
<span class="sd">        y: Vertical position (y-coordinate in pixels) of the line.</span>
<span class="sd">        left: Left boundary of the line (in pixels).</span>
<span class="sd">        center: Horizontal center position of the line (in pixels).</span>
<span class="sd">        right: Right boundary of the line (in pixels).</span>
<span class="sd">        top: Top boundary of the line (in pixels).</span>
<span class="sd">        middle: Vertical center position of the line (in pixels).</span>
<span class="sd">        bottom: Bottom boundary of the line (in pixels).</span>
<span class="sd">        words: List of Word objects contained in the line.</span>
<span class="sd">        syls: List of Syllable objects in the line (if available).</span>
<span class="sd">        chars: List of Char objects in the line.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">comment</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">layer</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">start_time</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">end_time</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">style</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">styleref</span><span class="p">:</span> <span class="n">Style</span>
    <span class="n">actor</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">margin_l</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">margin_r</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">margin_v</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">effect</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">raw_text</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">i</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">leadin</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">leadout</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">ascent</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">descent</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">internal_leading</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">external_leading</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">left</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">center</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">right</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">top</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">middle</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">bottom</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">words</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Word</span><span class="p">]</span>
    <span class="n">syls</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Syllable</span><span class="p">]</span>
    <span class="n">chars</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Char</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">duration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Line&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            A deep copy of this object (line)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_ass_line</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">line_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">styles</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Style</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Line&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse a single ASS line and return the corresponding Line object.&quot;&quot;&quot;</span>
        <span class="n">event_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(Dialogue|Comment):\s*(.+)$&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">event_match</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid event line. Line index: </span><span class="si">{</span><span class="n">line_index</span><span class="si">}</span><span class="s2">, Line: </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Layer, Start, End, Style, Name, MarginL, MarginR, MarginV, Effect, Text</span>
        <span class="n">event_type</span> <span class="o">=</span> <span class="n">event_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">event_data</span> <span class="o">=</span> <span class="n">event_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Split into fields, allowing the text field to contain commas</span>
        <span class="n">event_fields</span> <span class="o">=</span> <span class="n">event_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">event_fields</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Incomplete event line at index </span><span class="si">{</span><span class="n">line_index</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Convert time fields</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">Convert</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="n">event_fields</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">end_time</span> <span class="o">=</span> <span class="n">Convert</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="n">event_fields</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid time fields at line </span><span class="si">{</span><span class="n">line_index</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Resolve style reference</span>
        <span class="n">style_name</span> <span class="o">=</span> <span class="n">event_fields</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">styleref</span> <span class="o">=</span> <span class="n">styles</span><span class="p">[</span><span class="n">style_name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown style &#39;</span><span class="si">{</span><span class="n">style_name</span><span class="si">}</span><span class="s2">&#39; at line </span><span class="si">{</span><span class="n">line_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">comment</span><span class="o">=</span><span class="p">(</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;Comment&quot;</span><span class="p">),</span>
            <span class="n">layer</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">event_fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="n">start_time</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span>
            <span class="n">end_time</span><span class="o">=</span><span class="n">end_time</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="n">style_name</span><span class="p">,</span>
            <span class="n">styleref</span><span class="o">=</span><span class="n">styleref</span><span class="p">,</span>
            <span class="n">actor</span><span class="o">=</span><span class="n">event_fields</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
            <span class="n">margin_l</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">event_fields</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>
            <span class="n">margin_r</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">event_fields</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span>
            <span class="n">margin_v</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">event_fields</span><span class="p">[</span><span class="mi">7</span><span class="p">]),</span>
            <span class="n">effect</span><span class="o">=</span><span class="n">event_fields</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span>
            <span class="n">raw_text</span><span class="o">=</span><span class="n">event_fields</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span>
            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">i</span><span class="o">=</span><span class="n">line_index</span><span class="p">,</span>
            <span class="n">leadin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">leadout</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
            <span class="n">height</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
            <span class="n">ascent</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
            <span class="n">descent</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
            <span class="n">internal_leading</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
            <span class="n">external_leading</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
            <span class="n">x</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
            <span class="n">y</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
            <span class="n">left</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
            <span class="n">center</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
            <span class="n">right</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
            <span class="n">top</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
            <span class="n">middle</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
            <span class="n">bottom</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
            <span class="n">words</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">syls</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">chars</span><span class="o">=</span><span class="p">[],</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Serialize a Line object into an ASS line.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Comment&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Dialogue&#39;</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">layer</span><span class="si">}</span><span class="s2">,&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">Convert</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">)))</span><span class="si">}</span><span class="s2">,&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">Convert</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">)))</span><span class="si">}</span><span class="s2">,&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="si">}</span><span class="s2">,&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">actor</span><span class="si">}</span><span class="s2">,&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">margin_l</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">,&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">margin_r</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">,&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">margin_v</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">,&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">effect</span><span class="si">}</span><span class="s2">,&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="pyonfx.ass_core.Line.copy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">copy</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Line


  
      dataclass
   (pyonfx.ass_core.Line)" href="#pyonfx.ass_core.Line">Line</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A deep copy of this object (line)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>pyonfx/ass_core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Line&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        A deep copy of this object (line)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.ass_core.Line.from_ass_line" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_ass_line</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">line_index</span><span class="p">,</span> <span class="n">styles</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Parse a single ASS line and return the corresponding Line object.</p>


            <details class="quote">
              <summary>Source code in <code>pyonfx/ass_core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_ass_line</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">line_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">styles</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Style</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Line&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a single ASS line and return the corresponding Line object.&quot;&quot;&quot;</span>
    <span class="n">event_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(Dialogue|Comment):\s*(.+)$&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">event_match</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Invalid event line. Line index: </span><span class="si">{</span><span class="n">line_index</span><span class="si">}</span><span class="s2">, Line: </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Layer, Start, End, Style, Name, MarginL, MarginR, MarginV, Effect, Text</span>
    <span class="n">event_type</span> <span class="o">=</span> <span class="n">event_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">event_data</span> <span class="o">=</span> <span class="n">event_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Split into fields, allowing the text field to contain commas</span>
    <span class="n">event_fields</span> <span class="o">=</span> <span class="n">event_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">event_fields</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Incomplete event line at index </span><span class="si">{</span><span class="n">line_index</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Convert time fields</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">Convert</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="n">event_fields</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">Convert</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="n">event_fields</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid time fields at line </span><span class="si">{</span><span class="n">line_index</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Resolve style reference</span>
    <span class="n">style_name</span> <span class="o">=</span> <span class="n">event_fields</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">styleref</span> <span class="o">=</span> <span class="n">styles</span><span class="p">[</span><span class="n">style_name</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown style &#39;</span><span class="si">{</span><span class="n">style_name</span><span class="si">}</span><span class="s2">&#39; at line </span><span class="si">{</span><span class="n">line_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">comment</span><span class="o">=</span><span class="p">(</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;Comment&quot;</span><span class="p">),</span>
        <span class="n">layer</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">event_fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="n">start_time</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span>
        <span class="n">end_time</span><span class="o">=</span><span class="n">end_time</span><span class="p">,</span>
        <span class="n">style</span><span class="o">=</span><span class="n">style_name</span><span class="p">,</span>
        <span class="n">styleref</span><span class="o">=</span><span class="n">styleref</span><span class="p">,</span>
        <span class="n">actor</span><span class="o">=</span><span class="n">event_fields</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
        <span class="n">margin_l</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">event_fields</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>
        <span class="n">margin_r</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">event_fields</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span>
        <span class="n">margin_v</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">event_fields</span><span class="p">[</span><span class="mi">7</span><span class="p">]),</span>
        <span class="n">effect</span><span class="o">=</span><span class="n">event_fields</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span>
        <span class="n">raw_text</span><span class="o">=</span><span class="n">event_fields</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span>
        <span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">i</span><span class="o">=</span><span class="n">line_index</span><span class="p">,</span>
        <span class="n">leadin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">leadout</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
        <span class="n">height</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
        <span class="n">ascent</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
        <span class="n">descent</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
        <span class="n">internal_leading</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
        <span class="n">external_leading</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
        <span class="n">x</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
        <span class="n">y</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
        <span class="n">left</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
        <span class="n">center</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
        <span class="n">right</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
        <span class="n">top</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
        <span class="n">middle</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
        <span class="n">bottom</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
        <span class="n">words</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">syls</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">chars</span><span class="o">=</span><span class="p">[],</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.ass_core.Line.serialize" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">serialize</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Serialize a Line object into an ASS line.</p>


            <details class="quote">
              <summary>Source code in <code>pyonfx/ass_core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Serialize a Line object into an ASS line.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Comment&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Dialogue&#39;</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">layer</span><span class="si">}</span><span class="s2">,&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">Convert</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">)))</span><span class="si">}</span><span class="s2">,&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">Convert</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">)))</span><span class="si">}</span><span class="s2">,&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="si">}</span><span class="s2">,&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">actor</span><span class="si">}</span><span class="s2">,&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">margin_l</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">,&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">margin_r</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">,&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">margin_v</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">,&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">effect</span><span class="si">}</span><span class="s2">,&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pyonfx.ass_core.Ass" class="doc doc-heading">
            <code>Ass</code>


</h2>


    <div class="doc doc-contents ">


        <p>ASS File Handler.</p>
<p>This class provides an interface for reading, processing, and writing Advanced SubStation Alpha (ASS) subtitle files.
It extracts metadata, styles, and dialogue events, computes extended layout metrics, and outputs ASS files for use with Aegisub or MPV.
It also supports preserving the original subtitle content as comments and auto-resolves file paths.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Ass.path_input">path_input</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>absolute path to the input subtitle file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Ass.path_output">path_output</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>absolute path to the output subtitle file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Ass.meta">meta</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Meta


  
      dataclass
   (pyonfx.ass_core.Meta)" href="#pyonfx.ass_core.Meta">Meta</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>metadata extracted from the ASS file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Ass.styles">styles</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <a class="autorefs autorefs-internal" title="Style


  
      dataclass
   (pyonfx.ass_core.Style)" href="#pyonfx.ass_core.Style">Style</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>mapping of style names to their style objects present in the ASS file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="pyonfx.ass_core.Ass.lines">lines</span></code></td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="Line


  
      dataclass
   (pyonfx.ass_core.Line)" href="#pyonfx.ass_core.Line">Line</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of subtitle event lines parsed from the file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="PIXEL_STYLE = Style(name='p', fontname='Arial', fontsize=20, color1='FFFFFF', alpha1='00', color2='FFFFFF', alpha2='00', color3='000000', alpha3='0000', color4='000000', alpha4='0000', bold=False, italic=False, underline=False, strikeout=False, scale_x=100, scale_y=100, spacing=0, angle=0, border_style=False, outline=0, shadow=0, alignment=7, margin_l=0, margin_r=0, margin_v=0, encoding=1)

  
      class-attribute
      instance-attribute
   (pyonfx.ass_core.Ass.PIXEL_STYLE)" href="#pyonfx.ass_core.Ass.PIXEL_STYLE">PIXEL_STYLE</a></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Style


  
      dataclass
   (pyonfx.ass_core.Style)" href="#pyonfx.ass_core.Style">Style</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>default lightweight style for pixel-based effects.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">io</span> <span class="o">=</span> <span class="n">Ass</span><span class="p">(</span><span class="s2">&quot;in.ass&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
</code></pre></div>







              <details class="quote">
                <summary>Source code in <code>pyonfx/ass_core.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Ass</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ASS File Handler.</span>

<span class="sd">    This class provides an interface for reading, processing, and writing Advanced SubStation Alpha (ASS) subtitle files.</span>
<span class="sd">    It extracts metadata, styles, and dialogue events, computes extended layout metrics, and outputs ASS files for use with Aegisub or MPV.</span>
<span class="sd">    It also supports preserving the original subtitle content as comments and auto-resolves file paths.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        path_input: absolute path to the input subtitle file.</span>
<span class="sd">        path_output: absolute path to the output subtitle file.</span>
<span class="sd">        meta: metadata extracted from the ASS file.</span>
<span class="sd">        styles: mapping of style names to their style objects present in the ASS file.</span>
<span class="sd">        lines: list of subtitle event lines parsed from the file.</span>
<span class="sd">        PIXEL_STYLE: default lightweight style for pixel-based effects.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; io = Ass(&quot;in.ass&quot;)</span>
<span class="sd">        &gt;&gt;&gt; meta, styles, lines = io.get_data()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">PIXEL_STYLE</span><span class="p">:</span> <span class="n">Style</span> <span class="o">=</span> <span class="n">Style</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;p&quot;</span><span class="p">,</span>
        <span class="n">fontname</span><span class="o">=</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
        <span class="n">color1</span><span class="o">=</span><span class="s2">&quot;FFFFFF&quot;</span><span class="p">,</span>
        <span class="n">alpha1</span><span class="o">=</span><span class="s2">&quot;00&quot;</span><span class="p">,</span>
        <span class="n">color2</span><span class="o">=</span><span class="s2">&quot;FFFFFF&quot;</span><span class="p">,</span>
        <span class="n">alpha2</span><span class="o">=</span><span class="s2">&quot;00&quot;</span><span class="p">,</span>
        <span class="n">color3</span><span class="o">=</span><span class="s2">&quot;000000&quot;</span><span class="p">,</span>
        <span class="n">alpha3</span><span class="o">=</span><span class="s2">&quot;0000&quot;</span><span class="p">,</span>
        <span class="n">color4</span><span class="o">=</span><span class="s2">&quot;000000&quot;</span><span class="p">,</span>
        <span class="n">alpha4</span><span class="o">=</span><span class="s2">&quot;0000&quot;</span><span class="p">,</span>
        <span class="n">bold</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">italic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">underline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">strikeout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">scale_x</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">scale_y</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">spacing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">border_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">outline</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">shadow</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">alignment</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
        <span class="n">margin_l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">margin_r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">margin_v</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">encoding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Lightweight style for pixels.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">path_input</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">path_output</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;output.ass&quot;</span><span class="p">,</span>
        <span class="n">keep_original</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">extended</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">vertical_kanji</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the ASS object.</span>

<span class="sd">        Args:</span>
<span class="sd">            path_input: The path for the input ASS file, which can be relative or absolute.</span>
<span class="sd">            path_output: The path for the output ASS file (default: &quot;output.ass&quot;).</span>
<span class="sd">            keep_original: If True, the original lines are kept as comments in the output.</span>
<span class="sd">            extended: If True, extended information (including positioning, metrics, words, syllables, and characters) will be computed.</span>
<span class="sd">            vertical_kanji: If True, lines with alignment 4, 5 or 6 will be repositioned vertically.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Progress/statistics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_saved</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plines</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Total produced lines</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ptime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>  <span class="c1"># Total processing time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stats_by_effect</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lines&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;calls&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Output buffers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_extradata</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Public attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span> <span class="n">Meta</span> <span class="o">=</span> <span class="n">Meta</span><span class="p">(</span>
            <span class="n">wrap_style</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">scaled_border_and_shadow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">play_res_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">play_res_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">audio</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">video</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">timestamps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Style</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Line</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Getting absolute sub file path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path_input</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">_resolve_path</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">path_input</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_input</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                <span class="s2">&quot;Invalid path for the Subtitle file: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_input</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path_output</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">_resolve_path</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">path_output</span><span class="p">)</span>

        <span class="c1"># Parse the ASS file</span>
        <span class="n">current_section</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">line_index</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_input</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8-sig&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                <span class="c1"># New section?</span>
                <span class="n">section_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\[([^\]]*)\]&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">section_match</span><span class="p">:</span>
                    <span class="n">current_section</span> <span class="o">=</span> <span class="n">section_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">current_section</span> <span class="o">!=</span> <span class="s2">&quot;Aegisub Extradata&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="c1"># Copy-paste lines</span>
                <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Format&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="c1"># Sections parsers</span>
                <span class="k">elif</span> <span class="n">current_section</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Script Info&quot;</span><span class="p">,</span> <span class="s2">&quot;Aegisub Project Garbage&quot;</span><span class="p">):</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">parse_line</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_input</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">current_section</span> <span class="o">==</span> <span class="s2">&quot;V4+ Styles&quot;</span><span class="p">:</span>
                    <span class="n">style</span> <span class="o">=</span> <span class="n">Style</span><span class="o">.</span><span class="n">from_ass_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="p">[</span><span class="n">style</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">style</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">current_section</span> <span class="o">==</span> <span class="s2">&quot;Events&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Line</span><span class="o">.</span><span class="n">from_ass_line</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">line_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">keep_original</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(Dialogue|Comment):&quot;</span><span class="p">,</span> <span class="s2">&quot;Comment:&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="n">line_index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">current_section</span> <span class="o">==</span> <span class="s2">&quot;Aegisub Extradata&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_output_extradata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span>
                    <span class="n">current_section</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="p">):</span>  <span class="c1"># Non-empty line in unknown section</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Unexpected section in the input file: [</span><span class="si">{</span><span class="n">current_section</span><span class="si">}</span><span class="s2">]&quot;</span>
                    <span class="p">)</span>

        <span class="c1"># Add extended information to lines and meta?</span>
        <span class="k">if</span> <span class="n">extended</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process_extended_line_data</span><span class="p">(</span><span class="n">vertical_kanji</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_extended_line_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertical_kanji</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process extended line data including positioning, words, syllables, and characters.&quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_split_raw_segments</span><span class="p">(</span>
            <span class="n">lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Line</span><span class="p">],</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Line</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Split each raw_text at \\N and compute cumulative k-offsets.&quot;&quot;&quot;</span>
            <span class="n">output_lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Line</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">new_lines_indices</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">new_lines_k_offsets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="n">raw_segments</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">raw_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">N&quot;</span><span class="p">)</span>
                <span class="n">text_segments</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\{.*?\}&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">raw_text</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">N&quot;</span><span class="p">)</span>
                <span class="n">seg_k_durations</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="nb">sum</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">[kK][of]?(\d+)&quot;</span><span class="p">,</span> <span class="n">seg</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="n">raw_segments</span>
                <span class="p">]</span>
                <span class="n">cumulative_k_durations</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="nb">sum</span><span class="p">(</span><span class="n">seg_k_durations</span><span class="p">[:</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seg_k_durations</span><span class="p">))</span>
                <span class="p">]</span>

                <span class="k">for</span> <span class="n">seg_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">raw_seg</span><span class="p">,</span> <span class="n">text_seg</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                    <span class="nb">zip</span><span class="p">(</span><span class="n">raw_segments</span><span class="p">,</span> <span class="n">text_segments</span><span class="p">)</span>
                <span class="p">):</span>
                    <span class="n">seg_line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">seg_line</span><span class="o">.</span><span class="n">raw_text</span> <span class="o">=</span> <span class="n">raw_seg</span>
                    <span class="n">seg_line</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text_seg</span>
                    <span class="n">output_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg_line</span><span class="p">)</span>
                    <span class="n">new_lines_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg_idx</span><span class="p">)</span>
                    <span class="n">new_lines_k_offsets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cumulative_k_durations</span><span class="p">[</span><span class="n">seg_idx</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">output_lines</span><span class="p">,</span> <span class="n">new_lines_indices</span><span class="p">,</span> <span class="n">new_lines_k_offsets</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_compute_line_fields</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">font</span><span class="p">:</span> <span class="n">Font</span><span class="p">,</span> <span class="n">split_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">line</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\{.*?\}&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">raw_text</span><span class="p">)</span>

            <span class="n">line</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_text_extents</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="p">(</span>
                <span class="n">line</span><span class="o">.</span><span class="n">ascent</span><span class="p">,</span>
                <span class="n">line</span><span class="o">.</span><span class="n">descent</span><span class="p">,</span>
                <span class="n">line</span><span class="o">.</span><span class="n">internal_leading</span><span class="p">,</span>
                <span class="n">line</span><span class="o">.</span><span class="n">external_leading</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_metrics</span><span class="p">()</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">play_res_x</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">play_res_x</span> <span class="o">&lt;=</span> <span class="mi">0</span>
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">play_res_y</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">play_res_y</span> <span class="o">&lt;=</span> <span class="mi">0</span>
            <span class="p">):</span>
                <span class="k">return</span>

            <span class="c1"># Resolve margins</span>
            <span class="n">margins</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;l&quot;</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">margin_l</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">margin_l</span><span class="p">,</span>
                <span class="s2">&quot;r&quot;</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">margin_r</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">margin_r</span><span class="p">,</span>
                <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">margin_v</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">margin_v</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="c1"># Horizontal position</span>
            <span class="n">h_group</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">alignment</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">margins</span><span class="p">[</span><span class="s2">&quot;l&quot;</span><span class="p">],</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">play_res_x</span> <span class="o">-</span> <span class="n">line</span><span class="o">.</span><span class="n">width</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">margins</span><span class="p">[</span><span class="s2">&quot;l&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">margins</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">play_res_x</span> <span class="o">-</span> <span class="n">margins</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">line</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="n">line</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">positions</span><span class="p">[</span><span class="n">h_group</span><span class="p">]</span>
            <span class="n">line</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">line</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">line</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">line</span><span class="o">.</span><span class="n">width</span>
            <span class="n">line</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">right</span><span class="p">)[</span><span class="n">h_group</span><span class="p">]</span>

            <span class="c1"># Vertical position</span>
            <span class="n">v_group</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">alignment</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">3</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">play_res_y</span> <span class="o">-</span> <span class="n">margins</span><span class="p">[</span><span class="s2">&quot;v&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">line</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>  <span class="c1"># bottom</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">play_res_y</span> <span class="o">-</span> <span class="n">line</span><span class="o">.</span><span class="n">height</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># middle</span>
                <span class="n">margins</span><span class="p">[</span><span class="s2">&quot;v&quot;</span><span class="p">],</span>  <span class="c1"># top</span>
            <span class="p">]</span>
            <span class="n">line</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="n">positions</span><span class="p">[</span><span class="n">v_group</span><span class="p">]</span>
            <span class="n">line</span><span class="o">.</span><span class="n">middle</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">top</span> <span class="o">+</span> <span class="n">line</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">line</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">top</span> <span class="o">+</span> <span class="n">line</span><span class="o">.</span><span class="n">height</span>
            <span class="n">line</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">middle</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">top</span><span class="p">)[</span><span class="n">v_group</span><span class="p">]</span>

            <span class="c1"># Apply vertical offset for split lines</span>
            <span class="k">if</span> <span class="n">split_index</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">split_index</span> <span class="o">*</span> <span class="n">line</span><span class="o">.</span><span class="n">height</span>
                <span class="n">line</span><span class="o">.</span><span class="n">top</span> <span class="o">+=</span> <span class="n">offset</span>
                <span class="n">line</span><span class="o">.</span><span class="n">middle</span> <span class="o">+=</span> <span class="n">offset</span>
                <span class="n">line</span><span class="o">.</span><span class="n">bottom</span> <span class="o">+=</span> <span class="n">offset</span>
                <span class="n">line</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">offset</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_build_words</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">font</span><span class="p">:</span> <span class="n">Font</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">wi</span><span class="p">,</span> <span class="p">(</span><span class="n">prespace</span><span class="p">,</span> <span class="n">word_text</span><span class="p">,</span> <span class="n">postspace</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(\s*)([^\s]+)(\s*)&quot;</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_text_extents</span><span class="p">(</span><span class="n">word_text</span><span class="p">)</span>
                <span class="n">line</span><span class="o">.</span><span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">Word</span><span class="p">(</span>
                        <span class="n">i</span><span class="o">=</span><span class="n">wi</span><span class="p">,</span>
                        <span class="n">start_time</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span>
                        <span class="n">end_time</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">end_time</span><span class="p">,</span>
                        <span class="n">styleref</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="p">,</span>
                        <span class="n">text</span><span class="o">=</span><span class="n">word_text</span><span class="p">,</span>
                        <span class="n">prespace</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">prespace</span><span class="p">),</span>
                        <span class="n">postspace</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">postspace</span><span class="p">),</span>
                        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
                        <span class="n">x</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
                        <span class="n">y</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
                        <span class="n">left</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
                        <span class="n">center</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
                        <span class="n">right</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
                        <span class="n">top</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
                        <span class="n">middle</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
                        <span class="n">bottom</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="n">line</span><span class="o">.</span><span class="n">left</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">play_res_x</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">play_res_y</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="p">):</span>
                <span class="k">return</span>

            <span class="n">h_group</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">alignment</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span>
            <span class="n">v_group</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">alignment</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">3</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">vertical_kanji</span> <span class="ow">or</span> <span class="n">v_group</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">cur_x</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">left</span>
                <span class="n">space_offset</span> <span class="o">=</span> <span class="n">space_width</span> <span class="o">+</span> <span class="n">style_spacing</span>

                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">words</span><span class="p">):</span>
                    <span class="c1"># Add prespace offset for all words except the first one</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">cur_x</span> <span class="o">+=</span> <span class="n">word</span><span class="o">.</span><span class="n">prespace</span> <span class="o">*</span> <span class="n">space_offset</span>

                    <span class="c1"># Horizontal position</span>
                    <span class="n">word</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">cur_x</span>
                    <span class="n">word</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">word</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">word</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">word</span><span class="o">.</span><span class="n">width</span>
                    <span class="n">word</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">word</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="n">word</span><span class="o">.</span><span class="n">right</span><span class="p">][</span><span class="n">h_group</span><span class="p">]</span>

                    <span class="c1"># Vertical position (copy from line)</span>
                    <span class="n">word</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="n">word</span><span class="o">.</span><span class="n">middle</span><span class="p">,</span> <span class="n">word</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span> <span class="n">word</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">line</span><span class="o">.</span><span class="n">top</span><span class="p">,</span>
                        <span class="n">line</span><span class="o">.</span><span class="n">middle</span><span class="p">,</span>
                        <span class="n">line</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span>
                        <span class="n">line</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="c1"># Update cur_x for next word</span>
                    <span class="n">cur_x</span> <span class="o">+=</span> <span class="n">word</span><span class="o">.</span><span class="n">width</span> <span class="o">+</span> <span class="n">word</span><span class="o">.</span><span class="n">postspace</span> <span class="o">*</span> <span class="n">space_offset</span> <span class="o">+</span> <span class="n">style_spacing</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">max_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">width</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">words</span><span class="p">)</span>
                <span class="n">sum_height</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">height</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">words</span><span class="p">)</span>

                <span class="n">cur_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">play_res_y</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">sum_height</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">alignment</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">alignment</span>

                <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">words</span><span class="p">:</span>
                    <span class="c1"># Horizontal position</span>
                    <span class="n">x_fix</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_width</span> <span class="o">-</span> <span class="n">word</span><span class="o">.</span><span class="n">width</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

                    <span class="k">if</span> <span class="n">alignment</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="n">word</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">x_fix</span>
                        <span class="n">word</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">left</span>
                    <span class="k">elif</span> <span class="n">alignment</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="n">word</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">play_res_x</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">word</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>
                        <span class="n">word</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">word</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">word</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">right</span> <span class="o">-</span> <span class="n">word</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">x_fix</span>
                        <span class="n">word</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">word</span><span class="o">.</span><span class="n">width</span>

                    <span class="n">word</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">word</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">word</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">word</span><span class="o">.</span><span class="n">width</span>

                    <span class="c1"># Vertical position</span>
                    <span class="n">word</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="n">cur_y</span>
                    <span class="n">word</span><span class="o">.</span><span class="n">middle</span> <span class="o">=</span> <span class="n">cur_y</span> <span class="o">+</span> <span class="n">word</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">word</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">cur_y</span> <span class="o">+</span> <span class="n">word</span><span class="o">.</span><span class="n">height</span>
                    <span class="n">word</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">middle</span>
                    <span class="n">cur_y</span> <span class="o">+=</span> <span class="n">word</span><span class="o">.</span><span class="n">height</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_parse_syllables</span><span class="p">(</span><span class="n">line_raw_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
            <span class="n">KARAOKE_PATTERN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">[kK][fot]?(\d+)?&quot;</span><span class="p">)</span>
            <span class="n">TAG_BLOCK_PATTERN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\{([^}]*)\}|([^{]+)&quot;</span><span class="p">)</span>
            <span class="n">TAG_EXTRACT_PATTERN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">[^</span><span class="se">\\</span><span class="s2">]*&quot;</span><span class="p">)</span>

            <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">pending_tags</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">current_tags</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">current_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">current_duration</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="c1"># Split line into tag blocks {...} and text segments</span>
            <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">TAG_BLOCK_PATTERN</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">line_raw_text</span><span class="p">):</span>
                <span class="n">tag_content</span><span class="p">,</span> <span class="n">text_content</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">tag_content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">tags</span> <span class="o">=</span> <span class="n">TAG_EXTRACT_PATTERN</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">tag_content</span><span class="p">)</span>
                    <span class="n">karaoke_matches</span> <span class="o">=</span> <span class="p">{</span><span class="n">tag</span><span class="p">:</span> <span class="n">KARAOKE_PATTERN</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">}</span>
                    <span class="n">has_karaoke</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">karaoke_matches</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

                    <span class="k">if</span> <span class="n">has_karaoke</span><span class="p">:</span>
                        <span class="c1"># Karaoke block: process tags</span>
                        <span class="n">found_karaoke</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
                            <span class="n">k_match</span> <span class="o">=</span> <span class="n">karaoke_matches</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">k_match</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">current_tags</span><span class="p">:</span>
                                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                        <span class="p">(</span>
                                            <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_tags</span><span class="p">),</span>
                                            <span class="n">current_duration</span><span class="p">,</span>
                                            <span class="n">current_text</span><span class="p">,</span>
                                        <span class="p">)</span>
                                    <span class="p">)</span>
                                    <span class="n">current_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                                <span class="n">current_tags</span> <span class="o">=</span> <span class="n">pending_tags</span> <span class="o">+</span> <span class="p">[</span><span class="n">tag</span><span class="p">]</span>
                                <span class="n">current_duration</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="nb">int</span><span class="p">(</span><span class="n">k_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="k">if</span> <span class="n">k_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
                                <span class="p">)</span>
                                <span class="n">pending_tags</span> <span class="o">=</span> <span class="p">[]</span>
                                <span class="n">found_karaoke</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">found_karaoke</span><span class="p">:</span>
                                    <span class="n">current_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">pending_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Non-karaoke block: decide where these tags belong</span>
                        <span class="k">if</span> <span class="n">current_tags</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">current_text</span><span class="p">:</span>
                            <span class="n">current_tags</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">pending_tags</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Plain text: add to current division</span>
                    <span class="n">current_text</span> <span class="o">+=</span> <span class="n">text_content</span>

            <span class="c1"># Add the final division if it exists</span>
            <span class="k">if</span> <span class="n">current_tags</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_tags</span><span class="p">),</span> <span class="n">current_duration</span><span class="p">,</span> <span class="n">current_text</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">result</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_build_syllables</span><span class="p">(</span>
            <span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span>
            <span class="n">syllable_data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
            <span class="n">font</span><span class="p">:</span> <span class="n">Font</span><span class="p">,</span>
            <span class="n">split_k_offset</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="c1"># Precompute word boundaries (start_idx, end_idx, word_i)</span>
            <span class="n">word_boundaries</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">words</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">+</span> <span class="n">w</span><span class="o">.</span><span class="n">prespace</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                <span class="n">word_boundaries</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">w</span><span class="o">.</span><span class="n">i</span><span class="p">))</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">end</span> <span class="o">+</span> <span class="n">w</span><span class="o">.</span><span class="n">postspace</span>

            <span class="n">last_time</span> <span class="o">=</span> <span class="n">split_k_offset</span>
            <span class="n">syl_char_idx</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">syl_i</span><span class="p">,</span> <span class="p">(</span><span class="n">tags</span><span class="p">,</span> <span class="n">k_dur</span><span class="p">,</span> <span class="n">raw_text</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">syllable_data</span><span class="p">):</span>
                <span class="c1"># Inline effect</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">-([^\s</span><span class="se">\\</span><span class="s2">}]+)&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="p">)</span>
                <span class="n">inline_fx</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">m</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

                <span class="c1"># Text and spacing</span>
                <span class="n">text_stripped</span> <span class="o">=</span> <span class="n">raw_text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">prespace</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_text</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_text</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())</span>
                <span class="n">postspace</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">raw_text</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_text</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span> <span class="k">if</span> <span class="n">text_stripped</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="p">)</span>

                <span class="c1"># Timing</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="n">k_dur</span> <span class="o">*</span> <span class="mi">10</span> <span class="k">if</span> <span class="n">k_dur</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="n">start_time</span> <span class="o">=</span> <span class="n">last_time</span>
                <span class="n">end_time</span> <span class="o">=</span> <span class="n">start_time</span> <span class="o">+</span> <span class="n">duration</span>

                <span class="c1"># Determine word index</span>
                <span class="n">syl_start</span> <span class="o">=</span> <span class="n">syl_char_idx</span> <span class="o">+</span> <span class="n">prespace</span>
                <span class="n">syl_word_i</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">w_i</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">w_i</span> <span class="ow">in</span> <span class="n">word_boundaries</span> <span class="k">if</span> <span class="n">s</span> <span class="o">&lt;=</span> <span class="n">syl_start</span> <span class="o">&lt;</span> <span class="n">e</span><span class="p">),</span> <span class="mi">0</span>
                <span class="p">)</span>

                <span class="c1"># Font metrics</span>
                <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_text_extents</span><span class="p">(</span><span class="n">text_stripped</span><span class="p">)</span>

                <span class="c1"># Create and append syllable</span>
                <span class="n">line</span><span class="o">.</span><span class="n">syls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">Syllable</span><span class="p">(</span>
                        <span class="n">i</span><span class="o">=</span><span class="n">syl_i</span><span class="p">,</span>
                        <span class="n">word_i</span><span class="o">=</span><span class="n">syl_word_i</span><span class="p">,</span>
                        <span class="n">start_time</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span>
                        <span class="n">end_time</span><span class="o">=</span><span class="n">end_time</span><span class="p">,</span>
                        <span class="n">styleref</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="p">,</span>
                        <span class="n">text</span><span class="o">=</span><span class="n">text_stripped</span><span class="p">,</span>
                        <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">,</span>
                        <span class="n">inline_fx</span><span class="o">=</span><span class="n">inline_fx</span><span class="p">,</span>
                        <span class="n">prespace</span><span class="o">=</span><span class="n">prespace</span><span class="p">,</span>
                        <span class="n">postspace</span><span class="o">=</span><span class="n">postspace</span><span class="p">,</span>
                        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
                        <span class="n">x</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
                        <span class="n">y</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
                        <span class="n">left</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
                        <span class="n">center</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
                        <span class="n">right</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
                        <span class="n">top</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
                        <span class="n">middle</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
                        <span class="n">bottom</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
                    <span class="p">)</span>
                <span class="p">)</span>

                <span class="c1"># Update for next iteration</span>
                <span class="n">last_time</span> <span class="o">=</span> <span class="n">end_time</span>
                <span class="n">syl_char_idx</span> <span class="o">+=</span> <span class="n">prespace</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">text_stripped</span><span class="p">)</span> <span class="o">+</span> <span class="n">postspace</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="n">line</span><span class="o">.</span><span class="n">left</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">play_res_x</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">play_res_y</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="p">):</span>
                <span class="k">return</span>

            <span class="n">h_group</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">alignment</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span>
            <span class="n">v_group</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">alignment</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">3</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">vertical_kanji</span> <span class="ow">or</span> <span class="n">v_group</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">cur_x</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">left</span>
                <span class="n">found_first_text_syl</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">space_offset</span> <span class="o">=</span> <span class="n">space_width</span> <span class="o">+</span> <span class="n">style_spacing</span>

                <span class="k">for</span> <span class="n">syl</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">syls</span><span class="p">:</span>
                    <span class="c1"># Add prespace offset only after the first syllable with text</span>
                    <span class="k">if</span> <span class="n">found_first_text_syl</span><span class="p">:</span>
                        <span class="n">cur_x</span> <span class="o">+=</span> <span class="n">syl</span><span class="o">.</span><span class="n">prespace</span> <span class="o">*</span> <span class="n">space_offset</span>
                    <span class="k">elif</span> <span class="n">syl</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                        <span class="n">found_first_text_syl</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="c1"># Horizontal position</span>
                    <span class="n">syl</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">cur_x</span>
                    <span class="n">syl</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">syl</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">syl</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">syl</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">syl</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">syl</span><span class="o">.</span><span class="n">width</span>
                    <span class="n">syl</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">syl</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">syl</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="n">syl</span><span class="o">.</span><span class="n">right</span><span class="p">][</span><span class="n">h_group</span><span class="p">]</span>

                    <span class="c1"># Vertical position</span>
                    <span class="n">syl</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="n">syl</span><span class="o">.</span><span class="n">middle</span><span class="p">,</span> <span class="n">syl</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span> <span class="n">syl</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">line</span><span class="o">.</span><span class="n">top</span><span class="p">,</span>
                        <span class="n">line</span><span class="o">.</span><span class="n">middle</span><span class="p">,</span>
                        <span class="n">line</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span>
                        <span class="n">line</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="c1"># Update cur_x for next syllable</span>
                    <span class="n">cur_x</span> <span class="o">+=</span> <span class="n">syl</span><span class="o">.</span><span class="n">width</span> <span class="o">+</span> <span class="n">syl</span><span class="o">.</span><span class="n">postspace</span> <span class="o">*</span> <span class="n">space_offset</span> <span class="o">+</span> <span class="n">style_spacing</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">max_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">syl</span><span class="o">.</span><span class="n">width</span> <span class="k">for</span> <span class="n">syl</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">syls</span><span class="p">)</span>
                <span class="n">sum_height</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">syl</span><span class="o">.</span><span class="n">height</span> <span class="k">for</span> <span class="n">syl</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">syls</span><span class="p">)</span>

                <span class="n">cur_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">play_res_y</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">sum_height</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">alignment</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">alignment</span>

                <span class="k">for</span> <span class="n">syl</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">syls</span><span class="p">:</span>
                    <span class="n">x_fix</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_width</span> <span class="o">-</span> <span class="n">syl</span><span class="o">.</span><span class="n">width</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

                    <span class="c1"># Horizontal position</span>
                    <span class="k">if</span> <span class="n">alignment</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="n">syl</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">x_fix</span>
                    <span class="k">elif</span> <span class="n">alignment</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="n">syl</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">play_res_x</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">syl</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">syl</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">right</span> <span class="o">-</span> <span class="n">syl</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">x_fix</span>

                    <span class="n">syl</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">syl</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">syl</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">syl</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">syl</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">syl</span><span class="o">.</span><span class="n">width</span>
                    <span class="n">syl</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">syl</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">syl</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="n">syl</span><span class="o">.</span><span class="n">right</span><span class="p">][</span><span class="n">h_group</span><span class="p">]</span>

                    <span class="c1"># Vertical position</span>
                    <span class="n">syl</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="n">cur_y</span>
                    <span class="n">syl</span><span class="o">.</span><span class="n">middle</span> <span class="o">=</span> <span class="n">cur_y</span> <span class="o">+</span> <span class="n">syl</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">syl</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">cur_y</span> <span class="o">+</span> <span class="n">syl</span><span class="o">.</span><span class="n">height</span>
                    <span class="n">syl</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">syl</span><span class="o">.</span><span class="n">middle</span>

                    <span class="n">cur_y</span> <span class="o">+=</span> <span class="n">syl</span><span class="o">.</span><span class="n">height</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_build_chars</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">,</span> <span class="n">font</span><span class="p">:</span> <span class="n">Font</span><span class="p">):</span>
            <span class="c1"># Chars are built from syllables: fallback to words if no syllables</span>
            <span class="n">words_or_syls</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">syls</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">syls</span> <span class="k">else</span> <span class="n">line</span><span class="o">.</span><span class="n">words</span>

            <span class="n">char_index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">words_or_syls</span><span class="p">:</span>
                <span class="n">el_text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">el</span><span class="o">.</span><span class="n">prespace</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">el</span><span class="o">.</span><span class="n">postspace</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">ci</span><span class="p">,</span> <span class="n">char_text</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">el_text</span><span class="p">)):</span>
                    <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_text_extents</span><span class="p">(</span><span class="n">char_text</span><span class="p">)</span>

                    <span class="n">char</span> <span class="o">=</span> <span class="n">Char</span><span class="p">(</span>
                        <span class="n">i</span><span class="o">=</span><span class="n">char_index</span><span class="p">,</span>
                        <span class="n">word_i</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="s2">&quot;word_i&quot;</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">i</span><span class="p">),</span>
                        <span class="n">syl_i</span><span class="o">=</span><span class="n">el</span><span class="o">.</span><span class="n">i</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">syls</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># -1 means no syllable</span>
                        <span class="n">syl_char_i</span><span class="o">=</span><span class="n">ci</span><span class="p">,</span>
                        <span class="n">start_time</span><span class="o">=</span><span class="n">el</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span>
                        <span class="n">end_time</span><span class="o">=</span><span class="n">el</span><span class="o">.</span><span class="n">end_time</span><span class="p">,</span>
                        <span class="n">styleref</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="p">,</span>
                        <span class="n">text</span><span class="o">=</span><span class="n">char_text</span><span class="p">,</span>
                        <span class="n">inline_fx</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="s2">&quot;inline_fx&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                        <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                        <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
                        <span class="n">x</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
                        <span class="n">y</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
                        <span class="n">left</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
                        <span class="n">center</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
                        <span class="n">right</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
                        <span class="n">top</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
                        <span class="n">middle</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
                        <span class="n">bottom</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span>
                    <span class="p">)</span>
                    <span class="n">char_index</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">line</span><span class="o">.</span><span class="n">chars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="n">line</span><span class="o">.</span><span class="n">left</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">play_res_x</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">play_res_y</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="p">):</span>
                <span class="k">return</span>

            <span class="n">h_group</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">alignment</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span>
            <span class="n">v_group</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">alignment</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">3</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">vertical_kanji</span> <span class="ow">or</span> <span class="n">v_group</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">cur_x</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">left</span>
                <span class="n">found_first_non_whitespace</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">chars</span><span class="p">:</span>
                    <span class="c1"># Horizontal position</span>
                    <span class="n">char</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">cur_x</span>
                    <span class="n">char</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">char</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">char</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">char</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">char</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">char</span><span class="o">.</span><span class="n">width</span>
                    <span class="n">char</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">char</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">char</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="n">char</span><span class="o">.</span><span class="n">right</span><span class="p">][</span><span class="n">h_group</span><span class="p">]</span>

                    <span class="c1"># Update cur_x after first visible character</span>
                    <span class="k">if</span> <span class="n">found_first_non_whitespace</span><span class="p">:</span>
                        <span class="n">cur_x</span> <span class="o">+=</span> <span class="n">char</span><span class="o">.</span><span class="n">width</span> <span class="o">+</span> <span class="n">style_spacing</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="n">char</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
                        <span class="n">found_first_non_whitespace</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">cur_x</span> <span class="o">+=</span> <span class="n">char</span><span class="o">.</span><span class="n">width</span> <span class="o">+</span> <span class="n">style_spacing</span>

                    <span class="c1"># Vertical position (copy from line)</span>
                    <span class="n">char</span><span class="o">.</span><span class="n">top</span><span class="p">,</span> <span class="n">char</span><span class="o">.</span><span class="n">middle</span><span class="p">,</span> <span class="n">char</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span> <span class="n">char</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">line</span><span class="o">.</span><span class="n">top</span><span class="p">,</span>
                        <span class="n">line</span><span class="o">.</span><span class="n">middle</span><span class="p">,</span>
                        <span class="n">line</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span>
                        <span class="n">line</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">max_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">char</span><span class="o">.</span><span class="n">width</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">chars</span><span class="p">)</span>
                <span class="n">sum_height</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">char</span><span class="o">.</span><span class="n">height</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">chars</span><span class="p">)</span>
                <span class="n">cur_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">play_res_y</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">sum_height</span> <span class="o">/</span> <span class="mi">2</span>

                <span class="c1"># Set line box metrics</span>
                <span class="n">line</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="n">cur_y</span>
                <span class="n">line</span><span class="o">.</span><span class="n">middle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">play_res_y</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">line</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">top</span> <span class="o">+</span> <span class="n">sum_height</span>
                <span class="n">line</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">max_width</span>
                <span class="n">line</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">sum_height</span>

                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">alignment</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">line</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">max_width</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">line</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">max_width</span>
                <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">alignment</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="n">line</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">center</span> <span class="o">-</span> <span class="n">max_width</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">line</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">max_width</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">line</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">right</span> <span class="o">-</span> <span class="n">max_width</span>
                    <span class="n">line</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">max_width</span> <span class="o">/</span> <span class="mi">2</span>

                <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">chars</span><span class="p">:</span>
                    <span class="c1"># Horizontal position</span>
                    <span class="n">x_fix</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_width</span> <span class="o">-</span> <span class="n">char</span><span class="o">.</span><span class="n">width</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">alignment</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="n">char</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">x_fix</span>
                    <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">alignment</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="n">char</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">play_res_x</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">char</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">char</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">right</span> <span class="o">-</span> <span class="n">char</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">x_fix</span>

                    <span class="n">char</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">char</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">char</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">char</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">char</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">char</span><span class="o">.</span><span class="n">width</span>
                    <span class="n">char</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">char</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">char</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="n">char</span><span class="o">.</span><span class="n">right</span><span class="p">][</span><span class="n">h_group</span><span class="p">]</span>

                    <span class="c1"># Vertical position</span>
                    <span class="n">char</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="n">cur_y</span>
                    <span class="n">char</span><span class="o">.</span><span class="n">middle</span> <span class="o">=</span> <span class="n">cur_y</span> <span class="o">+</span> <span class="n">char</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">char</span><span class="o">.</span><span class="n">bottom</span> <span class="o">=</span> <span class="n">cur_y</span> <span class="o">+</span> <span class="n">char</span><span class="o">.</span><span class="n">height</span>
                    <span class="n">char</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">char</span><span class="o">.</span><span class="n">middle</span>

                    <span class="n">cur_y</span> <span class="o">+=</span> <span class="n">char</span><span class="o">.</span><span class="n">height</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_assign_lead_times</span><span class="p">(</span><span class="n">lines_by_styles</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">lines</span> <span class="ow">in</span> <span class="n">lines_by_styles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># Sort lines by start_time</span>
                <span class="n">sorted_lines</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="o">.</span><span class="n">start_time</span><span class="p">)</span>

                <span class="c1"># Group consecutive lines with the same index &#39;i&#39;</span>
                <span class="n">grouped</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="nb">list</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">sorted_lines</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="o">.</span><span class="n">i</span><span class="p">)</span>
                <span class="p">]</span>

                <span class="c1"># Compute and assign leadin/leadout for each group</span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">grouped</span><span class="p">):</span>
                    <span class="n">prev_end</span> <span class="o">=</span> <span class="n">grouped</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">end_time</span> <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="n">next_start</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">grouped</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start_time</span>
                        <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">grouped</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                        <span class="k">else</span> <span class="kc">None</span>
                    <span class="p">)</span>

                    <span class="n">leadin</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="mi">1001</span> <span class="k">if</span> <span class="n">prev_end</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">group</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start_time</span> <span class="o">-</span> <span class="n">prev_end</span>
                    <span class="p">)</span>
                    <span class="n">leadout</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="mi">1001</span> <span class="k">if</span> <span class="n">next_start</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">next_start</span> <span class="o">-</span> <span class="n">group</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">end_time</span>
                    <span class="p">)</span>

                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
                        <span class="n">line</span><span class="o">.</span><span class="n">leadin</span> <span class="o">=</span> <span class="n">leadin</span>
                        <span class="n">line</span><span class="o">.</span><span class="n">leadout</span> <span class="o">=</span> <span class="n">leadout</span>

        <span class="c1"># Let the fun begin (Pyon!)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">,</span> <span class="n">new_lines_indices</span><span class="p">,</span> <span class="n">new_lines_k_offsets</span> <span class="o">=</span> <span class="n">_split_raw_segments</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lines</span>
        <span class="p">)</span>
        <span class="n">lines_by_styles</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Line</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">line</span><span class="p">,</span> <span class="n">split_index</span><span class="p">,</span> <span class="n">split_k_offset</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">,</span> <span class="n">new_lines_indices</span><span class="p">,</span> <span class="n">new_lines_k_offsets</span>
        <span class="p">):</span>
            <span class="c1"># Group lines by style for leadin/leadout calculation</span>
            <span class="n">lines_by_styles</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">style</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

            <span class="c1"># Get font metrics and spacing</span>
            <span class="n">font</span> <span class="o">=</span> <span class="n">Font</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="p">)</span>
            <span class="n">space_width</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_text_extents</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">style_spacing</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">styleref</span><span class="o">.</span><span class="n">spacing</span>

            <span class="c1"># Compute line fields</span>
            <span class="n">_compute_line_fields</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">split_index</span><span class="p">)</span>

            <span class="c1"># Build words</span>
            <span class="n">_build_words</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">font</span><span class="p">)</span>

            <span class="c1"># Build syllables</span>
            <span class="n">syllable_data</span> <span class="o">=</span> <span class="n">_parse_syllables</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">raw_text</span><span class="p">)</span>
            <span class="n">_build_syllables</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">syllable_data</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">split_k_offset</span><span class="p">)</span>

            <span class="c1"># Build chars</span>
            <span class="n">_build_chars</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">font</span><span class="p">)</span>

        <span class="c1"># Add leadin/leadout</span>
        <span class="n">_assign_lead_times</span><span class="p">(</span><span class="n">lines_by_styles</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">replace_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta</span><span class="p">:</span> <span class="n">Meta</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Replace metadata in the ASS output file.</span>

<span class="sd">        Args:</span>
<span class="sd">            meta: A Meta object containing the updated metadata.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; meta, _, _ = io.get_data()</span>
<span class="sd">            &gt;&gt;&gt; meta.wrap_style = 2</span>
<span class="sd">            &gt;&gt;&gt; io.replace_meta(meta)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">meta</span>
        <span class="n">new_script_lines</span><span class="p">,</span> <span class="n">new_garbage_lines</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">get_key</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">update_section</span><span class="p">(</span><span class="n">section</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Build a dictionary of new meta lines keyed by their meta key</span>
            <span class="n">new_meta</span> <span class="o">=</span> <span class="p">{</span><span class="n">get_key</span><span class="p">(</span><span class="n">line</span><span class="p">):</span> <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">new_lines</span> <span class="k">if</span> <span class="n">get_key</span><span class="p">(</span><span class="n">line</span><span class="p">)}</span>

            <span class="c1"># Locate the section header in the _output list</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">header_idx</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
                    <span class="n">i</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">section</span> <span class="o">==</span> <span class="s2">&quot;[Aegisub Project Garbage]&quot;</span><span class="p">:</span>
                    <span class="c1"># Insert the Aegisub Project Garbage section after [Script Info] if available</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">script_idx</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
                            <span class="n">i</span>
                            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;[Script Info]&quot;</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">end_script_idx</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
                            <span class="p">(</span>
                                <span class="n">j</span>
                                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">[</span><span class="n">script_idx</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:],</span> <span class="n">start</span><span class="o">=</span><span class="n">script_idx</span> <span class="o">+</span> <span class="mi">1</span>
                                <span class="p">)</span>
                                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)</span>
                            <span class="p">),</span>
                            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">),</span>
                        <span class="p">)</span>
                        <span class="n">insert_idx</span> <span class="o">=</span> <span class="n">end_script_idx</span>
                    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                        <span class="n">insert_idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">insert_idx</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">section</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">insert_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">header_idx</span> <span class="o">=</span> <span class="n">insert_idx</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">section</span><span class="si">}</span><span class="s2"> is not a valid section.&quot;</span><span class="p">)</span>

            <span class="c1"># Determine the end of the section (first line starting with &#39;[&#39; after header)</span>
            <span class="n">end_idx</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">next</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">j</span>
                        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">[</span><span class="n">header_idx</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:],</span> <span class="n">start</span><span class="o">=</span><span class="n">header_idx</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)</span>
                    <span class="p">),</span>
                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="o">-</span> <span class="mi">1</span>
            <span class="p">)</span>

            <span class="c1"># Update only the meta-related lines in this section</span>
            <span class="n">updated_block</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">new_meta</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">get_key</span><span class="p">(</span><span class="n">line</span><span class="p">),</span> <span class="n">line</span><span class="p">)</span> <span class="k">if</span> <span class="n">get_key</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">else</span> <span class="n">line</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">[</span><span class="n">header_idx</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">end_idx</span><span class="p">]</span>
            <span class="p">]</span>

            <span class="c1"># Append any new meta lines not already present</span>
            <span class="n">updated_block</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_meta</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">[:</span> <span class="n">header_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">updated_block</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">[</span><span class="n">end_idx</span><span class="p">:]</span>
            <span class="p">)</span>

        <span class="n">update_section</span><span class="p">(</span><span class="s2">&quot;[Script Info]&quot;</span><span class="p">,</span> <span class="n">new_script_lines</span><span class="p">)</span>
        <span class="n">update_section</span><span class="p">(</span><span class="s2">&quot;[Aegisub Project Garbage]&quot;</span><span class="p">,</span> <span class="n">new_garbage_lines</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">replace_style</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">style_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">style</span><span class="p">:</span> <span class="n">Style</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Replace an existing style in the ASS output file.</span>

<span class="sd">        Args:</span>
<span class="sd">            style_name: The name of the style to be replaced.</span>
<span class="sd">            style: A Style object containing the updated style parameters.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; style = styles[&#39;Default&#39;]</span>
<span class="sd">            &gt;&gt;&gt; style.fontname = &#39;Helvetica&#39;</span>
<span class="sd">            &gt;&gt;&gt; io.replace_style(&#39;Default&#39;, style)</span>

<span class="sd">        See Also:</span>
<span class="sd">            [add_style][pyonfx.ass_core.Ass.add_style]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">style_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Style </span><span class="si">{</span><span class="n">style_name</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>

        <span class="c1"># Update the style in the dictionary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="p">[</span><span class="n">style_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">style</span>

        <span class="c1"># Serialize the new style</span>
        <span class="n">new_style_line</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">style_name</span><span class="p">)</span>

        <span class="c1"># Update the corresponding style line in the _output list</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">):</span>
            <span class="n">stripped_line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">stripped_line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Style:&quot;</span><span class="p">):</span>
                <span class="n">parts</span> <span class="o">=</span> <span class="n">stripped_line</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="s2">&quot;Style:&quot;</span><span class="p">)</span> <span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">parts</span> <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="n">style_name</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_style_line</span>
                    <span class="k">break</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_style</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">style_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">style</span><span class="p">:</span> <span class="n">Style</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a new style to the ASS output file.</span>

<span class="sd">        Args:</span>
<span class="sd">            style_name: The name for the new style. This name must be unique within the ASS file.</span>
<span class="sd">            style: A Style object containing the styling parameters for the new style.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; new_style = Style(name=&quot;NewStyle&quot;, fontname=&quot;Arial&quot;, fontsize=20, color1=&quot;FFFFFF&quot;, alpha1=&quot;00&quot;,</span>
<span class="sd">            ...                    color2=&quot;FFFFFF&quot;, alpha2=&quot;00&quot;, color3=&quot;000000&quot;, alpha3=&quot;0000&quot;,</span>
<span class="sd">            ...                    color4=&quot;000000&quot;, alpha4=&quot;0000&quot;, bold=False, italic=False, underline=False,</span>
<span class="sd">            ...                    strikeout=False, scale_x=100, scale_y=100, spacing=0, angle=0, border_style=False,</span>
<span class="sd">            ...                    outline=0, shadow=0, alignment=7, margin_l=0, margin_r=0, margin_v=0, encoding=1)</span>
<span class="sd">            &gt;&gt;&gt; io.add_style(&quot;NewStyle&quot;, new_style)</span>

<span class="sd">        Notes:</span>
<span class="sd">            Ensure that the style name is unique in the current styles mapping.</span>

<span class="sd">        See Also:</span>
<span class="sd">            [replace_style][pyonfx.ass_core.Ass.replace_style]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">style_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Style </span><span class="si">{</span><span class="n">style_name</span><span class="si">}</span><span class="s2"> already exists.&quot;</span><span class="p">)</span>

        <span class="n">insertion_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">in_styles_section</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">):</span>
            <span class="n">stripped</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">stripped</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;V4+ Styles&quot;</span> <span class="ow">in</span> <span class="n">stripped</span><span class="p">:</span>
                <span class="n">in_styles_section</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">in_styles_section</span> <span class="ow">and</span> <span class="n">stripped</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">):</span>
                <span class="n">insertion_index</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">insertion_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">insertion_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">)</span>

        <span class="n">style_line</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">style_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">insertion_index</span><span class="p">,</span> <span class="n">style_line</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="p">[</span><span class="n">style_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">style</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Meta</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Style</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="n">Line</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve metadata, styles, and subtitle lines from the ASS file.</span>

<span class="sd">        This utility method returns the essential components of a parsed ASS file:</span>

<span class="sd">        - meta: A Meta object containing configuration and metadata.</span>
<span class="sd">        - styles: A dictionary mapping style names to their corresponding Style objects.</span>
<span class="sd">        - lines: A list of Line objects representing the subtitle dialogue events.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: A tuple containing the meta object, the dictionary of styles, and the list of subtitle lines.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; meta, styles, lines = ass.get_data()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">write_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write a subtitle line to the output buffer.</span>

<span class="sd">        Args:</span>
<span class="sd">            line: A Line object representing a subtitle event.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; line = some_line_object  # a valid Line object</span>
<span class="sd">            &gt;&gt;&gt; io.write_line(line)</span>

<span class="sd">        Notes:</span>
<span class="sd">            This method only updates the internal buffer; you must call save() to persist the changes to disk.</span>

<span class="sd">        See Also:</span>
<span class="sd">            [save][pyonfx.ass_core.Ass.save]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">serialize</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plines</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the processed subtitles to the output ASS file and print performance metrics.</span>

<span class="sd">        Args:</span>
<span class="sd">            quiet: If True, suppresses the output messages during the save process. Defaults to False.</span>

<span class="sd">        Notes:</span>
<span class="sd">            Make sure to call this method after all subtitle processing is complete to persist your changes.</span>

<span class="sd">        See Also:</span>
<span class="sd">            [open_aegisub][pyonfx.ass_core.Ass.open_aegisub], [open_mpv][pyonfx.ass_core.Ass.open_mpv]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Add script generation info</span>
        <span class="n">header_idx</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
            <span class="n">i</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;[Script Info]&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">start_idx</span> <span class="o">=</span> <span class="n">header_idx</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">end_idx</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">i</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">found_generated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">start_idx</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">end_idx</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">stripped</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">stripped</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;; http:&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">end_idx</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">stripped</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;; Script generated by&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;; Script generated by PyonFX</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">found_generated</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">found_generated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="s2">&quot;; Script generated by PyonFX</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Writing to file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_output</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8-sig&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_extradata</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[Aegisub Extradata]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_extradata</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_saved</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">quiet</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">total_runtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ptime</span>
        <span class="n">avg_per_gen_line</span> <span class="o">=</span> <span class="n">total_runtime</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plines</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plines</span> <span class="k">else</span> <span class="mf">0.0</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Produced lines: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_plines</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;  Total runtime: </span><span class="si">{</span><span class="n">total_runtime</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; (avg </span><span class="si">{</span><span class="n">avg_per_gen_line</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">s per generated line)&quot;</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stats_by_effect</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> STATISTICS&quot;</span><span class="p">)</span>

            <span class="n">table_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">eff</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stats_by_effect</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">calls</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;calls&quot;</span><span class="p">]</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;lines&quot;</span><span class="p">]</span>
                <span class="n">time_s</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
                <span class="n">avg_call</span> <span class="o">=</span> <span class="n">time_s</span> <span class="o">/</span> <span class="n">calls</span> <span class="k">if</span> <span class="n">calls</span> <span class="k">else</span> <span class="mf">0.0</span>

                <span class="n">table_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">eff</span><span class="p">,</span>
                        <span class="n">calls</span><span class="p">,</span>
                        <span class="n">lines</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_s</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">avg_call</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">)</span>

            <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Calls&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Lines&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Time (s)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Avg/Call (s)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Avg/Line (s)&quot;</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="n">tabulate</span><span class="p">(</span>
                    <span class="n">table_data</span><span class="p">,</span>
                    <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                    <span class="n">tablefmt</span><span class="o">=</span><span class="s2">&quot;rounded_grid&quot;</span><span class="p">,</span>
                    <span class="n">numalign</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">open_aegisub</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Attempt to open the output ASS file in Aegisub.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the output file is successfully opened in Aegisub, False otherwise.</span>

<span class="sd">        Notes:</span>
<span class="sd">            Make sure to call the save() method before invoking open_aegisub, or the output file may not exist.</span>

<span class="sd">        See Also:</span>
<span class="sd">            `open_mpv`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check if it was saved</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_saved</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;[WARNING] You&#39;ve tried to open the output with Aegisub before having saved. Check your code.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;win32&quot;</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">startfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_output</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s2">&quot;aegisub&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_output</span><span class="p">)])</span>
            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING] Aegisub not found.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">open_mpv</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">video_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">video_start</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">full_screen</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">extra_mpv_options</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="n">aegisub_fallback</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Open the output subtitle file in MPV media player along with the associated video.</span>

<span class="sd">        This method attempts to play the output ASS file using MPV and automatically handles subtitle hot-reload via an IPC socket.</span>
<span class="sd">        If an existing MPV instance is detected, it sends a command to reload the subtitles;</span>
<span class="sd">        if not, it launches a new MPV process with IPC enabled.</span>

<span class="sd">        Args:</span>
<span class="sd">            video_path: The absolute path to the video file to be played. If None, the video path from meta.video is used.</span>
<span class="sd">            video_start: The starting time for video playback (e.g., &quot;00:01:23&quot;); if None, playback starts from the beginning.</span>
<span class="sd">            full_screen: If True, launches MPV in full-screen mode; otherwise, in windowed mode.</span>
<span class="sd">            extra_mpv_options: Additional command-line options to pass to MPV.</span>
<span class="sd">            aegisub_fallback: If True, falls back to opening the output with Aegisub when MPV is not found.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if MPV successfully launches or hot-reloads the subtitles; False otherwise.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; io.open_mpv(video_path=&quot;/path/to/video.mp4&quot;, full_screen=True)</span>

<span class="sd">        See Also:</span>
<span class="sd">            [open_aegisub][pyonfx.ass_core.Ass.open_aegisub]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_saved</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;[ERROR] You&#39;ve tried to open the output with MPV before having saved. Check your code.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;mpv&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">aegisub_fallback</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;[WARNING] MPV not found in your environment variables&quot;</span>
                    <span class="s2">&quot;(please refer to the documentation&#39;s &#39;Quick Start&#39; section).</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;Falling back to Aegisub.&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">open_aegisub</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;[ERROR] MPV not found in your environment variables&quot;</span>
                    <span class="s2">&quot;(please refer to the documentation&#39;s &#39;Quick Start&#39; section).</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;Exiting.&quot;</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">video_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">video</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;?dummy&quot;</span><span class="p">):</span>
                <span class="n">video_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">video</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;[ERROR] No video file specified and meta.video is None or is a dummy video.&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Define IPC socket path for mpv communication</span>
        <span class="n">ipc_socket</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">.\pipe\mpv_pyonfx&quot;</span> <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;win32&quot;</span> <span class="k">else</span> <span class="s2">&quot;/tmp/mpv_pyonfx&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Attempt hot-reload</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;win32&quot;</span> <span class="ow">and</span> <span class="s2">&quot;mpv_pyonfx&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">.\pipe&quot;</span><span class="p">)</span>
        <span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ipc_socket</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;win32&quot;</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ipc_socket</span><span class="p">,</span> <span class="s2">&quot;r+b&quot;</span><span class="p">,</span> <span class="n">buffering</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">as</span> <span class="n">pipe</span><span class="p">:</span>
                        <span class="n">pipe</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                            <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sub-reload&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
                            <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">with</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_UNIX</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span> <span class="k">as</span> <span class="n">sock</span><span class="p">:</span>
                        <span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">ipc_socket</span><span class="p">)</span>
                        <span class="n">sock</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span>
                            <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sub-reload&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
                            <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hot-reload: Subtitles reloaded in existing mpv instance.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hot-reload failed with OSError:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Build command to launch mpv with IPC enabled</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mpv&quot;</span><span class="p">,</span> <span class="s2">&quot;--input-ipc-server=&quot;</span> <span class="o">+</span> <span class="n">ipc_socket</span><span class="p">]</span>
        <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">video_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;--start=&quot;</span> <span class="o">+</span> <span class="n">video_start</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">full_screen</span><span class="p">:</span>
            <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;--fs&quot;</span><span class="p">)</span>
        <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;--sub-file=&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_output</span><span class="p">)</span>
        <span class="n">cmd</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">extra_mpv_options</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;[WARNING] MPV not found in your environment variables.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Please refer to the documentation&#39;s &#39;Quick Start&#39; section.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">track</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Decorator to track function performance, gathering timing statistics and monitoring progress.</span>

<span class="sd">        This decorator automatically measures execution time, counts function calls,</span>
<span class="sd">        and tracks the number of lines produced by the decorated function.</span>
<span class="sd">        All statistics are displayed in the final output when save() is called.</span>

<span class="sd">        Usage::</span>

<span class="sd">            @io.track</span>
<span class="sd">            def my_function(...):</span>
<span class="sd">                ...</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
            <span class="n">prev_produced_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plines</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
                <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stats_by_effect</span><span class="p">[</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span>
                <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;calls&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;lines&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plines</span> <span class="o">-</span> <span class="n">prev_produced_lines</span>
                <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>

        <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="pyonfx.ass_core.Ass.PIXEL_STYLE" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">PIXEL_STYLE</span> <span class="o">=</span> <span class="n">Style</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="n">fontname</span><span class="o">=</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color1</span><span class="o">=</span><span class="s1">&#39;FFFFFF&#39;</span><span class="p">,</span> <span class="n">alpha1</span><span class="o">=</span><span class="s1">&#39;00&#39;</span><span class="p">,</span> <span class="n">color2</span><span class="o">=</span><span class="s1">&#39;FFFFFF&#39;</span><span class="p">,</span> <span class="n">alpha2</span><span class="o">=</span><span class="s1">&#39;00&#39;</span><span class="p">,</span> <span class="n">color3</span><span class="o">=</span><span class="s1">&#39;000000&#39;</span><span class="p">,</span> <span class="n">alpha3</span><span class="o">=</span><span class="s1">&#39;0000&#39;</span><span class="p">,</span> <span class="n">color4</span><span class="o">=</span><span class="s1">&#39;000000&#39;</span><span class="p">,</span> <span class="n">alpha4</span><span class="o">=</span><span class="s1">&#39;0000&#39;</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">italic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">underline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">strikeout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scale_x</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">scale_y</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">border_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">outline</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alignment</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">margin_l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">margin_r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">margin_v</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Lightweight style for pixels.</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="pyonfx.ass_core.Ass.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">path_input</span><span class="p">,</span> <span class="n">path_output</span><span class="o">=</span><span class="s1">&#39;output.ass&#39;</span><span class="p">,</span> <span class="n">keep_original</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">extended</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vertical_kanji</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize the ASS object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path_input</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path for the input ASS file, which can be relative or absolute.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_output</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path for the output ASS file (default: "output.ass").</p>
              </div>
            </td>
            <td>
                  <code>&#39;output.ass&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>keep_original</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, the original lines are kept as comments in the output.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>extended</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, extended information (including positioning, metrics, words, syllables, and characters) will be computed.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vertical_kanji</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, lines with alignment 4, 5 or 6 will be repositioned vertically.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>pyonfx/ass_core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">path_input</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">path_output</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;output.ass&quot;</span><span class="p">,</span>
    <span class="n">keep_original</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">extended</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">vertical_kanji</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the ASS object.</span>

<span class="sd">    Args:</span>
<span class="sd">        path_input: The path for the input ASS file, which can be relative or absolute.</span>
<span class="sd">        path_output: The path for the output ASS file (default: &quot;output.ass&quot;).</span>
<span class="sd">        keep_original: If True, the original lines are kept as comments in the output.</span>
<span class="sd">        extended: If True, extended information (including positioning, metrics, words, syllables, and characters) will be computed.</span>
<span class="sd">        vertical_kanji: If True, lines with alignment 4, 5 or 6 will be repositioned vertically.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Progress/statistics</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_saved</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_plines</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Total produced lines</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_ptime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>  <span class="c1"># Total processing time</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_stats_by_effect</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lines&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;calls&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="c1"># Output buffers</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_output_extradata</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Public attributes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span> <span class="n">Meta</span> <span class="o">=</span> <span class="n">Meta</span><span class="p">(</span>
        <span class="n">wrap_style</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">scaled_border_and_shadow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">play_res_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">play_res_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">audio</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">video</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">timestamps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Style</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Line</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Getting absolute sub file path</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">path_input</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">_resolve_path</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">path_input</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_input</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
            <span class="s2">&quot;Invalid path for the Subtitle file: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_input</span>
        <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">path_output</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">_resolve_path</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">path_output</span><span class="p">)</span>

    <span class="c1"># Parse the ASS file</span>
    <span class="n">current_section</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">line_index</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_input</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8-sig&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
            <span class="c1"># New section?</span>
            <span class="n">section_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\[([^\]]*)\]&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">section_match</span><span class="p">:</span>
                <span class="n">current_section</span> <span class="o">=</span> <span class="n">section_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">current_section</span> <span class="o">!=</span> <span class="s2">&quot;Aegisub Extradata&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Copy-paste lines</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Format&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="c1"># Sections parsers</span>
            <span class="k">elif</span> <span class="n">current_section</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Script Info&quot;</span><span class="p">,</span> <span class="s2">&quot;Aegisub Project Garbage&quot;</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">parse_line</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_input</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">current_section</span> <span class="o">==</span> <span class="s2">&quot;V4+ Styles&quot;</span><span class="p">:</span>
                <span class="n">style</span> <span class="o">=</span> <span class="n">Style</span><span class="o">.</span><span class="n">from_ass_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="p">[</span><span class="n">style</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">style</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">current_section</span> <span class="o">==</span> <span class="s2">&quot;Events&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Line</span><span class="o">.</span><span class="n">from_ass_line</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">line_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">keep_original</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(Dialogue|Comment):&quot;</span><span class="p">,</span> <span class="s2">&quot;Comment:&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="n">line_index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">current_section</span> <span class="o">==</span> <span class="s2">&quot;Aegisub Extradata&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_output_extradata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span>
                <span class="n">current_section</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="p">):</span>  <span class="c1"># Non-empty line in unknown section</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Unexpected section in the input file: [</span><span class="si">{</span><span class="n">current_section</span><span class="si">}</span><span class="s2">]&quot;</span>
                <span class="p">)</span>

    <span class="c1"># Add extended information to lines and meta?</span>
    <span class="k">if</span> <span class="n">extended</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process_extended_line_data</span><span class="p">(</span><span class="n">vertical_kanji</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.ass_core.Ass.replace_meta" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">replace_meta</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Replace metadata in the ASS output file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>meta</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Meta


  
      dataclass
   (pyonfx.ass_core.Meta)" href="#pyonfx.ass_core.Meta">Meta</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A Meta object containing the updated metadata.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="o">.</span><span class="n">wrap_style</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">io</span><span class="o">.</span><span class="n">replace_meta</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>pyonfx/ass_core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">replace_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta</span><span class="p">:</span> <span class="n">Meta</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Replace metadata in the ASS output file.</span>

<span class="sd">    Args:</span>
<span class="sd">        meta: A Meta object containing the updated metadata.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; meta, _, _ = io.get_data()</span>
<span class="sd">        &gt;&gt;&gt; meta.wrap_style = 2</span>
<span class="sd">        &gt;&gt;&gt; io.replace_meta(meta)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">meta</span>
    <span class="n">new_script_lines</span><span class="p">,</span> <span class="n">new_garbage_lines</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_key</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_section</span><span class="p">(</span><span class="n">section</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Build a dictionary of new meta lines keyed by their meta key</span>
        <span class="n">new_meta</span> <span class="o">=</span> <span class="p">{</span><span class="n">get_key</span><span class="p">(</span><span class="n">line</span><span class="p">):</span> <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">new_lines</span> <span class="k">if</span> <span class="n">get_key</span><span class="p">(</span><span class="n">line</span><span class="p">)}</span>

        <span class="c1"># Locate the section header in the _output list</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">header_idx</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
                <span class="n">i</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">section</span> <span class="o">==</span> <span class="s2">&quot;[Aegisub Project Garbage]&quot;</span><span class="p">:</span>
                <span class="c1"># Insert the Aegisub Project Garbage section after [Script Info] if available</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">script_idx</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
                        <span class="n">i</span>
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;[Script Info]&quot;</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">end_script_idx</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
                        <span class="p">(</span>
                            <span class="n">j</span>
                            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">[</span><span class="n">script_idx</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:],</span> <span class="n">start</span><span class="o">=</span><span class="n">script_idx</span> <span class="o">+</span> <span class="mi">1</span>
                            <span class="p">)</span>
                            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)</span>
                        <span class="p">),</span>
                        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">),</span>
                    <span class="p">)</span>
                    <span class="n">insert_idx</span> <span class="o">=</span> <span class="n">end_script_idx</span>
                <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                    <span class="n">insert_idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">insert_idx</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">section</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">insert_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">header_idx</span> <span class="o">=</span> <span class="n">insert_idx</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">section</span><span class="si">}</span><span class="s2"> is not a valid section.&quot;</span><span class="p">)</span>

        <span class="c1"># Determine the end of the section (first line starting with &#39;[&#39; after header)</span>
        <span class="n">end_idx</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">next</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">j</span>
                    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">[</span><span class="n">header_idx</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:],</span> <span class="n">start</span><span class="o">=</span><span class="n">header_idx</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="o">-</span> <span class="mi">1</span>
        <span class="p">)</span>

        <span class="c1"># Update only the meta-related lines in this section</span>
        <span class="n">updated_block</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">new_meta</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">get_key</span><span class="p">(</span><span class="n">line</span><span class="p">),</span> <span class="n">line</span><span class="p">)</span> <span class="k">if</span> <span class="n">get_key</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">else</span> <span class="n">line</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">[</span><span class="n">header_idx</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">end_idx</span><span class="p">]</span>
        <span class="p">]</span>

        <span class="c1"># Append any new meta lines not already present</span>
        <span class="n">updated_block</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_meta</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">[:</span> <span class="n">header_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">updated_block</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">[</span><span class="n">end_idx</span><span class="p">:]</span>
        <span class="p">)</span>

    <span class="n">update_section</span><span class="p">(</span><span class="s2">&quot;[Script Info]&quot;</span><span class="p">,</span> <span class="n">new_script_lines</span><span class="p">)</span>
    <span class="n">update_section</span><span class="p">(</span><span class="s2">&quot;[Aegisub Project Garbage]&quot;</span><span class="p">,</span> <span class="n">new_garbage_lines</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.ass_core.Ass.replace_style" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">replace_style</span><span class="p">(</span><span class="n">style_name</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Replace an existing style in the ASS output file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>style_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the style to be replaced.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>style</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Style


  
      dataclass
   (pyonfx.ass_core.Style)" href="#pyonfx.ass_core.Style">Style</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A Style object containing the updated style parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">style</span> <span class="o">=</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Default&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">style</span><span class="o">.</span><span class="n">fontname</span> <span class="o">=</span> <span class="s1">&#39;Helvetica&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">io</span><span class="o">.</span><span class="n">replace_style</span><span class="p">(</span><span class="s1">&#39;Default&#39;</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>
</code></pre></div>


<details class="see-also" open>
  <summary>See Also</summary>
  <p><a class="autorefs autorefs-internal" title="add_style(style_name, style)" href="#pyonfx.ass_core.Ass.add_style">add_style</a></p>
</details>

            <details class="quote">
              <summary>Source code in <code>pyonfx/ass_core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">replace_style</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">style_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">style</span><span class="p">:</span> <span class="n">Style</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Replace an existing style in the ASS output file.</span>

<span class="sd">    Args:</span>
<span class="sd">        style_name: The name of the style to be replaced.</span>
<span class="sd">        style: A Style object containing the updated style parameters.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; style = styles[&#39;Default&#39;]</span>
<span class="sd">        &gt;&gt;&gt; style.fontname = &#39;Helvetica&#39;</span>
<span class="sd">        &gt;&gt;&gt; io.replace_style(&#39;Default&#39;, style)</span>

<span class="sd">    See Also:</span>
<span class="sd">        [add_style][pyonfx.ass_core.Ass.add_style]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">style_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Style </span><span class="si">{</span><span class="n">style_name</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>

    <span class="c1"># Update the style in the dictionary</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="p">[</span><span class="n">style_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">style</span>

    <span class="c1"># Serialize the new style</span>
    <span class="n">new_style_line</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">style_name</span><span class="p">)</span>

    <span class="c1"># Update the corresponding style line in the _output list</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">):</span>
        <span class="n">stripped_line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">stripped_line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Style:&quot;</span><span class="p">):</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">stripped_line</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="s2">&quot;Style:&quot;</span><span class="p">)</span> <span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">parts</span> <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="n">style_name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_style_line</span>
                <span class="k">break</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.ass_core.Ass.add_style" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_style</span><span class="p">(</span><span class="n">style_name</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Add a new style to the ASS output file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>style_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name for the new style. This name must be unique within the ASS file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>style</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Style


  
      dataclass
   (pyonfx.ass_core.Style)" href="#pyonfx.ass_core.Style">Style</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A Style object containing the styling parameters for the new style.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">new_style</span> <span class="o">=</span> <span class="n">Style</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;NewStyle&quot;</span><span class="p">,</span> <span class="n">fontname</span><span class="o">=</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color1</span><span class="o">=</span><span class="s2">&quot;FFFFFF&quot;</span><span class="p">,</span> <span class="n">alpha1</span><span class="o">=</span><span class="s2">&quot;00&quot;</span><span class="p">,</span>
<span class="gp">... </span>                   <span class="n">color2</span><span class="o">=</span><span class="s2">&quot;FFFFFF&quot;</span><span class="p">,</span> <span class="n">alpha2</span><span class="o">=</span><span class="s2">&quot;00&quot;</span><span class="p">,</span> <span class="n">color3</span><span class="o">=</span><span class="s2">&quot;000000&quot;</span><span class="p">,</span> <span class="n">alpha3</span><span class="o">=</span><span class="s2">&quot;0000&quot;</span><span class="p">,</span>
<span class="gp">... </span>                   <span class="n">color4</span><span class="o">=</span><span class="s2">&quot;000000&quot;</span><span class="p">,</span> <span class="n">alpha4</span><span class="o">=</span><span class="s2">&quot;0000&quot;</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">italic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">underline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="gp">... </span>                   <span class="n">strikeout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scale_x</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">scale_y</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">border_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="gp">... </span>                   <span class="n">outline</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alignment</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">margin_l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">margin_r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">margin_v</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">io</span><span class="o">.</span><span class="n">add_style</span><span class="p">(</span><span class="s2">&quot;NewStyle&quot;</span><span class="p">,</span> <span class="n">new_style</span><span class="p">)</span>
</code></pre></div>


<details class="notes" open>
  <summary>Notes</summary>
  <p>Ensure that the style name is unique in the current styles mapping.</p>
</details>

<details class="see-also" open>
  <summary>See Also</summary>
  <p><a class="autorefs autorefs-internal" title="replace_style(style_name, style)" href="#pyonfx.ass_core.Ass.replace_style">replace_style</a></p>
</details>

            <details class="quote">
              <summary>Source code in <code>pyonfx/ass_core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_style</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">style_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">style</span><span class="p">:</span> <span class="n">Style</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a new style to the ASS output file.</span>

<span class="sd">    Args:</span>
<span class="sd">        style_name: The name for the new style. This name must be unique within the ASS file.</span>
<span class="sd">        style: A Style object containing the styling parameters for the new style.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; new_style = Style(name=&quot;NewStyle&quot;, fontname=&quot;Arial&quot;, fontsize=20, color1=&quot;FFFFFF&quot;, alpha1=&quot;00&quot;,</span>
<span class="sd">        ...                    color2=&quot;FFFFFF&quot;, alpha2=&quot;00&quot;, color3=&quot;000000&quot;, alpha3=&quot;0000&quot;,</span>
<span class="sd">        ...                    color4=&quot;000000&quot;, alpha4=&quot;0000&quot;, bold=False, italic=False, underline=False,</span>
<span class="sd">        ...                    strikeout=False, scale_x=100, scale_y=100, spacing=0, angle=0, border_style=False,</span>
<span class="sd">        ...                    outline=0, shadow=0, alignment=7, margin_l=0, margin_r=0, margin_v=0, encoding=1)</span>
<span class="sd">        &gt;&gt;&gt; io.add_style(&quot;NewStyle&quot;, new_style)</span>

<span class="sd">    Notes:</span>
<span class="sd">        Ensure that the style name is unique in the current styles mapping.</span>

<span class="sd">    See Also:</span>
<span class="sd">        [replace_style][pyonfx.ass_core.Ass.replace_style]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">style_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Style </span><span class="si">{</span><span class="n">style_name</span><span class="si">}</span><span class="s2"> already exists.&quot;</span><span class="p">)</span>

    <span class="n">insertion_index</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">in_styles_section</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">):</span>
        <span class="n">stripped</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">stripped</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;V4+ Styles&quot;</span> <span class="ow">in</span> <span class="n">stripped</span><span class="p">:</span>
            <span class="n">in_styles_section</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">in_styles_section</span> <span class="ow">and</span> <span class="n">stripped</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">):</span>
            <span class="n">insertion_index</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="n">insertion_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">insertion_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">)</span>

    <span class="n">style_line</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">style_name</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">insertion_index</span><span class="p">,</span> <span class="n">style_line</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="p">[</span><span class="n">style_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">style</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.ass_core.Ass.get_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_data</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Retrieve metadata, styles, and subtitle lines from the ASS file.</p>
<p>This utility method returns the essential components of a parsed ASS file:</p>
<ul>
<li>meta: A Meta object containing configuration and metadata.</li>
<li>styles: A dictionary mapping style names to their corresponding Style objects.</li>
<li>lines: A list of Line objects representing the subtitle dialogue events.</li>
</ul>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
                  <code><span title="tuple">tuple</span>[<a class="autorefs autorefs-internal" title="Meta


  
      dataclass
   (pyonfx.ass_core.Meta)" href="#pyonfx.ass_core.Meta">Meta</a>, <span title="dict">dict</span>[<span title="str">str</span>, <a class="autorefs autorefs-internal" title="Style


  
      dataclass
   (pyonfx.ass_core.Style)" href="#pyonfx.ass_core.Style">Style</a>], <span title="list">list</span>[<a class="autorefs autorefs-internal" title="Line


  
      dataclass
   (pyonfx.ass_core.Line)" href="#pyonfx.ass_core.Line">Line</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the meta object, the dictionary of styles, and the list of subtitle lines.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="p">,</span> <span class="n">styles</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">ass</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>pyonfx/ass_core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Meta</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Style</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="n">Line</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve metadata, styles, and subtitle lines from the ASS file.</span>

<span class="sd">    This utility method returns the essential components of a parsed ASS file:</span>

<span class="sd">    - meta: A Meta object containing configuration and metadata.</span>
<span class="sd">    - styles: A dictionary mapping style names to their corresponding Style objects.</span>
<span class="sd">    - lines: A list of Line objects representing the subtitle dialogue events.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing the meta object, the dictionary of styles, and the list of subtitle lines.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; meta, styles, lines = ass.get_data()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.ass_core.Ass.write_line" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Write a subtitle line to the output buffer.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>line</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Line


  
      dataclass
   (pyonfx.ass_core.Line)" href="#pyonfx.ass_core.Line">Line</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A Line object representing a subtitle event.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">line</span> <span class="o">=</span> <span class="n">some_line_object</span>  <span class="c1"># a valid Line object</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">io</span><span class="o">.</span><span class="n">write_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</code></pre></div>


<details class="notes" open>
  <summary>Notes</summary>
  <p>This method only updates the internal buffer; you must call save() to persist the changes to disk.</p>
</details>

<details class="see-also" open>
  <summary>See Also</summary>
  <p><a class="autorefs autorefs-internal" title="save(quiet=False)" href="#pyonfx.ass_core.Ass.save">save</a></p>
</details>

            <details class="quote">
              <summary>Source code in <code>pyonfx/ass_core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="n">Line</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write a subtitle line to the output buffer.</span>

<span class="sd">    Args:</span>
<span class="sd">        line: A Line object representing a subtitle event.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; line = some_line_object  # a valid Line object</span>
<span class="sd">        &gt;&gt;&gt; io.write_line(line)</span>

<span class="sd">    Notes:</span>
<span class="sd">        This method only updates the internal buffer; you must call save() to persist the changes to disk.</span>

<span class="sd">    See Also:</span>
<span class="sd">        [save][pyonfx.ass_core.Ass.save]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">serialize</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_plines</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.ass_core.Ass.save" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save</span><span class="p">(</span><span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Save the processed subtitles to the output ASS file and print performance metrics.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>quiet</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, suppresses the output messages during the save process. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <p>Make sure to call this method after all subtitle processing is complete to persist your changes.</p>
</details>

<details class="see-also" open>
  <summary>See Also</summary>
  <p><a class="autorefs autorefs-internal" title="open_aegisub()" href="#pyonfx.ass_core.Ass.open_aegisub">open_aegisub</a>, <a class="autorefs autorefs-internal" title="open_mpv(video_path=None, *, video_start=None, full_screen=False, extra_mpv_options=[], aegisub_fallback=True)" href="#pyonfx.ass_core.Ass.open_mpv">open_mpv</a></p>
</details>

            <details class="quote">
              <summary>Source code in <code>pyonfx/ass_core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save the processed subtitles to the output ASS file and print performance metrics.</span>

<span class="sd">    Args:</span>
<span class="sd">        quiet: If True, suppresses the output messages during the save process. Defaults to False.</span>

<span class="sd">    Notes:</span>
<span class="sd">        Make sure to call this method after all subtitle processing is complete to persist your changes.</span>

<span class="sd">    See Also:</span>
<span class="sd">        [open_aegisub][pyonfx.ass_core.Ass.open_aegisub], [open_mpv][pyonfx.ass_core.Ass.open_mpv]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Add script generation info</span>
    <span class="n">header_idx</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
        <span class="n">i</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;[Script Info]&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">start_idx</span> <span class="o">=</span> <span class="n">header_idx</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">end_idx</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
        <span class="p">(</span>
            <span class="n">i</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)</span>
        <span class="p">),</span>
        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">found_generated</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">start_idx</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">end_idx</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">stripped</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">stripped</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;; http:&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">end_idx</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">stripped</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;; Script generated by&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;; Script generated by PyonFX</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">found_generated</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">found_generated</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="s2">&quot;; Script generated by PyonFX</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Writing to file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_output</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8-sig&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_extradata</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[Aegisub Extradata]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_extradata</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_saved</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">quiet</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">total_runtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ptime</span>
    <span class="n">avg_per_gen_line</span> <span class="o">=</span> <span class="n">total_runtime</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plines</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plines</span> <span class="k">else</span> <span class="mf">0.0</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Produced lines: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_plines</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;  Total runtime: </span><span class="si">{</span><span class="n">total_runtime</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s&quot;</span>
        <span class="sa">f</span><span class="s2">&quot; (avg </span><span class="si">{</span><span class="n">avg_per_gen_line</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">s per generated line)&quot;</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stats_by_effect</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> STATISTICS&quot;</span><span class="p">)</span>

        <span class="n">table_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">eff</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stats_by_effect</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">calls</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;calls&quot;</span><span class="p">]</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;lines&quot;</span><span class="p">]</span>
            <span class="n">time_s</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
            <span class="n">avg_call</span> <span class="o">=</span> <span class="n">time_s</span> <span class="o">/</span> <span class="n">calls</span> <span class="k">if</span> <span class="n">calls</span> <span class="k">else</span> <span class="mf">0.0</span>

            <span class="n">table_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">eff</span><span class="p">,</span>
                    <span class="n">calls</span><span class="p">,</span>
                    <span class="n">lines</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_s</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">avg_call</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;Name&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Calls&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Lines&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Time (s)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Avg/Call (s)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Avg/Line (s)&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="n">tabulate</span><span class="p">(</span>
                <span class="n">table_data</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                <span class="n">tablefmt</span><span class="o">=</span><span class="s2">&quot;rounded_grid&quot;</span><span class="p">,</span>
                <span class="n">numalign</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.ass_core.Ass.open_aegisub" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">open_aegisub</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Attempt to open the output ASS file in Aegisub.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the output file is successfully opened in Aegisub, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <p>Make sure to call the save() method before invoking open_aegisub, or the output file may not exist.</p>
</details>

<details class="see-also" open>
  <summary>See Also</summary>
  <p><code>open_mpv</code></p>
</details>

            <details class="quote">
              <summary>Source code in <code>pyonfx/ass_core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">open_aegisub</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Attempt to open the output ASS file in Aegisub.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the output file is successfully opened in Aegisub, False otherwise.</span>

<span class="sd">    Notes:</span>
<span class="sd">        Make sure to call the save() method before invoking open_aegisub, or the output file may not exist.</span>

<span class="sd">    See Also:</span>
<span class="sd">        `open_mpv`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check if it was saved</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_saved</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;[WARNING] You&#39;ve tried to open the output with Aegisub before having saved. Check your code.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;win32&quot;</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">startfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_output</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s2">&quot;aegisub&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_output</span><span class="p">)])</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[WARNING] Aegisub not found.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.ass_core.Ass.open_mpv" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">open_mpv</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">video_start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">full_screen</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">extra_mpv_options</span><span class="o">=</span><span class="p">[],</span> <span class="n">aegisub_fallback</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Open the output subtitle file in MPV media player along with the associated video.</p>
<p>This method attempts to play the output ASS file using MPV and automatically handles subtitle hot-reload via an IPC socket.
If an existing MPV instance is detected, it sends a command to reload the subtitles;
if not, it launches a new MPV process with IPC enabled.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>video_path</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The absolute path to the video file to be played. If None, the video path from meta.video is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>video_start</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The starting time for video playback (e.g., "00:01:23"); if None, playback starts from the beginning.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>full_screen</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, launches MPV in full-screen mode; otherwise, in windowed mode.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>extra_mpv_options</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional command-line options to pass to MPV.</p>
              </div>
            </td>
            <td>
                  <code>[]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aegisub_fallback</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, falls back to opening the output with Aegisub when MPV is not found.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if MPV successfully launches or hot-reloads the subtitles; False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">io</span><span class="o">.</span><span class="n">open_mpv</span><span class="p">(</span><span class="n">video_path</span><span class="o">=</span><span class="s2">&quot;/path/to/video.mp4&quot;</span><span class="p">,</span> <span class="n">full_screen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>


<details class="see-also" open>
  <summary>See Also</summary>
  <p><a class="autorefs autorefs-internal" title="open_aegisub()" href="#pyonfx.ass_core.Ass.open_aegisub">open_aegisub</a></p>
</details>

            <details class="quote">
              <summary>Source code in <code>pyonfx/ass_core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">open_mpv</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">video_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">video_start</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">full_screen</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">extra_mpv_options</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="n">aegisub_fallback</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Open the output subtitle file in MPV media player along with the associated video.</span>

<span class="sd">    This method attempts to play the output ASS file using MPV and automatically handles subtitle hot-reload via an IPC socket.</span>
<span class="sd">    If an existing MPV instance is detected, it sends a command to reload the subtitles;</span>
<span class="sd">    if not, it launches a new MPV process with IPC enabled.</span>

<span class="sd">    Args:</span>
<span class="sd">        video_path: The absolute path to the video file to be played. If None, the video path from meta.video is used.</span>
<span class="sd">        video_start: The starting time for video playback (e.g., &quot;00:01:23&quot;); if None, playback starts from the beginning.</span>
<span class="sd">        full_screen: If True, launches MPV in full-screen mode; otherwise, in windowed mode.</span>
<span class="sd">        extra_mpv_options: Additional command-line options to pass to MPV.</span>
<span class="sd">        aegisub_fallback: If True, falls back to opening the output with Aegisub when MPV is not found.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if MPV successfully launches or hot-reloads the subtitles; False otherwise.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; io.open_mpv(video_path=&quot;/path/to/video.mp4&quot;, full_screen=True)</span>

<span class="sd">    See Also:</span>
<span class="sd">        [open_aegisub][pyonfx.ass_core.Ass.open_aegisub]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_saved</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;[ERROR] You&#39;ve tried to open the output with MPV before having saved. Check your code.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;mpv&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">aegisub_fallback</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;[WARNING] MPV not found in your environment variables&quot;</span>
                <span class="s2">&quot;(please refer to the documentation&#39;s &#39;Quick Start&#39; section).</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Falling back to Aegisub.&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">open_aegisub</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;[ERROR] MPV not found in your environment variables&quot;</span>
                <span class="s2">&quot;(please refer to the documentation&#39;s &#39;Quick Start&#39; section).</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Exiting.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">video_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">video</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">video</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;?dummy&quot;</span><span class="p">):</span>
            <span class="n">video_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">video</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;[ERROR] No video file specified and meta.video is None or is a dummy video.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Define IPC socket path for mpv communication</span>
    <span class="n">ipc_socket</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">.\pipe\mpv_pyonfx&quot;</span> <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;win32&quot;</span> <span class="k">else</span> <span class="s2">&quot;/tmp/mpv_pyonfx&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Attempt hot-reload</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;win32&quot;</span> <span class="ow">and</span> <span class="s2">&quot;mpv_pyonfx&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">.\pipe&quot;</span><span class="p">)</span>
    <span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ipc_socket</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;win32&quot;</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ipc_socket</span><span class="p">,</span> <span class="s2">&quot;r+b&quot;</span><span class="p">,</span> <span class="n">buffering</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">as</span> <span class="n">pipe</span><span class="p">:</span>
                    <span class="n">pipe</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sub-reload&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
                        <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_UNIX</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span> <span class="k">as</span> <span class="n">sock</span><span class="p">:</span>
                    <span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">ipc_socket</span><span class="p">)</span>
                    <span class="n">sock</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span>
                        <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sub-reload&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
                        <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hot-reload: Subtitles reloaded in existing mpv instance.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hot-reload failed with OSError:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Build command to launch mpv with IPC enabled</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mpv&quot;</span><span class="p">,</span> <span class="s2">&quot;--input-ipc-server=&quot;</span> <span class="o">+</span> <span class="n">ipc_socket</span><span class="p">]</span>
    <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">video_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">video_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;--start=&quot;</span> <span class="o">+</span> <span class="n">video_start</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">full_screen</span><span class="p">:</span>
        <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;--fs&quot;</span><span class="p">)</span>
    <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;--sub-file=&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_output</span><span class="p">)</span>
    <span class="n">cmd</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">extra_mpv_options</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;[WARNING] MPV not found in your environment variables.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Please refer to the documentation&#39;s &#39;Quick Start&#39; section.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.ass_core.Ass.track" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">track</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Decorator to track function performance, gathering timing statistics and monitoring progress.</p>
<p>This decorator automatically measures execution time, counts function calls,
and tracks the number of lines produced by the decorated function.
All statistics are displayed in the final output when save() is called.</p>
<p>Usage::</p>
<pre><code>@io.track
def my_function(...):
    ...
</code></pre>


            <details class="quote">
              <summary>Source code in <code>pyonfx/ass_core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">track</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorator to track function performance, gathering timing statistics and monitoring progress.</span>

<span class="sd">    This decorator automatically measures execution time, counts function calls,</span>
<span class="sd">    and tracks the number of lines produced by the decorated function.</span>
<span class="sd">    All statistics are displayed in the final output when save() is called.</span>

<span class="sd">    Usage::</span>

<span class="sd">        @io.track</span>
<span class="sd">        def my_function(...):</span>
<span class="sd">            ...</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
        <span class="n">prev_produced_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plines</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
            <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stats_by_effect</span><span class="p">[</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span>
            <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;calls&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;lines&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plines</span> <span class="o">-</span> <span class="n">prev_produced_lines</span>
            <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>

    <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../" class="md-footer__link md-footer__link--prev" aria-label="Previous: Module index">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Module index
              </div>
            </div>
          </a>
        
        
          
          <a href="../convert/" class="md-footer__link md-footer__link--next" aria-label="Next: convert">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                convert
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2019-2025 Antonio Strippoli (CoffeeStraw) and <a href="https://github.com/CoffeeStraw/PyonFX/graphs/contributors"><u>contributors</u></a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections", "navigation.footer", "content.footnote.tooltips", "content.code.copy"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.50899def.min.js"></script>
      
    
  </body>
</html>

<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="PyonFX documentation.
">
      
      
        <meta name="author" content="CoffeeStraw">
      
      
      
        <link rel="prev" href="../pixel/">
      
      
        <link rel="next" href="../utils/">
      
      
      <link rel="icon" href="../../static/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>shape - PyonFX</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#shape" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="PyonFX" class="md-header__button md-logo" aria-label="PyonFX" data-md-component="logo">
      
  <img src="../../static/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PyonFX
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              shape
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/CoffeeStraw/PyonFX" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    CoffeeStraw/PyonFX
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="PyonFX" class="md-nav__button md-logo" aria-label="PyonFX" data-md-component="logo">
      
  <img src="../../static/logo.png" alt="logo">

    </a>
    PyonFX
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/CoffeeStraw/PyonFX" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    CoffeeStraw/PyonFX
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/installing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Install & Set-up
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    First Steps
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            First Steps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/0-first-steps/01-explore-ass-values/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exploring ASS values
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/0-first-steps/02-hello-world/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hello World
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/0-first-steps/03-time-and-space/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Timing & Positioning
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/0-first-steps/04-text-segmentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Text Segmentation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Beginner
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Beginner
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/1-beginner/01-first-kfx/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    First Karaoke Effect
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/1-beginner/02-first-kfx-organized/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Organizing Your First KFX
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/1-beginner/03-romaji-kanji-translation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Romaji, Kanji & Translation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Intermediate
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Intermediate
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/2-intermediate/01-variations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Variations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/2-intermediate/02-shapes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Shapes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Advanced
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Advanced
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/3-advanced/01-frame-by-frame/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Frame-by-Frame
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/404" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TBD
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Module index
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ass_core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ass_core
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../convert/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    convert
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pixel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pixel
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    shape
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    shape
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pyonfx.shape" class="md-nav__link">
    <span class="md-ellipsis">
      shape
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyonfx.shape.ShapeElement" class="md-nav__link">
    <span class="md-ellipsis">
      ShapeElement
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ShapeElement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.ShapeElement.command" class="md-nav__link">
    <span class="md-ellipsis">
      command
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.ShapeElement.coordinates" class="md-nav__link">
    <span class="md-ellipsis">
      coordinates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.ShapeElement.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.ShapeElement.from_ass_drawing_cmd" class="md-nav__link">
    <span class="md-ellipsis">
      from_ass_drawing_cmd
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape" class="md-nav__link">
    <span class="md-ellipsis">
      Shape
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Shape">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.elements" class="md-nav__link">
    <span class="md-ellipsis">
      elements
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.drawing_cmds" class="md-nav__link">
    <span class="md-ellipsis">
      drawing_cmds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.PIXEL" class="md-nav__link">
    <span class="md-ellipsis">
      PIXEL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.to_multipolygon" class="md-nav__link">
    <span class="md-ellipsis">
      to_multipolygon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.from_multipolygon" class="md-nav__link">
    <span class="md-ellipsis">
      from_multipolygon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.bounding" class="md-nav__link">
    <span class="md-ellipsis">
      bounding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.boolean" class="md-nav__link">
    <span class="md-ellipsis">
      boolean
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.map" class="md-nav__link">
    <span class="md-ellipsis">
      map
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.move" class="md-nav__link">
    <span class="md-ellipsis">
      move
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.align" class="md-nav__link">
    <span class="md-ellipsis">
      align
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.scale" class="md-nav__link">
    <span class="md-ellipsis">
      scale
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.rotate" class="md-nav__link">
    <span class="md-ellipsis">
      rotate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.shear" class="md-nav__link">
    <span class="md-ellipsis">
      shear
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.flatten" class="md-nav__link">
    <span class="md-ellipsis">
      flatten
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.split" class="md-nav__link">
    <span class="md-ellipsis">
      split
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.buffer" class="md-nav__link">
    <span class="md-ellipsis">
      buffer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.morph" class="md-nav__link">
    <span class="md-ellipsis">
      morph
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.morph_multi" class="md-nav__link">
    <span class="md-ellipsis">
      morph_multi
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.triangle" class="md-nav__link">
    <span class="md-ellipsis">
      triangle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.rectangle" class="md-nav__link">
    <span class="md-ellipsis">
      rectangle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.square" class="md-nav__link">
    <span class="md-ellipsis">
      square
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.rounded_rectangle" class="md-nav__link">
    <span class="md-ellipsis">
      rounded_rectangle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.polygon" class="md-nav__link">
    <span class="md-ellipsis">
      polygon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.ellipse" class="md-nav__link">
    <span class="md-ellipsis">
      ellipse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.circle" class="md-nav__link">
    <span class="md-ellipsis">
      circle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.ring" class="md-nav__link">
    <span class="md-ellipsis">
      ring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.heart" class="md-nav__link">
    <span class="md-ellipsis">
      heart
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.star" class="md-nav__link">
    <span class="md-ellipsis">
      star
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.glance" class="md-nav__link">
    <span class="md-ellipsis">
      glance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Explanation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Explanation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanation/404" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    TBD
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pyonfx.shape" class="md-nav__link">
    <span class="md-ellipsis">
      shape
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyonfx.shape.ShapeElement" class="md-nav__link">
    <span class="md-ellipsis">
      ShapeElement
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ShapeElement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.ShapeElement.command" class="md-nav__link">
    <span class="md-ellipsis">
      command
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.ShapeElement.coordinates" class="md-nav__link">
    <span class="md-ellipsis">
      coordinates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.ShapeElement.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.ShapeElement.from_ass_drawing_cmd" class="md-nav__link">
    <span class="md-ellipsis">
      from_ass_drawing_cmd
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape" class="md-nav__link">
    <span class="md-ellipsis">
      Shape
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Shape">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.elements" class="md-nav__link">
    <span class="md-ellipsis">
      elements
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.drawing_cmds" class="md-nav__link">
    <span class="md-ellipsis">
      drawing_cmds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.PIXEL" class="md-nav__link">
    <span class="md-ellipsis">
      PIXEL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.to_multipolygon" class="md-nav__link">
    <span class="md-ellipsis">
      to_multipolygon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.from_multipolygon" class="md-nav__link">
    <span class="md-ellipsis">
      from_multipolygon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.bounding" class="md-nav__link">
    <span class="md-ellipsis">
      bounding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.boolean" class="md-nav__link">
    <span class="md-ellipsis">
      boolean
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.map" class="md-nav__link">
    <span class="md-ellipsis">
      map
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.move" class="md-nav__link">
    <span class="md-ellipsis">
      move
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.align" class="md-nav__link">
    <span class="md-ellipsis">
      align
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.scale" class="md-nav__link">
    <span class="md-ellipsis">
      scale
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.rotate" class="md-nav__link">
    <span class="md-ellipsis">
      rotate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.shear" class="md-nav__link">
    <span class="md-ellipsis">
      shear
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.flatten" class="md-nav__link">
    <span class="md-ellipsis">
      flatten
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.split" class="md-nav__link">
    <span class="md-ellipsis">
      split
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.buffer" class="md-nav__link">
    <span class="md-ellipsis">
      buffer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.morph" class="md-nav__link">
    <span class="md-ellipsis">
      morph
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.morph_multi" class="md-nav__link">
    <span class="md-ellipsis">
      morph_multi
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.triangle" class="md-nav__link">
    <span class="md-ellipsis">
      triangle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.rectangle" class="md-nav__link">
    <span class="md-ellipsis">
      rectangle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.square" class="md-nav__link">
    <span class="md-ellipsis">
      square
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.rounded_rectangle" class="md-nav__link">
    <span class="md-ellipsis">
      rounded_rectangle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.polygon" class="md-nav__link">
    <span class="md-ellipsis">
      polygon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.ellipse" class="md-nav__link">
    <span class="md-ellipsis">
      ellipse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.circle" class="md-nav__link">
    <span class="md-ellipsis">
      circle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.ring" class="md-nav__link">
    <span class="md-ellipsis">
      ring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.heart" class="md-nav__link">
    <span class="md-ellipsis">
      heart
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.star" class="md-nav__link">
    <span class="md-ellipsis">
      star
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyonfx.shape.Shape.glance" class="md-nav__link">
    <span class="md-ellipsis">
      glance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="shape">Shape</h1>


<div class="doc doc-object doc-module">



<a id="pyonfx.shape"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="pyonfx.shape.ShapeElement" class="doc doc-heading">
            <code>ShapeElement</code>


</h2>


    <div class="doc doc-contents ">


        <p>Represents a single ASS drawing command and its associated coordinates.</p>
<p>This class encapsulates a drawing command used in the ASS format and stores the related coordinates
as <code>shapely.geometry.Point</code> objects. It validates the command against allowed values ("m", "n", "l", "p", "b", "s", "c")
and provides utility methods for creating and representing these commands.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="command = command

  
      instance-attribute
   (pyonfx.shape.ShapeElement.command)" href="#pyonfx.shape.ShapeElement.command">command</a></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The drawing command (e.g., "m", "n", "l", "p", "b", "s", "c").</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="coordinates = coordinates

  
      instance-attribute
   (pyonfx.shape.ShapeElement.coordinates)" href="#pyonfx.shape.ShapeElement.coordinates">coordinates</a></code></td>
            <td>
                  <code><span title="list">list</span>[<span title="shapely.geometry.Point">Point</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of <code>Point</code> objects representing the coordinate pairs.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="see-also" open>
  <summary>See Also</summary>
  <p><a class="autorefs autorefs-internal" href="#pyonfx.shape.Shape"><code>Shape</code></a></p>
</details>






              <details class="quote">
                <summary>Source code in <code>pyonfx/shape.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ShapeElement</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a single ASS drawing command and its associated coordinates.</span>

<span class="sd">    This class encapsulates a drawing command used in the ASS format and stores the related coordinates</span>
<span class="sd">    as `shapely.geometry.Point` objects. It validates the command against allowed values (&quot;m&quot;, &quot;n&quot;, &quot;l&quot;, &quot;p&quot;, &quot;b&quot;, &quot;s&quot;, &quot;c&quot;)</span>
<span class="sd">    and provides utility methods for creating and representing these commands.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        command: The drawing command (e.g., &quot;m&quot;, &quot;n&quot;, &quot;l&quot;, &quot;p&quot;, &quot;b&quot;, &quot;s&quot;, &quot;c&quot;).</span>
<span class="sd">        coordinates: A list of `Point` objects representing the coordinate pairs.</span>

<span class="sd">    See Also:</span>
<span class="sd">        [`Shape`][pyonfx.shape.Shape]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">command</span><span class="p">:</span> <span class="nb">str</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The drawing command (one of &quot;m&quot;, &quot;n&quot;, &quot;l&quot;, &quot;p&quot;, &quot;b&quot;, &quot;s&quot;, &quot;c&quot;).&quot;&quot;&quot;</span>
    <span class="n">coordinates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List of `Point` objects representing the coordinate pairs for this command.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a ShapeElement instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            command: The ASS drawing command. Allowed values are &quot;m&quot;, &quot;n&quot;, &quot;l&quot;, &quot;p&quot;, &quot;b&quot;, &quot;s&quot;, &quot;c&quot;.</span>
<span class="sd">            coordinates: A list of `Point` objects representing the coordinate pairs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">command</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">}:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid command &#39;</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="n">command</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">coordinates</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">coord_strs</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Point(</span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span><span class="p">]</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;ShapeElement(&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">command</span><span class="si">}</span><span class="s2">&#39;, [</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">coord_strs</span><span class="p">)</span><span class="si">}</span><span class="s2">])&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ShapeElement</span><span class="p">)</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">command</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">coordinates</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_ass_drawing_cmd</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="s2">&quot;ShapeElement&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse an ASS drawing command into one or more ShapeElement instances.</span>

<span class="sd">        Since some commands can be implicit, this method can return more than one element.</span>

<span class="sd">        Args:</span>
<span class="sd">            command: The ASS drawing command. Must be one of &quot;m&quot;, &quot;n&quot;, &quot;l&quot;, &quot;p&quot;, &quot;b&quot;, &quot;s&quot;, &quot;c&quot;.</span>
<span class="sd">            *args: A sequence of string arguments representing numeric values for coordinates.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[ShapeElement]: A list of ShapeElement instances created from the command.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - Command &#39;c&#39; does not accept any arguments.</span>
<span class="sd">            - Command &#39;l&#39; returns one element for each encountered coordinate.</span>
<span class="sd">            - Command &#39;b&#39; groups coordinates into sets of three.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Every ASS drawing command requires an even number of arguments (got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">Point</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid arguments (expected floats) for command &#39;</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">args</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">match</span> <span class="n">command</span><span class="p">:</span>
            <span class="k">case</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Command &#39;c&#39; does not take any arguments&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">[</span><span class="bp">cls</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="p">[])]</span>

            <span class="k">case</span> <span class="s2">&quot;m&quot;</span> <span class="o">|</span> <span class="s2">&quot;n&quot;</span> <span class="o">|</span> <span class="s2">&quot;p&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Command &#39;</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">&#39; requires exactly 1 coordinate pair&quot;</span>
                    <span class="p">)</span>
                <span class="k">return</span> <span class="p">[</span><span class="bp">cls</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">coords</span><span class="p">)]</span>

            <span class="k">case</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Command &#39;s&#39; requires at least 3 coordinate pairs&quot;</span>
                    <span class="p">)</span>
                <span class="k">return</span> <span class="p">[</span><span class="bp">cls</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">coords</span><span class="p">)]</span>

            <span class="k">case</span> <span class="s2">&quot;l&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">coords</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Command &#39;l&#39; requires at least 1 coordinate pair&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">[</span><span class="bp">cls</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="p">[</span><span class="n">c</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">]</span>

            <span class="k">case</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">coords</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;Command &#39;b&#39; requires a number of coordinate pairs multiple of 3&quot;</span>
                    <span class="p">)</span>

                <span class="k">return</span> <span class="p">[</span>
                    <span class="bp">cls</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">coords</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
                <span class="p">]</span>

            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected command &#39;</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="pyonfx.shape.ShapeElement.command" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">command</span> <span class="o">=</span> <span class="n">command</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>The drawing command (one of "m", "n", "l", "p", "b", "s", "c").</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="pyonfx.shape.ShapeElement.coordinates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">coordinates</span> <span class="o">=</span> <span class="n">coordinates</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>List of <code>Point</code> objects representing the coordinate pairs for this command.</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="pyonfx.shape.ShapeElement.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize a ShapeElement instance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>command</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ASS drawing command. Allowed values are "m", "n", "l", "p", "b", "s", "c".</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>coordinates</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="shapely.geometry.Point">Point</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of <code>Point</code> objects representing the coordinate pairs.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>pyonfx/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize a ShapeElement instance.</span>

<span class="sd">    Args:</span>
<span class="sd">        command: The ASS drawing command. Allowed values are &quot;m&quot;, &quot;n&quot;, &quot;l&quot;, &quot;p&quot;, &quot;b&quot;, &quot;s&quot;, &quot;c&quot;.</span>
<span class="sd">        coordinates: A list of `Point` objects representing the coordinate pairs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">command</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">}:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid command &#39;</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="n">command</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">coordinates</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.shape.ShapeElement.from_ass_drawing_cmd" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_ass_drawing_cmd</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Parse an ASS drawing command into one or more ShapeElement instances.</p>
<p>Since some commands can be implicit, this method can return more than one element.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>command</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ASS drawing command. Must be one of "m", "n", "l", "p", "b", "s", "c".</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>*args</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A sequence of string arguments representing numeric values for coordinates.</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="ShapeElement (pyonfx.shape.ShapeElement)" href="#pyonfx.shape.ShapeElement">ShapeElement</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[ShapeElement]: A list of ShapeElement instances created from the command.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>Command 'c' does not accept any arguments.</li>
<li>Command 'l' returns one element for each encountered coordinate.</li>
<li>Command 'b' groups coordinates into sets of three.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>pyonfx/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_ass_drawing_cmd</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="s2">&quot;ShapeElement&quot;</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse an ASS drawing command into one or more ShapeElement instances.</span>

<span class="sd">    Since some commands can be implicit, this method can return more than one element.</span>

<span class="sd">    Args:</span>
<span class="sd">        command: The ASS drawing command. Must be one of &quot;m&quot;, &quot;n&quot;, &quot;l&quot;, &quot;p&quot;, &quot;b&quot;, &quot;s&quot;, &quot;c&quot;.</span>
<span class="sd">        *args: A sequence of string arguments representing numeric values for coordinates.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[ShapeElement]: A list of ShapeElement instances created from the command.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - Command &#39;c&#39; does not accept any arguments.</span>
<span class="sd">        - Command &#39;l&#39; returns one element for each encountered coordinate.</span>
<span class="sd">        - Command &#39;b&#39; groups coordinates into sets of three.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Every ASS drawing command requires an even number of arguments (got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Point</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Invalid arguments (expected floats) for command &#39;</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">args</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">match</span> <span class="n">command</span><span class="p">:</span>
        <span class="k">case</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Command &#39;c&#39; does not take any arguments&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">cls</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="p">[])]</span>

        <span class="k">case</span> <span class="s2">&quot;m&quot;</span> <span class="o">|</span> <span class="s2">&quot;n&quot;</span> <span class="o">|</span> <span class="s2">&quot;p&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Command &#39;</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">&#39; requires exactly 1 coordinate pair&quot;</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">cls</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">coords</span><span class="p">)]</span>

        <span class="k">case</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Command &#39;s&#39; requires at least 3 coordinate pairs&quot;</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">cls</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">coords</span><span class="p">)]</span>

        <span class="k">case</span> <span class="s2">&quot;l&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">coords</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Command &#39;l&#39; requires at least 1 coordinate pair&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">cls</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="p">[</span><span class="n">c</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">]</span>

        <span class="k">case</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">coords</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Command &#39;b&#39; requires a number of coordinate pairs multiple of 3&quot;</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="p">[</span>
                <span class="bp">cls</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">coords</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
            <span class="p">]</span>

        <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected command &#39;</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pyonfx.shape.Shape" class="doc doc-heading">
            <code>Shape</code>


</h2>


    <div class="doc doc-contents ">


        <p>High-level container for ASS drawing commands.</p>
<p>This class represents a vector outline for ASS subtitles, storing its geometry as a sequence of <a class="autorefs autorefs-internal" href="#pyonfx.shape.ShapeElement"><code>ShapeElement</code></a> objects.
It dynamically generates an ASS drawing command string from its internal elements, ensuring consistency between the geometry and its textual representation.
The <code>Shape</code> class provides numerous methods for geometric transformations (e.g., move, scale, rotate, shear), analysis (e.g., bounding box computation), boolean operations, and morphing.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="elements

  
      instance-attribute
   (pyonfx.shape.Shape.elements)" href="#pyonfx.shape.Shape.elements">elements</a></code></td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="ShapeElement (pyonfx.shape.ShapeElement)" href="#pyonfx.shape.ShapeElement">ShapeElement</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of drawing command elements representing the shape outline.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="drawing_cmds

  
      property
   (pyonfx.shape.Shape.drawing_cmds)" href="#pyonfx.shape.Shape.drawing_cmds">drawing_cmds</a></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dynamically generated ASS drawing command string derived from <code>elements</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">shape</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="s2">&quot;m 0 0 l 10 0 10 10&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">shape</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="go">&#39;m 5 5 l 15 5 15 15&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">shape</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
</code></pre></div>


<details class="notes" open>
  <summary>Notes</summary>
  <p>Transformations typically return a new <code>Shape</code> instance to allow method chaining.</p>
</details>

<details class="see-also" open>
  <summary>See Also</summary>
  <p><a class="autorefs autorefs-internal" href="#pyonfx.shape.ShapeElement"><code>ShapeElement</code></a></p>
</details>






              <details class="quote">
                <summary>Source code in <code>pyonfx/shape.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Shape</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;High-level container for ASS drawing commands.</span>

<span class="sd">    This class represents a vector outline for ASS subtitles, storing its geometry as a sequence of [`ShapeElement`][pyonfx.shape.ShapeElement] objects.</span>
<span class="sd">    It dynamically generates an ASS drawing command string from its internal elements, ensuring consistency between the geometry and its textual representation.</span>
<span class="sd">    The `Shape` class provides numerous methods for geometric transformations (e.g., move, scale, rotate, shear), analysis (e.g., bounding box computation), boolean operations, and morphing.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        elements: List of drawing command elements representing the shape outline.</span>
<span class="sd">        drawing_cmds: The dynamically generated ASS drawing command string derived from `elements`.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; shape = Shape(&quot;m 0 0 l 10 0 10 10&quot;)</span>
<span class="sd">        &gt;&gt;&gt; shape.move(5, 5)</span>
<span class="sd">        &#39;m 5 5 l 15 5 15 15&#39;</span>
<span class="sd">        &gt;&gt;&gt; for element in shape:</span>
<span class="sd">        ...     print(element)</span>

<span class="sd">    Notes:</span>
<span class="sd">        Transformations typically return a new `Shape` instance to allow method chaining.</span>

<span class="sd">    See Also:</span>
<span class="sd">        [`ShapeElement`][pyonfx.shape.ShapeElement]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">elements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ShapeElement</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The shape&#39;s elements as a list of :class:`ShapeElement` objects.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drawing_cmds</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">elements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ShapeElement</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]):</span>
        <span class="c1"># Assure that drawing_cmds is a string</span>
        <span class="k">if</span> <span class="n">drawing_cmds</span> <span class="ow">and</span> <span class="n">elements</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot pass both drawing_cmds and elements.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">drawing_cmds</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="n">Shape</span><span class="o">.</span><span class="n">_cmds_to_elements</span><span class="p">(</span><span class="n">drawing_cmds</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="n">elements</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># We return drawing commands as a string rapresentation of the object</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">drawing_cmds</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;Shape&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">drawing_cmds</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">drawing_cmds</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">drawing_cmds</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The shape&#39;s drawing commands in ASS format as a string.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Shape</span><span class="o">.</span><span class="n">_elements_to_cmds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_cmds_to_elements</span><span class="p">(</span><span class="n">drawing_cmds</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ShapeElement</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parses the drawing commands string and updates the internal list of ShapeElement objects.&quot;&quot;&quot;</span>
        <span class="n">cmds_and_points</span> <span class="o">=</span> <span class="n">drawing_cmds</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cmds_and_points</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">all_commands</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">}</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmds_and_points</span><span class="p">):</span>
            <span class="n">command</span> <span class="o">=</span> <span class="n">cmds_and_points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">command</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_commands</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected command &#39;</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">start_args</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmds_and_points</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cmds_and_points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_commands</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">args</span> <span class="o">=</span> <span class="n">cmds_and_points</span><span class="p">[</span><span class="n">start_args</span><span class="p">:</span><span class="n">i</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">ShapeElement</span><span class="o">.</span><span class="n">from_ass_drawing_cmd</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
                <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">elements</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_elements_to_cmds</span><span class="p">(</span><span class="n">elements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ShapeElement</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a Shape string from a list of ShapeElement objects.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">elements</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;m 0 0&quot;</span>

        <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">prev_command</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">command</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;c&quot;</span><span class="p">}:</span>
                <span class="c1"># Commands with no coordinates</span>
                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">command</span><span class="p">)</span>
                <span class="n">prev_command</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">command</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Commands with coordinates</span>
                <span class="n">coord_strs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">:</span>
                    <span class="n">coord_strs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">Shape</span><span class="o">.</span><span class="n">format_value</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="n">Shape</span><span class="o">.</span><span class="n">format_value</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">)]</span>
                    <span class="p">)</span>

                <span class="c1"># Check if we can use implicit command (for consecutive &quot;l&quot; or &quot;b&quot; commands)</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">element</span><span class="o">.</span><span class="n">command</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">}</span>
                    <span class="ow">and</span> <span class="n">element</span><span class="o">.</span><span class="n">command</span> <span class="o">==</span> <span class="n">prev_command</span>
                    <span class="ow">and</span> <span class="n">coord_strs</span>
                <span class="p">):</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">coord_strs</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">element</span><span class="o">.</span><span class="n">command</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">coord_strs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="n">prev_command</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">command</span>

        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">format_value</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">prec</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># Utility function to properly format values for shapes also returning them as a string</span>
        <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">prec</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;0&quot;</span> <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="s2">&quot;-0&quot;</span> <span class="k">else</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_multipolygon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MultiPolygon</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the shape to a Shapely MultiPolygon.</span>

<span class="sd">        It processes the shape into individual closed loops that are then assembled into polygons with proper shell-hole relationships.</span>
<span class="sd">        It automatically calls [`flatten`][pyonfx.shape.Shape.flatten] to convert curves into straight line segments.</span>

<span class="sd">        Args:</span>
<span class="sd">            tolerance: The tolerance angle in degrees used to determine when a bezier curve is considered flat. Higher values yield lower accuracy but faster processing.</span>

<span class="sd">        Returns:</span>
<span class="sd">            MultiPolygon: A MultiPolygon where each polygon consists of an outer shell (and optional holes) representing distinct contours of the shape.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; shape = Shape(&quot;m 0 0 l 10 0 10 10 l 0 10 c&quot;)</span>
<span class="sd">            &gt;&gt;&gt; mp = shape.to_multipolygon(tolerance=1.0)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Work on a copy to avoid modifying the original shape</span>
        <span class="n">shape_copy</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drawing_cmds</span><span class="p">)</span>

        <span class="c1"># 1. Ensure the outline is fully linear by flattening Bziers.</span>
        <span class="n">shape_copy</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">tolerance</span><span class="p">)</span>

        <span class="c1"># 2. Extract individual closed loops (contours).</span>
        <span class="n">loops</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current_loop</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">shape_copy</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">command</span>
            <span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">current_loop</span><span class="p">:</span>
                    <span class="n">loops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_loop</span><span class="p">)</span>
                <span class="n">current_loop</span> <span class="o">=</span> <span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">}:</span>
                <span class="n">current_loop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">current_loop</span><span class="p">:</span>
            <span class="n">loops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_loop</span><span class="p">)</span>

        <span class="c1"># 3. Convert loops to Shapely polygons (without holes yet).</span>
        <span class="n">loop_polys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Polygon</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pts</span> <span class="ow">in</span> <span class="n">loops</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="c1"># Degenerate loop  ignore.</span>
                <span class="k">continue</span>
            <span class="n">loop_polys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Polygon</span><span class="p">(</span><span class="n">pts</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">loop_polys</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MultiPolygon</span><span class="p">([])</span>

        <span class="c1"># 4. Sort by descending area magnitude so that larger shells are processed first.</span>
        <span class="n">loop_polys</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">area</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">shells</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Polygon</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">holes_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Polygon</span><span class="p">,</span> <span class="nb">set</span><span class="p">[</span><span class="n">Polygon</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">loop_poly</span> <span class="ow">in</span> <span class="n">loop_polys</span><span class="p">:</span>
            <span class="c1"># Try to place the loop as a hole inside an existing shell.</span>
            <span class="k">for</span> <span class="n">shell</span> <span class="ow">in</span> <span class="n">shells</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">shell</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">loop_poly</span><span class="p">):</span>
                    <span class="n">holes_map</span><span class="p">[</span><span class="n">shell</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">loop_poly</span><span class="p">)</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># It&#39;s a new outer shell.</span>
                <span class="n">shells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loop_poly</span><span class="p">)</span>
                <span class="n">holes_map</span><span class="p">[</span><span class="n">loop_poly</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="c1"># 5. Build compound polygons with their holes.</span>
        <span class="n">compounds</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Polygon</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">shell</span> <span class="ow">in</span> <span class="n">shells</span><span class="p">:</span>
            <span class="n">holes</span> <span class="o">=</span> <span class="n">holes_map</span><span class="p">[</span><span class="n">shell</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">holes</span><span class="p">:</span>
                <span class="n">compound</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">shell</span><span class="o">.</span><span class="n">exterior</span><span class="p">,</span> <span class="p">[</span><span class="n">h</span><span class="o">.</span><span class="n">exterior</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">holes</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">compound</span> <span class="o">=</span> <span class="n">shell</span>
            <span class="n">compounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">compound</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">MultiPolygon</span><span class="p">(</span><span class="n">compounds</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_multipolygon</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">multipolygon</span><span class="p">:</span> <span class="n">MultiPolygon</span><span class="p">,</span> <span class="n">min_point_spacing</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a Shape instance from a Shapely MultiPolygon.</span>

<span class="sd">        Args:</span>
<span class="sd">            multipolygon: The Shapely MultiPolygon geometry to convert.</span>
<span class="sd">            min_point_spacing: Per-axis spacing threshold - a vertex is kept only if both `|x|` and `|y|` from the previous vertex are  this value (increasing it will boost performance during reproduction, but lower accuracy).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Shape: A new Shape instance representing the geometry of the provided MultiPolygon.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; from shapely.geometry import MultiPolygon, Polygon</span>
<span class="sd">            &gt;&gt;&gt; mp = MultiPolygon([Polygon([(0,0), (10,0), (10,10), (0,10)])])</span>
<span class="sd">            &gt;&gt;&gt; shape = Shape.from_multipolygon(mp, min_point_spacing=0.5)</span>

<span class="sd">        See Also:</span>
<span class="sd">            [`to_multipolygon`][pyonfx.shape.Shape.to_multipolygon]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">multipolygon</span><span class="p">,</span> <span class="n">MultiPolygon</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Expected a MultiPolygon instance&quot;</span><span class="p">)</span>

        <span class="n">elements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ShapeElement</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_linear_ring_to_elements</span><span class="p">(</span><span class="n">linear_ring</span><span class="p">:</span> <span class="n">LinearRing</span><span class="p">,</span> <span class="n">is_hole</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">nonlocal</span> <span class="n">elements</span>

            <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">linear_ring</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">coords</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="c1"># Remove duplicate closing point if present</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">coords</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

            <span class="c1"># Normalize orientation (outer = CW, inner = CCW)</span>
            <span class="k">if</span> <span class="n">is_hole</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">linear_ring</span><span class="o">.</span><span class="n">is_ccw</span><span class="p">:</span>
                <span class="n">coords</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">is_hole</span> <span class="ow">and</span> <span class="n">linear_ring</span><span class="o">.</span><span class="n">is_ccw</span><span class="p">:</span>
                <span class="n">coords</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># Consecutive &quot;m&quot; commands are overriden, drop last one</span>
            <span class="k">if</span> <span class="n">elements</span> <span class="ow">and</span> <span class="n">elements</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
                <span class="n">elements</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

            <span class="n">first_point</span> <span class="o">=</span> <span class="n">last_point</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ShapeElement</span><span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="n">first_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">first_point</span><span class="p">[</span><span class="mi">1</span><span class="p">])]))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="nb">abs</span><span class="p">(</span><span class="n">last_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">min_point_spacing</span>
                        <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">last_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">min_point_spacing</span>
                    <span class="p">):</span>
                        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ShapeElement</span><span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)]))</span>
                        <span class="n">last_point</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">polygon</span> <span class="ow">in</span> <span class="n">multipolygon</span><span class="o">.</span><span class="n">geoms</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">polygon</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">)</span> <span class="ow">or</span> <span class="n">polygon</span><span class="o">.</span><span class="n">is_empty</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">_linear_ring_to_elements</span><span class="p">(</span><span class="n">polygon</span><span class="o">.</span><span class="n">exterior</span><span class="p">,</span> <span class="n">is_hole</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">interior</span> <span class="ow">in</span> <span class="n">polygon</span><span class="o">.</span><span class="n">interiors</span><span class="p">:</span>
                <span class="n">_linear_ring_to_elements</span><span class="p">(</span><span class="n">interior</span><span class="p">,</span> <span class="n">is_hole</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Ending with &quot;m&quot; command is not VSFilter compatible, drop it</span>
        <span class="k">if</span> <span class="n">elements</span> <span class="ow">and</span> <span class="n">elements</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="n">elements</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">bounding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exact</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the bounding box of the shape.</span>

<span class="sd">        Args:</span>
<span class="sd">            exact: If True, perform an exact calculation by considering curve details; if False, use a faster approximation (libass).</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[float, float, float, float]: A tuple (x_min, y_min, x_max, y_max) representing the bounding coordinates of the shape.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; shape = Shape(&quot;m 10 5 l 25 5 25 42 10 42&quot;)</span>
<span class="sd">            &gt;&gt;&gt; shape.bounding()</span>
<span class="sd">            (10.0, 5.0, 25.0, 42.0)  # left, top, right, bottom</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">coord</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">exact</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MultiPoint</span><span class="p">(</span><span class="n">all_points</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_cubic_bezier_bounds</span><span class="p">(</span>
            <span class="n">p0</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span>
            <span class="n">p1</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span>
            <span class="n">p2</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span>
            <span class="n">p3</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Axis-aligned bounds of a cubic Bzier curve.</span>

<span class="sd">            Implementation adapted from https://stackoverflow.com/a/14429749</span>
<span class="sd">            taking care of degenerate cases (coincident control points).</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">_axis_bounds</span><span class="p">(</span><span class="n">c0</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">):</span>
                <span class="c1"># Solve derivative 3*at^2 + 2*bt + c for roots in (0,1)</span>
                <span class="n">a</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="n">c0</span> <span class="o">+</span> <span class="mi">9</span> <span class="o">*</span> <span class="n">c1</span> <span class="o">-</span> <span class="mi">9</span> <span class="o">*</span> <span class="n">c2</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">c3</span>
                <span class="n">b</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">c0</span> <span class="o">-</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">c1</span> <span class="o">+</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">c2</span>
                <span class="n">c</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">c1</span> <span class="o">-</span> <span class="n">c0</span><span class="p">)</span>

                <span class="n">ts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-12</span><span class="p">:</span>  <span class="c1"># Quadratic (or linear) case</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-12</span><span class="p">:</span>
                        <span class="n">t</span> <span class="o">=</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span> <span class="n">b</span>
                        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># Cubic case</span>
                    <span class="n">disc</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">b</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">c</span>
                    <span class="k">if</span> <span class="n">disc</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">sqrt_disc</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">disc</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">sign</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                            <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">+</span> <span class="n">sign</span> <span class="o">*</span> <span class="n">sqrt_disc</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
                            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

                <span class="c1"># extrema candidates are the end-points and the roots above</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">c0</span><span class="p">,</span> <span class="n">c3</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ts</span><span class="p">:</span>
                    <span class="n">mt</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">t</span>
                    <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">mt</span> <span class="o">*</span> <span class="n">mt</span> <span class="o">*</span> <span class="n">mt</span> <span class="o">*</span> <span class="n">c0</span>
                        <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">mt</span> <span class="o">*</span> <span class="n">mt</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">c1</span>
                        <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">mt</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">c2</span>
                        <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">c3</span>
                    <span class="p">)</span>

                <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">vals</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

            <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">_axis_bounds</span><span class="p">(</span><span class="n">p0</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p3</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
            <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">_axis_bounds</span><span class="p">(</span><span class="n">p0</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p3</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span>

        <span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">inf</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_update</span><span class="p">(</span><span class="n">pt</span><span class="p">:</span> <span class="n">Point</span><span class="p">):</span>
            <span class="k">nonlocal</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span>
            <span class="n">x_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
            <span class="n">y_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="n">x_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x_max</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
            <span class="n">y_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y_max</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

        <span class="n">prev_element</span><span class="p">:</span> <span class="n">ShapeElement</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">match</span> <span class="n">element</span><span class="o">.</span><span class="n">command</span><span class="p">:</span>
                <span class="k">case</span> <span class="s2">&quot;m&quot;</span> <span class="o">|</span> <span class="s2">&quot;n&quot;</span><span class="p">:</span>
                    <span class="n">prev_element</span> <span class="o">=</span> <span class="n">element</span>
                <span class="k">case</span> <span class="s2">&quot;l&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">prev_element</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">prev_element</span><span class="o">.</span><span class="n">command</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">}:</span>
                        <span class="n">_update</span><span class="p">(</span><span class="n">prev_element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">:</span>
                        <span class="n">_update</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                    <span class="n">prev_element</span> <span class="o">=</span> <span class="n">element</span>
                <span class="k">case</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">prev_element</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="s2">&quot;Bezier command found without an initial point.&quot;</span>
                        <span class="p">)</span>
                    <span class="n">bx_min</span><span class="p">,</span> <span class="n">by_min</span><span class="p">,</span> <span class="n">bx_max</span><span class="p">,</span> <span class="n">by_max</span> <span class="o">=</span> <span class="n">_cubic_bezier_bounds</span><span class="p">(</span>
                        <span class="n">prev_element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">*</span><span class="n">element</span><span class="o">.</span><span class="n">coordinates</span>
                    <span class="p">)</span>
                    <span class="n">_update</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">bx_min</span><span class="p">,</span> <span class="n">by_min</span><span class="p">))</span>
                    <span class="n">_update</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">bx_max</span><span class="p">,</span> <span class="n">by_max</span><span class="p">))</span>
                    <span class="n">prev_element</span> <span class="o">=</span> <span class="n">element</span>
                <span class="k">case</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Drawing command &#39;</span><span class="si">{</span><span class="n">element</span><span class="o">.</span><span class="n">command</span><span class="si">}</span><span class="s2">&#39; not handled by bounding().&quot;</span>
                    <span class="p">)</span>

        <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span> <span class="ow">in</span> <span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">)</span> <span class="ow">or</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">inf</span> <span class="ow">in</span> <span class="p">(</span><span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid or empty shape - could not determine bounds.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">boolean</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;Shape&quot;</span><span class="p">,</span>
        <span class="n">op</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;union&quot;</span><span class="p">,</span> <span class="s2">&quot;intersection&quot;</span><span class="p">,</span> <span class="s2">&quot;difference&quot;</span><span class="p">,</span> <span class="s2">&quot;xor&quot;</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">min_point_spacing</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform a boolean operation between two shapes.</span>

<span class="sd">        This method converts both shapes to Shapely MultiPolygon objects (flattening any Bzier curves with the provided tolerance)</span>
<span class="sd">        and performs the specified boolean operation (union, intersection, difference, or symmetric difference).</span>
<span class="sd">        The result is converted back into a Shape instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            other: The other shape to combine with this shape.</span>
<span class="sd">            op: The boolean operation to perform. Use &quot;union&quot; for combined area, &quot;intersection&quot; for overlapping area, &quot;difference&quot; for subtraction, or &quot;xor&quot; for symmetric difference.</span>
<span class="sd">            tolerance: The tolerance angle in degrees used for flattening curves. Higher tolerance reduces processing time but lowers accuracy.</span>
<span class="sd">            min_point_spacing: The minimum spacing between consecutive points when converting back from polygons to a shape.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Shape: A new Shape instance representing the resulting shape after the boolean operation.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; shape1 = Shape(&quot;m 0 0 l 10 0 10 10 0 10&quot;)</span>
<span class="sd">            &gt;&gt;&gt; shape2 = Shape(&quot;m 5 5 l 15 5 15 15 5 15&quot;)</span>
<span class="sd">            &gt;&gt;&gt; shape1.boolean(shape2, op=&quot;intersection&quot;, tolerance=1.0, min_point_spacing=0.5)</span>
<span class="sd">            m 10 10 l 10 5 5 5 5 10</span>

<span class="sd">        See Also:</span>
<span class="sd">            [`to_multipolygon`][pyonfx.shape.Shape.to_multipolygon]</span>
<span class="sd">            [`from_multipolygon`][pyonfx.shape.Shape.from_multipolygon]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Shape</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;other must be a Shape instance&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">op</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;union&quot;</span><span class="p">,</span> <span class="s2">&quot;intersection&quot;</span><span class="p">,</span> <span class="s2">&quot;difference&quot;</span><span class="p">,</span> <span class="s2">&quot;xor&quot;</span><span class="p">}:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;op must be one of &#39;union&#39;, &#39;intersection&#39;, &#39;difference&#39;, or &#39;xor&#39;&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Convert both shapes to MultiPolygon (this flattens curves).</span>
        <span class="n">mp_self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_multipolygon</span><span class="p">(</span><span class="n">tolerance</span><span class="p">)</span>
        <span class="n">mp_other</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">to_multipolygon</span><span class="p">(</span><span class="n">tolerance</span><span class="p">)</span>

        <span class="c1"># Perform the requested boolean operation.</span>
        <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;union&quot;</span><span class="p">:</span>
            <span class="n">result_geom</span> <span class="o">=</span> <span class="n">mp_self</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">mp_other</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;intersection&quot;</span><span class="p">:</span>
            <span class="n">result_geom</span> <span class="o">=</span> <span class="n">mp_self</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">mp_other</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;difference&quot;</span><span class="p">:</span>
            <span class="n">result_geom</span> <span class="o">=</span> <span class="n">mp_self</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">mp_other</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># op == &quot;xor&quot;</span>
            <span class="n">result_geom</span> <span class="o">=</span> <span class="n">mp_self</span><span class="o">.</span><span class="n">symmetric_difference</span><span class="p">(</span><span class="n">mp_other</span><span class="p">)</span>

        <span class="c1"># Normalise to MultiPolygon</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result_geom</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">):</span>
            <span class="n">result_geom</span> <span class="o">=</span> <span class="n">MultiPolygon</span><span class="p">([</span><span class="n">result_geom</span><span class="p">])</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result_geom</span><span class="p">,</span> <span class="n">MultiPolygon</span><span class="p">):</span>
            <span class="c1"># No overlapping geometry  return an empty shape.</span>
            <span class="k">return</span> <span class="n">Shape</span><span class="p">()</span>

        <span class="c1"># Convert back to Shape.</span>
        <span class="k">return</span> <span class="n">Shape</span><span class="o">.</span><span class="n">from_multipolygon</span><span class="p">(</span><span class="n">result_geom</span><span class="p">,</span> <span class="n">min_point_spacing</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">map</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">fun</span><span class="p">:</span> <span class="p">(</span>
            <span class="n">Callable</span><span class="p">[[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span>
            <span class="o">|</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span>
        <span class="p">),</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sends every point of the shape through a transformation function.</span>

<span class="sd">        This method applies a user-provided transformation function to each coordinate of the shape&#39;s elements, allowing for arbitrary deformations or adjustments.</span>
<span class="sd">        The function can accept two parameters (x and y) or three parameters (x, y, and the command type), providing flexibility in the transformation logic.</span>

<span class="sd">        Args:</span>
<span class="sd">            fun: A function that takes the x and y coordinates (and optionally the drawing command as the third argument) and returns a tuple with the transformed (x, y) coordinates.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Shape: A new Shape instance with each point transformed according to the provided function.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; original = Shape(&quot;m 0 0 l 20 0 20 10 0 10&quot;)</span>
<span class="sd">            &gt;&gt;&gt; original.map(lambda x, y: (x + 10, y + 5))</span>
<span class="sd">            m 10 5 l 30 5 30 15 10 15</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">fun</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;(Lambda) function expected&quot;</span><span class="p">)</span>

        <span class="c1"># Determine the arity of the transformation function</span>
        <span class="n">n_params</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">signature</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n_params</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Function must have 2 or 3 parameters&quot;</span><span class="p">)</span>

        <span class="c1"># Create a wrapper function accepting always 3 parameters</span>
        <span class="k">if</span> <span class="n">n_params</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">fun</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span> <span class="n">fun</span><span class="p">)</span>
            <span class="n">_apply</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">cmd</span><span class="p">:</span> <span class="n">fun</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">cmd</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fun</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span> <span class="n">fun</span><span class="p">)</span>
            <span class="n">_apply</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="n">fun</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">)</span>

        <span class="c1"># Apply the transformation to each element</span>
        <span class="n">transformed_elements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ShapeElement</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">:</span>
                <span class="n">transformed_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">transformed_coords</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">Point</span><span class="p">(</span><span class="o">*</span><span class="n">_apply</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">command</span><span class="p">))</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">coordinates</span>
            <span class="p">]</span>
            <span class="n">transformed_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ShapeElement</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">command</span><span class="p">,</span> <span class="n">transformed_coords</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">Shape</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="n">transformed_elements</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Move the shape by the specified x and y offsets.</span>

<span class="sd">        This method translates every point in the shape by adding the given x and y offsets to the corresponding coordinates.</span>

<span class="sd">        Args:</span>
<span class="sd">            x: The displacement along the x-axis.</span>
<span class="sd">            y: The displacement along the y-axis.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Shape: A new Shape instance with the coordinates moved by the specified offsets.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; shape = Shape(&quot;m 0 0 l 30 0 30 20 0 20&quot;)</span>
<span class="sd">            &gt;&gt;&gt; shape.move(-5, 10)</span>
<span class="sd">            m -5 10 l 25 10 25 30 -5 30</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">:</span> <span class="p">(</span><span class="n">cx</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">cy</span> <span class="o">+</span> <span class="n">y</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">align</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">an</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">anchor</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Align the shape based on a specified alignment code and pivot.</span>

<span class="sd">        This method adjusts the shape&#39;s position so that a chosen pivot inside the shape</span>
<span class="sd">        coincides with the position used for rendering (i.e., the \\pos point in ASS).</span>

<span class="sd">        Args:</span>
<span class="sd">            an: The alignment of the subtitle line (e.g., 1 through 9 corresponding to positions such as bottom-left, center, top-right, etc.).</span>
<span class="sd">            anchor: The pivot inside the shape to be used for alignment. If not provided, defaults to the value of &#39;an&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Shape: A new Shape instance with the shape aligned according to the specified parameters.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; shape = Shape(&quot;m 10 10 l 30 10 30 20 10 20&quot;)</span>
<span class="sd">            &gt;&gt;&gt; shape.align()</span>
<span class="sd">            m 0 0 l 20 0 20 10 0 10</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">anchor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">anchor</span> <span class="o">=</span> <span class="n">an</span>

        <span class="k">if</span> <span class="n">an</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">an</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Alignment value must be an integer between 1 and 9&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">anchor</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">anchor</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Anchor value must be an integer between 1 and 9&quot;</span><span class="p">)</span>

        <span class="c1"># Keypad decomposition (0: left / bottom, 1: centre, 2: right / top)</span>
        <span class="n">pivot_row</span><span class="p">,</span> <span class="n">pivot_col</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">anchor</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">line_row</span><span class="p">,</span> <span class="n">line_col</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">an</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="c1"># Bounding boxes (exact vs. libass)</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounding</span><span class="p">(</span><span class="n">exact</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">l_left</span><span class="p">,</span> <span class="n">l_top</span><span class="p">,</span> <span class="n">l_right</span><span class="p">,</span> <span class="n">l_bottom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounding</span><span class="p">(</span><span class="n">exact</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">right</span> <span class="o">-</span> <span class="n">left</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">-</span> <span class="n">top</span>

        <span class="n">x_move</span> <span class="o">=</span> <span class="o">-</span><span class="n">left</span>
        <span class="n">y_move</span> <span class="o">=</span> <span class="o">-</span><span class="n">top</span>

        <span class="c1"># Centre according to line alignment (libass corrections included)</span>
        <span class="k">if</span> <span class="n">line_col</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># left</span>
            <span class="n">x_move</span> <span class="o">-=</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">line_col</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># centre</span>
            <span class="n">x_move</span> <span class="o">-=</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">l_right</span> <span class="o">-</span> <span class="n">l_left</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">line_col</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># right</span>
            <span class="n">x_move</span> <span class="o">+=</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="n">l_right</span> <span class="o">-</span> <span class="n">l_left</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">line_row</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># bottom</span>
            <span class="n">y_move</span> <span class="o">+=</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="n">l_bottom</span> <span class="o">-</span> <span class="n">l_top</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">line_row</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># middle</span>
            <span class="n">y_move</span> <span class="o">-=</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">l_bottom</span> <span class="o">-</span> <span class="n">l_top</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">line_row</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># top</span>
            <span class="n">y_move</span> <span class="o">-=</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1"># Finally shift so that requested pivot is the reference point</span>
        <span class="k">if</span> <span class="n">pivot_col</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># left</span>
            <span class="n">x_move</span> <span class="o">+=</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">pivot_col</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># right</span>
            <span class="n">x_move</span> <span class="o">-=</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="k">if</span> <span class="n">pivot_row</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># bottom</span>
            <span class="n">y_move</span> <span class="o">-=</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">pivot_row</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># top</span>
            <span class="n">y_move</span> <span class="o">+=</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">x_move</span><span class="p">,</span> <span class="n">y_move</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scale</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">fscx</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">fscy</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">origin</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Scale the shape by specified horizontal and vertical scale factors, optionally around a given origin.</span>

<span class="sd">        This method scales the shape&#39;s coordinates relative to a specified origin point, which serves as the pivot for the scaling transformation.</span>

<span class="sd">        Args:</span>
<span class="sd">            fscx: The horizontal scaling factor as a percentage (100 means no change).</span>
<span class="sd">            fscy: The vertical scaling factor as a percentage (100 means no change).</span>
<span class="sd">            origin: The pivot point (x, y) around which scaling is performed. Default is (0.0, 0.0).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Shape: A new Shape instance with the coordinates scaled accordingly.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; shape = Shape(&quot;m 0 50 l 0 0 50 0 50 50&quot;)</span>
<span class="sd">            &gt;&gt;&gt; shape.scale(fscx=200)</span>
<span class="sd">            m 0 50 l 0 0 100 0 100 50</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fscx</span> <span class="o">==</span> <span class="mf">100.0</span> <span class="ow">and</span> <span class="n">fscy</span> <span class="o">==</span> <span class="mf">100.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="n">scale_x</span> <span class="o">=</span> <span class="n">fscx</span> <span class="o">/</span> <span class="mf">100.0</span>
        <span class="n">scale_y</span> <span class="o">=</span> <span class="n">fscy</span> <span class="o">/</span> <span class="mf">100.0</span>

        <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span> <span class="o">=</span> <span class="n">origin</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">ox</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale_x</span> <span class="o">+</span> <span class="n">ox</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">oy</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale_y</span> <span class="o">+</span> <span class="n">oy</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rotate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">frx</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">fry</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">frz</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">origin</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Rotate the shape by specified angles about given axes around a pivot point.</span>

<span class="sd">        This method applies rotation transformations to the shape&#39;s coordinates based on the provided angles for the x, y, and z axes, in degrees.</span>
<span class="sd">        The pivot point around which the rotation is applied is specified by the &#39;origin&#39; parameter.</span>

<span class="sd">        Args:</span>
<span class="sd">            frx: The rotation angle around the x-axis (in degrees).</span>
<span class="sd">            fry: The rotation angle around the y-axis (in degrees).</span>
<span class="sd">            frz: The rotation angle around the z-axis (in degrees).</span>
<span class="sd">            origin: The pivot point (x, y) for the rotation.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Shape: A new Shape instance with the coordinates rotated as specified.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; shape = Shape(&quot;m 0 0 l 30 0 30 20 0 20&quot;)</span>
<span class="sd">            &gt;&gt;&gt; shape.rotate(frx=0, fry=0, frz=45, origin=(15,10))</span>
<span class="sd">            m -2.678 13.536 l 18.536 -7.678 32.678 6.464 11.464 27.678</span>

<span class="sd">        Notes:</span>
<span class="sd">            The rotation is applied in the order: X-axis, then Y-axis, then Z-axis.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">frx</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">fry</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">frz</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="c1"># Normalise the origin</span>
        <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span> <span class="o">=</span> <span class="n">origin</span>

        <span class="c1"># Pre-compute sines/cosines</span>
        <span class="c1"># (Mathematical convention is counter-clockwise, but ASS uses clockwise, *sigh*)</span>
        <span class="n">rx</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="o">-</span><span class="n">frx</span><span class="p">)</span>
        <span class="n">ry</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="o">-</span><span class="n">fry</span><span class="p">)</span>
        <span class="n">rz</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="o">-</span><span class="n">frz</span><span class="p">)</span>
        <span class="n">cosx</span><span class="p">,</span> <span class="n">sinx</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rx</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rx</span><span class="p">)</span>
        <span class="n">cosy</span><span class="p">,</span> <span class="n">siny</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ry</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ry</span><span class="p">)</span>
        <span class="n">cosz</span><span class="p">,</span> <span class="n">sinz</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rz</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rz</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_transform</span><span class="p">(</span><span class="n">px</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">py</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
            <span class="c1"># Translate to origin</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">px</span> <span class="o">-</span> <span class="n">ox</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">py</span> <span class="o">-</span> <span class="n">oy</span>
            <span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="c1"># Rotation around X (pitch)</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">cosx</span> <span class="o">-</span> <span class="n">z</span> <span class="o">*</span> <span class="n">sinx</span>
            <span class="n">z1</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">sinx</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="n">cosx</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span>

            <span class="c1"># Rotation around Y (yaw)</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">cosy</span> <span class="o">+</span> <span class="n">z1</span> <span class="o">*</span> <span class="n">siny</span>
            <span class="n">z2</span> <span class="o">=</span> <span class="o">-</span><span class="n">x1</span> <span class="o">*</span> <span class="n">siny</span> <span class="o">+</span> <span class="n">z1</span> <span class="o">*</span> <span class="n">cosy</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">y1</span>

            <span class="c1"># Rotation around Z (roll)</span>
            <span class="n">x3</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">cosz</span> <span class="o">-</span> <span class="n">y2</span> <span class="o">*</span> <span class="n">sinz</span>
            <span class="n">y3</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">sinz</span> <span class="o">+</span> <span class="n">y2</span> <span class="o">*</span> <span class="n">cosz</span>
            <span class="n">z3</span> <span class="o">=</span> <span class="n">z2</span>

            <span class="c1"># Translate back</span>
            <span class="k">return</span> <span class="n">x3</span> <span class="o">+</span> <span class="n">ox</span><span class="p">,</span> <span class="n">y3</span> <span class="o">+</span> <span class="n">oy</span>

        <span class="c1"># Apply transformation to every point in the shape</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">_transform</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">shear</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">fax</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">fay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">origin</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply a shear transformation to the shape.</span>

<span class="sd">        This method deforms the shape by applying a shear transformation relative to a specified origin, which acts as the pivot.</span>

<span class="sd">        Args:</span>
<span class="sd">            fax: The horizontal shear factor. Positive values slant the top of the shape to the right, negative values slant to the left.</span>
<span class="sd">            fay: The vertical shear factor. Positive values slant the right side of the shape downward, negative values slant upward.</span>
<span class="sd">            origin: The pivot point (x, y) for the shear transformation.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Shape: A new Shape instance with the coordinates sheared accordingly.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; shape = Shape(&quot;m 0 0 l 30 0 30 20 0 20&quot;)</span>
<span class="sd">            &gt;&gt;&gt; shape.shear(fax=0.5, fay=0, origin=(15,10))</span>
<span class="sd">            m -5 0 l 25 0 35 20 5 20</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fax</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">fay</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span> <span class="o">=</span> <span class="n">origin</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_shear</span><span class="p">(</span><span class="n">px</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">py</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
            <span class="c1"># Translate to origin</span>
            <span class="n">x_rel</span> <span class="o">=</span> <span class="n">px</span> <span class="o">-</span> <span class="n">ox</span>
            <span class="n">y_rel</span> <span class="o">=</span> <span class="n">py</span> <span class="o">-</span> <span class="n">oy</span>

            <span class="c1"># Apply shear matrix [[1, fax], [fay, 1]]</span>
            <span class="n">new_x_rel</span> <span class="o">=</span> <span class="n">x_rel</span> <span class="o">+</span> <span class="n">fax</span> <span class="o">*</span> <span class="n">y_rel</span>
            <span class="n">new_y_rel</span> <span class="o">=</span> <span class="n">fay</span> <span class="o">*</span> <span class="n">x_rel</span> <span class="o">+</span> <span class="n">y_rel</span>

            <span class="c1"># Translate back</span>
            <span class="k">return</span> <span class="n">new_x_rel</span> <span class="o">+</span> <span class="n">ox</span><span class="p">,</span> <span class="n">new_y_rel</span> <span class="o">+</span> <span class="n">oy</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">_shear</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">flatten</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Flatten the shape&#39;s Bzier curves into line segments.</span>

<span class="sd">        This method processes the shape by subdividing Bzier curves into multiple straight line segments.</span>
<span class="sd">        The subdivision is controlled by the tolerance parameter, which defines the threshold angle (in degrees) at which a curve is considered flat.</span>
<span class="sd">        This conversion is useful for operations that require linear segments, such as detailed transformations or morphing.</span>

<span class="sd">        Args:</span>
<span class="sd">            tolerance: The angle in degrees used to determine when a Bzier curve is flat enough to be approximated by a straight line. Higher values yield fewer segments and faster processing but lower accuracy.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Shape: A new Shape instance with the curves converted into line segments.</span>

<span class="sd">        Notes:</span>
<span class="sd">            Flattening curves may significantly increase the number of points, which can impact performance for subsequent operations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tolerance</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Tolerance must be a positive number&quot;</span><span class="p">)</span>

        <span class="c1"># Convert tolerance to radians once to avoid repeated conversions</span>
        <span class="n">tolerance_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">tolerance</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_subdivide_bezier</span><span class="p">(</span><span class="n">p0x</span><span class="p">,</span> <span class="n">p0y</span><span class="p">,</span> <span class="n">p1x</span><span class="p">,</span> <span class="n">p1y</span><span class="p">,</span> <span class="n">p2x</span><span class="p">,</span> <span class="n">p2y</span><span class="p">,</span> <span class="n">p3x</span><span class="p">,</span> <span class="n">p3y</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;De Casteljau subdivision of cubic bezier curve using raw coordinates.&quot;&quot;&quot;</span>
            <span class="c1"># First level</span>
            <span class="n">q0x</span> <span class="o">=</span> <span class="n">p0x</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">p1x</span> <span class="o">-</span> <span class="n">p0x</span><span class="p">)</span>
            <span class="n">q0y</span> <span class="o">=</span> <span class="n">p0y</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">p1y</span> <span class="o">-</span> <span class="n">p0y</span><span class="p">)</span>
            <span class="n">q1x</span> <span class="o">=</span> <span class="n">p1x</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">p2x</span> <span class="o">-</span> <span class="n">p1x</span><span class="p">)</span>
            <span class="n">q1y</span> <span class="o">=</span> <span class="n">p1y</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">p2y</span> <span class="o">-</span> <span class="n">p1y</span><span class="p">)</span>
            <span class="n">q2x</span> <span class="o">=</span> <span class="n">p2x</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">p3x</span> <span class="o">-</span> <span class="n">p2x</span><span class="p">)</span>
            <span class="n">q2y</span> <span class="o">=</span> <span class="n">p2y</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">p3y</span> <span class="o">-</span> <span class="n">p2y</span><span class="p">)</span>

            <span class="c1"># Second level</span>
            <span class="n">r0x</span> <span class="o">=</span> <span class="n">q0x</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">q1x</span> <span class="o">-</span> <span class="n">q0x</span><span class="p">)</span>
            <span class="n">r0y</span> <span class="o">=</span> <span class="n">q0y</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">q1y</span> <span class="o">-</span> <span class="n">q0y</span><span class="p">)</span>
            <span class="n">r1x</span> <span class="o">=</span> <span class="n">q1x</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">q2x</span> <span class="o">-</span> <span class="n">q1x</span><span class="p">)</span>
            <span class="n">r1y</span> <span class="o">=</span> <span class="n">q1y</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">q2y</span> <span class="o">-</span> <span class="n">q1y</span><span class="p">)</span>

            <span class="c1"># Final point</span>
            <span class="n">sx</span> <span class="o">=</span> <span class="n">r0x</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">r1x</span> <span class="o">-</span> <span class="n">r0x</span><span class="p">)</span>
            <span class="n">sy</span> <span class="o">=</span> <span class="n">r0y</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">r1y</span> <span class="o">-</span> <span class="n">r0y</span><span class="p">)</span>

            <span class="k">return</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">p0x</span><span class="p">,</span> <span class="n">p0y</span><span class="p">,</span> <span class="n">q0x</span><span class="p">,</span> <span class="n">q0y</span><span class="p">,</span> <span class="n">r0x</span><span class="p">,</span> <span class="n">r0y</span><span class="p">,</span> <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">),</span>
                <span class="p">(</span><span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">r1x</span><span class="p">,</span> <span class="n">r1y</span><span class="p">,</span> <span class="n">q2x</span><span class="p">,</span> <span class="n">q2y</span><span class="p">,</span> <span class="n">p3x</span><span class="p">,</span> <span class="n">p3y</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_is_bezier_flat</span><span class="p">(</span><span class="n">p0x</span><span class="p">,</span> <span class="n">p0y</span><span class="p">,</span> <span class="n">p1x</span><span class="p">,</span> <span class="n">p1y</span><span class="p">,</span> <span class="n">p2x</span><span class="p">,</span> <span class="n">p2y</span><span class="p">,</span> <span class="n">p3x</span><span class="p">,</span> <span class="n">p3y</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Check if bezier curve is flat enough based on angle tolerance.&quot;&quot;&quot;</span>
            <span class="n">points</span> <span class="o">=</span> <span class="p">[(</span><span class="n">p0x</span><span class="p">,</span> <span class="n">p0y</span><span class="p">),</span> <span class="p">(</span><span class="n">p1x</span><span class="p">,</span> <span class="n">p1y</span><span class="p">),</span> <span class="p">(</span><span class="n">p2x</span><span class="p">,</span> <span class="n">p2y</span><span class="p">),</span> <span class="p">(</span><span class="n">p3x</span><span class="p">,</span> <span class="n">p3y</span><span class="p">)]</span>

            <span class="n">vectors</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)):</span>
                <span class="n">dx</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">dy</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">dx</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">dy</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">vectors</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">))</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vectors</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="c1"># Check angle between consecutive vectors</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">vectors</span><span class="p">)):</span>
                <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">vectors</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">vectors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                <span class="n">angle</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span>
                    <span class="n">v1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">v1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tolerance_rad</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>

            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_bezier_to_lines</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Convert bezier curve to line segments.&quot;&quot;&quot;</span>
            <span class="n">stack</span> <span class="o">=</span> <span class="p">[(</span><span class="n">p0</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p0</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p3</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p3</span><span class="o">.</span><span class="n">y</span><span class="p">)]</span>

            <span class="n">line_points</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="n">stack</span><span class="p">:</span>
                <span class="n">coords</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">_is_bezier_flat</span><span class="p">(</span><span class="o">*</span><span class="n">coords</span><span class="p">):</span>
                    <span class="c1"># End point</span>
                    <span class="n">line_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Subdivide and add both halves to stack</span>
                    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">_subdivide_bezier</span><span class="p">(</span><span class="o">*</span><span class="n">coords</span><span class="p">)</span>
                    <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>  <span class="c1"># Process right first (stack order)</span>
                    <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">left</span><span class="p">)</span>

            <span class="k">return</span> <span class="p">(</span>
                <span class="n">line_points</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">line_points</span> <span class="k">else</span> <span class="p">[]</span>
            <span class="p">)</span>  <span class="c1"># Exclude last to avoid duplication</span>

        <span class="c1"># Process elements</span>
        <span class="n">flattened_elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current_point</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">current_point</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Bezier curve found without a starting point&quot;</span><span class="p">)</span>

                <span class="c1"># Convert bezier to line segments</span>
                <span class="n">p0</span> <span class="o">=</span> <span class="n">current_point</span>
                <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">coordinates</span>

                <span class="n">line_points</span> <span class="o">=</span> <span class="n">_bezier_to_lines</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">)</span>

                <span class="c1"># Add line segments</span>
                <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">line_points</span><span class="p">:</span>
                    <span class="n">flattened_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ShapeElement</span><span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">point</span><span class="p">]))</span>

                <span class="c1"># Add final point</span>
                <span class="n">flattened_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ShapeElement</span><span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">p3</span><span class="p">]))</span>
                <span class="n">current_point</span> <span class="o">=</span> <span class="n">p3</span>

            <span class="k">elif</span> <span class="n">element</span><span class="o">.</span><span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span>
                <span class="c1"># Bezier curves are already converted to lines</span>
                <span class="k">pass</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Keep other commands as-is and track current point</span>
                <span class="n">flattened_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">:</span>
                    <span class="n">current_point</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Return shape with flattened elements</span>
        <span class="k">return</span> <span class="n">Shape</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="n">flattened_elements</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_len</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Split the shape into smaller segments.</span>

<span class="sd">        This method first flattens any Bzier curves in the shape, then subdivides the resulting line segments so that no segment exceeds the specified maximum length.</span>
<span class="sd">        This process increases the number of points in the shape, which can be useful for detailed deformations or morphing.</span>

<span class="sd">        Args:</span>
<span class="sd">            max_len: The maximum allowed length for any line segment. Segments longer than this value will be subdivided.</span>
<span class="sd">            tolerance: The tolerance angle in degrees used to flatten Bzier curves before splitting.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Shape: A new Shape instance with the split line segments.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; shape = Shape(&quot;m 0 50 l 0 0 50 0 50 50&quot;)</span>
<span class="sd">            &gt;&gt;&gt; shape.split()</span>
<span class="sd">            m 0 50 l 0 48 0 32 0 16 0 0 2 0 18 0 34 0 50 0 50 2 50 18 50 34 50 50 48 50 32 50 16 50 0 50</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">max_len</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The length of segments must be a positive and non-zero value&quot;</span>
            <span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_split_line_segment</span><span class="p">(</span><span class="n">p1</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">p2</span><span class="p">:</span> <span class="n">Point</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Split a line segment *p1p2* into shorter segments of length ``&lt;= max_len``&quot;&quot;&quot;</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">LineString</span><span class="p">([</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">])</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">length</span>

            <span class="c1"># If already short enough, just return the end point</span>
            <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;=</span> <span class="n">max_len</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="n">p2</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">y</span><span class="p">)]</span>

            <span class="c1"># Split the line into segments of max_len, with possibly shorter first segment</span>
            <span class="n">segments</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">distance_rest</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">%</span> <span class="n">max_len</span>
            <span class="n">cur_distance</span> <span class="o">=</span> <span class="n">distance_rest</span> <span class="k">if</span> <span class="n">distance_rest</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">max_len</span>

            <span class="k">while</span> <span class="n">cur_distance</span> <span class="o">&lt;=</span> <span class="n">distance</span><span class="p">:</span>
                <span class="n">point</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">cur_distance</span><span class="p">)</span>
                <span class="n">segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">point</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
                <span class="n">cur_distance</span> <span class="o">+=</span> <span class="n">max_len</span>

            <span class="k">return</span> <span class="n">segments</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_close_contour_if_needed</span><span class="p">(</span><span class="n">current_pt</span><span class="p">,</span> <span class="n">first_move_pt</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Helper to close a contour by splitting the closing line if needed.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">current_pt</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">first_move_pt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">current_pt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">current_pt</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">first_move_pt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">first_move_pt</span><span class="o">.</span><span class="n">y</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[]</span>

            <span class="n">closing_points</span> <span class="o">=</span> <span class="n">_split_line_segment</span><span class="p">(</span><span class="n">current_pt</span><span class="p">,</span> <span class="n">first_move_pt</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">ShapeElement</span><span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">pt</span><span class="p">])</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">closing_points</span><span class="p">]</span>

        <span class="c1"># First flatten the shape to convert bezier curves to lines</span>
        <span class="n">flattened_shape</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drawing_cmds</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">tolerance</span><span class="p">)</span>

        <span class="c1"># Process elements</span>
        <span class="n">split_elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current_point</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">first_move_point</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">flattened_shape</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
                <span class="c1"># Close previous contour if needed</span>
                <span class="n">split_elements</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="n">_close_contour_if_needed</span><span class="p">(</span><span class="n">current_point</span><span class="p">,</span> <span class="n">first_move_point</span><span class="p">)</span>
                <span class="p">)</span>

                <span class="c1"># Start new contour</span>
                <span class="n">split_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
                <span class="n">current_point</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">first_move_point</span> <span class="o">=</span> <span class="n">current_point</span>

            <span class="k">elif</span> <span class="n">element</span><span class="o">.</span><span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;l&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">current_point</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Line command found without a starting point&quot;</span><span class="p">)</span>

                <span class="c1"># Split the line segment</span>
                <span class="n">line_points</span> <span class="o">=</span> <span class="n">_split_line_segment</span><span class="p">(</span><span class="n">current_point</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                <span class="c1"># Add each segment as a separate line element</span>
                <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">line_points</span><span class="p">:</span>
                    <span class="n">split_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ShapeElement</span><span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">point</span><span class="p">]))</span>

                <span class="c1"># Update current point</span>
                <span class="n">current_point</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">line_points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">line_points</span> <span class="k">else</span> <span class="n">element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="n">element</span><span class="o">.</span><span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span>
                <span class="c1"># Close current contour</span>
                <span class="n">split_elements</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="n">_close_contour_if_needed</span><span class="p">(</span><span class="n">current_point</span><span class="p">,</span> <span class="n">first_move_point</span><span class="p">)</span>
                <span class="p">)</span>

                <span class="c1"># Reset state for next contour</span>
                <span class="n">current_point</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">first_move_point</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">split_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">:</span>
                    <span class="n">current_point</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Close the final contour if needed</span>
        <span class="n">split_elements</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_close_contour_if_needed</span><span class="p">(</span><span class="n">current_point</span><span class="p">,</span> <span class="n">first_move_point</span><span class="p">))</span>

        <span class="c1"># Update shape with split elements</span>
        <span class="k">return</span> <span class="n">Shape</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="n">split_elements</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">buffer</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dist_xy</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">dist_y</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="s2">&quot;border&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;border&quot;</span><span class="p">,</span>
        <span class="n">join</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;round&quot;</span><span class="p">,</span> <span class="s2">&quot;bevel&quot;</span><span class="p">,</span> <span class="s2">&quot;mitre&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;round&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a buffered version of the shape.</span>

<span class="sd">        It makes a thicker or thinner version of the original shape by adding or removing space around it, based on the distances you specify.</span>
<span class="sd">        The &quot;kind&quot; option decides if you get the whole new shape filled in or just the edge line.</span>

<span class="sd">        Args:</span>
<span class="sd">            dist_xy: Horizontal buffer distance. Positive values expand the shape, and negative values contract it.</span>
<span class="sd">            dist_y: Vertical buffer distance. If None, the same value as dist_xy is used. The sign must match that of dist_xy.</span>
<span class="sd">            kind: Determines whether to return the filled buffered geometry (&quot;fill&quot;) or just the border (&quot;border&quot;).</span>
<span class="sd">            join: The corner join style to use on buffered corners.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Shape: A new Shape instance representing the buffered shape.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; shape = Shape(&quot;m 0 0 l 100 0 100 50 0 50&quot;)</span>
<span class="sd">            &gt;&gt;&gt; shape.buffer(5, kind=&quot;border&quot;, join=&quot;round&quot;)</span>
<span class="sd">            m -3.333 50 l -3.269 50.65 (...)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">join</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;round&quot;</span><span class="p">,</span> <span class="s2">&quot;bevel&quot;</span><span class="p">,</span> <span class="s2">&quot;mitre&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;join must be one of &#39;round&#39;, &#39;bevel&#39;, or &#39;mitre&#39;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kind</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="s2">&quot;border&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;kind must be either &#39;fill&#39; or &#39;border&#39;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dist_y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dist_y</span> <span class="o">=</span> <span class="n">dist_xy</span>
        <span class="k">if</span> <span class="n">dist_xy</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">dist_y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Shape</span><span class="p">()</span> <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;border&quot;</span> <span class="k">else</span> <span class="bp">self</span>

        <span class="c1"># Validate signs: both distances must have the same sign (or be zero)</span>
        <span class="k">if</span> <span class="n">dist_xy</span> <span class="o">*</span> <span class="n">dist_y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;dist_xy and dist_y must have the same sign&quot;</span><span class="p">)</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">dist_xy</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c1"># Build Shapely geometry</span>
        <span class="n">multipoly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_multipolygon</span><span class="p">()</span>

        <span class="c1"># Apply libass hack</span>
        <span class="n">_LIBASS_HACK</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span>
        <span class="n">dist_xy</span> <span class="o">*=</span> <span class="n">_LIBASS_HACK</span>
        <span class="n">dist_y</span> <span class="o">*=</span> <span class="n">_LIBASS_HACK</span>

        <span class="c1"># Anisotropic scaling so that the buffer distance is uniform</span>
        <span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">dist_xy</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dist_y</span><span class="p">))</span>

        <span class="n">_EPS</span> <span class="o">=</span> <span class="mf">1e-9</span>  <span class="c1"># Avoid division-by-zero</span>
        <span class="n">xscale</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dist_xy</span><span class="p">)</span> <span class="o">/</span> <span class="n">width</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dist_xy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">_EPS</span>
        <span class="n">yscale</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dist_y</span><span class="p">)</span> <span class="o">/</span> <span class="n">width</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dist_y</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">_EPS</span>

        <span class="n">inv_xscale</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">xscale</span>
        <span class="n">inv_yscale</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">yscale</span>
        <span class="n">scaled_geom</span> <span class="o">=</span> <span class="n">affine_scale</span><span class="p">(</span>
            <span class="n">multipoly</span><span class="p">,</span> <span class="n">xfact</span><span class="o">=</span><span class="n">inv_xscale</span><span class="p">,</span> <span class="n">yfact</span><span class="o">=</span><span class="n">inv_yscale</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Apply buffer (positive  outward, negative  inward)</span>
        <span class="n">buffered_scaled</span> <span class="o">=</span> <span class="n">scaled_geom</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span>
            <span class="n">sign</span> <span class="o">*</span> <span class="n">width</span><span class="p">,</span> <span class="n">join_style</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">JOIN_STYLE</span><span class="p">,</span> <span class="n">join</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;fill&quot;</span><span class="p">:</span>
            <span class="c1"># Grown/shrunk geometry</span>
            <span class="n">result_scaled</span> <span class="o">=</span> <span class="n">buffered_scaled</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sign</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># External border: grow and subtract original</span>
                <span class="n">result_scaled</span> <span class="o">=</span> <span class="n">buffered_scaled</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">scaled_geom</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Internal border: shrink original and subtract new interior</span>
                <span class="n">result_scaled</span> <span class="o">=</span> <span class="n">scaled_geom</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">buffered_scaled</span><span class="p">)</span>

        <span class="c1"># Scale back to the original coordinate system</span>
        <span class="n">result_geom</span> <span class="o">=</span> <span class="n">affine_scale</span><span class="p">(</span>
            <span class="n">result_scaled</span><span class="p">,</span> <span class="n">xfact</span><span class="o">=</span><span class="n">xscale</span><span class="p">,</span> <span class="n">yfact</span><span class="o">=</span><span class="n">yscale</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Craft MultiPolygon</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result_geom</span><span class="p">,</span> <span class="n">MultiPolygon</span><span class="p">):</span>
            <span class="n">mp</span> <span class="o">=</span> <span class="n">result_geom</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result_geom</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">):</span>
            <span class="n">mp</span> <span class="o">=</span> <span class="n">MultiPolygon</span><span class="p">([</span><span class="n">result_geom</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid stroke geometry type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">result_geom</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Convert back to Shape</span>
        <span class="k">return</span> <span class="n">Shape</span><span class="o">.</span><span class="n">from_multipolygon</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_prepare_morph</span><span class="p">(</span>
        <span class="n">source_ids_and_cmds</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="o">...</span><span class="p">],</span>
        <span class="n">target_ids_and_cmds</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="o">...</span><span class="p">],</span>
        <span class="n">max_len</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">w_dist</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">w_area</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">w_overlap</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">cost_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">ensure_shell_pairs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span>
        <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">LinearRing</span><span class="p">,</span> <span class="n">LinearRing</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
        <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">LinearRing</span><span class="p">,</span> <span class="n">Point</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
        <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">LinearRing</span><span class="p">,</span> <span class="n">Point</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
    <span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepare the morphing process by decomposing the shapes into compounds and pairing them.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple containing:</span>
<span class="sd">            - A list of (src, tgt, is_hole, src_id, tgt_id) ring pairs.</span>
<span class="sd">            - A list of (src, ref, is_hole, src_id) unmatched source rings.</span>
<span class="sd">            - A list of (tgt, ref, is_hole, tgt_id) unmatched target rings.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_pair_rings</span><span class="p">(</span>
            <span class="n">source_rings_meta</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Polygon</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
            <span class="n">target_rings_meta</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Polygon</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
            <span class="n">w_dist</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
            <span class="n">w_area</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
            <span class="n">w_overlap</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
            <span class="n">cost_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
            <span class="n">ensure_shell_pairs</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span>
            <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">LinearRing</span><span class="p">,</span> <span class="n">LinearRing</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
            <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">LinearRing</span><span class="p">,</span> <span class="n">Point</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
            <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">LinearRing</span><span class="p">,</span> <span class="n">Point</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
        <span class="p">]:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Pair source and target polygon rings (exteriors and interiors) based on centroid distance,</span>
<span class="sd">            area similarity, and overlap, avoiding shell-hole mismatches.</span>

<span class="sd">            Any ring left without a counterpart is matched to the closest centroid so that downstream</span>
<span class="sd">            morphing logic can decide whether it is *appearing* or *disappearing*.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">matched</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">LinearRing</span><span class="p">,</span> <span class="n">LinearRing</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">unmatched_src</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">LinearRing</span><span class="p">,</span> <span class="n">Point</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">unmatched_tgt</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">LinearRing</span><span class="p">,</span> <span class="n">Point</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Global centroid arrays (used for nearest-neighbour fallback)</span>
            <span class="n">all_src_centroids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span><span class="n">poly</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">poly</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">source_rings_meta</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">all_tgt_centroids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span><span class="n">poly</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">poly</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">target_rings_meta</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="c1"># Match separately for shells (False) and holes (True)</span>
            <span class="k">for</span> <span class="n">is_hole</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                <span class="n">cur_src</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">sid</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">poly</span><span class="p">,</span> <span class="n">hole</span><span class="p">,</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">source_rings_meta</span>
                    <span class="k">if</span> <span class="n">hole</span> <span class="o">==</span> <span class="n">is_hole</span>
                <span class="p">]</span>
                <span class="n">cur_tgt</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">sid</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">poly</span><span class="p">,</span> <span class="n">hole</span><span class="p">,</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">target_rings_meta</span>
                    <span class="k">if</span> <span class="n">hole</span> <span class="o">==</span> <span class="n">is_hole</span>
                <span class="p">]</span>
                <span class="n">n_src</span><span class="p">,</span> <span class="n">n_tgt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cur_src</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">cur_tgt</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">n_src</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">n_tgt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">n_src</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">poly</span><span class="p">,</span> <span class="n">did</span> <span class="ow">in</span> <span class="n">cur_tgt</span><span class="p">:</span>
                        <span class="n">ref</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">Point</span><span class="p">(</span><span class="n">all_src_centroids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="k">if</span> <span class="n">all_src_centroids</span><span class="o">.</span><span class="n">size</span>
                            <span class="k">else</span> <span class="n">poly</span><span class="o">.</span><span class="n">centroid</span>
                        <span class="p">)</span>
                        <span class="n">unmatched_tgt</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">poly</span><span class="o">.</span><span class="n">exterior</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">is_hole</span><span class="p">,</span> <span class="n">did</span><span class="p">))</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">n_tgt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">poly</span><span class="p">,</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">cur_src</span><span class="p">:</span>
                        <span class="n">ref</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">Point</span><span class="p">(</span><span class="n">all_tgt_centroids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="k">if</span> <span class="n">all_tgt_centroids</span><span class="o">.</span><span class="n">size</span>
                            <span class="k">else</span> <span class="n">poly</span><span class="o">.</span><span class="n">centroid</span>
                        <span class="p">)</span>
                        <span class="n">unmatched_src</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">poly</span><span class="o">.</span><span class="n">exterior</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">is_hole</span><span class="p">,</span> <span class="n">sid</span><span class="p">))</span>
                    <span class="k">continue</span>

                <span class="n">src_areas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">area</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">cur_src</span><span class="p">])</span>
                <span class="n">tgt_areas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">area</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">cur_tgt</span><span class="p">])</span>
                <span class="n">src_centroids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">cur_src</span><span class="p">])</span>
                <span class="n">tgt_centroids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">cur_tgt</span><span class="p">])</span>

                <span class="c1"># 1) Centroid distance (normalised)</span>
                <span class="n">diff</span> <span class="o">=</span> <span class="n">src_centroids</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">tgt_centroids</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">size_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">src_areas</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">tgt_areas</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]))</span>
                <span class="n">centroid_term</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">/</span> <span class="p">(</span><span class="n">size_norm</span> <span class="o">+</span> <span class="mf">1e-8</span><span class="p">)</span>

                <span class="c1"># 2) Relative area difference</span>
                <span class="n">area_term</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">src_areas</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">tgt_areas</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:])</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">src_areas</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">tgt_areas</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:])</span> <span class="o">+</span> <span class="mf">1e-8</span>
                <span class="p">)</span>

                <span class="n">costs</span> <span class="o">=</span> <span class="n">w_dist</span> <span class="o">*</span> <span class="n">centroid_term</span> <span class="o">+</span> <span class="n">w_area</span> <span class="o">*</span> <span class="n">area_term</span>

                <span class="c1"># 3) Add overlap term for top 8 promising pairs only</span>
                <span class="n">k</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">n_tgt</span><span class="p">)</span>
                <span class="n">candidate_cols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argpartition</span><span class="p">(</span><span class="n">costs</span><span class="p">,</span> <span class="n">kth</span><span class="o">=</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="p">:</span><span class="n">k</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cols</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">candidate_cols</span><span class="p">):</span>
                    <span class="n">poly_i</span> <span class="o">=</span> <span class="n">cur_src</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">area_i</span> <span class="o">=</span> <span class="n">src_areas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
                        <span class="n">poly_j</span> <span class="o">=</span> <span class="n">cur_tgt</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">inter_area</span> <span class="o">=</span> <span class="mf">0.0</span>
                        <span class="k">if</span> <span class="n">poly_i</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">poly_j</span><span class="p">):</span>
                            <span class="n">inter_area</span> <span class="o">=</span> <span class="n">poly_i</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">poly_j</span><span class="p">)</span><span class="o">.</span><span class="n">area</span>
                        <span class="n">min_area</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">area_i</span><span class="p">,</span> <span class="n">tgt_areas</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">min_area</span><span class="p">:</span>
                            <span class="n">iou_term</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">inter_area</span> <span class="o">/</span> <span class="n">min_area</span><span class="p">)</span>
                            <span class="n">costs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">w_overlap</span> <span class="o">*</span> <span class="n">iou_term</span>

                <span class="c1"># 4) Solve assignment (Hungarian algorithm)</span>
                <span class="n">row_ind</span><span class="p">,</span> <span class="n">col_ind</span> <span class="o">=</span> <span class="n">linear_sum_assignment</span><span class="p">(</span><span class="n">costs</span><span class="p">)</span>

                <span class="n">used_src</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="n">used_tgt</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">row_ind</span><span class="p">,</span> <span class="n">col_ind</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">cost_threshold</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">costs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">cost_threshold</span><span class="p">:</span>
                        <span class="n">matched</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">(</span>
                                <span class="n">cur_src</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">exterior</span><span class="p">,</span>
                                <span class="n">cur_tgt</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">exterior</span><span class="p">,</span>
                                <span class="n">is_hole</span><span class="p">,</span>
                                <span class="n">cur_src</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                <span class="n">cur_tgt</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">used_src</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                        <span class="n">used_tgt</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

                <span class="c1"># 5) Handle still-unmatched rings.</span>
                <span class="n">unmatched_src_idx</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_src</span><span class="p">))</span> <span class="o">-</span> <span class="n">used_src</span>
                <span class="n">unmatched_tgt_idx</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_tgt</span><span class="p">))</span> <span class="o">-</span> <span class="n">used_tgt</span>

                <span class="c1"># Optionally force-pair shells so that they always morph into something.</span>
                <span class="k">if</span> <span class="n">ensure_shell_pairs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_hole</span> <span class="ow">and</span> <span class="n">n_src</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">n_tgt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># Pair every remaining source shell with its minimum-cost target shell</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">unmatched_src_idx</span><span class="p">:</span>
                        <span class="n">j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">costs</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                        <span class="n">matched</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">(</span>
                                <span class="n">cur_src</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">exterior</span><span class="p">,</span>
                                <span class="n">cur_tgt</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">exterior</span><span class="p">,</span>
                                <span class="n">is_hole</span><span class="p">,</span>
                                <span class="n">cur_src</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                <span class="n">cur_tgt</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">used_src</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">unmatched_tgt_idx</span><span class="p">:</span>
                        <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">costs</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]))</span>
                        <span class="n">matched</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">(</span>
                                <span class="n">cur_src</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">exterior</span><span class="p">,</span>
                                <span class="n">cur_tgt</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">exterior</span><span class="p">,</span>
                                <span class="n">is_hole</span><span class="p">,</span>
                                <span class="n">cur_src</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                <span class="n">cur_tgt</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">used_tgt</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

                <span class="c1"># Any ring still left unmatched will be matched to the closest centroid.</span>
                <span class="n">un_src_idx</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_src</span><span class="p">))</span> <span class="o">-</span> <span class="n">used_src</span>
                <span class="n">un_tgt_idx</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_tgt</span><span class="p">))</span> <span class="o">-</span> <span class="n">used_tgt</span>

                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">un_src_idx</span><span class="p">:</span>
                    <span class="n">poly</span><span class="p">,</span> <span class="n">source_id</span> <span class="o">=</span> <span class="n">cur_src</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                    <span class="n">src_cent</span> <span class="o">=</span> <span class="n">src_centroids</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                    <span class="n">nn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">all_tgt_centroids</span> <span class="o">-</span> <span class="n">src_cent</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
                    <span class="n">unmatched_src</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span>
                            <span class="n">poly</span><span class="o">.</span><span class="n">exterior</span><span class="p">,</span>
                            <span class="n">Point</span><span class="p">(</span><span class="n">all_tgt_centroids</span><span class="p">[</span><span class="n">nn</span><span class="p">]),</span>
                            <span class="n">is_hole</span><span class="p">,</span>
                            <span class="n">source_id</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">un_tgt_idx</span><span class="p">:</span>
                    <span class="n">poly</span><span class="p">,</span> <span class="n">target_id</span> <span class="o">=</span> <span class="n">cur_tgt</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                    <span class="n">tgt_cent</span> <span class="o">=</span> <span class="n">tgt_centroids</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                    <span class="n">nn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">all_src_centroids</span> <span class="o">-</span> <span class="n">tgt_cent</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
                    <span class="n">unmatched_tgt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span>
                            <span class="n">poly</span><span class="o">.</span><span class="n">exterior</span><span class="p">,</span>
                            <span class="n">Point</span><span class="p">(</span><span class="n">all_src_centroids</span><span class="p">[</span><span class="n">nn</span><span class="p">]),</span>
                            <span class="n">is_hole</span><span class="p">,</span>
                            <span class="n">target_id</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

            <span class="k">return</span> <span class="n">matched</span><span class="p">,</span> <span class="n">unmatched_src</span><span class="p">,</span> <span class="n">unmatched_tgt</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_resample_loop</span><span class="p">(</span><span class="n">loop</span><span class="p">:</span> <span class="n">LinearRing</span><span class="p">,</span> <span class="n">n_points</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LinearRing</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Return *loop* resampled to *n_points* evenly spaced vertices along its perimeter, while preserving all the original loop points if *preserve_original_points* is True.&quot;&quot;&quot;</span>

            <span class="k">if</span> <span class="n">n_points</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;n_points must be at least 3 for a valid LinearRing.&quot;</span><span class="p">)</span>

            <span class="c1"># Ensure the loop is closed and get coordinates</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">loop</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input LinearRing must be closed.&quot;</span><span class="p">)</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># remove duplicate endpoint</span>

            <span class="k">if</span> <span class="n">n_points</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;n_points must be &gt;= number of original vertices when preserve_original_points=True.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">n_points</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">loop</span>

            <span class="n">extra</span> <span class="o">=</span> <span class="n">n_points</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>

            <span class="c1"># Compute segment lengths and cumulative lengths</span>
            <span class="n">deltas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="p">[</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="n">segment_lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">deltas</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">total_length</span> <span class="o">=</span> <span class="n">segment_lengths</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

            <span class="c1"># Ideal (floating point) allocation of extra vertices per segment</span>
            <span class="n">ideal_alloc</span> <span class="o">=</span> <span class="n">segment_lengths</span> <span class="o">/</span> <span class="n">total_length</span> <span class="o">*</span> <span class="n">extra</span>

            <span class="c1"># Initial integer allocation (floor) and compute how many vertices are still unassigned</span>
            <span class="n">int_alloc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ideal_alloc</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">allocated</span> <span class="o">=</span> <span class="n">int_alloc</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">remaining</span> <span class="o">=</span> <span class="n">extra</span> <span class="o">-</span> <span class="n">allocated</span>

            <span class="c1"># Distribute the remaining vertices to the segments with the largest fractional parts</span>
            <span class="k">if</span> <span class="n">remaining</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">frac_parts</span> <span class="o">=</span> <span class="n">ideal_alloc</span> <span class="o">-</span> <span class="n">int_alloc</span>
                <span class="c1"># Indices of segments sorted by descending fractional part</span>
                <span class="n">order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="n">frac_parts</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">order</span><span class="p">[:</span><span class="n">remaining</span><span class="p">]:</span>
                    <span class="n">int_alloc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Build the new coordinate list</span>
            <span class="n">new_coords</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">start_pt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
                <span class="n">end_pt</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)]</span>
                <span class="n">new_coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">start_pt</span><span class="p">))</span>  <span class="c1"># always keep the original vertex</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">int_alloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="c1"># Insert *k* equally spaced points *strictly inside* the segment</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">ratio</span> <span class="o">=</span> <span class="n">j</span> <span class="o">/</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">interp_pt</span> <span class="o">=</span> <span class="n">start_pt</span> <span class="o">+</span> <span class="n">ratio</span> <span class="o">*</span> <span class="p">(</span><span class="n">end_pt</span> <span class="o">-</span> <span class="n">start_pt</span><span class="p">)</span>
                    <span class="n">new_coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">interp_pt</span><span class="p">))</span>

            <span class="n">new_coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># close the ring</span>
            <span class="k">return</span> <span class="n">LinearRing</span><span class="p">(</span><span class="n">new_coords</span><span class="p">)</span>

        <span class="c1"># --- Execute the pipeline ---</span>
        <span class="c1"># 1) Flatten and split each shape into short lines to have more points to work with,</span>
        <span class="c1">#    then convert to polygons and extract rings.</span>
        <span class="n">source_rings_meta</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Polygon</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">target_rings_meta</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Polygon</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">source_cmds</span> <span class="ow">in</span> <span class="n">source_ids_and_cmds</span><span class="p">:</span>
            <span class="n">shape_mp</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="n">source_cmds</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">max_len</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">)</span><span class="o">.</span><span class="n">to_multipolygon</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">shape_mp</span><span class="o">.</span><span class="n">geoms</span><span class="p">:</span>
                <span class="n">source_rings_meta</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">Polygon</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">exterior</span><span class="p">),</span> <span class="kc">False</span><span class="p">,</span> <span class="n">source_id</span><span class="p">))</span>
                <span class="n">source_rings_meta</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">Polygon</span><span class="p">(</span><span class="n">inter</span><span class="p">),</span> <span class="kc">True</span><span class="p">,</span> <span class="n">source_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">inter</span> <span class="ow">in</span> <span class="n">poly</span><span class="o">.</span><span class="n">interiors</span>
                <span class="p">)</span>

        <span class="k">for</span> <span class="n">target_id</span><span class="p">,</span> <span class="n">target_cmds</span> <span class="ow">in</span> <span class="n">target_ids_and_cmds</span><span class="p">:</span>
            <span class="n">shape_mp</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="n">target_cmds</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">max_len</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">)</span><span class="o">.</span><span class="n">to_multipolygon</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">shape_mp</span><span class="o">.</span><span class="n">geoms</span><span class="p">:</span>
                <span class="n">target_rings_meta</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">Polygon</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">exterior</span><span class="p">),</span> <span class="kc">False</span><span class="p">,</span> <span class="n">target_id</span><span class="p">))</span>
                <span class="n">target_rings_meta</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">Polygon</span><span class="p">(</span><span class="n">inter</span><span class="p">),</span> <span class="kc">True</span><span class="p">,</span> <span class="n">target_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">inter</span> <span class="ow">in</span> <span class="n">poly</span><span class="o">.</span><span class="n">interiors</span>
                <span class="p">)</span>

        <span class="c1"># 2) Pair individual rings extracted from those compounds</span>
        <span class="n">matched</span><span class="p">,</span> <span class="n">unmatched_src</span><span class="p">,</span> <span class="n">unmatched_tgt</span> <span class="o">=</span> <span class="n">_pair_rings</span><span class="p">(</span>
            <span class="n">source_rings_meta</span><span class="p">,</span>
            <span class="n">target_rings_meta</span><span class="p">,</span>
            <span class="n">w_dist</span><span class="p">,</span>
            <span class="n">w_area</span><span class="p">,</span>
            <span class="n">w_overlap</span><span class="p">,</span>
            <span class="n">cost_threshold</span><span class="p">,</span>
            <span class="n">ensure_shell_pairs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># 3) Resample each paired ring so that both have the same vertex count</span>
        <span class="n">resampled</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">LinearRing</span><span class="p">,</span> <span class="n">LinearRing</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">src_r</span><span class="p">,</span> <span class="n">tgt_r</span><span class="p">,</span> <span class="n">is_hole</span><span class="p">,</span> <span class="n">source_id</span><span class="p">,</span> <span class="n">target_id</span> <span class="ow">in</span> <span class="n">matched</span><span class="p">:</span>
            <span class="n">n_src</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">src_r</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">n_tgt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tgt_r</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">n_pts</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">n_src</span><span class="p">,</span> <span class="n">n_tgt</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="n">resampled</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">_resample_loop</span><span class="p">(</span><span class="n">src_r</span><span class="p">,</span> <span class="n">n_pts</span><span class="p">),</span>
                    <span class="n">_resample_loop</span><span class="p">(</span><span class="n">tgt_r</span><span class="p">,</span> <span class="n">n_pts</span><span class="p">),</span>
                    <span class="n">is_hole</span><span class="p">,</span>
                    <span class="n">source_id</span><span class="p">,</span>
                    <span class="n">target_id</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">resampled</span><span class="p">,</span> <span class="n">unmatched_src</span><span class="p">,</span> <span class="n">unmatched_tgt</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">morph</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">target</span><span class="p">:</span> <span class="s2">&quot;Shape&quot;</span><span class="p">,</span>
        <span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">max_len</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">16.0</span><span class="p">,</span>
        <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">min_point_spacing</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">w_dist</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.55</span><span class="p">,</span>
        <span class="n">w_area</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.35</span><span class="p">,</span>
        <span class="n">w_overlap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="n">cost_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.5</span><span class="p">,</span>
        <span class="n">ensure_shell_pairs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Interpolate the current shape toward a target shape.</span>

<span class="sd">        This method computes an intermediate shape by morphing the current shape into a target shape based on an interpolation factor t (where 0 corresponds to the source shape and 1 corresponds to the target shape).</span>
<span class="sd">        The morph is performed by decomposing both shapes into closed ring segments and matching corresponding rings based on spatial properties. Matched rings are linearly interpolated, and unmatched rings are processed to appear or disappear gradually.</span>

<span class="sd">        Args:</span>
<span class="sd">            target: The target shape to morph into.</span>
<span class="sd">            t: Interpolation factor between 0 and 1, where 0 returns the original shape and 1 returns the target shape.</span>
<span class="sd">            max_len: The maximum allowed length for any line segment when splitting curves before morphing.</span>
<span class="sd">            tolerance: The tolerance angle in degrees used when flattening curves.</span>
<span class="sd">            min_point_spacing: Per-axis spacing threshold - a vertex is kept only if both `|x|` and `|y|` from the previous vertex are  this value (increasing it will boost performance during reproduction, but lower accuracy).</span>
<span class="sd">            w_dist: Weight for the centroid-distance term (higher values make proximity more important).</span>
<span class="sd">            w_area: Weight for the relative area-difference term (higher values make size similarity more important).</span>
<span class="sd">            w_overlap: Weight for the overlap / IoU term that penalises pairs with little spatial intersection.</span>
<span class="sd">            cost_threshold: Maximum acceptable cost for a pairing. Pairs whose cost is above this threshold are treated as unmatched and will grow/shrink to the closest centroid.</span>
<span class="sd">            ensure_shell_pairs: If `True`, shell rings that would otherwise remain unmatched will be force-paired with the shell that yields the minimum cost. This guarantees that every visible contour morphs into something, at the price of allowing the same shell to be reused multiple times.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Shape: A new Shape instance representing the intermediate morph state.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; source = Shape(&quot;m 0 0 l 100 0 100 100 0 100 c&quot;)</span>
<span class="sd">            &gt;&gt;&gt; target = Shape(&quot;m 50 50 l 150 50 150 150 50 150 c&quot;)</span>
<span class="sd">            &gt;&gt;&gt; morph = source.morph(target, t=0.5)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Fast-path validations</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Shape</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Target must be a Shape instance&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;t must be between 0 and 1&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">target</span>

        <span class="c1"># Use the multi-shape morphing routine to get intermediate geometries.</span>
        <span class="n">morphs</span> <span class="o">=</span> <span class="n">Shape</span><span class="o">.</span><span class="n">morph_multi</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;_&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;_&quot;</span><span class="p">:</span> <span class="n">target</span><span class="p">},</span>
            <span class="n">t</span><span class="p">,</span>
            <span class="n">max_len</span><span class="o">=</span><span class="n">max_len</span><span class="p">,</span>
            <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="p">,</span>
            <span class="n">min_point_spacing</span><span class="o">=</span><span class="n">min_point_spacing</span><span class="p">,</span>
            <span class="n">w_dist</span><span class="o">=</span><span class="n">w_dist</span><span class="p">,</span>
            <span class="n">w_area</span><span class="o">=</span><span class="n">w_area</span><span class="p">,</span>
            <span class="n">w_overlap</span><span class="o">=</span><span class="n">w_overlap</span><span class="p">,</span>
            <span class="n">cost_threshold</span><span class="o">=</span><span class="n">cost_threshold</span><span class="p">,</span>
            <span class="n">ensure_shell_pairs</span><span class="o">=</span><span class="n">ensure_shell_pairs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">shapes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">morphs</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">combined_shape</span> <span class="o">=</span> <span class="n">shapes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">combined_shape</span> <span class="o">=</span> <span class="n">combined_shape</span><span class="o">.</span><span class="n">boolean</span><span class="p">(</span>
                <span class="n">shape</span><span class="p">,</span>
                <span class="n">op</span><span class="o">=</span><span class="s2">&quot;union&quot;</span><span class="p">,</span>
                <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="p">,</span>
                <span class="n">min_point_spacing</span><span class="o">=</span><span class="n">min_point_spacing</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">combined_shape</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">morph_multi</span><span class="p">(</span>
        <span class="n">src_shapes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;Shape&quot;</span><span class="p">],</span>
        <span class="n">tgt_shapes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;Shape&quot;</span><span class="p">],</span>
        <span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">max_len</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">16.0</span><span class="p">,</span>
        <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">min_point_spacing</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">w_dist</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.55</span><span class="p">,</span>
        <span class="n">w_area</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.35</span><span class="p">,</span>
        <span class="n">w_overlap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="n">cost_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.5</span><span class="p">,</span>
        <span class="n">ensure_shell_pairs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">],</span> <span class="s2">&quot;Shape&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Interpolate multiple shapes simultaneously.</span>

<span class="sd">        This class method performs a multi-shape morphing operation by interpolating between collections of source and target shapes.</span>
<span class="sd">        It decomposes each shape into rings, matches corresponding rings across the source and target collections based on spatial relationships, and computes intermediate shapes at a given interpolation factor t.</span>
<span class="sd">        The output is a dictionary mapping source-target identifier tuples to the resulting interpolated Shape.</span>

<span class="sd">        Args:</span>
<span class="sd">            src_shapes: A dictionary mapping source shape identifiers to their corresponding Shape instances.</span>
<span class="sd">            tgt_shapes: A dictionary mapping target shape identifiers to their corresponding Shape instances.</span>
<span class="sd">            t: Interpolation factor between 0 and 1. A value of 0 returns the source shapes and 1 returns the target shapes.</span>
<span class="sd">            max_len: Maximum allowed length for any line segment after splitting curves.</span>
<span class="sd">            tolerance: The tolerance angle in degrees used when flattening curves.</span>
<span class="sd">            min_point_spacing: Per-axis spacing threshold - a vertex is kept only if both `|x|` and `|y|` from the previous vertex are  this value (increasing it will boost performance during reproduction, but lower accuracy).</span>
<span class="sd">            w_dist: Weight for the centroid-distance term (higher values make proximity more important).</span>
<span class="sd">            w_area: Weight for the relative area-difference term (higher values make size similarity more important).</span>
<span class="sd">            w_overlap: Weight for the overlap / IoU term that penalises pairs with little spatial intersection.</span>
<span class="sd">            cost_threshold: Maximum acceptable cost for a pairing. Pairs whose cost is above this threshold are treated as unmatched and will grow/shrink to the closest centroid.</span>
<span class="sd">            ensure_shell_pairs: If `True`, shell rings that would otherwise remain unmatched will be force-paired with the shell that yields the minimum cost. This guarantees that every visible contour morphs into something, at the price of allowing the same shell to be reused multiple times.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[tuple[str | None, str | None], Shape]: A dictionary mapping tuples of source and target identifiers to the corresponding interpolated Shape. A source identifier of None indicates an appearing shape, while a target identifier of None indicates a disappearing shape.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; src = { &#39;A&#39;: Shape.star(5, 20, 40), &#39;B&#39;: Shape.ellipse(50, 30).move(100, 0) }</span>
<span class="sd">            &gt;&gt;&gt; tgt = { &#39;X&#39;: Shape.polygon(6, 45) }</span>
<span class="sd">            &gt;&gt;&gt; morphs = Shape.morph_multi(src, tgt, t=0.5)</span>
<span class="sd">            &gt;&gt;&gt; for (src_id, tgt_id), shape in morphs.items():</span>
<span class="sd">            ...     print(f&quot;{src_id} -&gt; {tgt_id}: {shape}&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Basic validation</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;t must be between 0 and 1&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">Shape</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">src_shapes</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;All src_shapes values must be Shape instances&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">Shape</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">tgt_shapes</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;All tgt_shapes values must be Shape instances&quot;</span><span class="p">)</span>

        <span class="c1"># Fast-paths</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src_shapes</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{(</span><span class="kc">None</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tgt_shapes</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_morph_transition</span><span class="p">(</span>
            <span class="n">ring</span><span class="p">:</span> <span class="n">LinearRing</span><span class="p">,</span>
            <span class="n">ref_pt</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span>
            <span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
            <span class="n">appearing</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LinearRing</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Morphism helper shared by *appearing* and *disappearing* rings.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">appearing</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">appearing</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">ring</span>

            <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ring</span><span class="o">.</span><span class="n">coords</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">appearing</span><span class="p">:</span>
                <span class="c1"># Grow *ring* from *ref_pt*</span>
                <span class="n">origin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ref_pt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ref_pt</span><span class="o">.</span><span class="n">y</span><span class="p">])</span>
                <span class="n">new_coords</span> <span class="o">=</span> <span class="n">origin</span> <span class="o">+</span> <span class="p">(</span><span class="n">coords</span> <span class="o">-</span> <span class="n">origin</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Shrink *ring* towards *ref_pt*</span>
                <span class="n">centroid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ring</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">dest</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ref_pt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ref_pt</span><span class="o">.</span><span class="n">y</span><span class="p">])</span>
                <span class="n">new_coords</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">centroid</span> <span class="o">+</span> <span class="p">(</span><span class="n">coords</span> <span class="o">-</span> <span class="n">centroid</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">dest</span> <span class="o">-</span> <span class="n">centroid</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span>
                <span class="p">)</span>

            <span class="n">new_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">new_coords</span><span class="p">,</span> <span class="n">new_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>  <span class="c1"># close ring</span>
            <span class="k">return</span> <span class="n">LinearRing</span><span class="p">(</span><span class="n">new_coords</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_interpolate_rings</span><span class="p">(</span>
            <span class="n">src_ring</span><span class="p">:</span> <span class="n">LinearRing</span><span class="p">,</span> <span class="n">tgt_ring</span><span class="p">:</span> <span class="n">LinearRing</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LinearRing</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Linear interpolation between two rings with optimal vertex correspondence.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">src_ring</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">tgt_ring</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">src_ring</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tgt_ring</span><span class="o">.</span><span class="n">coords</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Rings must have the same number of vertices: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">src_ring</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tgt_ring</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="n">src_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">src_ring</span><span class="o">.</span><span class="n">coords</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">tgt_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tgt_ring</span><span class="o">.</span><span class="n">coords</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

            <span class="c1"># Ensure orientation consistency</span>
            <span class="k">if</span> <span class="n">src_ring</span><span class="o">.</span><span class="n">is_ccw</span> <span class="o">!=</span> <span class="n">tgt_ring</span><span class="o">.</span><span class="n">is_ccw</span><span class="p">:</span>
                <span class="n">tgt_coords</span> <span class="o">=</span> <span class="n">tgt_coords</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># Find optimal alignment by minimizing total vertex distances</span>
            <span class="n">n_vertices</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">src_coords</span><span class="p">)</span>
            <span class="n">min_total_distance</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
            <span class="n">best_shift</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># Try all possible rotations and find the one with minimum total distance</span>
            <span class="k">for</span> <span class="n">shift</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_vertices</span><span class="p">):</span>
                <span class="n">shifted_tgt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">tgt_coords</span><span class="p">,</span> <span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">total_distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">src_coords</span> <span class="o">-</span> <span class="n">shifted_tgt</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">total_distance</span> <span class="o">&lt;</span> <span class="n">min_total_distance</span><span class="p">:</span>
                    <span class="n">min_total_distance</span> <span class="o">=</span> <span class="n">total_distance</span>
                    <span class="n">best_shift</span> <span class="o">=</span> <span class="n">shift</span>

            <span class="c1"># Apply the best alignment</span>
            <span class="k">if</span> <span class="n">best_shift</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">tgt_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">tgt_coords</span><span class="p">,</span> <span class="o">-</span><span class="n">best_shift</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># Perform linear interpolation between corresponding vertices</span>
            <span class="n">interp_coords</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">src_coords</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">tgt_coords</span>

            <span class="c1"># Close the ring</span>
            <span class="n">interp_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">interp_coords</span><span class="p">,</span> <span class="n">interp_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="k">return</span> <span class="n">LinearRing</span><span class="p">(</span><span class="n">interp_coords</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_rings_to_multipolygon</span><span class="p">(</span>
            <span class="n">rings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">LinearRing</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]],</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MultiPolygon</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Convert a collection of `(ring, is_hole)` tuples to a `MultiPolygon`.&quot;&quot;&quot;</span>

            <span class="c1"># Gather polygons (shells and holes)</span>
            <span class="n">shell_polys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Polygon</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">hole_polys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Polygon</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">lr</span><span class="p">,</span> <span class="n">is_hole</span> <span class="ow">in</span> <span class="n">rings</span><span class="p">:</span>
                <span class="n">poly</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">lr</span><span class="p">)</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">poly</span><span class="o">.</span><span class="n">is_empty</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">poly</span><span class="o">.</span><span class="n">is_valid</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="p">(</span><span class="n">hole_polys</span> <span class="k">if</span> <span class="n">is_hole</span> <span class="k">else</span> <span class="n">shell_polys</span><span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>

            <span class="c1"># Union the shells and holes</span>
            <span class="n">shell_union</span> <span class="o">=</span> <span class="n">unary_union</span><span class="p">(</span><span class="n">shell_polys</span><span class="p">)</span> <span class="k">if</span> <span class="n">shell_polys</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">hole_union</span> <span class="o">=</span> <span class="n">unary_union</span><span class="p">(</span><span class="n">hole_polys</span><span class="p">)</span> <span class="k">if</span> <span class="n">hole_polys</span> <span class="k">else</span> <span class="kc">None</span>

            <span class="c1"># Subtract the holes from the shells (if any)</span>
            <span class="k">if</span> <span class="n">shell_union</span> <span class="ow">and</span> <span class="n">hole_union</span><span class="p">:</span>
                <span class="n">combined</span> <span class="o">=</span> <span class="n">shell_union</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">hole_union</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">shell_union</span><span class="p">:</span>
                <span class="n">combined</span> <span class="o">=</span> <span class="n">shell_union</span>
            <span class="k">elif</span> <span class="n">hole_union</span><span class="p">:</span>
                <span class="n">combined</span> <span class="o">=</span> <span class="n">hole_union</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">MultiPolygon</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">combined</span><span class="p">,</span> <span class="n">MultiPolygon</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">combined</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">combined</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">MultiPolygon</span><span class="p">([</span><span class="n">combined</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Combined geometry is not a Polygon or MultiPolygon&quot;</span><span class="p">)</span>

        <span class="c1"># 1) Retrieve pairing &amp; resampling information (cached)</span>
        <span class="n">src_cmds</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">drawing_cmds</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">src_shapes</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
        <span class="n">dst_cmds</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">drawing_cmds</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">tgt_shapes</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>

        <span class="n">paired</span><span class="p">,</span> <span class="n">src_unmatched</span><span class="p">,</span> <span class="n">tgt_unmatched</span> <span class="o">=</span> <span class="n">Shape</span><span class="o">.</span><span class="n">_prepare_morph</span><span class="p">(</span>
            <span class="n">src_cmds</span><span class="p">,</span>
            <span class="n">dst_cmds</span><span class="p">,</span>
            <span class="n">max_len</span><span class="p">,</span>
            <span class="n">tolerance</span><span class="p">,</span>
            <span class="n">w_dist</span><span class="p">,</span>
            <span class="n">w_area</span><span class="p">,</span>
            <span class="n">w_overlap</span><span class="p">,</span>
            <span class="n">cost_threshold</span><span class="p">,</span>
            <span class="n">ensure_shell_pairs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># 2) Interpolate matched rings</span>
        <span class="n">result_rings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">LinearRing</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">_interpolate_rings</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">tgt</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="n">is_hole</span><span class="p">,</span> <span class="n">src_id</span><span class="p">,</span> <span class="n">tgt_id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">tgt</span><span class="p">,</span> <span class="n">is_hole</span><span class="p">,</span> <span class="n">src_id</span><span class="p">,</span> <span class="n">tgt_id</span> <span class="ow">in</span> <span class="n">paired</span>
        <span class="p">]</span>

        <span class="c1"># 3) Handle disappearing / appearing rings</span>
        <span class="k">for</span> <span class="n">ring</span><span class="p">,</span> <span class="n">dest_pt</span><span class="p">,</span> <span class="n">is_hole</span><span class="p">,</span> <span class="n">src_id</span> <span class="ow">in</span> <span class="n">src_unmatched</span><span class="p">:</span>
            <span class="n">result_rings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">_morph_transition</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="n">dest_pt</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">appearing</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
                    <span class="n">is_hole</span><span class="p">,</span>
                    <span class="n">src_id</span><span class="p">,</span>
                    <span class="kc">None</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">ring</span><span class="p">,</span> <span class="n">origin_pt</span><span class="p">,</span> <span class="n">is_hole</span><span class="p">,</span> <span class="n">tgt_id</span> <span class="ow">in</span> <span class="n">tgt_unmatched</span><span class="p">:</span>
            <span class="n">result_rings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">_morph_transition</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="n">origin_pt</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">appearing</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                    <span class="n">is_hole</span><span class="p">,</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="n">tgt_id</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># 4) Group by (shape_id, target_id)</span>
        <span class="c1">#    Holes coming from / going to *None* (i.e. appearing/disappearing) must be</span>
        <span class="c1">#    subtracted from *every* shape  they are collected in `global_holes` and</span>
        <span class="c1">#    later injected into every flow.</span>

        <span class="n">global_holes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">LinearRing</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># always [(ring, True)]</span>
        <span class="n">flows</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">LinearRing</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">ring</span><span class="p">,</span> <span class="n">is_hole</span><span class="p">,</span> <span class="n">src_id</span><span class="p">,</span> <span class="n">tgt_id</span> <span class="ow">in</span> <span class="n">result_rings</span><span class="p">:</span>
            <span class="c1"># If the ring is a hole and one side of the morph is missing, treat it as</span>
            <span class="c1"># a *global* hole that has to be removed from every resulting geometry.</span>
            <span class="k">if</span> <span class="n">is_hole</span> <span class="ow">and</span> <span class="p">(</span><span class="n">src_id</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">tgt_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">global_holes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ring</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
                <span class="k">continue</span>

            <span class="n">flows</span><span class="o">.</span><span class="n">setdefault</span><span class="p">((</span><span class="n">src_id</span><span class="p">,</span> <span class="n">tgt_id</span><span class="p">),</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ring</span><span class="p">,</span> <span class="n">is_hole</span><span class="p">))</span>

        <span class="c1"># Inject global holes into every shape flow so they are diffed out.</span>
        <span class="k">if</span> <span class="n">global_holes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ring_list</span> <span class="ow">in</span> <span class="n">flows</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">ring_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">global_holes</span><span class="p">)</span>

        <span class="c1"># 5) Convert back to Shape and return as dictionary</span>
        <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">],</span> <span class="n">Shape</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">src_id</span><span class="p">,</span> <span class="n">tgt_id</span><span class="p">),</span> <span class="n">ring_list</span> <span class="ow">in</span> <span class="n">flows</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">mp</span> <span class="o">=</span> <span class="n">_rings_to_multipolygon</span><span class="p">(</span><span class="n">ring_list</span><span class="p">)</span>
            <span class="n">result</span><span class="p">[(</span><span class="n">src_id</span><span class="p">,</span> <span class="n">tgt_id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">Shape</span><span class="o">.</span><span class="n">from_multipolygon</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span> <span class="n">min_point_spacing</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">PIXEL</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;m 0 1 l 0 0 1 0 1 1&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A string representing a pixel.&quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">triangle</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a triangle centered at the origin with the specified width and height.</span>

<span class="sd">        The triangle is defined by three vertices:</span>
<span class="sd">        - Top vertex at (0, height/2).</span>
<span class="sd">        - Bottom-left vertex at (-width/2, -height/2).</span>
<span class="sd">        - Bottom-right vertex at (width/2, -height/2).</span>

<span class="sd">        Args:</span>
<span class="sd">            width: The width of the triangle base (must be positive).</span>
<span class="sd">            height: The height of the triangle (must be positive).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Shape: A new Shape instance representing the triangle.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">width</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">height</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Width and height must be positive&quot;</span><span class="p">)</span>

        <span class="c1"># Calculate vertices</span>
        <span class="n">half_w</span> <span class="o">=</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">half_h</span> <span class="o">=</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">half_h</span><span class="p">),</span>  <span class="c1"># Top vertex</span>
            <span class="p">(</span><span class="o">-</span><span class="n">half_w</span><span class="p">,</span> <span class="o">-</span><span class="n">half_h</span><span class="p">),</span>  <span class="c1"># Bottom-left vertex</span>
            <span class="p">(</span><span class="n">half_w</span><span class="p">,</span> <span class="o">-</span><span class="n">half_h</span><span class="p">),</span>  <span class="c1"># Bottom-right vertex</span>
        <span class="p">]</span>

        <span class="c1"># Build ASS path command</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">format_value</span>
        <span class="n">path_parts</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;m </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">vertices</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">path_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;l </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">vertex</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">vertex</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_parts</span><span class="p">))</span><span class="o">.</span><span class="n">align</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rectangle</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a rectangle shape with the specified width and height.</span>

<span class="sd">        Args:</span>
<span class="sd">            width: The width of the rectangle (must be positive).</span>
<span class="sd">            height: The height of the rectangle (must be positive).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Shape: A new Shape instance representing the rectangle.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">width</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">height</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Width and height must be positive&quot;</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">format_value</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="s2">&quot;m 0 0 l </span><span class="si">%s</span><span class="s2"> 0 </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> 0 </span><span class="si">%s</span><span class="s2"> 0 0&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">width</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">width</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">height</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">height</span><span class="p">))</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">square</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a square shape with the given side length.</span>

<span class="sd">        Args:</span>
<span class="sd">            size: The side length of the square (must be positive).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Shape: A new Shape instance representing the square.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rounded_rectangle</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a rounded rectangle shape.</span>

<span class="sd">        Args:</span>
<span class="sd">            width: Rectangle width in pixels (must be positive).</span>
<span class="sd">            height: Rectangle height in pixels (must be positive).</span>
<span class="sd">            radius: Corner radius in pixels (must be &lt;= min(width/2, height/2)).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Shape: A rounded rectangle with origin at top-left (0,0), extending to (width, height).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">width</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">height</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Width and height must be positive&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">radius</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Radius must be non-negative&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">radius</span> <span class="o">&gt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Radius is too large for the given dimensions&quot;</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">format_value</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mf">0.5522847498</span> <span class="o">*</span> <span class="n">radius</span>  <span class="c1"># Bezier approximation constant</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">radius</span>

        <span class="c1"># Each tuple: (line_end_x, line_end_y, bezier_c1x, c1y, c2x, c2y, end_x, end_y)</span>
        <span class="n">segments</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="n">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">w</span> <span class="o">-</span> <span class="n">r</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">r</span><span class="p">),</span>  <span class="c1"># Top edge + top-right corner</span>
            <span class="p">(</span>
                <span class="n">w</span><span class="p">,</span>
                <span class="n">h</span> <span class="o">-</span> <span class="n">r</span><span class="p">,</span>
                <span class="n">w</span><span class="p">,</span>
                <span class="n">h</span> <span class="o">-</span> <span class="n">r</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span>
                <span class="n">w</span> <span class="o">-</span> <span class="n">k</span><span class="p">,</span>
                <span class="n">h</span><span class="p">,</span>
                <span class="n">w</span> <span class="o">-</span> <span class="n">r</span><span class="p">,</span>
                <span class="n">h</span><span class="p">,</span>
            <span class="p">),</span>  <span class="c1"># Right edge + bottom-right corner</span>
            <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">r</span> <span class="o">-</span> <span class="n">k</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">h</span> <span class="o">-</span> <span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">h</span> <span class="o">-</span> <span class="n">r</span><span class="p">),</span>  <span class="c1"># Bottom edge + bottom-left corner</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r</span> <span class="o">-</span> <span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>  <span class="c1"># Left edge + top-left corner</span>
        <span class="p">]</span>

        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;m </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">lx</span><span class="p">,</span> <span class="n">ly</span><span class="p">,</span> <span class="n">c1x</span><span class="p">,</span> <span class="n">c1y</span><span class="p">,</span> <span class="n">c2x</span><span class="p">,</span> <span class="n">c2y</span><span class="p">,</span> <span class="n">ex</span><span class="p">,</span> <span class="n">ey</span> <span class="ow">in</span> <span class="n">segments</span><span class="p">:</span>
            <span class="n">cmd</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;l </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">lx</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">ly</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;b </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">c1x</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">c1y</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">c2x</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">c2y</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">ey</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">polygon</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">edges</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">side_length</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a regular n-sided polygon shape.</span>

<span class="sd">        Args:</span>
<span class="sd">            edges: Number of sides for the polygon (must be at least 3).</span>
<span class="sd">            side_length: The length of each side (must be positive).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Shape: A Shape object representing the polygon.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">edges</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Edges must be  3&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">side_length</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Side length must be positive&quot;</span><span class="p">)</span>

        <span class="c1"># Calculate circumradius from side length</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="n">side_length</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">edges</span><span class="p">))</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">format_value</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Rotate to get a more natural orientation (flat bottom when possible)</span>
        <span class="n">angle_offset</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">edges</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">edges</span><span class="p">):</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="n">edges</span> <span class="o">+</span> <span class="n">angle_offset</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
            <span class="n">pts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">y</span><span class="p">)))</span>

        <span class="n">cmd_parts</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;m </span><span class="si">{</span><span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> l&quot;</span><span class="p">]</span>
        <span class="n">cmd_parts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd_parts</span><span class="p">))</span><span class="o">.</span><span class="n">align</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ellipse</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates an ellipse shape centered at the origin.</span>

<span class="sd">        Args:</span>
<span class="sd">            w: The width of the ellipse.</span>
<span class="sd">            h: The height of the ellipse.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Shape: A Shape object representing the ellipse.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">w2</span><span class="p">,</span> <span class="n">h2</span> <span class="o">=</span> <span class="n">w</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Number(s) expected&quot;</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">format_value</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="s2">&quot;m 0 </span><span class="si">%s</span><span class="s2"> &quot;</span>
            <span class="s2">&quot;b 0 </span><span class="si">%s</span><span class="s2"> 0 0 </span><span class="si">%s</span><span class="s2"> 0 &quot;</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> 0 </span><span class="si">%s</span><span class="s2"> 0 </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> &quot;</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> &quot;</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> 0 </span><span class="si">%s</span><span class="s2"> 0 </span><span class="si">%s</span><span class="s2">&quot;</span>
            <span class="o">%</span> <span class="p">(</span>
                <span class="n">f</span><span class="p">(</span><span class="n">h2</span><span class="p">),</span>  <span class="c1"># move</span>
                <span class="n">f</span><span class="p">(</span><span class="n">h2</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">w2</span><span class="p">),</span>  <span class="c1"># curve 1</span>
                <span class="n">f</span><span class="p">(</span><span class="n">w2</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">h2</span><span class="p">),</span>  <span class="c1"># curve 2</span>
                <span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">h2</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">h</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">w2</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">h</span><span class="p">),</span>  <span class="c1"># curve 3</span>
                <span class="n">f</span><span class="p">(</span><span class="n">w2</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">h</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">h</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">h2</span><span class="p">),</span>  <span class="c1"># curve 4</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">circle</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a circle shape with the given radius.</span>

<span class="sd">        Args:</span>
<span class="sd">            radius: The radius of the circle (must be positive).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Shape: A new Shape instance representing the circle.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">ellipse</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">radius</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">radius</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ring</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">out_r</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">in_r</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a ring shape with specified inner and outer radii centered at the origin.</span>

<span class="sd">        Args:</span>
<span class="sd">            out_r: The outer radius of the ring.</span>
<span class="sd">            in_r: The inner radius of the ring (must be less than out_r).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Shape: A Shape object representing the ring.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">out_r2</span><span class="p">,</span> <span class="n">in_r2</span> <span class="o">=</span> <span class="n">out_r</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">in_r</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="n">off</span> <span class="o">=</span> <span class="n">out_r</span> <span class="o">-</span> <span class="n">in_r</span>
            <span class="n">off_in_r</span> <span class="o">=</span> <span class="n">off</span> <span class="o">+</span> <span class="n">in_r</span>
            <span class="n">off_in_r2</span> <span class="o">=</span> <span class="n">off</span> <span class="o">+</span> <span class="n">in_r2</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Number(s) expected&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">in_r</span> <span class="o">&gt;=</span> <span class="n">out_r</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Valid number expected. Inner radius must be less than outer radius&quot;</span>
            <span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">format_value</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="s2">&quot;m 0 </span><span class="si">%s</span><span class="s2"> &quot;</span>
            <span class="s2">&quot;b 0 </span><span class="si">%s</span><span class="s2"> 0 0 </span><span class="si">%s</span><span class="s2"> 0 &quot;</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> 0 </span><span class="si">%s</span><span class="s2"> 0 </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> &quot;</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> &quot;</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> 0 </span><span class="si">%s</span><span class="s2"> 0 </span><span class="si">%s</span><span class="s2"> &quot;</span>
            <span class="s2">&quot;m </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> &quot;</span>
            <span class="s2">&quot;b </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> &quot;</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> &quot;</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> &quot;</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span>
            <span class="o">%</span> <span class="p">(</span>
                <span class="n">f</span><span class="p">(</span><span class="n">out_r</span><span class="p">),</span>  <span class="c1"># outer move</span>
                <span class="n">f</span><span class="p">(</span><span class="n">out_r</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">out_r</span><span class="p">),</span>  <span class="c1"># outer curve 1</span>
                <span class="n">f</span><span class="p">(</span><span class="n">out_r</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">out_r2</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">out_r2</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">out_r</span><span class="p">),</span>  <span class="c1"># outer curve 2</span>
                <span class="n">f</span><span class="p">(</span><span class="n">out_r2</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">out_r</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">out_r2</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">out_r2</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">out_r</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">out_r2</span><span class="p">),</span>  <span class="c1"># outer curve 3</span>
                <span class="n">f</span><span class="p">(</span><span class="n">out_r</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">out_r2</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">out_r2</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">out_r</span><span class="p">),</span>  <span class="c1"># outer curve 4</span>
                <span class="n">f</span><span class="p">(</span><span class="n">off</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">off_in_r</span><span class="p">),</span>  <span class="c1"># inner move</span>
                <span class="n">f</span><span class="p">(</span><span class="n">off</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">off_in_r</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">off</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">off_in_r2</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">off_in_r</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">off_in_r2</span><span class="p">),</span>  <span class="c1"># inner curve 1</span>
                <span class="n">f</span><span class="p">(</span><span class="n">off_in_r</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">off_in_r2</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">off_in_r2</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">off_in_r2</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">off_in_r2</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">off_in_r</span><span class="p">),</span>  <span class="c1"># inner curve 2</span>
                <span class="n">f</span><span class="p">(</span><span class="n">off_in_r2</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">off_in_r</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">off_in_r2</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">off</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">off_in_r</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">off</span><span class="p">),</span>  <span class="c1"># inner curve 3</span>
                <span class="n">f</span><span class="p">(</span><span class="n">off_in_r</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">off</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">off</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">off</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">off</span><span class="p">),</span>
                <span class="n">f</span><span class="p">(</span><span class="n">off_in_r</span><span class="p">),</span>  <span class="c1"># inner curve 4</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">heart</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a heart shape with specified dimensions and vertical offset.</span>

<span class="sd">        Args:</span>
<span class="sd">            size: The width and height of the heart.</span>
<span class="sd">            offset: The vertical offset for the heart&#39;s center point (default is 0).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Shape: A Shape object representing the heart.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mult</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">size</span> <span class="o">/</span> <span class="mi">30</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Size parameter must be a number&quot;</span><span class="p">)</span>
        <span class="c1"># Build shape from template</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="s2">&quot;m 15 30 b 27 22 30 18 30 14 30 8 22 0 15 10 8 0 0 8 0 14 0 18 3 22 15 30&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">mult</span><span class="p">)</span>

        <span class="c1"># Shift mid point of heart vertically</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">shift_mid_point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">nonlocal</span> <span class="n">count</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">offset</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Offset parameter must be a number&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

        <span class="c1"># Return result</span>
        <span class="k">return</span> <span class="n">shape</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">shift_mid_point</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_glance_or_star</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">edges</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">inner_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">outer_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">g_or_s</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates a shape for a star or glance based on provided parameters.</span>

<span class="sd">        Args:</span>
<span class="sd">            edges: The number of edges in the shape.</span>
<span class="sd">            inner_size: The size used for the inner vertex or control points.</span>
<span class="sd">            outer_size: The size used for the outer vertex.</span>
<span class="sd">            g_or_s: Flag to determine the style (&#39;l&#39; for star with lines, &#39;b&#39; for glance with curves).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Shape: A Shape object representing the generated star or glance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Alias for utility functions</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">format_value</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">rotate_on_axis_z</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
            <span class="c1"># Internal function to rotate a point around z axis by a given angle.</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Quaternion</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">angle</span><span class="o">=</span><span class="n">theta</span><span class="p">)</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>

        <span class="c1"># Building shape</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;m 0 </span><span class="si">{</span><span class="o">-</span><span class="n">outer_size</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">g_or_s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">inner_p</span><span class="p">,</span> <span class="n">outer_p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">edges</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># Inner edge</span>
            <span class="n">inner_p</span> <span class="o">=</span> <span class="n">rotate_on_axis_z</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">inner_size</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">((</span><span class="n">i</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="n">edges</span><span class="p">)</span> <span class="o">*</span> <span class="mi">360</span><span class="p">)</span>
            <span class="c1"># Outer edge</span>
            <span class="n">outer_p</span> <span class="o">=</span> <span class="n">rotate_on_axis_z</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">outer_size</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="n">edges</span><span class="p">)</span> <span class="o">*</span> <span class="mi">360</span><span class="p">)</span>
            <span class="c1"># Add curve / line</span>
            <span class="k">if</span> <span class="n">g_or_s</span> <span class="o">==</span> <span class="s2">&quot;l&quot;</span><span class="p">:</span>
                <span class="n">shape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">inner_p</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">f</span><span class="p">(</span><span class="n">inner_p</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">f</span><span class="p">(</span><span class="n">outer_p</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">f</span><span class="p">(</span><span class="n">outer_p</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span>
                    <span class="o">%</span> <span class="p">(</span>
                        <span class="n">f</span><span class="p">(</span><span class="n">inner_p</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="n">f</span><span class="p">(</span><span class="n">inner_p</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="n">f</span><span class="p">(</span><span class="n">inner_p</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="n">f</span><span class="p">(</span><span class="n">inner_p</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="n">f</span><span class="p">(</span><span class="n">outer_p</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="n">f</span><span class="p">(</span><span class="n">outer_p</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="n">shape</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>

        <span class="c1"># Return result centered</span>
        <span class="k">return</span> <span class="n">shape</span><span class="o">.</span><span class="n">align</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">star</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">edges</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">inner_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">outer_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a star shape centered at the origin.</span>

<span class="sd">        Args:</span>
<span class="sd">            edges: The number of edges for the star.</span>
<span class="sd">            inner_size: The distance from the center to the inner vertices.</span>
<span class="sd">            outer_size: The distance from the center to the outer vertices.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Shape: A Shape object representing the star.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_glance_or_star</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">inner_size</span><span class="p">,</span> <span class="n">outer_size</span><span class="p">,</span> <span class="s2">&quot;l&quot;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">glance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">edges</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">inner_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">outer_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a glance shape with curved transitions between edges.</span>

<span class="sd">        Args:</span>
<span class="sd">            edges: The number of edges for the glance.</span>
<span class="sd">            inner_size: The distance from the center to the inner control points.</span>
<span class="sd">            outer_size: The control point distance for the curves between outer edges.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Shape: A Shape object representing the glance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_glance_or_star</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">inner_size</span><span class="p">,</span> <span class="n">outer_size</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="pyonfx.shape.Shape.elements" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">elements</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>The shape's elements as a list of :class:<code>ShapeElement</code> objects.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="pyonfx.shape.Shape.drawing_cmds" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">drawing_cmds</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>The shape's drawing commands in ASS format as a string.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="pyonfx.shape.Shape.PIXEL" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">PIXEL</span> <span class="o">=</span> <span class="s1">&#39;m 0 1 l 0 0 1 0 1 1&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>A string representing a pixel.</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="pyonfx.shape.Shape.to_multipolygon" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_multipolygon</span><span class="p">(</span><span class="n">tolerance</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Convert the shape to a Shapely MultiPolygon.</p>
<p>It processes the shape into individual closed loops that are then assembled into polygons with proper shell-hole relationships.
It automatically calls <a class="autorefs autorefs-internal" title="flatten(tolerance=1.0)" href="#pyonfx.shape.Shape.flatten"><code>flatten</code></a> to convert curves into straight line segments.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tolerance</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tolerance angle in degrees used to determine when a bezier curve is considered flat. Higher values yield lower accuracy but faster processing.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>MultiPolygon</code></td>            <td>
                  <code><span title="shapely.geometry.MultiPolygon">MultiPolygon</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A MultiPolygon where each polygon consists of an outer shell (and optional holes) representing distinct contours of the shape.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">shape</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="s2">&quot;m 0 0 l 10 0 10 10 l 0 10 c&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mp</span> <span class="o">=</span> <span class="n">shape</span><span class="o">.</span><span class="n">to_multipolygon</span><span class="p">(</span><span class="n">tolerance</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>pyonfx/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_multipolygon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MultiPolygon</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert the shape to a Shapely MultiPolygon.</span>

<span class="sd">    It processes the shape into individual closed loops that are then assembled into polygons with proper shell-hole relationships.</span>
<span class="sd">    It automatically calls [`flatten`][pyonfx.shape.Shape.flatten] to convert curves into straight line segments.</span>

<span class="sd">    Args:</span>
<span class="sd">        tolerance: The tolerance angle in degrees used to determine when a bezier curve is considered flat. Higher values yield lower accuracy but faster processing.</span>

<span class="sd">    Returns:</span>
<span class="sd">        MultiPolygon: A MultiPolygon where each polygon consists of an outer shell (and optional holes) representing distinct contours of the shape.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; shape = Shape(&quot;m 0 0 l 10 0 10 10 l 0 10 c&quot;)</span>
<span class="sd">        &gt;&gt;&gt; mp = shape.to_multipolygon(tolerance=1.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Work on a copy to avoid modifying the original shape</span>
    <span class="n">shape_copy</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drawing_cmds</span><span class="p">)</span>

    <span class="c1"># 1. Ensure the outline is fully linear by flattening Bziers.</span>
    <span class="n">shape_copy</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">tolerance</span><span class="p">)</span>

    <span class="c1"># 2. Extract individual closed loops (contours).</span>
    <span class="n">loops</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_loop</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">shape_copy</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">command</span>
        <span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">current_loop</span><span class="p">:</span>
                <span class="n">loops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_loop</span><span class="p">)</span>
            <span class="n">current_loop</span> <span class="o">=</span> <span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">elif</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">}:</span>
            <span class="n">current_loop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">current_loop</span><span class="p">:</span>
        <span class="n">loops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_loop</span><span class="p">)</span>

    <span class="c1"># 3. Convert loops to Shapely polygons (without holes yet).</span>
    <span class="n">loop_polys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Polygon</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">pts</span> <span class="ow">in</span> <span class="n">loops</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1"># Degenerate loop  ignore.</span>
            <span class="k">continue</span>
        <span class="n">loop_polys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Polygon</span><span class="p">(</span><span class="n">pts</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">loop_polys</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">MultiPolygon</span><span class="p">([])</span>

    <span class="c1"># 4. Sort by descending area magnitude so that larger shells are processed first.</span>
    <span class="n">loop_polys</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">area</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">shells</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Polygon</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">holes_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Polygon</span><span class="p">,</span> <span class="nb">set</span><span class="p">[</span><span class="n">Polygon</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">loop_poly</span> <span class="ow">in</span> <span class="n">loop_polys</span><span class="p">:</span>
        <span class="c1"># Try to place the loop as a hole inside an existing shell.</span>
        <span class="k">for</span> <span class="n">shell</span> <span class="ow">in</span> <span class="n">shells</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shell</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">loop_poly</span><span class="p">):</span>
                <span class="n">holes_map</span><span class="p">[</span><span class="n">shell</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">loop_poly</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># It&#39;s a new outer shell.</span>
            <span class="n">shells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loop_poly</span><span class="p">)</span>
            <span class="n">holes_map</span><span class="p">[</span><span class="n">loop_poly</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="c1"># 5. Build compound polygons with their holes.</span>
    <span class="n">compounds</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Polygon</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">shell</span> <span class="ow">in</span> <span class="n">shells</span><span class="p">:</span>
        <span class="n">holes</span> <span class="o">=</span> <span class="n">holes_map</span><span class="p">[</span><span class="n">shell</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">holes</span><span class="p">:</span>
            <span class="n">compound</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">shell</span><span class="o">.</span><span class="n">exterior</span><span class="p">,</span> <span class="p">[</span><span class="n">h</span><span class="o">.</span><span class="n">exterior</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">holes</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">compound</span> <span class="o">=</span> <span class="n">shell</span>
        <span class="n">compounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">compound</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">MultiPolygon</span><span class="p">(</span><span class="n">compounds</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.shape.Shape.from_multipolygon" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_multipolygon</span><span class="p">(</span><span class="n">multipolygon</span><span class="p">,</span> <span class="n">min_point_spacing</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Create a Shape instance from a Shapely MultiPolygon.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>multipolygon</code>
            </td>
            <td>
                  <code><span title="shapely.geometry.MultiPolygon">MultiPolygon</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Shapely MultiPolygon geometry to convert.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_point_spacing</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Per-axis spacing threshold - a vertex is kept only if both <code>|x|</code> and <code>|y|</code> from the previous vertex are  this value (increasing it will boost performance during reproduction, but lower accuracy).</p>
              </div>
            </td>
            <td>
                  <code>0.5</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Shape</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Shape (pyonfx.shape.Shape)" href="#pyonfx.shape.Shape">Shape</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new Shape instance representing the geometry of the provided MultiPolygon.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">shapely.geometry</span><span class="w"> </span><span class="kn">import</span> <span class="n">MultiPolygon</span><span class="p">,</span> <span class="n">Polygon</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mp</span> <span class="o">=</span> <span class="n">MultiPolygon</span><span class="p">([</span><span class="n">Polygon</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)])])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">shape</span> <span class="o">=</span> <span class="n">Shape</span><span class="o">.</span><span class="n">from_multipolygon</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span> <span class="n">min_point_spacing</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</code></pre></div>


<details class="see-also" open>
  <summary>See Also</summary>
  <p><a class="autorefs autorefs-internal" title="to_multipolygon(tolerance=1.0)" href="#pyonfx.shape.Shape.to_multipolygon"><code>to_multipolygon</code></a></p>
</details>

            <details class="quote">
              <summary>Source code in <code>pyonfx/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_multipolygon</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">multipolygon</span><span class="p">:</span> <span class="n">MultiPolygon</span><span class="p">,</span> <span class="n">min_point_spacing</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a Shape instance from a Shapely MultiPolygon.</span>

<span class="sd">    Args:</span>
<span class="sd">        multipolygon: The Shapely MultiPolygon geometry to convert.</span>
<span class="sd">        min_point_spacing: Per-axis spacing threshold - a vertex is kept only if both `|x|` and `|y|` from the previous vertex are  this value (increasing it will boost performance during reproduction, but lower accuracy).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Shape: A new Shape instance representing the geometry of the provided MultiPolygon.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; from shapely.geometry import MultiPolygon, Polygon</span>
<span class="sd">        &gt;&gt;&gt; mp = MultiPolygon([Polygon([(0,0), (10,0), (10,10), (0,10)])])</span>
<span class="sd">        &gt;&gt;&gt; shape = Shape.from_multipolygon(mp, min_point_spacing=0.5)</span>

<span class="sd">    See Also:</span>
<span class="sd">        [`to_multipolygon`][pyonfx.shape.Shape.to_multipolygon]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">multipolygon</span><span class="p">,</span> <span class="n">MultiPolygon</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Expected a MultiPolygon instance&quot;</span><span class="p">)</span>

    <span class="n">elements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ShapeElement</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_linear_ring_to_elements</span><span class="p">(</span><span class="n">linear_ring</span><span class="p">:</span> <span class="n">LinearRing</span><span class="p">,</span> <span class="n">is_hole</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">nonlocal</span> <span class="n">elements</span>

        <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">linear_ring</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">coords</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Remove duplicate closing point if present</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">coords</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="c1"># Normalize orientation (outer = CW, inner = CCW)</span>
        <span class="k">if</span> <span class="n">is_hole</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">linear_ring</span><span class="o">.</span><span class="n">is_ccw</span><span class="p">:</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">is_hole</span> <span class="ow">and</span> <span class="n">linear_ring</span><span class="o">.</span><span class="n">is_ccw</span><span class="p">:</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Consecutive &quot;m&quot; commands are overriden, drop last one</span>
        <span class="k">if</span> <span class="n">elements</span> <span class="ow">and</span> <span class="n">elements</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="n">first_point</span> <span class="o">=</span> <span class="n">last_point</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ShapeElement</span><span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="n">first_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">first_point</span><span class="p">[</span><span class="mi">1</span><span class="p">])]))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="nb">abs</span><span class="p">(</span><span class="n">last_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">min_point_spacing</span>
                    <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">last_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">min_point_spacing</span>
                <span class="p">):</span>
                    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ShapeElement</span><span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)]))</span>
                    <span class="n">last_point</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">polygon</span> <span class="ow">in</span> <span class="n">multipolygon</span><span class="o">.</span><span class="n">geoms</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">polygon</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">)</span> <span class="ow">or</span> <span class="n">polygon</span><span class="o">.</span><span class="n">is_empty</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">_linear_ring_to_elements</span><span class="p">(</span><span class="n">polygon</span><span class="o">.</span><span class="n">exterior</span><span class="p">,</span> <span class="n">is_hole</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">interior</span> <span class="ow">in</span> <span class="n">polygon</span><span class="o">.</span><span class="n">interiors</span><span class="p">:</span>
            <span class="n">_linear_ring_to_elements</span><span class="p">(</span><span class="n">interior</span><span class="p">,</span> <span class="n">is_hole</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Ending with &quot;m&quot; command is not VSFilter compatible, drop it</span>
    <span class="k">if</span> <span class="n">elements</span> <span class="ow">and</span> <span class="n">elements</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="n">elements</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.shape.Shape.bounding" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bounding</span><span class="p">(</span><span class="n">exact</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate the bounding box of the shape.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>exact</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, perform an exact calculation by considering curve details; if False, use a faster approximation (libass).</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>, <span title="float">float</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[float, float, float, float]: A tuple (x_min, y_min, x_max, y_max) representing the bounding coordinates of the shape.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">shape</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="s2">&quot;m 10 5 l 25 5 25 42 10 42&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">shape</span><span class="o">.</span><span class="n">bounding</span><span class="p">()</span>
<span class="go">(10.0, 5.0, 25.0, 42.0)  # left, top, right, bottom</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>pyonfx/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bounding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exact</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the bounding box of the shape.</span>

<span class="sd">    Args:</span>
<span class="sd">        exact: If True, perform an exact calculation by considering curve details; if False, use a faster approximation (libass).</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[float, float, float, float]: A tuple (x_min, y_min, x_max, y_max) representing the bounding coordinates of the shape.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; shape = Shape(&quot;m 10 5 l 25 5 25 42 10 42&quot;)</span>
<span class="sd">        &gt;&gt;&gt; shape.bounding()</span>
<span class="sd">        (10.0, 5.0, 25.0, 42.0)  # left, top, right, bottom</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">coord</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">exact</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">MultiPoint</span><span class="p">(</span><span class="n">all_points</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cubic_bezier_bounds</span><span class="p">(</span>
        <span class="n">p0</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span>
        <span class="n">p1</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span>
        <span class="n">p2</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span>
        <span class="n">p3</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Axis-aligned bounds of a cubic Bzier curve.</span>

<span class="sd">        Implementation adapted from https://stackoverflow.com/a/14429749</span>
<span class="sd">        taking care of degenerate cases (coincident control points).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_axis_bounds</span><span class="p">(</span><span class="n">c0</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">):</span>
            <span class="c1"># Solve derivative 3*at^2 + 2*bt + c for roots in (0,1)</span>
            <span class="n">a</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="n">c0</span> <span class="o">+</span> <span class="mi">9</span> <span class="o">*</span> <span class="n">c1</span> <span class="o">-</span> <span class="mi">9</span> <span class="o">*</span> <span class="n">c2</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">c3</span>
            <span class="n">b</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">c0</span> <span class="o">-</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">c1</span> <span class="o">+</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">c2</span>
            <span class="n">c</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">c1</span> <span class="o">-</span> <span class="n">c0</span><span class="p">)</span>

            <span class="n">ts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-12</span><span class="p">:</span>  <span class="c1"># Quadratic (or linear) case</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-12</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span> <span class="n">b</span>
                    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Cubic case</span>
                <span class="n">disc</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">b</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">c</span>
                <span class="k">if</span> <span class="n">disc</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">sqrt_disc</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">disc</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">sign</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">+</span> <span class="n">sign</span> <span class="o">*</span> <span class="n">sqrt_disc</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
                        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

            <span class="c1"># extrema candidates are the end-points and the roots above</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">c0</span><span class="p">,</span> <span class="n">c3</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ts</span><span class="p">:</span>
                <span class="n">mt</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">t</span>
                <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">mt</span> <span class="o">*</span> <span class="n">mt</span> <span class="o">*</span> <span class="n">mt</span> <span class="o">*</span> <span class="n">c0</span>
                    <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">mt</span> <span class="o">*</span> <span class="n">mt</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">c1</span>
                    <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">mt</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">c2</span>
                    <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">c3</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">vals</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">_axis_bounds</span><span class="p">(</span><span class="n">p0</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p3</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">_axis_bounds</span><span class="p">(</span><span class="n">p0</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p3</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span>

    <span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">inf</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update</span><span class="p">(</span><span class="n">pt</span><span class="p">:</span> <span class="n">Point</span><span class="p">):</span>
        <span class="k">nonlocal</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span>
        <span class="n">x_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">y_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x_max</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">y_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y_max</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

    <span class="n">prev_element</span><span class="p">:</span> <span class="n">ShapeElement</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="k">match</span> <span class="n">element</span><span class="o">.</span><span class="n">command</span><span class="p">:</span>
            <span class="k">case</span> <span class="s2">&quot;m&quot;</span> <span class="o">|</span> <span class="s2">&quot;n&quot;</span><span class="p">:</span>
                <span class="n">prev_element</span> <span class="o">=</span> <span class="n">element</span>
            <span class="k">case</span> <span class="s2">&quot;l&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">prev_element</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">prev_element</span><span class="o">.</span><span class="n">command</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">}:</span>
                    <span class="n">_update</span><span class="p">(</span><span class="n">prev_element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">:</span>
                    <span class="n">_update</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="n">prev_element</span> <span class="o">=</span> <span class="n">element</span>
            <span class="k">case</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">prev_element</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;Bezier command found without an initial point.&quot;</span>
                    <span class="p">)</span>
                <span class="n">bx_min</span><span class="p">,</span> <span class="n">by_min</span><span class="p">,</span> <span class="n">bx_max</span><span class="p">,</span> <span class="n">by_max</span> <span class="o">=</span> <span class="n">_cubic_bezier_bounds</span><span class="p">(</span>
                    <span class="n">prev_element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">*</span><span class="n">element</span><span class="o">.</span><span class="n">coordinates</span>
                <span class="p">)</span>
                <span class="n">_update</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">bx_min</span><span class="p">,</span> <span class="n">by_min</span><span class="p">))</span>
                <span class="n">_update</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">bx_max</span><span class="p">,</span> <span class="n">by_max</span><span class="p">))</span>
                <span class="n">prev_element</span> <span class="o">=</span> <span class="n">element</span>
            <span class="k">case</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Drawing command &#39;</span><span class="si">{</span><span class="n">element</span><span class="o">.</span><span class="n">command</span><span class="si">}</span><span class="s2">&#39; not handled by bounding().&quot;</span>
                <span class="p">)</span>

    <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span> <span class="ow">in</span> <span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">)</span> <span class="ow">or</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">inf</span> <span class="ow">in</span> <span class="p">(</span><span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid or empty shape - could not determine bounds.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.shape.Shape.boolean" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">boolean</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">min_point_spacing</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Perform a boolean operation between two shapes.</p>
<p>This method converts both shapes to Shapely MultiPolygon objects (flattening any Bzier curves with the provided tolerance)
and performs the specified boolean operation (union, intersection, difference, or symmetric difference).
The result is converted back into a Shape instance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>other</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Shape (pyonfx.shape.Shape)" href="#pyonfx.shape.Shape">Shape</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The other shape to combine with this shape.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>op</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;union&#39;, &#39;intersection&#39;, &#39;difference&#39;, &#39;xor&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The boolean operation to perform. Use "union" for combined area, "intersection" for overlapping area, "difference" for subtraction, or "xor" for symmetric difference.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tolerance</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tolerance angle in degrees used for flattening curves. Higher tolerance reduces processing time but lowers accuracy.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_point_spacing</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum spacing between consecutive points when converting back from polygons to a shape.</p>
              </div>
            </td>
            <td>
                  <code>0.5</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Shape</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Shape (pyonfx.shape.Shape)" href="#pyonfx.shape.Shape">Shape</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new Shape instance representing the resulting shape after the boolean operation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">shape1</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="s2">&quot;m 0 0 l 10 0 10 10 0 10&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">shape2</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="s2">&quot;m 5 5 l 15 5 15 15 5 15&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">shape1</span><span class="o">.</span><span class="n">boolean</span><span class="p">(</span><span class="n">shape2</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="s2">&quot;intersection&quot;</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">min_point_spacing</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="go">m 10 10 l 10 5 5 5 5 10</span>
</code></pre></div>


<details class="see-also" open>
  <summary>See Also</summary>
  <p><a class="autorefs autorefs-internal" title="to_multipolygon(tolerance=1.0)" href="#pyonfx.shape.Shape.to_multipolygon"><code>to_multipolygon</code></a>
<a class="autorefs autorefs-internal" title="from_multipolygon(multipolygon, min_point_spacing=0.5)

  
      classmethod
  " href="#pyonfx.shape.Shape.from_multipolygon"><code>from_multipolygon</code></a></p>
</details>

            <details class="quote">
              <summary>Source code in <code>pyonfx/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">boolean</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;Shape&quot;</span><span class="p">,</span>
    <span class="n">op</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;union&quot;</span><span class="p">,</span> <span class="s2">&quot;intersection&quot;</span><span class="p">,</span> <span class="s2">&quot;difference&quot;</span><span class="p">,</span> <span class="s2">&quot;xor&quot;</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">min_point_spacing</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform a boolean operation between two shapes.</span>

<span class="sd">    This method converts both shapes to Shapely MultiPolygon objects (flattening any Bzier curves with the provided tolerance)</span>
<span class="sd">    and performs the specified boolean operation (union, intersection, difference, or symmetric difference).</span>
<span class="sd">    The result is converted back into a Shape instance.</span>

<span class="sd">    Args:</span>
<span class="sd">        other: The other shape to combine with this shape.</span>
<span class="sd">        op: The boolean operation to perform. Use &quot;union&quot; for combined area, &quot;intersection&quot; for overlapping area, &quot;difference&quot; for subtraction, or &quot;xor&quot; for symmetric difference.</span>
<span class="sd">        tolerance: The tolerance angle in degrees used for flattening curves. Higher tolerance reduces processing time but lowers accuracy.</span>
<span class="sd">        min_point_spacing: The minimum spacing between consecutive points when converting back from polygons to a shape.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Shape: A new Shape instance representing the resulting shape after the boolean operation.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; shape1 = Shape(&quot;m 0 0 l 10 0 10 10 0 10&quot;)</span>
<span class="sd">        &gt;&gt;&gt; shape2 = Shape(&quot;m 5 5 l 15 5 15 15 5 15&quot;)</span>
<span class="sd">        &gt;&gt;&gt; shape1.boolean(shape2, op=&quot;intersection&quot;, tolerance=1.0, min_point_spacing=0.5)</span>
<span class="sd">        m 10 10 l 10 5 5 5 5 10</span>

<span class="sd">    See Also:</span>
<span class="sd">        [`to_multipolygon`][pyonfx.shape.Shape.to_multipolygon]</span>
<span class="sd">        [`from_multipolygon`][pyonfx.shape.Shape.from_multipolygon]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Shape</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;other must be a Shape instance&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">op</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;union&quot;</span><span class="p">,</span> <span class="s2">&quot;intersection&quot;</span><span class="p">,</span> <span class="s2">&quot;difference&quot;</span><span class="p">,</span> <span class="s2">&quot;xor&quot;</span><span class="p">}:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;op must be one of &#39;union&#39;, &#39;intersection&#39;, &#39;difference&#39;, or &#39;xor&#39;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Convert both shapes to MultiPolygon (this flattens curves).</span>
    <span class="n">mp_self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_multipolygon</span><span class="p">(</span><span class="n">tolerance</span><span class="p">)</span>
    <span class="n">mp_other</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">to_multipolygon</span><span class="p">(</span><span class="n">tolerance</span><span class="p">)</span>

    <span class="c1"># Perform the requested boolean operation.</span>
    <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;union&quot;</span><span class="p">:</span>
        <span class="n">result_geom</span> <span class="o">=</span> <span class="n">mp_self</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">mp_other</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;intersection&quot;</span><span class="p">:</span>
        <span class="n">result_geom</span> <span class="o">=</span> <span class="n">mp_self</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">mp_other</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="s2">&quot;difference&quot;</span><span class="p">:</span>
        <span class="n">result_geom</span> <span class="o">=</span> <span class="n">mp_self</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">mp_other</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># op == &quot;xor&quot;</span>
        <span class="n">result_geom</span> <span class="o">=</span> <span class="n">mp_self</span><span class="o">.</span><span class="n">symmetric_difference</span><span class="p">(</span><span class="n">mp_other</span><span class="p">)</span>

    <span class="c1"># Normalise to MultiPolygon</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result_geom</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">):</span>
        <span class="n">result_geom</span> <span class="o">=</span> <span class="n">MultiPolygon</span><span class="p">([</span><span class="n">result_geom</span><span class="p">])</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result_geom</span><span class="p">,</span> <span class="n">MultiPolygon</span><span class="p">):</span>
        <span class="c1"># No overlapping geometry  return an empty shape.</span>
        <span class="k">return</span> <span class="n">Shape</span><span class="p">()</span>

    <span class="c1"># Convert back to Shape.</span>
    <span class="k">return</span> <span class="n">Shape</span><span class="o">.</span><span class="n">from_multipolygon</span><span class="p">(</span><span class="n">result_geom</span><span class="p">,</span> <span class="n">min_point_spacing</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.shape.Shape.map" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">map</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Sends every point of the shape through a transformation function.</p>
<p>This method applies a user-provided transformation function to each coordinate of the shape's elements, allowing for arbitrary deformations or adjustments.
The function can accept two parameters (x and y) or three parameters (x, y, and the command type), providing flexibility in the transformation logic.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fun</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span>[[<span title="float">float</span>, <span title="float">float</span>], <span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>]] | <span title="typing.Callable">Callable</span>[[<span title="float">float</span>, <span title="float">float</span>, <span title="str">str</span>], <span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A function that takes the x and y coordinates (and optionally the drawing command as the third argument) and returns a tuple with the transformed (x, y) coordinates.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Shape</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Shape (pyonfx.shape.Shape)" href="#pyonfx.shape.Shape">Shape</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new Shape instance with each point transformed according to the provided function.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">original</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="s2">&quot;m 0 0 l 20 0 20 10 0 10&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">original</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">5</span><span class="p">))</span>
<span class="go">m 10 5 l 30 5 30 15 10 15</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>pyonfx/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">map</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">fun</span><span class="p">:</span> <span class="p">(</span>
        <span class="n">Callable</span><span class="p">[[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span>
        <span class="o">|</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span>
    <span class="p">),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sends every point of the shape through a transformation function.</span>

<span class="sd">    This method applies a user-provided transformation function to each coordinate of the shape&#39;s elements, allowing for arbitrary deformations or adjustments.</span>
<span class="sd">    The function can accept two parameters (x and y) or three parameters (x, y, and the command type), providing flexibility in the transformation logic.</span>

<span class="sd">    Args:</span>
<span class="sd">        fun: A function that takes the x and y coordinates (and optionally the drawing command as the third argument) and returns a tuple with the transformed (x, y) coordinates.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Shape: A new Shape instance with each point transformed according to the provided function.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; original = Shape(&quot;m 0 0 l 20 0 20 10 0 10&quot;)</span>
<span class="sd">        &gt;&gt;&gt; original.map(lambda x, y: (x + 10, y + 5))</span>
<span class="sd">        m 10 5 l 30 5 30 15 10 15</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">fun</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;(Lambda) function expected&quot;</span><span class="p">)</span>

    <span class="c1"># Determine the arity of the transformation function</span>
    <span class="n">n_params</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">signature</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n_params</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Function must have 2 or 3 parameters&quot;</span><span class="p">)</span>

    <span class="c1"># Create a wrapper function accepting always 3 parameters</span>
    <span class="k">if</span> <span class="n">n_params</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">fun</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span> <span class="n">fun</span><span class="p">)</span>
        <span class="n">_apply</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">cmd</span><span class="p">:</span> <span class="n">fun</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">cmd</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fun</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span> <span class="n">fun</span><span class="p">)</span>
        <span class="n">_apply</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="n">fun</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">)</span>

    <span class="c1"># Apply the transformation to each element</span>
    <span class="n">transformed_elements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ShapeElement</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">:</span>
            <span class="n">transformed_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">transformed_coords</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Point</span><span class="p">(</span><span class="o">*</span><span class="n">_apply</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">command</span><span class="p">))</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">coordinates</span>
        <span class="p">]</span>
        <span class="n">transformed_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ShapeElement</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">command</span><span class="p">,</span> <span class="n">transformed_coords</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">Shape</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="n">transformed_elements</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.shape.Shape.move" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">move</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Move the shape by the specified x and y offsets.</p>
<p>This method translates every point in the shape by adding the given x and y offsets to the corresponding coordinates.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The displacement along the x-axis.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The displacement along the y-axis.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Shape</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Shape (pyonfx.shape.Shape)" href="#pyonfx.shape.Shape">Shape</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new Shape instance with the coordinates moved by the specified offsets.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">shape</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="s2">&quot;m 0 0 l 30 0 30 20 0 20&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">shape</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="go">m -5 10 l 25 10 25 30 -5 30</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>pyonfx/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Move the shape by the specified x and y offsets.</span>

<span class="sd">    This method translates every point in the shape by adding the given x and y offsets to the corresponding coordinates.</span>

<span class="sd">    Args:</span>
<span class="sd">        x: The displacement along the x-axis.</span>
<span class="sd">        y: The displacement along the y-axis.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Shape: A new Shape instance with the coordinates moved by the specified offsets.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; shape = Shape(&quot;m 0 0 l 30 0 30 20 0 20&quot;)</span>
<span class="sd">        &gt;&gt;&gt; shape.move(-5, 10)</span>
<span class="sd">        m -5 10 l 25 10 25 30 -5 30</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">:</span> <span class="p">(</span><span class="n">cx</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">cy</span> <span class="o">+</span> <span class="n">y</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.shape.Shape.align" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">align</span><span class="p">(</span><span class="n">an</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Align the shape based on a specified alignment code and pivot.</p>
<p>This method adjusts the shape's position so that a chosen pivot inside the shape
coincides with the position used for rendering (i.e., the \pos point in ASS).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>an</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The alignment of the subtitle line (e.g., 1 through 9 corresponding to positions such as bottom-left, center, top-right, etc.).</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>anchor</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The pivot inside the shape to be used for alignment. If not provided, defaults to the value of 'an'.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Shape</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Shape (pyonfx.shape.Shape)" href="#pyonfx.shape.Shape">Shape</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new Shape instance with the shape aligned according to the specified parameters.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">shape</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="s2">&quot;m 10 10 l 30 10 30 20 10 20&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">shape</span><span class="o">.</span><span class="n">align</span><span class="p">()</span>
<span class="go">m 0 0 l 20 0 20 10 0 10</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>pyonfx/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">align</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">an</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">anchor</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Align the shape based on a specified alignment code and pivot.</span>

<span class="sd">    This method adjusts the shape&#39;s position so that a chosen pivot inside the shape</span>
<span class="sd">    coincides with the position used for rendering (i.e., the \\pos point in ASS).</span>

<span class="sd">    Args:</span>
<span class="sd">        an: The alignment of the subtitle line (e.g., 1 through 9 corresponding to positions such as bottom-left, center, top-right, etc.).</span>
<span class="sd">        anchor: The pivot inside the shape to be used for alignment. If not provided, defaults to the value of &#39;an&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Shape: A new Shape instance with the shape aligned according to the specified parameters.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; shape = Shape(&quot;m 10 10 l 30 10 30 20 10 20&quot;)</span>
<span class="sd">        &gt;&gt;&gt; shape.align()</span>
<span class="sd">        m 0 0 l 20 0 20 10 0 10</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">anchor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">anchor</span> <span class="o">=</span> <span class="n">an</span>

    <span class="k">if</span> <span class="n">an</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">an</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Alignment value must be an integer between 1 and 9&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">anchor</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">anchor</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Anchor value must be an integer between 1 and 9&quot;</span><span class="p">)</span>

    <span class="c1"># Keypad decomposition (0: left / bottom, 1: centre, 2: right / top)</span>
    <span class="n">pivot_row</span><span class="p">,</span> <span class="n">pivot_col</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">anchor</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">line_row</span><span class="p">,</span> <span class="n">line_col</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">an</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="c1"># Bounding boxes (exact vs. libass)</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounding</span><span class="p">(</span><span class="n">exact</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">l_left</span><span class="p">,</span> <span class="n">l_top</span><span class="p">,</span> <span class="n">l_right</span><span class="p">,</span> <span class="n">l_bottom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounding</span><span class="p">(</span><span class="n">exact</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">right</span> <span class="o">-</span> <span class="n">left</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">-</span> <span class="n">top</span>

    <span class="n">x_move</span> <span class="o">=</span> <span class="o">-</span><span class="n">left</span>
    <span class="n">y_move</span> <span class="o">=</span> <span class="o">-</span><span class="n">top</span>

    <span class="c1"># Centre according to line alignment (libass corrections included)</span>
    <span class="k">if</span> <span class="n">line_col</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># left</span>
        <span class="n">x_move</span> <span class="o">-=</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="n">line_col</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># centre</span>
        <span class="n">x_move</span> <span class="o">-=</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">l_right</span> <span class="o">-</span> <span class="n">l_left</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="n">line_col</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># right</span>
        <span class="n">x_move</span> <span class="o">+=</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="n">l_right</span> <span class="o">-</span> <span class="n">l_left</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">line_row</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># bottom</span>
        <span class="n">y_move</span> <span class="o">+=</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="n">l_bottom</span> <span class="o">-</span> <span class="n">l_top</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">line_row</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># middle</span>
        <span class="n">y_move</span> <span class="o">-=</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">l_bottom</span> <span class="o">-</span> <span class="n">l_top</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="n">line_row</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># top</span>
        <span class="n">y_move</span> <span class="o">-=</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="c1"># Finally shift so that requested pivot is the reference point</span>
    <span class="k">if</span> <span class="n">pivot_col</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># left</span>
        <span class="n">x_move</span> <span class="o">+=</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="n">pivot_col</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># right</span>
        <span class="n">x_move</span> <span class="o">-=</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="k">if</span> <span class="n">pivot_row</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># bottom</span>
        <span class="n">y_move</span> <span class="o">-=</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="n">pivot_row</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># top</span>
        <span class="n">y_move</span> <span class="o">+=</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">x_move</span><span class="p">,</span> <span class="n">y_move</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.shape.Shape.scale" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">scale</span><span class="p">(</span><span class="n">fscx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">fscy</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Scale the shape by specified horizontal and vertical scale factors, optionally around a given origin.</p>
<p>This method scales the shape's coordinates relative to a specified origin point, which serves as the pivot for the scaling transformation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fscx</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The horizontal scaling factor as a percentage (100 means no change).</p>
              </div>
            </td>
            <td>
                  <code>100</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fscy</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The vertical scaling factor as a percentage (100 means no change).</p>
              </div>
            </td>
            <td>
                  <code>100</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>origin</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The pivot point (x, y) around which scaling is performed. Default is (0.0, 0.0).</p>
              </div>
            </td>
            <td>
                  <code>(0.0, 0.0)</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Shape</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Shape (pyonfx.shape.Shape)" href="#pyonfx.shape.Shape">Shape</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new Shape instance with the coordinates scaled accordingly.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">shape</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="s2">&quot;m 0 50 l 0 0 50 0 50 50&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">shape</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">fscx</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="go">m 0 50 l 0 0 100 0 100 50</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>pyonfx/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">scale</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">fscx</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="n">fscy</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="n">origin</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Scale the shape by specified horizontal and vertical scale factors, optionally around a given origin.</span>

<span class="sd">    This method scales the shape&#39;s coordinates relative to a specified origin point, which serves as the pivot for the scaling transformation.</span>

<span class="sd">    Args:</span>
<span class="sd">        fscx: The horizontal scaling factor as a percentage (100 means no change).</span>
<span class="sd">        fscy: The vertical scaling factor as a percentage (100 means no change).</span>
<span class="sd">        origin: The pivot point (x, y) around which scaling is performed. Default is (0.0, 0.0).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Shape: A new Shape instance with the coordinates scaled accordingly.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; shape = Shape(&quot;m 0 50 l 0 0 50 0 50 50&quot;)</span>
<span class="sd">        &gt;&gt;&gt; shape.scale(fscx=200)</span>
<span class="sd">        m 0 50 l 0 0 100 0 100 50</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">fscx</span> <span class="o">==</span> <span class="mf">100.0</span> <span class="ow">and</span> <span class="n">fscy</span> <span class="o">==</span> <span class="mf">100.0</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="n">scale_x</span> <span class="o">=</span> <span class="n">fscx</span> <span class="o">/</span> <span class="mf">100.0</span>
    <span class="n">scale_y</span> <span class="o">=</span> <span class="n">fscy</span> <span class="o">/</span> <span class="mf">100.0</span>

    <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span> <span class="o">=</span> <span class="n">origin</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">ox</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale_x</span> <span class="o">+</span> <span class="n">ox</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">oy</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale_y</span> <span class="o">+</span> <span class="n">oy</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.shape.Shape.rotate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rotate</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">frx</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">fry</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">frz</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Rotate the shape by specified angles about given axes around a pivot point.</p>
<p>This method applies rotation transformations to the shape's coordinates based on the provided angles for the x, y, and z axes, in degrees.
The pivot point around which the rotation is applied is specified by the 'origin' parameter.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>frx</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The rotation angle around the x-axis (in degrees).</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fry</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The rotation angle around the y-axis (in degrees).</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>frz</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The rotation angle around the z-axis (in degrees).</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>origin</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The pivot point (x, y) for the rotation.</p>
              </div>
            </td>
            <td>
                  <code>(0.0, 0.0)</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Shape</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Shape (pyonfx.shape.Shape)" href="#pyonfx.shape.Shape">Shape</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new Shape instance with the coordinates rotated as specified.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">shape</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="s2">&quot;m 0 0 l 30 0 30 20 0 20&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">shape</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">frx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fry</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">frz</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="go">m -2.678 13.536 l 18.536 -7.678 32.678 6.464 11.464 27.678</span>
</code></pre></div>


<details class="notes" open>
  <summary>Notes</summary>
  <p>The rotation is applied in the order: X-axis, then Y-axis, then Z-axis.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>pyonfx/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rotate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">frx</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">fry</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">frz</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">origin</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Rotate the shape by specified angles about given axes around a pivot point.</span>

<span class="sd">    This method applies rotation transformations to the shape&#39;s coordinates based on the provided angles for the x, y, and z axes, in degrees.</span>
<span class="sd">    The pivot point around which the rotation is applied is specified by the &#39;origin&#39; parameter.</span>

<span class="sd">    Args:</span>
<span class="sd">        frx: The rotation angle around the x-axis (in degrees).</span>
<span class="sd">        fry: The rotation angle around the y-axis (in degrees).</span>
<span class="sd">        frz: The rotation angle around the z-axis (in degrees).</span>
<span class="sd">        origin: The pivot point (x, y) for the rotation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Shape: A new Shape instance with the coordinates rotated as specified.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; shape = Shape(&quot;m 0 0 l 30 0 30 20 0 20&quot;)</span>
<span class="sd">        &gt;&gt;&gt; shape.rotate(frx=0, fry=0, frz=45, origin=(15,10))</span>
<span class="sd">        m -2.678 13.536 l 18.536 -7.678 32.678 6.464 11.464 27.678</span>

<span class="sd">    Notes:</span>
<span class="sd">        The rotation is applied in the order: X-axis, then Y-axis, then Z-axis.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">frx</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">fry</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">frz</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># Normalise the origin</span>
    <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span> <span class="o">=</span> <span class="n">origin</span>

    <span class="c1"># Pre-compute sines/cosines</span>
    <span class="c1"># (Mathematical convention is counter-clockwise, but ASS uses clockwise, *sigh*)</span>
    <span class="n">rx</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="o">-</span><span class="n">frx</span><span class="p">)</span>
    <span class="n">ry</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="o">-</span><span class="n">fry</span><span class="p">)</span>
    <span class="n">rz</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="o">-</span><span class="n">frz</span><span class="p">)</span>
    <span class="n">cosx</span><span class="p">,</span> <span class="n">sinx</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rx</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rx</span><span class="p">)</span>
    <span class="n">cosy</span><span class="p">,</span> <span class="n">siny</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ry</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ry</span><span class="p">)</span>
    <span class="n">cosz</span><span class="p">,</span> <span class="n">sinz</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rz</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rz</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_transform</span><span class="p">(</span><span class="n">px</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">py</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="c1"># Translate to origin</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">px</span> <span class="o">-</span> <span class="n">ox</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">py</span> <span class="o">-</span> <span class="n">oy</span>
        <span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="c1"># Rotation around X (pitch)</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">cosx</span> <span class="o">-</span> <span class="n">z</span> <span class="o">*</span> <span class="n">sinx</span>
        <span class="n">z1</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">sinx</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="n">cosx</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span>

        <span class="c1"># Rotation around Y (yaw)</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">cosy</span> <span class="o">+</span> <span class="n">z1</span> <span class="o">*</span> <span class="n">siny</span>
        <span class="n">z2</span> <span class="o">=</span> <span class="o">-</span><span class="n">x1</span> <span class="o">*</span> <span class="n">siny</span> <span class="o">+</span> <span class="n">z1</span> <span class="o">*</span> <span class="n">cosy</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">y1</span>

        <span class="c1"># Rotation around Z (roll)</span>
        <span class="n">x3</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">cosz</span> <span class="o">-</span> <span class="n">y2</span> <span class="o">*</span> <span class="n">sinz</span>
        <span class="n">y3</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">*</span> <span class="n">sinz</span> <span class="o">+</span> <span class="n">y2</span> <span class="o">*</span> <span class="n">cosz</span>
        <span class="n">z3</span> <span class="o">=</span> <span class="n">z2</span>

        <span class="c1"># Translate back</span>
        <span class="k">return</span> <span class="n">x3</span> <span class="o">+</span> <span class="n">ox</span><span class="p">,</span> <span class="n">y3</span> <span class="o">+</span> <span class="n">oy</span>

    <span class="c1"># Apply transformation to every point in the shape</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">_transform</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.shape.Shape.shear" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">shear</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">fax</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">fay</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Apply a shear transformation to the shape.</p>
<p>This method deforms the shape by applying a shear transformation relative to a specified origin, which acts as the pivot.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fax</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The horizontal shear factor. Positive values slant the top of the shape to the right, negative values slant to the left.</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fay</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The vertical shear factor. Positive values slant the right side of the shape downward, negative values slant upward.</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>origin</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The pivot point (x, y) for the shear transformation.</p>
              </div>
            </td>
            <td>
                  <code>(0.0, 0.0)</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Shape</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Shape (pyonfx.shape.Shape)" href="#pyonfx.shape.Shape">Shape</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new Shape instance with the coordinates sheared accordingly.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">shape</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="s2">&quot;m 0 0 l 30 0 30 20 0 20&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">shape</span><span class="o">.</span><span class="n">shear</span><span class="p">(</span><span class="n">fax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fay</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="go">m -5 0 l 25 0 35 20 5 20</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>pyonfx/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">shear</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">fax</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">fay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">origin</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply a shear transformation to the shape.</span>

<span class="sd">    This method deforms the shape by applying a shear transformation relative to a specified origin, which acts as the pivot.</span>

<span class="sd">    Args:</span>
<span class="sd">        fax: The horizontal shear factor. Positive values slant the top of the shape to the right, negative values slant to the left.</span>
<span class="sd">        fay: The vertical shear factor. Positive values slant the right side of the shape downward, negative values slant upward.</span>
<span class="sd">        origin: The pivot point (x, y) for the shear transformation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Shape: A new Shape instance with the coordinates sheared accordingly.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; shape = Shape(&quot;m 0 0 l 30 0 30 20 0 20&quot;)</span>
<span class="sd">        &gt;&gt;&gt; shape.shear(fax=0.5, fay=0, origin=(15,10))</span>
<span class="sd">        m -5 0 l 25 0 35 20 5 20</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">fax</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">fay</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span> <span class="o">=</span> <span class="n">origin</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_shear</span><span class="p">(</span><span class="n">px</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">py</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="c1"># Translate to origin</span>
        <span class="n">x_rel</span> <span class="o">=</span> <span class="n">px</span> <span class="o">-</span> <span class="n">ox</span>
        <span class="n">y_rel</span> <span class="o">=</span> <span class="n">py</span> <span class="o">-</span> <span class="n">oy</span>

        <span class="c1"># Apply shear matrix [[1, fax], [fay, 1]]</span>
        <span class="n">new_x_rel</span> <span class="o">=</span> <span class="n">x_rel</span> <span class="o">+</span> <span class="n">fax</span> <span class="o">*</span> <span class="n">y_rel</span>
        <span class="n">new_y_rel</span> <span class="o">=</span> <span class="n">fay</span> <span class="o">*</span> <span class="n">x_rel</span> <span class="o">+</span> <span class="n">y_rel</span>

        <span class="c1"># Translate back</span>
        <span class="k">return</span> <span class="n">new_x_rel</span> <span class="o">+</span> <span class="n">ox</span><span class="p">,</span> <span class="n">new_y_rel</span> <span class="o">+</span> <span class="n">oy</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">_shear</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.shape.Shape.flatten" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">flatten</span><span class="p">(</span><span class="n">tolerance</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Flatten the shape's Bzier curves into line segments.</p>
<p>This method processes the shape by subdividing Bzier curves into multiple straight line segments.
The subdivision is controlled by the tolerance parameter, which defines the threshold angle (in degrees) at which a curve is considered flat.
This conversion is useful for operations that require linear segments, such as detailed transformations or morphing.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tolerance</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The angle in degrees used to determine when a Bzier curve is flat enough to be approximated by a straight line. Higher values yield fewer segments and faster processing but lower accuracy.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Shape</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Shape (pyonfx.shape.Shape)" href="#pyonfx.shape.Shape">Shape</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new Shape instance with the curves converted into line segments.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <p>Flattening curves may significantly increase the number of points, which can impact performance for subsequent operations.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>pyonfx/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">flatten</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Flatten the shape&#39;s Bzier curves into line segments.</span>

<span class="sd">    This method processes the shape by subdividing Bzier curves into multiple straight line segments.</span>
<span class="sd">    The subdivision is controlled by the tolerance parameter, which defines the threshold angle (in degrees) at which a curve is considered flat.</span>
<span class="sd">    This conversion is useful for operations that require linear segments, such as detailed transformations or morphing.</span>

<span class="sd">    Args:</span>
<span class="sd">        tolerance: The angle in degrees used to determine when a Bzier curve is flat enough to be approximated by a straight line. Higher values yield fewer segments and faster processing but lower accuracy.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Shape: A new Shape instance with the curves converted into line segments.</span>

<span class="sd">    Notes:</span>
<span class="sd">        Flattening curves may significantly increase the number of points, which can impact performance for subsequent operations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">tolerance</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Tolerance must be a positive number&quot;</span><span class="p">)</span>

    <span class="c1"># Convert tolerance to radians once to avoid repeated conversions</span>
    <span class="n">tolerance_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">tolerance</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_subdivide_bezier</span><span class="p">(</span><span class="n">p0x</span><span class="p">,</span> <span class="n">p0y</span><span class="p">,</span> <span class="n">p1x</span><span class="p">,</span> <span class="n">p1y</span><span class="p">,</span> <span class="n">p2x</span><span class="p">,</span> <span class="n">p2y</span><span class="p">,</span> <span class="n">p3x</span><span class="p">,</span> <span class="n">p3y</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;De Casteljau subdivision of cubic bezier curve using raw coordinates.&quot;&quot;&quot;</span>
        <span class="c1"># First level</span>
        <span class="n">q0x</span> <span class="o">=</span> <span class="n">p0x</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">p1x</span> <span class="o">-</span> <span class="n">p0x</span><span class="p">)</span>
        <span class="n">q0y</span> <span class="o">=</span> <span class="n">p0y</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">p1y</span> <span class="o">-</span> <span class="n">p0y</span><span class="p">)</span>
        <span class="n">q1x</span> <span class="o">=</span> <span class="n">p1x</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">p2x</span> <span class="o">-</span> <span class="n">p1x</span><span class="p">)</span>
        <span class="n">q1y</span> <span class="o">=</span> <span class="n">p1y</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">p2y</span> <span class="o">-</span> <span class="n">p1y</span><span class="p">)</span>
        <span class="n">q2x</span> <span class="o">=</span> <span class="n">p2x</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">p3x</span> <span class="o">-</span> <span class="n">p2x</span><span class="p">)</span>
        <span class="n">q2y</span> <span class="o">=</span> <span class="n">p2y</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">p3y</span> <span class="o">-</span> <span class="n">p2y</span><span class="p">)</span>

        <span class="c1"># Second level</span>
        <span class="n">r0x</span> <span class="o">=</span> <span class="n">q0x</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">q1x</span> <span class="o">-</span> <span class="n">q0x</span><span class="p">)</span>
        <span class="n">r0y</span> <span class="o">=</span> <span class="n">q0y</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">q1y</span> <span class="o">-</span> <span class="n">q0y</span><span class="p">)</span>
        <span class="n">r1x</span> <span class="o">=</span> <span class="n">q1x</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">q2x</span> <span class="o">-</span> <span class="n">q1x</span><span class="p">)</span>
        <span class="n">r1y</span> <span class="o">=</span> <span class="n">q1y</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">q2y</span> <span class="o">-</span> <span class="n">q1y</span><span class="p">)</span>

        <span class="c1"># Final point</span>
        <span class="n">sx</span> <span class="o">=</span> <span class="n">r0x</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">r1x</span> <span class="o">-</span> <span class="n">r0x</span><span class="p">)</span>
        <span class="n">sy</span> <span class="o">=</span> <span class="n">r0y</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">r1y</span> <span class="o">-</span> <span class="n">r0y</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">p0x</span><span class="p">,</span> <span class="n">p0y</span><span class="p">,</span> <span class="n">q0x</span><span class="p">,</span> <span class="n">q0y</span><span class="p">,</span> <span class="n">r0x</span><span class="p">,</span> <span class="n">r0y</span><span class="p">,</span> <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">),</span>
            <span class="p">(</span><span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">r1x</span><span class="p">,</span> <span class="n">r1y</span><span class="p">,</span> <span class="n">q2x</span><span class="p">,</span> <span class="n">q2y</span><span class="p">,</span> <span class="n">p3x</span><span class="p">,</span> <span class="n">p3y</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_is_bezier_flat</span><span class="p">(</span><span class="n">p0x</span><span class="p">,</span> <span class="n">p0y</span><span class="p">,</span> <span class="n">p1x</span><span class="p">,</span> <span class="n">p1y</span><span class="p">,</span> <span class="n">p2x</span><span class="p">,</span> <span class="n">p2y</span><span class="p">,</span> <span class="n">p3x</span><span class="p">,</span> <span class="n">p3y</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if bezier curve is flat enough based on angle tolerance.&quot;&quot;&quot;</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[(</span><span class="n">p0x</span><span class="p">,</span> <span class="n">p0y</span><span class="p">),</span> <span class="p">(</span><span class="n">p1x</span><span class="p">,</span> <span class="n">p1y</span><span class="p">),</span> <span class="p">(</span><span class="n">p2x</span><span class="p">,</span> <span class="n">p2y</span><span class="p">),</span> <span class="p">(</span><span class="n">p3x</span><span class="p">,</span> <span class="n">p3y</span><span class="p">)]</span>

        <span class="n">vectors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)):</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dx</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">dy</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">vectors</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vectors</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># Check angle between consecutive vectors</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">vectors</span><span class="p">)):</span>
            <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">vectors</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">vectors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="n">angle</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span>
                <span class="n">v1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">v1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tolerance_rad</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_bezier_to_lines</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert bezier curve to line segments.&quot;&quot;&quot;</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="p">[(</span><span class="n">p0</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p0</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p3</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p3</span><span class="o">.</span><span class="n">y</span><span class="p">)]</span>

        <span class="n">line_points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">stack</span><span class="p">:</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">_is_bezier_flat</span><span class="p">(</span><span class="o">*</span><span class="n">coords</span><span class="p">):</span>
                <span class="c1"># End point</span>
                <span class="n">line_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Subdivide and add both halves to stack</span>
                <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">_subdivide_bezier</span><span class="p">(</span><span class="o">*</span><span class="n">coords</span><span class="p">)</span>
                <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>  <span class="c1"># Process right first (stack order)</span>
                <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">left</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">line_points</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">line_points</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="p">)</span>  <span class="c1"># Exclude last to avoid duplication</span>

    <span class="c1"># Process elements</span>
    <span class="n">flattened_elements</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_point</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">current_point</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Bezier curve found without a starting point&quot;</span><span class="p">)</span>

            <span class="c1"># Convert bezier to line segments</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">current_point</span>
            <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">coordinates</span>

            <span class="n">line_points</span> <span class="o">=</span> <span class="n">_bezier_to_lines</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">)</span>

            <span class="c1"># Add line segments</span>
            <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">line_points</span><span class="p">:</span>
                <span class="n">flattened_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ShapeElement</span><span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">point</span><span class="p">]))</span>

            <span class="c1"># Add final point</span>
            <span class="n">flattened_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ShapeElement</span><span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">p3</span><span class="p">]))</span>
            <span class="n">current_point</span> <span class="o">=</span> <span class="n">p3</span>

        <span class="k">elif</span> <span class="n">element</span><span class="o">.</span><span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span>
            <span class="c1"># Bezier curves are already converted to lines</span>
            <span class="k">pass</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Keep other commands as-is and track current point</span>
            <span class="n">flattened_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">:</span>
                <span class="n">current_point</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Return shape with flattened elements</span>
    <span class="k">return</span> <span class="n">Shape</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="n">flattened_elements</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.shape.Shape.split" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">split</span><span class="p">(</span><span class="n">max_len</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Split the shape into smaller segments.</p>
<p>This method first flattens any Bzier curves in the shape, then subdivides the resulting line segments so that no segment exceeds the specified maximum length.
This process increases the number of points in the shape, which can be useful for detailed deformations or morphing.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>max_len</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum allowed length for any line segment. Segments longer than this value will be subdivided.</p>
              </div>
            </td>
            <td>
                  <code>16</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tolerance</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tolerance angle in degrees used to flatten Bzier curves before splitting.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Shape</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Shape (pyonfx.shape.Shape)" href="#pyonfx.shape.Shape">Shape</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new Shape instance with the split line segments.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">shape</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="s2">&quot;m 0 50 l 0 0 50 0 50 50&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">shape</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="go">m 0 50 l 0 48 0 32 0 16 0 0 2 0 18 0 34 0 50 0 50 2 50 18 50 34 50 50 48 50 32 50 16 50 0 50</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>pyonfx/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_len</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Split the shape into smaller segments.</span>

<span class="sd">    This method first flattens any Bzier curves in the shape, then subdivides the resulting line segments so that no segment exceeds the specified maximum length.</span>
<span class="sd">    This process increases the number of points in the shape, which can be useful for detailed deformations or morphing.</span>

<span class="sd">    Args:</span>
<span class="sd">        max_len: The maximum allowed length for any line segment. Segments longer than this value will be subdivided.</span>
<span class="sd">        tolerance: The tolerance angle in degrees used to flatten Bzier curves before splitting.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Shape: A new Shape instance with the split line segments.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; shape = Shape(&quot;m 0 50 l 0 0 50 0 50 50&quot;)</span>
<span class="sd">        &gt;&gt;&gt; shape.split()</span>
<span class="sd">        m 0 50 l 0 48 0 32 0 16 0 0 2 0 18 0 34 0 50 0 50 2 50 18 50 34 50 50 48 50 32 50 16 50 0 50</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">max_len</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The length of segments must be a positive and non-zero value&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_split_line_segment</span><span class="p">(</span><span class="n">p1</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">p2</span><span class="p">:</span> <span class="n">Point</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Split a line segment *p1p2* into shorter segments of length ``&lt;= max_len``&quot;&quot;&quot;</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">LineString</span><span class="p">([</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">])</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">length</span>

        <span class="c1"># If already short enough, just return the end point</span>
        <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;=</span> <span class="n">max_len</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="n">p2</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">y</span><span class="p">)]</span>

        <span class="c1"># Split the line into segments of max_len, with possibly shorter first segment</span>
        <span class="n">segments</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Point</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">distance_rest</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">%</span> <span class="n">max_len</span>
        <span class="n">cur_distance</span> <span class="o">=</span> <span class="n">distance_rest</span> <span class="k">if</span> <span class="n">distance_rest</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">max_len</span>

        <span class="k">while</span> <span class="n">cur_distance</span> <span class="o">&lt;=</span> <span class="n">distance</span><span class="p">:</span>
            <span class="n">point</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">cur_distance</span><span class="p">)</span>
            <span class="n">segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">point</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
            <span class="n">cur_distance</span> <span class="o">+=</span> <span class="n">max_len</span>

        <span class="k">return</span> <span class="n">segments</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_close_contour_if_needed</span><span class="p">(</span><span class="n">current_pt</span><span class="p">,</span> <span class="n">first_move_pt</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper to close a contour by splitting the closing line if needed.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">current_pt</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">first_move_pt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">current_pt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">current_pt</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">first_move_pt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">first_move_pt</span><span class="o">.</span><span class="n">y</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">closing_points</span> <span class="o">=</span> <span class="n">_split_line_segment</span><span class="p">(</span><span class="n">current_pt</span><span class="p">,</span> <span class="n">first_move_pt</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ShapeElement</span><span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">pt</span><span class="p">])</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">closing_points</span><span class="p">]</span>

    <span class="c1"># First flatten the shape to convert bezier curves to lines</span>
    <span class="n">flattened_shape</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drawing_cmds</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">tolerance</span><span class="p">)</span>

    <span class="c1"># Process elements</span>
    <span class="n">split_elements</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_point</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">first_move_point</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">flattened_shape</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
            <span class="c1"># Close previous contour if needed</span>
            <span class="n">split_elements</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="n">_close_contour_if_needed</span><span class="p">(</span><span class="n">current_point</span><span class="p">,</span> <span class="n">first_move_point</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># Start new contour</span>
            <span class="n">split_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
            <span class="n">current_point</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">first_move_point</span> <span class="o">=</span> <span class="n">current_point</span>

        <span class="k">elif</span> <span class="n">element</span><span class="o">.</span><span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;l&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">current_point</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Line command found without a starting point&quot;</span><span class="p">)</span>

            <span class="c1"># Split the line segment</span>
            <span class="n">line_points</span> <span class="o">=</span> <span class="n">_split_line_segment</span><span class="p">(</span><span class="n">current_point</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="c1"># Add each segment as a separate line element</span>
            <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">line_points</span><span class="p">:</span>
                <span class="n">split_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ShapeElement</span><span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">point</span><span class="p">]))</span>

            <span class="c1"># Update current point</span>
            <span class="n">current_point</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">line_points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">line_points</span> <span class="k">else</span> <span class="n">element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="n">element</span><span class="o">.</span><span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span>
            <span class="c1"># Close current contour</span>
            <span class="n">split_elements</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="n">_close_contour_if_needed</span><span class="p">(</span><span class="n">current_point</span><span class="p">,</span> <span class="n">first_move_point</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># Reset state for next contour</span>
            <span class="n">current_point</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">first_move_point</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">split_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">:</span>
                <span class="n">current_point</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Close the final contour if needed</span>
    <span class="n">split_elements</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_close_contour_if_needed</span><span class="p">(</span><span class="n">current_point</span><span class="p">,</span> <span class="n">first_move_point</span><span class="p">))</span>

    <span class="c1"># Update shape with split elements</span>
    <span class="k">return</span> <span class="n">Shape</span><span class="p">(</span><span class="n">elements</span><span class="o">=</span><span class="n">split_elements</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.shape.Shape.buffer" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">buffer</span><span class="p">(</span><span class="n">dist_xy</span><span class="p">,</span> <span class="n">dist_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;border&#39;</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return a buffered version of the shape.</p>
<p>It makes a thicker or thinner version of the original shape by adding or removing space around it, based on the distances you specify.
The "kind" option decides if you get the whole new shape filled in or just the edge line.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dist_xy</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Horizontal buffer distance. Positive values expand the shape, and negative values contract it.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dist_y</code>
            </td>
            <td>
                  <code><span title="float">float</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Vertical buffer distance. If None, the same value as dist_xy is used. The sign must match that of dist_xy.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kind</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;fill&#39;, &#39;border&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Determines whether to return the filled buffered geometry ("fill") or just the border ("border").</p>
              </div>
            </td>
            <td>
                  <code>&#39;border&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>join</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;round&#39;, &#39;bevel&#39;, &#39;mitre&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The corner join style to use on buffered corners.</p>
              </div>
            </td>
            <td>
                  <code>&#39;round&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Shape</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Shape (pyonfx.shape.Shape)" href="#pyonfx.shape.Shape">Shape</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new Shape instance representing the buffered shape.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">shape</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="s2">&quot;m 0 0 l 100 0 100 50 0 50&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">shape</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;border&quot;</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s2">&quot;round&quot;</span><span class="p">)</span>
<span class="go">m -3.333 50 l -3.269 50.65 (...)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>pyonfx/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">buffer</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dist_xy</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">dist_y</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="s2">&quot;border&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;border&quot;</span><span class="p">,</span>
    <span class="n">join</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;round&quot;</span><span class="p">,</span> <span class="s2">&quot;bevel&quot;</span><span class="p">,</span> <span class="s2">&quot;mitre&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;round&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a buffered version of the shape.</span>

<span class="sd">    It makes a thicker or thinner version of the original shape by adding or removing space around it, based on the distances you specify.</span>
<span class="sd">    The &quot;kind&quot; option decides if you get the whole new shape filled in or just the edge line.</span>

<span class="sd">    Args:</span>
<span class="sd">        dist_xy: Horizontal buffer distance. Positive values expand the shape, and negative values contract it.</span>
<span class="sd">        dist_y: Vertical buffer distance. If None, the same value as dist_xy is used. The sign must match that of dist_xy.</span>
<span class="sd">        kind: Determines whether to return the filled buffered geometry (&quot;fill&quot;) or just the border (&quot;border&quot;).</span>
<span class="sd">        join: The corner join style to use on buffered corners.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Shape: A new Shape instance representing the buffered shape.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; shape = Shape(&quot;m 0 0 l 100 0 100 50 0 50&quot;)</span>
<span class="sd">        &gt;&gt;&gt; shape.buffer(5, kind=&quot;border&quot;, join=&quot;round&quot;)</span>
<span class="sd">        m -3.333 50 l -3.269 50.65 (...)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">join</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;round&quot;</span><span class="p">,</span> <span class="s2">&quot;bevel&quot;</span><span class="p">,</span> <span class="s2">&quot;mitre&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;join must be one of &#39;round&#39;, &#39;bevel&#39;, or &#39;mitre&#39;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kind</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="s2">&quot;border&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;kind must be either &#39;fill&#39; or &#39;border&#39;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dist_y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dist_y</span> <span class="o">=</span> <span class="n">dist_xy</span>
    <span class="k">if</span> <span class="n">dist_xy</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">dist_y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Shape</span><span class="p">()</span> <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;border&quot;</span> <span class="k">else</span> <span class="bp">self</span>

    <span class="c1"># Validate signs: both distances must have the same sign (or be zero)</span>
    <span class="k">if</span> <span class="n">dist_xy</span> <span class="o">*</span> <span class="n">dist_y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;dist_xy and dist_y must have the same sign&quot;</span><span class="p">)</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">dist_xy</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>

    <span class="c1"># Build Shapely geometry</span>
    <span class="n">multipoly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_multipolygon</span><span class="p">()</span>

    <span class="c1"># Apply libass hack</span>
    <span class="n">_LIBASS_HACK</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span>
    <span class="n">dist_xy</span> <span class="o">*=</span> <span class="n">_LIBASS_HACK</span>
    <span class="n">dist_y</span> <span class="o">*=</span> <span class="n">_LIBASS_HACK</span>

    <span class="c1"># Anisotropic scaling so that the buffer distance is uniform</span>
    <span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">dist_xy</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dist_y</span><span class="p">))</span>

    <span class="n">_EPS</span> <span class="o">=</span> <span class="mf">1e-9</span>  <span class="c1"># Avoid division-by-zero</span>
    <span class="n">xscale</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dist_xy</span><span class="p">)</span> <span class="o">/</span> <span class="n">width</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dist_xy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">_EPS</span>
    <span class="n">yscale</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dist_y</span><span class="p">)</span> <span class="o">/</span> <span class="n">width</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dist_y</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">_EPS</span>

    <span class="n">inv_xscale</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">xscale</span>
    <span class="n">inv_yscale</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">yscale</span>
    <span class="n">scaled_geom</span> <span class="o">=</span> <span class="n">affine_scale</span><span class="p">(</span>
        <span class="n">multipoly</span><span class="p">,</span> <span class="n">xfact</span><span class="o">=</span><span class="n">inv_xscale</span><span class="p">,</span> <span class="n">yfact</span><span class="o">=</span><span class="n">inv_yscale</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Apply buffer (positive  outward, negative  inward)</span>
    <span class="n">buffered_scaled</span> <span class="o">=</span> <span class="n">scaled_geom</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span>
        <span class="n">sign</span> <span class="o">*</span> <span class="n">width</span><span class="p">,</span> <span class="n">join_style</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">JOIN_STYLE</span><span class="p">,</span> <span class="n">join</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;fill&quot;</span><span class="p">:</span>
        <span class="c1"># Grown/shrunk geometry</span>
        <span class="n">result_scaled</span> <span class="o">=</span> <span class="n">buffered_scaled</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sign</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># External border: grow and subtract original</span>
            <span class="n">result_scaled</span> <span class="o">=</span> <span class="n">buffered_scaled</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">scaled_geom</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Internal border: shrink original and subtract new interior</span>
            <span class="n">result_scaled</span> <span class="o">=</span> <span class="n">scaled_geom</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">buffered_scaled</span><span class="p">)</span>

    <span class="c1"># Scale back to the original coordinate system</span>
    <span class="n">result_geom</span> <span class="o">=</span> <span class="n">affine_scale</span><span class="p">(</span>
        <span class="n">result_scaled</span><span class="p">,</span> <span class="n">xfact</span><span class="o">=</span><span class="n">xscale</span><span class="p">,</span> <span class="n">yfact</span><span class="o">=</span><span class="n">yscale</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Craft MultiPolygon</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result_geom</span><span class="p">,</span> <span class="n">MultiPolygon</span><span class="p">):</span>
        <span class="n">mp</span> <span class="o">=</span> <span class="n">result_geom</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result_geom</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">):</span>
        <span class="n">mp</span> <span class="o">=</span> <span class="n">MultiPolygon</span><span class="p">([</span><span class="n">result_geom</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid stroke geometry type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">result_geom</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Convert back to Shape</span>
    <span class="k">return</span> <span class="n">Shape</span><span class="o">.</span><span class="n">from_multipolygon</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.shape.Shape.morph" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">morph</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span><span class="mf">16.0</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">min_point_spacing</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">w_dist</span><span class="o">=</span><span class="mf">0.55</span><span class="p">,</span> <span class="n">w_area</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">w_overlap</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">cost_threshold</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">ensure_shell_pairs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Interpolate the current shape toward a target shape.</p>
<p>This method computes an intermediate shape by morphing the current shape into a target shape based on an interpolation factor t (where 0 corresponds to the source shape and 1 corresponds to the target shape).
The morph is performed by decomposing both shapes into closed ring segments and matching corresponding rings based on spatial properties. Matched rings are linearly interpolated, and unmatched rings are processed to appear or disappear gradually.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Shape (pyonfx.shape.Shape)" href="#pyonfx.shape.Shape">Shape</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The target shape to morph into.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>t</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Interpolation factor between 0 and 1, where 0 returns the original shape and 1 returns the target shape.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_len</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum allowed length for any line segment when splitting curves before morphing.</p>
              </div>
            </td>
            <td>
                  <code>16.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tolerance</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tolerance angle in degrees used when flattening curves.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_point_spacing</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Per-axis spacing threshold - a vertex is kept only if both <code>|x|</code> and <code>|y|</code> from the previous vertex are  this value (increasing it will boost performance during reproduction, but lower accuracy).</p>
              </div>
            </td>
            <td>
                  <code>0.5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>w_dist</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weight for the centroid-distance term (higher values make proximity more important).</p>
              </div>
            </td>
            <td>
                  <code>0.55</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>w_area</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weight for the relative area-difference term (higher values make size similarity more important).</p>
              </div>
            </td>
            <td>
                  <code>0.35</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>w_overlap</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weight for the overlap / IoU term that penalises pairs with little spatial intersection.</p>
              </div>
            </td>
            <td>
                  <code>0.1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cost_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum acceptable cost for a pairing. Pairs whose cost is above this threshold are treated as unmatched and will grow/shrink to the closest centroid.</p>
              </div>
            </td>
            <td>
                  <code>2.5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ensure_shell_pairs</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, shell rings that would otherwise remain unmatched will be force-paired with the shell that yields the minimum cost. This guarantees that every visible contour morphs into something, at the price of allowing the same shell to be reused multiple times.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Shape</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Shape (pyonfx.shape.Shape)" href="#pyonfx.shape.Shape">Shape</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new Shape instance representing the intermediate morph state.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">source</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="s2">&quot;m 0 0 l 100 0 100 100 0 100 c&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">(</span><span class="s2">&quot;m 50 50 l 150 50 150 150 50 150 c&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">morph</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">morph</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>pyonfx/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">morph</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">target</span><span class="p">:</span> <span class="s2">&quot;Shape&quot;</span><span class="p">,</span>
    <span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">max_len</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">16.0</span><span class="p">,</span>
    <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">min_point_spacing</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">w_dist</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.55</span><span class="p">,</span>
    <span class="n">w_area</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.35</span><span class="p">,</span>
    <span class="n">w_overlap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">cost_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.5</span><span class="p">,</span>
    <span class="n">ensure_shell_pairs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interpolate the current shape toward a target shape.</span>

<span class="sd">    This method computes an intermediate shape by morphing the current shape into a target shape based on an interpolation factor t (where 0 corresponds to the source shape and 1 corresponds to the target shape).</span>
<span class="sd">    The morph is performed by decomposing both shapes into closed ring segments and matching corresponding rings based on spatial properties. Matched rings are linearly interpolated, and unmatched rings are processed to appear or disappear gradually.</span>

<span class="sd">    Args:</span>
<span class="sd">        target: The target shape to morph into.</span>
<span class="sd">        t: Interpolation factor between 0 and 1, where 0 returns the original shape and 1 returns the target shape.</span>
<span class="sd">        max_len: The maximum allowed length for any line segment when splitting curves before morphing.</span>
<span class="sd">        tolerance: The tolerance angle in degrees used when flattening curves.</span>
<span class="sd">        min_point_spacing: Per-axis spacing threshold - a vertex is kept only if both `|x|` and `|y|` from the previous vertex are  this value (increasing it will boost performance during reproduction, but lower accuracy).</span>
<span class="sd">        w_dist: Weight for the centroid-distance term (higher values make proximity more important).</span>
<span class="sd">        w_area: Weight for the relative area-difference term (higher values make size similarity more important).</span>
<span class="sd">        w_overlap: Weight for the overlap / IoU term that penalises pairs with little spatial intersection.</span>
<span class="sd">        cost_threshold: Maximum acceptable cost for a pairing. Pairs whose cost is above this threshold are treated as unmatched and will grow/shrink to the closest centroid.</span>
<span class="sd">        ensure_shell_pairs: If `True`, shell rings that would otherwise remain unmatched will be force-paired with the shell that yields the minimum cost. This guarantees that every visible contour morphs into something, at the price of allowing the same shell to be reused multiple times.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Shape: A new Shape instance representing the intermediate morph state.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; source = Shape(&quot;m 0 0 l 100 0 100 100 0 100 c&quot;)</span>
<span class="sd">        &gt;&gt;&gt; target = Shape(&quot;m 50 50 l 150 50 150 150 50 150 c&quot;)</span>
<span class="sd">        &gt;&gt;&gt; morph = source.morph(target, t=0.5)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Fast-path validations</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Shape</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Target must be a Shape instance&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;t must be between 0 and 1&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">target</span>

    <span class="c1"># Use the multi-shape morphing routine to get intermediate geometries.</span>
    <span class="n">morphs</span> <span class="o">=</span> <span class="n">Shape</span><span class="o">.</span><span class="n">morph_multi</span><span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;_&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;_&quot;</span><span class="p">:</span> <span class="n">target</span><span class="p">},</span>
        <span class="n">t</span><span class="p">,</span>
        <span class="n">max_len</span><span class="o">=</span><span class="n">max_len</span><span class="p">,</span>
        <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="p">,</span>
        <span class="n">min_point_spacing</span><span class="o">=</span><span class="n">min_point_spacing</span><span class="p">,</span>
        <span class="n">w_dist</span><span class="o">=</span><span class="n">w_dist</span><span class="p">,</span>
        <span class="n">w_area</span><span class="o">=</span><span class="n">w_area</span><span class="p">,</span>
        <span class="n">w_overlap</span><span class="o">=</span><span class="n">w_overlap</span><span class="p">,</span>
        <span class="n">cost_threshold</span><span class="o">=</span><span class="n">cost_threshold</span><span class="p">,</span>
        <span class="n">ensure_shell_pairs</span><span class="o">=</span><span class="n">ensure_shell_pairs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">shapes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">morphs</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">combined_shape</span> <span class="o">=</span> <span class="n">shapes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">combined_shape</span> <span class="o">=</span> <span class="n">combined_shape</span><span class="o">.</span><span class="n">boolean</span><span class="p">(</span>
            <span class="n">shape</span><span class="p">,</span>
            <span class="n">op</span><span class="o">=</span><span class="s2">&quot;union&quot;</span><span class="p">,</span>
            <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="p">,</span>
            <span class="n">min_point_spacing</span><span class="o">=</span><span class="n">min_point_spacing</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">combined_shape</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.shape.Shape.morph_multi" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">morph_multi</span><span class="p">(</span><span class="n">src_shapes</span><span class="p">,</span> <span class="n">tgt_shapes</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span><span class="mf">16.0</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">min_point_spacing</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">w_dist</span><span class="o">=</span><span class="mf">0.55</span><span class="p">,</span> <span class="n">w_area</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">w_overlap</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">cost_threshold</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">ensure_shell_pairs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Interpolate multiple shapes simultaneously.</p>
<p>This class method performs a multi-shape morphing operation by interpolating between collections of source and target shapes.
It decomposes each shape into rings, matches corresponding rings across the source and target collections based on spatial relationships, and computes intermediate shapes at a given interpolation factor t.
The output is a dictionary mapping source-target identifier tuples to the resulting interpolated Shape.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>src_shapes</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <a class="autorefs autorefs-internal" title="Shape (pyonfx.shape.Shape)" href="#pyonfx.shape.Shape">Shape</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary mapping source shape identifiers to their corresponding Shape instances.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tgt_shapes</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <a class="autorefs autorefs-internal" title="Shape (pyonfx.shape.Shape)" href="#pyonfx.shape.Shape">Shape</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary mapping target shape identifiers to their corresponding Shape instances.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>t</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Interpolation factor between 0 and 1. A value of 0 returns the source shapes and 1 returns the target shapes.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_len</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum allowed length for any line segment after splitting curves.</p>
              </div>
            </td>
            <td>
                  <code>16.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tolerance</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tolerance angle in degrees used when flattening curves.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_point_spacing</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Per-axis spacing threshold - a vertex is kept only if both <code>|x|</code> and <code>|y|</code> from the previous vertex are  this value (increasing it will boost performance during reproduction, but lower accuracy).</p>
              </div>
            </td>
            <td>
                  <code>0.5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>w_dist</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weight for the centroid-distance term (higher values make proximity more important).</p>
              </div>
            </td>
            <td>
                  <code>0.55</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>w_area</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weight for the relative area-difference term (higher values make size similarity more important).</p>
              </div>
            </td>
            <td>
                  <code>0.35</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>w_overlap</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Weight for the overlap / IoU term that penalises pairs with little spatial intersection.</p>
              </div>
            </td>
            <td>
                  <code>0.1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cost_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum acceptable cost for a pairing. Pairs whose cost is above this threshold are treated as unmatched and will grow/shrink to the closest centroid.</p>
              </div>
            </td>
            <td>
                  <code>2.5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ensure_shell_pairs</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, shell rings that would otherwise remain unmatched will be force-paired with the shell that yields the minimum cost. This guarantees that every visible contour morphs into something, at the price of allowing the same shell to be reused multiple times.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="tuple">tuple</span>[<span title="str">str</span> | None, <span title="str">str</span> | None], <a class="autorefs autorefs-internal" title="Shape (pyonfx.shape.Shape)" href="#pyonfx.shape.Shape">Shape</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[tuple[str | None, str | None], Shape]: A dictionary mapping tuples of source and target identifiers to the corresponding interpolated Shape. A source identifier of None indicates an appearing shape, while a target identifier of None indicates a disappearing shape.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">src</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="n">Shape</span><span class="o">.</span><span class="n">star</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="n">Shape</span><span class="o">.</span><span class="n">ellipse</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tgt</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">Shape</span><span class="o">.</span><span class="n">polygon</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span> <span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">morphs</span> <span class="o">=</span> <span class="n">Shape</span><span class="o">.</span><span class="n">morph_multi</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">tgt</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="p">(</span><span class="n">src_id</span><span class="p">,</span> <span class="n">tgt_id</span><span class="p">),</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">morphs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">src_id</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">tgt_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>


            <details class="quote">
              <summary>Source code in <code>pyonfx/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">morph_multi</span><span class="p">(</span>
    <span class="n">src_shapes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;Shape&quot;</span><span class="p">],</span>
    <span class="n">tgt_shapes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;Shape&quot;</span><span class="p">],</span>
    <span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">max_len</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">16.0</span><span class="p">,</span>
    <span class="n">tolerance</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">min_point_spacing</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">w_dist</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.55</span><span class="p">,</span>
    <span class="n">w_area</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.35</span><span class="p">,</span>
    <span class="n">w_overlap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">cost_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.5</span><span class="p">,</span>
    <span class="n">ensure_shell_pairs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">],</span> <span class="s2">&quot;Shape&quot;</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interpolate multiple shapes simultaneously.</span>

<span class="sd">    This class method performs a multi-shape morphing operation by interpolating between collections of source and target shapes.</span>
<span class="sd">    It decomposes each shape into rings, matches corresponding rings across the source and target collections based on spatial relationships, and computes intermediate shapes at a given interpolation factor t.</span>
<span class="sd">    The output is a dictionary mapping source-target identifier tuples to the resulting interpolated Shape.</span>

<span class="sd">    Args:</span>
<span class="sd">        src_shapes: A dictionary mapping source shape identifiers to their corresponding Shape instances.</span>
<span class="sd">        tgt_shapes: A dictionary mapping target shape identifiers to their corresponding Shape instances.</span>
<span class="sd">        t: Interpolation factor between 0 and 1. A value of 0 returns the source shapes and 1 returns the target shapes.</span>
<span class="sd">        max_len: Maximum allowed length for any line segment after splitting curves.</span>
<span class="sd">        tolerance: The tolerance angle in degrees used when flattening curves.</span>
<span class="sd">        min_point_spacing: Per-axis spacing threshold - a vertex is kept only if both `|x|` and `|y|` from the previous vertex are  this value (increasing it will boost performance during reproduction, but lower accuracy).</span>
<span class="sd">        w_dist: Weight for the centroid-distance term (higher values make proximity more important).</span>
<span class="sd">        w_area: Weight for the relative area-difference term (higher values make size similarity more important).</span>
<span class="sd">        w_overlap: Weight for the overlap / IoU term that penalises pairs with little spatial intersection.</span>
<span class="sd">        cost_threshold: Maximum acceptable cost for a pairing. Pairs whose cost is above this threshold are treated as unmatched and will grow/shrink to the closest centroid.</span>
<span class="sd">        ensure_shell_pairs: If `True`, shell rings that would otherwise remain unmatched will be force-paired with the shell that yields the minimum cost. This guarantees that every visible contour morphs into something, at the price of allowing the same shell to be reused multiple times.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[tuple[str | None, str | None], Shape]: A dictionary mapping tuples of source and target identifiers to the corresponding interpolated Shape. A source identifier of None indicates an appearing shape, while a target identifier of None indicates a disappearing shape.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; src = { &#39;A&#39;: Shape.star(5, 20, 40), &#39;B&#39;: Shape.ellipse(50, 30).move(100, 0) }</span>
<span class="sd">        &gt;&gt;&gt; tgt = { &#39;X&#39;: Shape.polygon(6, 45) }</span>
<span class="sd">        &gt;&gt;&gt; morphs = Shape.morph_multi(src, tgt, t=0.5)</span>
<span class="sd">        &gt;&gt;&gt; for (src_id, tgt_id), shape in morphs.items():</span>
<span class="sd">        ...     print(f&quot;{src_id} -&gt; {tgt_id}: {shape}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Basic validation</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;t must be between 0 and 1&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">Shape</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">src_shapes</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;All src_shapes values must be Shape instances&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">Shape</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">tgt_shapes</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;All tgt_shapes values must be Shape instances&quot;</span><span class="p">)</span>

    <span class="c1"># Fast-paths</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">src_shapes</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{(</span><span class="kc">None</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tgt_shapes</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_morph_transition</span><span class="p">(</span>
        <span class="n">ring</span><span class="p">:</span> <span class="n">LinearRing</span><span class="p">,</span>
        <span class="n">ref_pt</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span>
        <span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">appearing</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LinearRing</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Morphism helper shared by *appearing* and *disappearing* rings.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">appearing</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">appearing</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ring</span>

        <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ring</span><span class="o">.</span><span class="n">coords</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">appearing</span><span class="p">:</span>
            <span class="c1"># Grow *ring* from *ref_pt*</span>
            <span class="n">origin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ref_pt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ref_pt</span><span class="o">.</span><span class="n">y</span><span class="p">])</span>
            <span class="n">new_coords</span> <span class="o">=</span> <span class="n">origin</span> <span class="o">+</span> <span class="p">(</span><span class="n">coords</span> <span class="o">-</span> <span class="n">origin</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Shrink *ring* towards *ref_pt*</span>
            <span class="n">centroid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ring</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">dest</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ref_pt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ref_pt</span><span class="o">.</span><span class="n">y</span><span class="p">])</span>
            <span class="n">new_coords</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">centroid</span> <span class="o">+</span> <span class="p">(</span><span class="n">coords</span> <span class="o">-</span> <span class="n">centroid</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">dest</span> <span class="o">-</span> <span class="n">centroid</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span>
            <span class="p">)</span>

        <span class="n">new_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">new_coords</span><span class="p">,</span> <span class="n">new_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>  <span class="c1"># close ring</span>
        <span class="k">return</span> <span class="n">LinearRing</span><span class="p">(</span><span class="n">new_coords</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_interpolate_rings</span><span class="p">(</span>
        <span class="n">src_ring</span><span class="p">:</span> <span class="n">LinearRing</span><span class="p">,</span> <span class="n">tgt_ring</span><span class="p">:</span> <span class="n">LinearRing</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LinearRing</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Linear interpolation between two rings with optimal vertex correspondence.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">src_ring</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tgt_ring</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">src_ring</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tgt_ring</span><span class="o">.</span><span class="n">coords</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Rings must have the same number of vertices: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">src_ring</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tgt_ring</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">src_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">src_ring</span><span class="o">.</span><span class="n">coords</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">tgt_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tgt_ring</span><span class="o">.</span><span class="n">coords</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="c1"># Ensure orientation consistency</span>
        <span class="k">if</span> <span class="n">src_ring</span><span class="o">.</span><span class="n">is_ccw</span> <span class="o">!=</span> <span class="n">tgt_ring</span><span class="o">.</span><span class="n">is_ccw</span><span class="p">:</span>
            <span class="n">tgt_coords</span> <span class="o">=</span> <span class="n">tgt_coords</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Find optimal alignment by minimizing total vertex distances</span>
        <span class="n">n_vertices</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">src_coords</span><span class="p">)</span>
        <span class="n">min_total_distance</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
        <span class="n">best_shift</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Try all possible rotations and find the one with minimum total distance</span>
        <span class="k">for</span> <span class="n">shift</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_vertices</span><span class="p">):</span>
            <span class="n">shifted_tgt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">tgt_coords</span><span class="p">,</span> <span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">total_distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">src_coords</span> <span class="o">-</span> <span class="n">shifted_tgt</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">total_distance</span> <span class="o">&lt;</span> <span class="n">min_total_distance</span><span class="p">:</span>
                <span class="n">min_total_distance</span> <span class="o">=</span> <span class="n">total_distance</span>
                <span class="n">best_shift</span> <span class="o">=</span> <span class="n">shift</span>

        <span class="c1"># Apply the best alignment</span>
        <span class="k">if</span> <span class="n">best_shift</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tgt_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">tgt_coords</span><span class="p">,</span> <span class="o">-</span><span class="n">best_shift</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Perform linear interpolation between corresponding vertices</span>
        <span class="n">interp_coords</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">src_coords</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">tgt_coords</span>

        <span class="c1"># Close the ring</span>
        <span class="n">interp_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">interp_coords</span><span class="p">,</span> <span class="n">interp_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">LinearRing</span><span class="p">(</span><span class="n">interp_coords</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_rings_to_multipolygon</span><span class="p">(</span>
        <span class="n">rings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">LinearRing</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MultiPolygon</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a collection of `(ring, is_hole)` tuples to a `MultiPolygon`.&quot;&quot;&quot;</span>

        <span class="c1"># Gather polygons (shells and holes)</span>
        <span class="n">shell_polys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Polygon</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">hole_polys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Polygon</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">lr</span><span class="p">,</span> <span class="n">is_hole</span> <span class="ow">in</span> <span class="n">rings</span><span class="p">:</span>
            <span class="n">poly</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">lr</span><span class="p">)</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">poly</span><span class="o">.</span><span class="n">is_empty</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">poly</span><span class="o">.</span><span class="n">is_valid</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="p">(</span><span class="n">hole_polys</span> <span class="k">if</span> <span class="n">is_hole</span> <span class="k">else</span> <span class="n">shell_polys</span><span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>

        <span class="c1"># Union the shells and holes</span>
        <span class="n">shell_union</span> <span class="o">=</span> <span class="n">unary_union</span><span class="p">(</span><span class="n">shell_polys</span><span class="p">)</span> <span class="k">if</span> <span class="n">shell_polys</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">hole_union</span> <span class="o">=</span> <span class="n">unary_union</span><span class="p">(</span><span class="n">hole_polys</span><span class="p">)</span> <span class="k">if</span> <span class="n">hole_polys</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="c1"># Subtract the holes from the shells (if any)</span>
        <span class="k">if</span> <span class="n">shell_union</span> <span class="ow">and</span> <span class="n">hole_union</span><span class="p">:</span>
            <span class="n">combined</span> <span class="o">=</span> <span class="n">shell_union</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">hole_union</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">shell_union</span><span class="p">:</span>
            <span class="n">combined</span> <span class="o">=</span> <span class="n">shell_union</span>
        <span class="k">elif</span> <span class="n">hole_union</span><span class="p">:</span>
            <span class="n">combined</span> <span class="o">=</span> <span class="n">hole_union</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MultiPolygon</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">combined</span><span class="p">,</span> <span class="n">MultiPolygon</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">combined</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">combined</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">MultiPolygon</span><span class="p">([</span><span class="n">combined</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Combined geometry is not a Polygon or MultiPolygon&quot;</span><span class="p">)</span>

    <span class="c1"># 1) Retrieve pairing &amp; resampling information (cached)</span>
    <span class="n">src_cmds</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">drawing_cmds</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">src_shapes</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
    <span class="n">dst_cmds</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">drawing_cmds</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">tgt_shapes</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>

    <span class="n">paired</span><span class="p">,</span> <span class="n">src_unmatched</span><span class="p">,</span> <span class="n">tgt_unmatched</span> <span class="o">=</span> <span class="n">Shape</span><span class="o">.</span><span class="n">_prepare_morph</span><span class="p">(</span>
        <span class="n">src_cmds</span><span class="p">,</span>
        <span class="n">dst_cmds</span><span class="p">,</span>
        <span class="n">max_len</span><span class="p">,</span>
        <span class="n">tolerance</span><span class="p">,</span>
        <span class="n">w_dist</span><span class="p">,</span>
        <span class="n">w_area</span><span class="p">,</span>
        <span class="n">w_overlap</span><span class="p">,</span>
        <span class="n">cost_threshold</span><span class="p">,</span>
        <span class="n">ensure_shell_pairs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># 2) Interpolate matched rings</span>
    <span class="n">result_rings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">LinearRing</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">_interpolate_rings</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">tgt</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="n">is_hole</span><span class="p">,</span> <span class="n">src_id</span><span class="p">,</span> <span class="n">tgt_id</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">tgt</span><span class="p">,</span> <span class="n">is_hole</span><span class="p">,</span> <span class="n">src_id</span><span class="p">,</span> <span class="n">tgt_id</span> <span class="ow">in</span> <span class="n">paired</span>
    <span class="p">]</span>

    <span class="c1"># 3) Handle disappearing / appearing rings</span>
    <span class="k">for</span> <span class="n">ring</span><span class="p">,</span> <span class="n">dest_pt</span><span class="p">,</span> <span class="n">is_hole</span><span class="p">,</span> <span class="n">src_id</span> <span class="ow">in</span> <span class="n">src_unmatched</span><span class="p">:</span>
        <span class="n">result_rings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">_morph_transition</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="n">dest_pt</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">appearing</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
                <span class="n">is_hole</span><span class="p">,</span>
                <span class="n">src_id</span><span class="p">,</span>
                <span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">for</span> <span class="n">ring</span><span class="p">,</span> <span class="n">origin_pt</span><span class="p">,</span> <span class="n">is_hole</span><span class="p">,</span> <span class="n">tgt_id</span> <span class="ow">in</span> <span class="n">tgt_unmatched</span><span class="p">:</span>
        <span class="n">result_rings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">_morph_transition</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="n">origin_pt</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">appearing</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="n">is_hole</span><span class="p">,</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="n">tgt_id</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># 4) Group by (shape_id, target_id)</span>
    <span class="c1">#    Holes coming from / going to *None* (i.e. appearing/disappearing) must be</span>
    <span class="c1">#    subtracted from *every* shape  they are collected in `global_holes` and</span>
    <span class="c1">#    later injected into every flow.</span>

    <span class="n">global_holes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">LinearRing</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># always [(ring, True)]</span>
    <span class="n">flows</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">LinearRing</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">ring</span><span class="p">,</span> <span class="n">is_hole</span><span class="p">,</span> <span class="n">src_id</span><span class="p">,</span> <span class="n">tgt_id</span> <span class="ow">in</span> <span class="n">result_rings</span><span class="p">:</span>
        <span class="c1"># If the ring is a hole and one side of the morph is missing, treat it as</span>
        <span class="c1"># a *global* hole that has to be removed from every resulting geometry.</span>
        <span class="k">if</span> <span class="n">is_hole</span> <span class="ow">and</span> <span class="p">(</span><span class="n">src_id</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">tgt_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">global_holes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ring</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
            <span class="k">continue</span>

        <span class="n">flows</span><span class="o">.</span><span class="n">setdefault</span><span class="p">((</span><span class="n">src_id</span><span class="p">,</span> <span class="n">tgt_id</span><span class="p">),</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ring</span><span class="p">,</span> <span class="n">is_hole</span><span class="p">))</span>

    <span class="c1"># Inject global holes into every shape flow so they are diffed out.</span>
    <span class="k">if</span> <span class="n">global_holes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ring_list</span> <span class="ow">in</span> <span class="n">flows</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">ring_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">global_holes</span><span class="p">)</span>

    <span class="c1"># 5) Convert back to Shape and return as dictionary</span>
    <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">],</span> <span class="n">Shape</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">src_id</span><span class="p">,</span> <span class="n">tgt_id</span><span class="p">),</span> <span class="n">ring_list</span> <span class="ow">in</span> <span class="n">flows</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">mp</span> <span class="o">=</span> <span class="n">_rings_to_multipolygon</span><span class="p">(</span><span class="n">ring_list</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[(</span><span class="n">src_id</span><span class="p">,</span> <span class="n">tgt_id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">Shape</span><span class="o">.</span><span class="n">from_multipolygon</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span> <span class="n">min_point_spacing</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.shape.Shape.triangle" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">triangle</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Creates a triangle centered at the origin with the specified width and height.</p>
<p>The triangle is defined by three vertices:
- Top vertex at (0, height/2).
- Bottom-left vertex at (-width/2, -height/2).
- Bottom-right vertex at (width/2, -height/2).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>width</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The width of the triangle base (must be positive).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>height</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The height of the triangle (must be positive).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Shape</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Shape (pyonfx.shape.Shape)" href="#pyonfx.shape.Shape">Shape</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new Shape instance representing the triangle.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>pyonfx/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">triangle</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a triangle centered at the origin with the specified width and height.</span>

<span class="sd">    The triangle is defined by three vertices:</span>
<span class="sd">    - Top vertex at (0, height/2).</span>
<span class="sd">    - Bottom-left vertex at (-width/2, -height/2).</span>
<span class="sd">    - Bottom-right vertex at (width/2, -height/2).</span>

<span class="sd">    Args:</span>
<span class="sd">        width: The width of the triangle base (must be positive).</span>
<span class="sd">        height: The height of the triangle (must be positive).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Shape: A new Shape instance representing the triangle.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">width</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">height</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Width and height must be positive&quot;</span><span class="p">)</span>

    <span class="c1"># Calculate vertices</span>
    <span class="n">half_w</span> <span class="o">=</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">half_h</span> <span class="o">=</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">half_h</span><span class="p">),</span>  <span class="c1"># Top vertex</span>
        <span class="p">(</span><span class="o">-</span><span class="n">half_w</span><span class="p">,</span> <span class="o">-</span><span class="n">half_h</span><span class="p">),</span>  <span class="c1"># Bottom-left vertex</span>
        <span class="p">(</span><span class="n">half_w</span><span class="p">,</span> <span class="o">-</span><span class="n">half_h</span><span class="p">),</span>  <span class="c1"># Bottom-right vertex</span>
    <span class="p">]</span>

    <span class="c1"># Build ASS path command</span>
    <span class="n">f</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">format_value</span>
    <span class="n">path_parts</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;m </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">vertices</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">path_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;l </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">vertex</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">vertex</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_parts</span><span class="p">))</span><span class="o">.</span><span class="n">align</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.shape.Shape.rectangle" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rectangle</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Creates a rectangle shape with the specified width and height.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>width</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The width of the rectangle (must be positive).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>height</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The height of the rectangle (must be positive).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Shape</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Shape (pyonfx.shape.Shape)" href="#pyonfx.shape.Shape">Shape</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new Shape instance representing the rectangle.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>pyonfx/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">rectangle</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a rectangle shape with the specified width and height.</span>

<span class="sd">    Args:</span>
<span class="sd">        width: The width of the rectangle (must be positive).</span>
<span class="sd">        height: The height of the rectangle (must be positive).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Shape: A new Shape instance representing the rectangle.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">width</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">height</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Width and height must be positive&quot;</span><span class="p">)</span>

    <span class="n">f</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">format_value</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="s2">&quot;m 0 0 l </span><span class="si">%s</span><span class="s2"> 0 </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> 0 </span><span class="si">%s</span><span class="s2"> 0 0&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">width</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">width</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">height</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">height</span><span class="p">))</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.shape.Shape.square" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">square</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Creates a square shape with the given side length.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>size</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The side length of the square (must be positive).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Shape</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Shape (pyonfx.shape.Shape)" href="#pyonfx.shape.Shape">Shape</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new Shape instance representing the square.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>pyonfx/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">square</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a square shape with the given side length.</span>

<span class="sd">    Args:</span>
<span class="sd">        size: The side length of the square (must be positive).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Shape: A new Shape instance representing the square.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.shape.Shape.rounded_rectangle" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rounded_rectangle</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Creates a rounded rectangle shape.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>width</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Rectangle width in pixels (must be positive).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>height</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Rectangle height in pixels (must be positive).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>radius</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Corner radius in pixels (must be &lt;= min(width/2, height/2)).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Shape</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Shape (pyonfx.shape.Shape)" href="#pyonfx.shape.Shape">Shape</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A rounded rectangle with origin at top-left (0,0), extending to (width, height).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>pyonfx/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">rounded_rectangle</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a rounded rectangle shape.</span>

<span class="sd">    Args:</span>
<span class="sd">        width: Rectangle width in pixels (must be positive).</span>
<span class="sd">        height: Rectangle height in pixels (must be positive).</span>
<span class="sd">        radius: Corner radius in pixels (must be &lt;= min(width/2, height/2)).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Shape: A rounded rectangle with origin at top-left (0,0), extending to (width, height).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">width</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">height</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Width and height must be positive&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">radius</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Radius must be non-negative&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">radius</span> <span class="o">&gt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Radius is too large for the given dimensions&quot;</span><span class="p">)</span>

    <span class="n">f</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">format_value</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mf">0.5522847498</span> <span class="o">*</span> <span class="n">radius</span>  <span class="c1"># Bezier approximation constant</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">radius</span>

    <span class="c1"># Each tuple: (line_end_x, line_end_y, bezier_c1x, c1y, c2x, c2y, end_x, end_y)</span>
    <span class="n">segments</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="n">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">w</span> <span class="o">-</span> <span class="n">r</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">r</span><span class="p">),</span>  <span class="c1"># Top edge + top-right corner</span>
        <span class="p">(</span>
            <span class="n">w</span><span class="p">,</span>
            <span class="n">h</span> <span class="o">-</span> <span class="n">r</span><span class="p">,</span>
            <span class="n">w</span><span class="p">,</span>
            <span class="n">h</span> <span class="o">-</span> <span class="n">r</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span>
            <span class="n">w</span> <span class="o">-</span> <span class="n">k</span><span class="p">,</span>
            <span class="n">h</span><span class="p">,</span>
            <span class="n">w</span> <span class="o">-</span> <span class="n">r</span><span class="p">,</span>
            <span class="n">h</span><span class="p">,</span>
        <span class="p">),</span>  <span class="c1"># Right edge + bottom-right corner</span>
        <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">r</span> <span class="o">-</span> <span class="n">k</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">h</span> <span class="o">-</span> <span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">h</span> <span class="o">-</span> <span class="n">r</span><span class="p">),</span>  <span class="c1"># Bottom edge + bottom-left corner</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r</span> <span class="o">-</span> <span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>  <span class="c1"># Left edge + top-left corner</span>
    <span class="p">]</span>

    <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;m </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">lx</span><span class="p">,</span> <span class="n">ly</span><span class="p">,</span> <span class="n">c1x</span><span class="p">,</span> <span class="n">c1y</span><span class="p">,</span> <span class="n">c2x</span><span class="p">,</span> <span class="n">c2y</span><span class="p">,</span> <span class="n">ex</span><span class="p">,</span> <span class="n">ey</span> <span class="ow">in</span> <span class="n">segments</span><span class="p">:</span>
        <span class="n">cmd</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;l </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">lx</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">ly</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;b </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">c1x</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">c1y</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">c2x</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">c2y</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">f</span><span class="p">(</span><span class="n">ey</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.shape.Shape.polygon" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">polygon</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">side_length</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Creates a regular n-sided polygon shape.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>edges</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of sides for the polygon (must be at least 3).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>side_length</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The length of each side (must be positive).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Shape</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Shape (pyonfx.shape.Shape)" href="#pyonfx.shape.Shape">Shape</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A Shape object representing the polygon.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>pyonfx/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">polygon</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">edges</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">side_length</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a regular n-sided polygon shape.</span>

<span class="sd">    Args:</span>
<span class="sd">        edges: Number of sides for the polygon (must be at least 3).</span>
<span class="sd">        side_length: The length of each side (must be positive).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Shape: A Shape object representing the polygon.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">edges</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Edges must be  3&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">side_length</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Side length must be positive&quot;</span><span class="p">)</span>

    <span class="c1"># Calculate circumradius from side length</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="n">side_length</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">edges</span><span class="p">))</span>

    <span class="n">f</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">format_value</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Rotate to get a more natural orientation (flat bottom when possible)</span>
    <span class="n">angle_offset</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">edges</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">edges</span><span class="p">):</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="n">edges</span> <span class="o">+</span> <span class="n">angle_offset</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="n">pts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">y</span><span class="p">)))</span>

    <span class="n">cmd_parts</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;m </span><span class="si">{</span><span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> l&quot;</span><span class="p">]</span>
    <span class="n">cmd_parts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd_parts</span><span class="p">))</span><span class="o">.</span><span class="n">align</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.shape.Shape.ellipse" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ellipse</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Creates an ellipse shape centered at the origin.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>w</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The width of the ellipse.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>h</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The height of the ellipse.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Shape</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Shape (pyonfx.shape.Shape)" href="#pyonfx.shape.Shape">Shape</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A Shape object representing the ellipse.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>pyonfx/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">ellipse</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates an ellipse shape centered at the origin.</span>

<span class="sd">    Args:</span>
<span class="sd">        w: The width of the ellipse.</span>
<span class="sd">        h: The height of the ellipse.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Shape: A Shape object representing the ellipse.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">w2</span><span class="p">,</span> <span class="n">h2</span> <span class="o">=</span> <span class="n">w</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Number(s) expected&quot;</span><span class="p">)</span>

    <span class="n">f</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">format_value</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="s2">&quot;m 0 </span><span class="si">%s</span><span class="s2"> &quot;</span>
        <span class="s2">&quot;b 0 </span><span class="si">%s</span><span class="s2"> 0 0 </span><span class="si">%s</span><span class="s2"> 0 &quot;</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> 0 </span><span class="si">%s</span><span class="s2"> 0 </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> &quot;</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> &quot;</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> 0 </span><span class="si">%s</span><span class="s2"> 0 </span><span class="si">%s</span><span class="s2">&quot;</span>
        <span class="o">%</span> <span class="p">(</span>
            <span class="n">f</span><span class="p">(</span><span class="n">h2</span><span class="p">),</span>  <span class="c1"># move</span>
            <span class="n">f</span><span class="p">(</span><span class="n">h2</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">w2</span><span class="p">),</span>  <span class="c1"># curve 1</span>
            <span class="n">f</span><span class="p">(</span><span class="n">w2</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">h2</span><span class="p">),</span>  <span class="c1"># curve 2</span>
            <span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">h2</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">w</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">h</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">w2</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">h</span><span class="p">),</span>  <span class="c1"># curve 3</span>
            <span class="n">f</span><span class="p">(</span><span class="n">w2</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">h</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">h</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">h2</span><span class="p">),</span>  <span class="c1"># curve 4</span>
        <span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.shape.Shape.circle" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">circle</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Creates a circle shape with the given radius.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>radius</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The radius of the circle (must be positive).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Shape</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Shape (pyonfx.shape.Shape)" href="#pyonfx.shape.Shape">Shape</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new Shape instance representing the circle.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>pyonfx/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">circle</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a circle shape with the given radius.</span>

<span class="sd">    Args:</span>
<span class="sd">        radius: The radius of the circle (must be positive).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Shape: A new Shape instance representing the circle.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">ellipse</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">radius</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">radius</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.shape.Shape.ring" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ring</span><span class="p">(</span><span class="n">out_r</span><span class="p">,</span> <span class="n">in_r</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Creates a ring shape with specified inner and outer radii centered at the origin.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>out_r</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The outer radius of the ring.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>in_r</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The inner radius of the ring (must be less than out_r).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Shape</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Shape (pyonfx.shape.Shape)" href="#pyonfx.shape.Shape">Shape</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A Shape object representing the ring.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>pyonfx/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">ring</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">out_r</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">in_r</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a ring shape with specified inner and outer radii centered at the origin.</span>

<span class="sd">    Args:</span>
<span class="sd">        out_r: The outer radius of the ring.</span>
<span class="sd">        in_r: The inner radius of the ring (must be less than out_r).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Shape: A Shape object representing the ring.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">out_r2</span><span class="p">,</span> <span class="n">in_r2</span> <span class="o">=</span> <span class="n">out_r</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">in_r</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">off</span> <span class="o">=</span> <span class="n">out_r</span> <span class="o">-</span> <span class="n">in_r</span>
        <span class="n">off_in_r</span> <span class="o">=</span> <span class="n">off</span> <span class="o">+</span> <span class="n">in_r</span>
        <span class="n">off_in_r2</span> <span class="o">=</span> <span class="n">off</span> <span class="o">+</span> <span class="n">in_r2</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Number(s) expected&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">in_r</span> <span class="o">&gt;=</span> <span class="n">out_r</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Valid number expected. Inner radius must be less than outer radius&quot;</span>
        <span class="p">)</span>

    <span class="n">f</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">format_value</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="s2">&quot;m 0 </span><span class="si">%s</span><span class="s2"> &quot;</span>
        <span class="s2">&quot;b 0 </span><span class="si">%s</span><span class="s2"> 0 0 </span><span class="si">%s</span><span class="s2"> 0 &quot;</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> 0 </span><span class="si">%s</span><span class="s2"> 0 </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> &quot;</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> &quot;</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> 0 </span><span class="si">%s</span><span class="s2"> 0 </span><span class="si">%s</span><span class="s2"> &quot;</span>
        <span class="s2">&quot;m </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> &quot;</span>
        <span class="s2">&quot;b </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> &quot;</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> &quot;</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> &quot;</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span>
        <span class="o">%</span> <span class="p">(</span>
            <span class="n">f</span><span class="p">(</span><span class="n">out_r</span><span class="p">),</span>  <span class="c1"># outer move</span>
            <span class="n">f</span><span class="p">(</span><span class="n">out_r</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">out_r</span><span class="p">),</span>  <span class="c1"># outer curve 1</span>
            <span class="n">f</span><span class="p">(</span><span class="n">out_r</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">out_r2</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">out_r2</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">out_r</span><span class="p">),</span>  <span class="c1"># outer curve 2</span>
            <span class="n">f</span><span class="p">(</span><span class="n">out_r2</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">out_r</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">out_r2</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">out_r2</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">out_r</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">out_r2</span><span class="p">),</span>  <span class="c1"># outer curve 3</span>
            <span class="n">f</span><span class="p">(</span><span class="n">out_r</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">out_r2</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">out_r2</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">out_r</span><span class="p">),</span>  <span class="c1"># outer curve 4</span>
            <span class="n">f</span><span class="p">(</span><span class="n">off</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">off_in_r</span><span class="p">),</span>  <span class="c1"># inner move</span>
            <span class="n">f</span><span class="p">(</span><span class="n">off</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">off_in_r</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">off</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">off_in_r2</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">off_in_r</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">off_in_r2</span><span class="p">),</span>  <span class="c1"># inner curve 1</span>
            <span class="n">f</span><span class="p">(</span><span class="n">off_in_r</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">off_in_r2</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">off_in_r2</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">off_in_r2</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">off_in_r2</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">off_in_r</span><span class="p">),</span>  <span class="c1"># inner curve 2</span>
            <span class="n">f</span><span class="p">(</span><span class="n">off_in_r2</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">off_in_r</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">off_in_r2</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">off</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">off_in_r</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">off</span><span class="p">),</span>  <span class="c1"># inner curve 3</span>
            <span class="n">f</span><span class="p">(</span><span class="n">off_in_r</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">off</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">off</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">off</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">off</span><span class="p">),</span>
            <span class="n">f</span><span class="p">(</span><span class="n">off_in_r</span><span class="p">),</span>  <span class="c1"># inner curve 4</span>
        <span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.shape.Shape.heart" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">heart</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Creates a heart shape with specified dimensions and vertical offset.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>size</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The width and height of the heart.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>offset</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The vertical offset for the heart's center point (default is 0).</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Shape</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Shape (pyonfx.shape.Shape)" href="#pyonfx.shape.Shape">Shape</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A Shape object representing the heart.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>pyonfx/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">heart</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a heart shape with specified dimensions and vertical offset.</span>

<span class="sd">    Args:</span>
<span class="sd">        size: The width and height of the heart.</span>
<span class="sd">        offset: The vertical offset for the heart&#39;s center point (default is 0).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Shape: A Shape object representing the heart.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">mult</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">size</span> <span class="o">/</span> <span class="mi">30</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Size parameter must be a number&quot;</span><span class="p">)</span>
    <span class="c1"># Build shape from template</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="s2">&quot;m 15 30 b 27 22 30 18 30 14 30 8 22 0 15 10 8 0 0 8 0 14 0 18 3 22 15 30&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">mult</span><span class="p">)</span>

    <span class="c1"># Shift mid point of heart vertically</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">shift_mid_point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">nonlocal</span> <span class="n">count</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">offset</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Offset parameter must be a number&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

    <span class="c1"># Return result</span>
    <span class="k">return</span> <span class="n">shape</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">shift_mid_point</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.shape.Shape.star" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">star</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">inner_size</span><span class="p">,</span> <span class="n">outer_size</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Creates a star shape centered at the origin.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>edges</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of edges for the star.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>inner_size</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The distance from the center to the inner vertices.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>outer_size</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The distance from the center to the outer vertices.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Shape</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Shape (pyonfx.shape.Shape)" href="#pyonfx.shape.Shape">Shape</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A Shape object representing the star.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>pyonfx/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">star</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">edges</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">inner_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">outer_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a star shape centered at the origin.</span>

<span class="sd">    Args:</span>
<span class="sd">        edges: The number of edges for the star.</span>
<span class="sd">        inner_size: The distance from the center to the inner vertices.</span>
<span class="sd">        outer_size: The distance from the center to the outer vertices.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Shape: A Shape object representing the star.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_glance_or_star</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">inner_size</span><span class="p">,</span> <span class="n">outer_size</span><span class="p">,</span> <span class="s2">&quot;l&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyonfx.shape.Shape.glance" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">glance</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">inner_size</span><span class="p">,</span> <span class="n">outer_size</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Creates a glance shape with curved transitions between edges.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>edges</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of edges for the glance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>inner_size</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The distance from the center to the inner control points.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>outer_size</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The control point distance for the curves between outer edges.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Shape</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Shape (pyonfx.shape.Shape)" href="#pyonfx.shape.Shape">Shape</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A Shape object representing the glance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>pyonfx/shape.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">glance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">edges</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">inner_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">outer_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Shape&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a glance shape with curved transitions between edges.</span>

<span class="sd">    Args:</span>
<span class="sd">        edges: The number of edges for the glance.</span>
<span class="sd">        inner_size: The distance from the center to the inner control points.</span>
<span class="sd">        outer_size: The control point distance for the curves between outer edges.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Shape: A Shape object representing the glance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_glance_or_star</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">inner_size</span><span class="p">,</span> <span class="n">outer_size</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../pixel/" class="md-footer__link md-footer__link--prev" aria-label="Previous: pixel">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                pixel
              </div>
            </div>
          </a>
        
        
          
          <a href="../utils/" class="md-footer__link md-footer__link--next" aria-label="Next: utils">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                utils
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2019-2025 Antonio Strippoli (CoffeeStraw) and <a href="https://github.com/CoffeeStraw/PyonFX/graphs/contributors"><u>contributors</u></a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections", "navigation.footer", "content.footnote.tooltips", "content.code.copy"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.50899def.min.js"></script>
      
    
  </body>
</html>